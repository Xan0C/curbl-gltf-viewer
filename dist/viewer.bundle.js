!function(n){var r={};function __webpack_require__(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,__webpack_require__),t.l=!0,t.exports}__webpack_require__.m=n,__webpack_require__.c=r,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)__webpack_require__.d(n,r,function(e){return t[e]}.bind(null,r));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=15)}([function(e,n,t){"use strict";function __export(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),__export(t(4)),__export(t(3)),__export(t(5)),__export(t(7)),__export(t(9)),__export(t(10)),__export(t(6)),__export(t(8))},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,h="~";function Events(){}function EE(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function addListener(e,t,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new EE(n,r||e,i),a=h?h+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],o]:e._events[a].push(o):(e._events[a]=o,e._eventsCount++),e}function clearEvent(e,t){0==--e._eventsCount?e._events=new Events:delete e._events[t]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(h=!1)),EventEmitter.prototype.eventNames=function eventNames(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(h?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},EventEmitter.prototype.listeners=function listeners(e){var t=h?h+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o},EventEmitter.prototype.listenerCount=function listenerCount(e){var t=h?h+e:e,n=this._events[t];return n?n.fn?1:n.length:0},EventEmitter.prototype.emit=function emit(e,t,n,r,i,o){var a=h?h+e:e;if(!this._events[a])return!1;var s,u,c=this._events[a],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,o),!0}for(u=1,s=new Array(l-1);u<l;u++)s[u-1]=arguments[u];c.fn.apply(c.context,s)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),l){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,r);break;default:if(!s)for(d=1,s=new Array(l-1);d<l;d++)s[d-1]=arguments[d];c[u].fn.apply(c[u].context,s)}}return!0},EventEmitter.prototype.on=function on(e,t,n){return addListener(this,e,t,n,!1)},EventEmitter.prototype.once=function once(e,t,n){return addListener(this,e,t,n,!0)},EventEmitter.prototype.removeListener=function removeListener(e,t,n,r){var i=h?h+e:e;if(!this._events[i])return this;if(!t)return clearEvent(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||clearEvent(this,i);else{for(var a=0,s=[],u=o.length;a<u;a++)(o[a].fn!==t||r&&!o[a].once||n&&o[a].context!==n)&&s.push(o[a]);s.length?this._events[i]=1===s.length?s[0]:s:clearEvent(this,i)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(e){var t;return e?(t=h?h+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=h,EventEmitter.EventEmitter=EventEmitter,e.exports=EventEmitter},function(e,t,n){"use strict";var r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ESM_EVENTS||(t.ESM_EVENTS={})).SYSTEM_ADDED="entitySystemManager.systemAdded",r.SYSTEM_REMOVED="entitySystemManager.systemRemoved",r.ENTITY_ADDED_TO_SYSTEM="entitySystemManager.entityAddedToSystem",r.ENTITY_REMOVED_FROM_SYSTEM="entitySystemManager.entityRemovedFromSystem",(i=t.SYSTEM_EVENTS||(t.SYSTEM_EVENTS={})).ENTITY_ADDED="system.entityAdded",i.ENTITY_REMOVED="system.entityRemoved",(o=t.ECM_EVENTS||(t.ECM_EVENTS={})).ENTITY_ADDED="entityComponentManager.entityAdded",o.ENTITY_REMOVED="entityComponentManager.entityRemoved",o.ENTITY_DESTROYED="entityComponentManager.entityDestroyed",o.COMPONENT_ADDED="entityComponentManager.componentAdded",o.COMPONENT_REMOVED="entityComponentManager.componentRemoved"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),r=n(7),a=n(4),s=n(6),i=n(9),u=n(10),c=n(1),l=n(2),d=function(){function ECS(){this.componentBitmaskMap=new a.ComponentBitmaskMap,this.events=new c,this.ecm=new r.EntityComponentManager(this.componentBitmaskMap,this.events),this.scm=new i.EntitySystemManager(this.componentBitmaskMap,this.events),this.registerEvents()}return ECS.prototype.registerEvents=function(){this.ecm.events.on(l.ECM_EVENTS.ENTITY_ADDED,this.onEntityAdded),this.ecm.events.on(l.ECM_EVENTS.ENTITY_REMOVED,this.onEntityRemoved),this.ecm.events.on(l.ECM_EVENTS.ENTITY_DESTROYED,this.onEntityDestroyed),this.ecm.events.on(l.ECM_EVENTS.COMPONENT_ADDED,this.onComponentAdded),this.ecm.events.on(l.ECM_EVENTS.COMPONENT_REMOVED,this.onComponentRemoved),this.scm.events.on(l.ESM_EVENTS.SYSTEM_ADDED,this.onSystemAdded)},ECS.prototype.onEntityAdded=function(e){ECS.instance.scm.updateEntity(e)},ECS.prototype.onEntityRemoved=function(e){ECS.instance.scm.removeEntity(e)},ECS.prototype.onEntityDestroyed=function(e){ECS.instance.scm.removeEntity(e)},ECS.prototype.onComponentAdded=function(e){ECS.instance.scm.updateEntity(e)},ECS.prototype.onComponentRemoved=function(e){ECS.instance.scm.updateEntity(e)},ECS.prototype.onSystemAdded=function(e){for(var t in ECS.instance.ecm.entities)ECS.instance.scm.updateEntity(ECS.instance.ecm.entities[t],e)},Object.defineProperty(ECS,"instance",{get:function(){return ECS._instance?ECS._instance:ECS._instance=new ECS},enumerable:!0,configurable:!0}),ECS.setPrototypeOf=function(e,t){return(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)},Object.defineProperty(ECS,"Injector",{get:function(){return u.InjectorService.instance},enumerable:!0,configurable:!0}),ECS.noop=function(){},ECS.createEntity=function(e,t){return ECS.instance.ecm.createEntity(e,t)},ECS.addEntity=function(e,t){return ECS.instance.ecm.addEntity(e,t)},ECS.getEntities=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=ECS.instance.ecm).getEntities.apply(e,t)},ECS.removeEntity=function(e){return ECS.instance.ecm.removeEntity(e)},ECS.removeAllEntities=function(){return ECS.instance.ecm.removeAllEntities()},ECS.destroyEntity=function(e,t){return ECS.instance.ecm.destroyEntity(e,t)},ECS.destroyAllEntities=function(){return ECS.instance.ecm.destroyAllEntities()},ECS.hasEntity=function(e){return ECS.instance.ecm.hasEntity(e)},ECS.removeComponent=function(e,t){return ECS.instance.ecm.removeComponent(e,t)},ECS.addComponent=function(e,t){return ECS.instance.ecm.addComponent(e,t)},ECS.addSystem=function(e,t){return ECS.instance.scm.add(e,t)},ECS.hasSystem=function(e){return ECS.instance.scm.has(e)},ECS.hasSystemOf=function(e){return ECS.instance.scm.hasOf(e)},ECS.removeSystem=function(e){return ECS.instance.scm.remove(e)},ECS.removeSystemOf=function(e){return ECS.instance.scm.removeOf(e)},ECS.getSystemComponentMaskOf=function(e){return ECS.instance.scm.getComponentMaskOf(e)},ECS.removeEntityFromSystem=function(e,t){ECS.instance.scm.removeEntity(e,t)},ECS.getSystem=function(e){return ECS.instance.scm.get(e)},ECS.update=function(e,t,n,r,i,o,a,s,u){ECS.instance.scm.update(e,t,n,r,i,o,a,s,u)},ECS.callSystemMethod=function(e){ECS.instance.scm.callSystemMethod(e)},ECS.createComponentsFromDecorator=function(e){for(var t,n=Object.create(null),r=0,i=e;r<i.length;r++){var o=i[r];n[(t=new o.component(o.config)).id]=t}return n},ECS.Component=function(i){return function(r){var e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=new(r.bind.apply(r,[void 0].concat(e)));return ECS.setPrototypeOf(n,Object.getPrototypeOf(this)),a.injectComponent(n),n.id=i||r.prototype.constructor.name,n};return e.prototype=r.prototype,e}},ECS.System=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return function(r){var e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=new(r.bind.apply(r,[void 0].concat(e)));return ECS.setPrototypeOf(n,Object.getPrototypeOf(this)),s.injectSystem(n,ECS.instance.scm.systemUpdateMethods),n.id=n.id||r.prototype.constructor.name,ECS.instance.scm.updateBitmask(n,i),n};return e.prototype=r.prototype,e}},ECS.Entity=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return function(r){var e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=new(r.bind.apply(r,[void 0].concat(e)));return ECS.setPrototypeOf(n,Object.getPrototypeOf(this)),o.injectEntity(n),ECS.instance.ecm.createEntity(n,ECS.createComponentsFromDecorator(i)),n};return e.prototype=r.prototype,e}},Object.defineProperty(ECS,"uuid",{get:function(){return ECS.instance.ecm.uuid},set:function(e){ECS.instance.ecm.uuid=e},enumerable:!0,configurable:!0}),Object.defineProperty(ECS,"systemUpdateMethods",{get:function(){return ECS.instance.scm.systemUpdateMethods},set:function(e){ECS.instance.scm.systemUpdateMethods=e},enumerable:!0,configurable:!0}),Object.defineProperty(ECS,"events",{get:function(){return ECS.instance.events},enumerable:!0,configurable:!0}),ECS}();t.ECS=d},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(3),i=function(){function ComponentBitmaskMap(){this.bitmaskMap=Object.create(null)}return ComponentBitmaskMap.prototype.has=function(e){return"string"==typeof e?!!this.bitmaskMap[e]:!!this.bitmaskMap[e.prototype.constructor.name]},ComponentBitmaskMap.prototype.add=function(e){"string"==typeof e?this.bitmaskMap[e]=1<<this.size:this.bitmaskMap[e.prototype.constructor.name]=1<<this.size},ComponentBitmaskMap.prototype.get=function(e){return this.has(e)||this.add(e),"string"==typeof e?this.bitmaskMap[e]||0:this.bitmaskMap[e.prototype.constructor.name]||0},Object.defineProperty(ComponentBitmaskMap.prototype,"size",{get:function(){return Object.keys(this.bitmaskMap).length},enumerable:!0,configurable:!0}),ComponentBitmaskMap}();r.ComponentBitmaskMap=i;var o={},a={init:function(){return n.ECS.noop},remove:function(){return n.ECS.noop}};r.COMPONENT_PROPERTY_DECORATOR={},r.injectComponent=function injectComponent(e){for(var t in o)void 0!==e[t]&&null!==e[t]||(e[t]=o[t]());for(var t in r.COMPONENT_PROPERTY_DECORATOR)void 0!==e[t]&&null!==e[t]||r.COMPONENT_PROPERTY_DECORATOR[t](e);for(var n in a)e.constructor&&e.constructor.prototype?void 0!==e.constructor.prototype[n]&&null!==e.constructor.prototype[n]||(e.constructor.prototype[n]=a[n]()):void 0!==e[n]&&null!==e[n]||(e[n]=a[n]())}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(3),i={id:function(){return n.ECS.uuid()},components:function(){return Object.create(null)},bitmask:function(){return 0}},o={get:function(){return a.prototype.get},getAll:function(){return a.prototype.getAll},has:function(){return a.prototype.has},add:function(){return a.prototype.add},remove:function(){return a.prototype.remove},dispose:function(){return a.prototype.dispose},destroy:function(){return a.prototype.destroy}};r.ENTITY_PROPERTY_DECORATOR={},r.injectEntity=function injectEntity(e){for(var t in i)void 0!==e[t]&&null!==e[t]||(e[t]=i[t]());for(var t in r.ENTITY_PROPERTY_DECORATOR)void 0!==e[t]&&null!==e[t]||r.ENTITY_PROPERTY_DECORATOR[t](e);for(var n in o)e.constructor&&e.constructor.prototype?void 0!==e.constructor.prototype[n]&&null!==e.constructor.prototype[n]||(e.constructor.prototype[n]=o[n]()):void 0!==e[n]&&null!==e[n]||(e[n]=o[n]())};var a=function(){function Entity(){this.id=i.id(),this.components=i.components(),this.bitmask=i.bitmask()}return Entity.prototype.getAll=function(){return this.components},Entity.prototype.get=function(e){return"string"==typeof e?this.components[e]:this.components[e.prototype.constructor.name]},Entity.prototype.has=function(e){return"string"==typeof e?!!this.components[e]:!!this.components[e.prototype.constructor.name]},Entity.prototype.add=function(e){return n.ECS.addComponent(this,e)},Entity.prototype.remove=function(e){return n.ECS.removeComponent(this,e)},Entity.prototype.dispose=function(){return n.ECS.removeEntity(this)},Entity.prototype.destroy=function(e){return n.ECS.destroyEntity(this,e)},Entity}();r.Entity=a},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=t(3),n=t(1);o.SYSTEM_PROTOTYPE={setUp:function(){return a.ECS.noop},tearDown:function(){return a.ECS.noop},has:function(){return r.prototype.has},remove:function(){return r.prototype.remove},dispose:function(){return r.prototype.dispose}},o.SYSTEM_PROPERTIES={bitmask:function(){return 0},entities:function(){return[]},events:function(){return new n}},o.SYSTEM_PROPERTY_DECORATOR={},o.injectSystem=function injectSystem(e,t){for(var n in o.SYSTEM_PROPERTIES)void 0!==e[n]&&null!==e[n]||(e[n]=o.SYSTEM_PROPERTIES[n]());for(var n in o.SYSTEM_PROPERTY_DECORATOR)void 0!==e[n]&&null!==e[n]||o.SYSTEM_PROPERTY_DECORATOR[n](e);for(var r in o.SYSTEM_PROTOTYPE)e.constructor&&e.constructor.prototype?void 0!==e.constructor.prototype[r]&&null!==e.constructor.prototype[r]||(e.constructor.prototype[r]=o.SYSTEM_PROTOTYPE[r]()):void 0!==e[r]&&null!==e[r]||(e[r]=o.SYSTEM_PROTOTYPE[r]());var i=0;for(r=void 0;r=t[i];i++)e.constructor&&e.constructor.prototype?void 0!==e.constructor.prototype[r]&&null!==e.constructor.prototype[r]||(e.constructor.prototype[r]=a.ECS.noop):void 0!==e[r]&&null!==e[r]||(e[r]=a.ECS.noop)};var r=function(){function System(){this.bitmask=o.SYSTEM_PROPERTIES.bitmask(),this.entities=o.SYSTEM_PROPERTIES.entities(),this.events=o.SYSTEM_PROPERTIES.events()}return System.prototype.has=function(e){return-1!==this.entities.indexOf(e)},System.prototype.remove=function(e,t,n){void 0===t&&(t=!0),t&&(n?a.ECS.destroyEntity(e,!0):a.ECS.removeEntity(e)),a.ECS.removeEntityFromSystem(e,this)},System.prototype.dispose=function(){a.ECS.removeSystem(this)},System}();o.System=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(5),o=n(8),a=n(2),s=function(){function EntityComponentManager(e,t,n){void 0===n&&(n=o.UUIDGenerator.uuid),this._events=t,this._uuid=n,this.componentBitmask=e,this._entities=Object.create(null)}return EntityComponentManager.prototype.createEntity=function(e,t){return e||(e=new i.Entity),e.components=t||Object.create(null),e.bitmask=0,this.updateComponentBitmask(e),e},EntityComponentManager.prototype.updateComponentBitmask=function(e){for(var t in e.components)e.bitmask=e.bitmask|this.componentBitmask.get(e.components[t].id)},EntityComponentManager.prototype.addEntity=function(e,t,n){return void 0===n&&(n=!1),i.injectEntity(e),(this._entities[e.id]=e).components=t||e.components||Object.create(null),e.bitmask=e.bitmask||0,t&&this.updateComponentBitmask(e),n||this._events.emit(a.ECM_EVENTS.ENTITY_ADDED,e),e},EntityComponentManager.prototype.getEntities=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=0,i=void 0;i=e[r];r++)n|=this.componentBitmask.get(i);for(var o=Object.keys(this._entities),a=[],s=(r=0,void 0);s=this._entities[o[r]];r++)(s.bitmask&n)===n&&a.push(s);return a},EntityComponentManager.prototype.destroyEntity=function(e,t){if(void 0===t&&(t=!1),this._entities[e.id]){for(var n in e.components)this.removeComponent(e,e.components[n].id,!0);return e.bitmask=0,e.components=Object.create(null),!t&&this.hasEntity(e)&&this._events.emit(a.ECM_EVENTS.ENTITY_DESTROYED,e),delete this._entities[e.id]}return!1},EntityComponentManager.prototype.destroyAllEntities=function(e){for(var t=Object.keys(this._entities),n=0,r=void 0;r=this._entities[t[n]];n++)this.destroyEntity(r,e)},EntityComponentManager.prototype.removeEntity=function(e,t){return void 0===t&&(t=!1),this._entities[e.id]&&(!t&&this.hasEntity(e)&&this._events.emit(a.ECM_EVENTS.ENTITY_REMOVED,e),delete this._entities[e.id]),e},EntityComponentManager.prototype.removeAllEntities=function(){for(var e=[],t=Object.keys(this._entities),n=0,r=void 0;r=this._entities[t[n]];n++)e.push(this.removeEntity(r));return e},EntityComponentManager.prototype.hasEntity=function(e){return!!this._entities[e.id]},EntityComponentManager.prototype.addComponent=function(e,t,n){void 0===n&&(n=!1),r.injectComponent(t),e.components[t.id]=t,e.bitmask=e.bitmask|this.componentBitmask.get(t.id),!n&&this.hasEntity(e)&&this._events.emit(a.ECM_EVENTS.COMPONENT_ADDED,e,t)},EntityComponentManager.prototype.removeComponent=function(e,t,n){var r;return void 0===n&&(n=!1),!!(r="string"==typeof t?e.components[t]:e.components[t.prototype.constructor.name])&&(e.bitmask=e.bitmask^this.componentBitmask.get(r.id),!n&&this.hasEntity(e)&&this._events.emit(a.ECM_EVENTS.COMPONENT_REMOVED,e,r),r.remove(),delete e.components[r.id])},Object.defineProperty(EntityComponentManager.prototype,"entities",{get:function(){return this._entities},enumerable:!0,configurable:!0}),Object.defineProperty(EntityComponentManager.prototype,"uuid",{get:function(){return this._uuid},set:function(e){this._uuid=e},enumerable:!0,configurable:!0}),Object.defineProperty(EntityComponentManager.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),EntityComponentManager}();t.EntityComponentManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UUIDGenerator={uuid:function(){return(""+1e7+-1e3+-4e3+-8e3+-1e11).replace(/1|0/g,function(){return(0|16*Math.random()).toString(16)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),u=n(2),r=function(){function EntitySystemManager(e,t){this._events=t,this._systemUpdateMethods=["update"],this.componentBitmask=e,this.systems=Object.create(null),this.ids=[]}return EntitySystemManager.prototype.updateBitmask=function(e,t){void 0===t&&(t=[]);for(var n=0,r=void 0;r=t[n];n++)e.bitmask=e.bitmask|this.componentBitmask.get(r);return e},EntitySystemManager.prototype.add=function(e,t,n){return void 0===t&&(t=[]),void 0===n&&(n=!1),this.has(e)?console.warn("System "+e+" already exists! And can only exists ones"):(o.injectSystem(e,this.systemUpdateMethods),this.systems[e.id]=e,this.ids.push(e.id),this.updateBitmask(e,t),e.setUp(),n||this._events.emit(u.ESM_EVENTS.SYSTEM_ADDED,e)),e},EntitySystemManager.prototype.has=function(e){return!!this.systems[e.id]},EntitySystemManager.prototype.hasOf=function(e){return!!this.systems[e.prototype.constructor.name]},EntitySystemManager.prototype.remove=function(e,t){return void 0===t&&(t=!1),!!this.has(e)&&(t||this._events.emit(u.ESM_EVENTS.SYSTEM_REMOVED,e),e.tearDown(),this.ids.splice(this.ids.indexOf(e.id),1),delete this.systems[e.id])},EntitySystemManager.prototype.removeOf=function(e,t){return this.remove(this.get(e),t)},EntitySystemManager.prototype.getEntitiesOf=function(e){var t=this.get(e);if(t)return t.entities},EntitySystemManager.prototype.getComponentMaskOf=function(e){var t=this.get(e);if(t)return t.bitmask},EntitySystemManager.prototype.get=function(e){return this.systems[e.prototype.constructor.name]},EntitySystemManager.prototype.addEntity=function(e,t,n){if(void 0===n&&(n=!1),t)0!==t.bitmask&&(e.bitmask&t.bitmask)===t.bitmask&&(t.entities.push(e),t.events.emit(u.SYSTEM_EVENTS.ENTITY_ADDED,e));else for(var r,i=this.ids,o=this.systems,a=0;r=o[i[a]];a++)(e.bitmask&r.bitmask)===r.bitmask&&(r.entities.push(e),r.events.emit(u.SYSTEM_EVENTS.ENTITY_ADDED,e));n||t&&!this.has(t)||this._events.emit(u.ESM_EVENTS.ENTITY_ADDED_TO_SYSTEM,e,t)},EntitySystemManager.prototype.removeEntity=function(e,t,n){if(void 0===n&&(n=!1),t)-1!=(a=t.entities.indexOf(e))&&t.entities.splice(a,1),t.events.emit(u.SYSTEM_EVENTS.ENTITY_REMOVED,e);else for(var r,i=this.ids,o=this.systems,a=-1,s=0;r=o[i[s]];s++)-1!=(a=r.entities.indexOf(e))&&r.entities.splice(a,1),r.events.emit(u.SYSTEM_EVENTS.ENTITY_REMOVED,e);n||this._events.emit(u.ESM_EVENTS.ENTITY_REMOVED_FROM_SYSTEM,e,t)},EntitySystemManager.prototype.updateEntity=function(e,t){if(t)this.addEntityToSystem(t,e);else for(var n,r=this.ids,i=this.systems,o=0;n=i[r[o]];o++)this.addEntityToSystem(n,e)},EntitySystemManager.prototype.addEntityToSystem=function(e,t){(t.bitmask&e.bitmask)===e.bitmask?e.has(t)||this.addEntity(t,e):e.has(t)&&this.removeEntity(t,e)},EntitySystemManager.prototype.callSystemMethod=function(e,t,n,r,i,o,a,s,u,c){for(var l=this.ids,d=this.systems,f=0,h=void 0;h=d[l[f]];f++)h[e](t,n,r,i,o,a,s,u,c)},EntitySystemManager.prototype.update=function(e,t,n,r,i,o,a,s,u){for(var c=0,l=void 0;l=this._systemUpdateMethods[c];c++)this.callSystemMethod(l,e,t,n,r,i,o,a,s,u)},EntitySystemManager.prototype.updateSystemMethods=function(){for(var e=this.ids,t=this.systems,n=this.systemUpdateMethods,r=0,i=void 0;i=t[e[r]];r++)o.injectSystem(i,n)},Object.defineProperty(EntitySystemManager.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),Object.defineProperty(EntitySystemManager.prototype,"systemUpdateMethods",{get:function(){return this._systemUpdateMethods},set:function(e){this._systemUpdateMethods=e,this.updateSystemMethods()},enumerable:!0,configurable:!0}),EntitySystemManager}();t.EntitySystemManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(3),r=function(){function InjectorService(){}return Object.defineProperty(InjectorService,"instance",{get:function(){return InjectorService._instance?InjectorService._instance:InjectorService._instance=new InjectorService},enumerable:!0,configurable:!0}),InjectorService.prototype.System=function(s){return function(a){var e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new(a.bind.apply(a,[void 0].concat(e)))}.apply(this,e);u.ECS.setPrototypeOf(n,Object.getPrototypeOf(this));for(var r=Object.keys(s),i=0,o=void 0;o=s[r[i]];i++)n[r[i]]=u.ECS.getSystem(o);return n};return e.prototype=a.prototype,e}},InjectorService}();t.InjectorService=r},,,,,function(e,t,n){"use strict";n.r(t);var u={};n.r(u),n.d(u,"create",function(){return mat4_create}),n.d(u,"clone",function(){return clone}),n.d(u,"copy",function(){return copy}),n.d(u,"fromValues",function(){return fromValues}),n.d(u,"set",function(){return mat4_set}),n.d(u,"identity",function(){return identity}),n.d(u,"transpose",function(){return transpose}),n.d(u,"invert",function(){return invert}),n.d(u,"adjoint",function(){return adjoint}),n.d(u,"determinant",function(){return determinant}),n.d(u,"multiply",function(){return multiply}),n.d(u,"translate",function(){return translate}),n.d(u,"scale",function(){return mat4_scale}),n.d(u,"rotate",function(){return mat4_rotate}),n.d(u,"rotateX",function(){return rotateX}),n.d(u,"rotateY",function(){return rotateY}),n.d(u,"rotateZ",function(){return rotateZ}),n.d(u,"fromTranslation",function(){return fromTranslation}),n.d(u,"fromScaling",function(){return fromScaling}),n.d(u,"fromRotation",function(){return fromRotation}),n.d(u,"fromXRotation",function(){return fromXRotation}),n.d(u,"fromYRotation",function(){return fromYRotation}),n.d(u,"fromZRotation",function(){return fromZRotation}),n.d(u,"fromRotationTranslation",function(){return fromRotationTranslation}),n.d(u,"fromQuat2",function(){return fromQuat2}),n.d(u,"getTranslation",function(){return getTranslation}),n.d(u,"getScaling",function(){return getScaling}),n.d(u,"getRotation",function(){return getRotation}),n.d(u,"fromRotationTranslationScale",function(){return fromRotationTranslationScale}),n.d(u,"fromRotationTranslationScaleOrigin",function(){return fromRotationTranslationScaleOrigin}),n.d(u,"fromQuat",function(){return fromQuat}),n.d(u,"frustum",function(){return frustum}),n.d(u,"perspective",function(){return mat4_perspective}),n.d(u,"perspectiveFromFieldOfView",function(){return perspectiveFromFieldOfView}),n.d(u,"ortho",function(){return ortho}),n.d(u,"lookAt",function(){return lookAt}),n.d(u,"targetTo",function(){return targetTo}),n.d(u,"str",function(){return str}),n.d(u,"frob",function(){return frob}),n.d(u,"add",function(){return mat4_add}),n.d(u,"subtract",function(){return subtract}),n.d(u,"multiplyScalar",function(){return multiplyScalar}),n.d(u,"multiplyScalarAndAdd",function(){return multiplyScalarAndAdd}),n.d(u,"exactEquals",function(){return exactEquals}),n.d(u,"equals",function(){return mat4_equals}),n.d(u,"mul",function(){return se}),n.d(u,"sub",function(){return ue});var b={};n.r(b),n.d(b,"create",function(){return vec3_create}),n.d(b,"clone",function(){return vec3_clone}),n.d(b,"length",function(){return vec3_length}),n.d(b,"fromValues",function(){return vec3_fromValues}),n.d(b,"copy",function(){return vec3_copy}),n.d(b,"set",function(){return vec3_set}),n.d(b,"add",function(){return vec3_add}),n.d(b,"subtract",function(){return vec3_subtract}),n.d(b,"multiply",function(){return vec3_multiply}),n.d(b,"divide",function(){return divide}),n.d(b,"ceil",function(){return ceil}),n.d(b,"floor",function(){return floor}),n.d(b,"min",function(){return vec3_min}),n.d(b,"max",function(){return vec3_max}),n.d(b,"round",function(){return round}),n.d(b,"scale",function(){return vec3_scale}),n.d(b,"scaleAndAdd",function(){return scaleAndAdd}),n.d(b,"distance",function(){return distance}),n.d(b,"squaredDistance",function(){return squaredDistance}),n.d(b,"squaredLength",function(){return squaredLength}),n.d(b,"negate",function(){return negate}),n.d(b,"inverse",function(){return inverse}),n.d(b,"normalize",function(){return normalize}),n.d(b,"dot",function(){return vec3_dot}),n.d(b,"cross",function(){return cross}),n.d(b,"lerp",function(){return vec3_lerp}),n.d(b,"hermite",function(){return hermite}),n.d(b,"bezier",function(){return bezier}),n.d(b,"random",function(){return random}),n.d(b,"transformMat4",function(){return transformMat4}),n.d(b,"transformMat3",function(){return transformMat3}),n.d(b,"transformQuat",function(){return transformQuat}),n.d(b,"rotateX",function(){return vec3_rotateX}),n.d(b,"rotateY",function(){return vec3_rotateY}),n.d(b,"rotateZ",function(){return vec3_rotateZ}),n.d(b,"angle",function(){return vec3_angle}),n.d(b,"zero",function(){return zero}),n.d(b,"str",function(){return vec3_str}),n.d(b,"exactEquals",function(){return vec3_exactEquals}),n.d(b,"equals",function(){return vec3_equals}),n.d(b,"sub",function(){return le}),n.d(b,"mul",function(){return de}),n.d(b,"div",function(){return fe}),n.d(b,"dist",function(){return he}),n.d(b,"sqrDist",function(){return pe}),n.d(b,"len",function(){return me}),n.d(b,"sqrLen",function(){return _e}),n.d(b,"forEach",function(){return ge});var a={};n.r(a),n.d(a,"create",function(){return vec4_create}),n.d(a,"clone",function(){return vec4_clone}),n.d(a,"fromValues",function(){return vec4_fromValues}),n.d(a,"copy",function(){return vec4_copy}),n.d(a,"set",function(){return vec4_set}),n.d(a,"add",function(){return vec4_add}),n.d(a,"subtract",function(){return vec4_subtract}),n.d(a,"multiply",function(){return vec4_multiply}),n.d(a,"divide",function(){return vec4_divide}),n.d(a,"ceil",function(){return vec4_ceil}),n.d(a,"floor",function(){return vec4_floor}),n.d(a,"min",function(){return vec4_min}),n.d(a,"max",function(){return vec4_max}),n.d(a,"round",function(){return vec4_round}),n.d(a,"scale",function(){return vec4_scale}),n.d(a,"scaleAndAdd",function(){return vec4_scaleAndAdd}),n.d(a,"distance",function(){return vec4_distance}),n.d(a,"squaredDistance",function(){return vec4_squaredDistance}),n.d(a,"length",function(){return vec4_length}),n.d(a,"squaredLength",function(){return vec4_squaredLength}),n.d(a,"negate",function(){return vec4_negate}),n.d(a,"inverse",function(){return vec4_inverse}),n.d(a,"normalize",function(){return vec4_normalize}),n.d(a,"dot",function(){return vec4_dot}),n.d(a,"cross",function(){return vec4_cross}),n.d(a,"lerp",function(){return vec4_lerp}),n.d(a,"random",function(){return vec4_random}),n.d(a,"transformMat4",function(){return vec4_transformMat4}),n.d(a,"transformQuat",function(){return vec4_transformQuat}),n.d(a,"zero",function(){return vec4_zero}),n.d(a,"str",function(){return vec4_str}),n.d(a,"exactEquals",function(){return vec4_exactEquals}),n.d(a,"equals",function(){return vec4_equals}),n.d(a,"sub",function(){return ve}),n.d(a,"mul",function(){return be}),n.d(a,"div",function(){return Ee}),n.d(a,"dist",function(){return Se}),n.d(a,"sqrDist",function(){return Ae}),n.d(a,"len",function(){return Ce}),n.d(a,"sqrLen",function(){return Te}),n.d(a,"forEach",function(){return we});var E={};n.r(E),n.d(E,"create",function(){return quat_create}),n.d(E,"identity",function(){return quat_identity}),n.d(E,"setAxisAngle",function(){return setAxisAngle}),n.d(E,"getAxisAngle",function(){return getAxisAngle}),n.d(E,"multiply",function(){return quat_multiply}),n.d(E,"rotateX",function(){return quat_rotateX}),n.d(E,"rotateY",function(){return quat_rotateY}),n.d(E,"rotateZ",function(){return quat_rotateZ}),n.d(E,"calculateW",function(){return calculateW}),n.d(E,"slerp",function(){return slerp}),n.d(E,"random",function(){return quat_random}),n.d(E,"invert",function(){return quat_invert}),n.d(E,"conjugate",function(){return conjugate}),n.d(E,"fromMat3",function(){return fromMat3}),n.d(E,"fromEuler",function(){return fromEuler}),n.d(E,"str",function(){return quat_str}),n.d(E,"clone",function(){return ke}),n.d(E,"fromValues",function(){return De}),n.d(E,"copy",function(){return Be}),n.d(E,"set",function(){return Ie}),n.d(E,"add",function(){return Ne}),n.d(E,"mul",function(){return Fe}),n.d(E,"scale",function(){return Ue}),n.d(E,"dot",function(){return je}),n.d(E,"lerp",function(){return Ge}),n.d(E,"length",function(){return Ve}),n.d(E,"len",function(){return He}),n.d(E,"squaredLength",function(){return ze}),n.d(E,"sqrLen",function(){return Ye}),n.d(E,"normalize",function(){return We}),n.d(E,"exactEquals",function(){return Xe}),n.d(E,"equals",function(){return qe}),n.d(E,"rotationTo",function(){return Ke}),n.d(E,"sqlerp",function(){return Qe}),n.d(E,"setAxes",function(){return $e});var i,o,v,c,s,l,S,d,f,h,p,m="brdfLUT",_="diffuseEnvironment",g="specularEnvironment",y="skybox";function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(o=i||(i={}))[o.CAMERA=0]="CAMERA",o[o.SKIN=1]="SKIN",(v||(v={})).value=function value(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"samplerCube":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"bool":return!1;case"bvec2":return booleanArray(2*t);case"bvec3":return booleanArray(3*t);case"bvec4":return booleanArray(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);default:console.warn("no default value for type ",e)}function booleanArray(e){for(var t=new Array(e),n=0;n<t.length;n++)t[n]=!1;return t}},s=c||(c={}),l={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},s.map=function map(e){return l[e]},d=S||(S={}),f=null,h={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},d.map=function map(e,t){if(!f){var n=Object.keys(h);f={};for(var r=0;r<n.length;r++){var i=n[r];f[e[i]]=h[i]}}return f[t]},function(e){function create3DContext(e,t){for(var n=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null,i=0;i<n.length;i++){var o=n[i];try{r=e.getContext(o,t)}catch(e){}if(r)break}return r}e.setupWebGL=function setupWebGL(e,t,n){var r=n||function handleCreationError(e){var t=document.getElementsByTagName("body")[0];if(t){var n=window.WebGL2RenderingContext?'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>':'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';e&&(n+="<br/><br/>Status: "+e),t.innerHTML=function makeFailHTML(e){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+e+"</div>"}(n)}};e.addEventListener&&e.addEventListener("webglcontextcreationerr",function(e){r(e.statusMessage)},!1);var i=create3DContext(e,t);return i||(window.WebGL2RenderingContext,r("")),i},e.create3DContext=create3DContext,window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.clearTimeout)}(p||(p={}));var A,C,T,w,M=function(){function Canvas(e){this._defaultWidth=e.width,this._defaultHeight=e.height,this._element=document.createElement("canvas"),this._element.id="viewer_canvas",this._element.width=this._defaultWidth,this._element.height=this._defaultHeight}return Canvas.prototype.appendCanvas=function appendCanvas(e){if(!this._element)throw"canvas failed to initialize";e?document.getElementById(e).appendChild(this._element):document.body.appendChild(this._element)},function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(Canvas,[{key:"context",get:function get(){return this._context||(this._context=p.setupWebGL(this._element,{antialias:!0,stencil:!0})),this._context}},{key:"element",get:function get(){return this._element},set:function set(e){this._element=e}},{key:"width",get:function get(){return this._element.width}},{key:"height",get:function get(){return this._element.height}}]),Canvas}(),R=n(1),x=function(){function EmitSignal(e,t){this._type=t,this._emitter=e}return EmitSignal.prototype.emit=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this._emitter).emit.apply(e,[this._type].concat(t))},EmitSignal.prototype.dispatch=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.emit.apply(this,e)},EmitSignal.prototype.on=function(e,t){return this._emitter.on(this._type,e,t),this},EmitSignal.prototype.add=function(e,t){return this.on(e,t)},EmitSignal.prototype.once=function(e,t){return this._emitter.once(this._type,e,t),this},EmitSignal.prototype.addOnce=function(e,t){return this.once(e,t)},EmitSignal.prototype.removeAllListeners=function(){return this._emitter.removeAllListeners(this._type),this},EmitSignal.prototype.removeListener=function(e,t,n){return this._emitter.removeListener(this._type,e,t,n),this},Object.defineProperty(EmitSignal.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(EmitSignal.prototype,"emitter",{get:function(){return this._emitter},enumerable:!0,configurable:!0}),EmitSignal}(),O=function(){return(O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};(C=A||(A={})).PROGRESS="resource_event_progress",C.LOAD_START="resource_event_loadStart",C.LOAD_COMPLETE="resource_event_load",C.ERROR="resource_event_error",C.ABORT="resource_event_abort",C.TIMEOUT="resource_event_timeout",(w=T||(T={})).XHR="xhr",w.IMAGE="image";var P,L=function(){function Resource(e,t){this.config=t||Object.create(null),this.options="string"==typeof e?{url:e,loadType:T.XHR,responseType:""}:O({},e,{url:e.url,loadType:e.loadType||T.XHR,responseType:e.responseType||""}),this._emitter=new R,this.onProgress=new x(this._emitter,A.PROGRESS),this.onLoadStart=new x(this._emitter,A.LOAD_START),this.onLoadFinished=new x(this._emitter,A.LOAD_COMPLETE),this.onError=new x(this._emitter,A.ERROR),this.onAbort=new x(this._emitter,A.ABORT),this.onTimeout=new x(this._emitter,A.TIMEOUT)}return Resource.prototype.loadXhr=function(e){for(var n=this,r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var i=new XMLHttpRequest;return i.timeout=e.timeout,i.responseType=e.responseType||"text",i.open("GET",e.url,void 0===e.async||!!e.async),i.addEventListener("progress",function(e){return n.onProgress.emit(e,i)},{once:!0}),i.addEventListener("loadstart",function(e){var t;return(t=n.onLoadStart).emit.apply(t,[e,i].concat(r))},{once:!0}),i.addEventListener("load",function(e){return n.onLoadFinished.emit(n)},{once:!0}),i.addEventListener("error",function(e){return n.onError.emit(e,i)},{once:!0}),i.addEventListener("abort",function(e){return n.onAbort.emit(e,i)},{once:!0}),i.addEventListener("timeout",function(e){return n.onTimeout.emit(e,i)},{once:!0}),i.send(),i},Resource.prototype.loadImage=function(e){for(var n=this,r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var i=new Image(e.width,e.height);return i?(i.addEventListener("progress",function(e){return n.onProgress.emit(e,i)},{once:!0}),i.addEventListener("loadstart",function(e){var t;return(t=n.onLoadStart).emit.apply(t,[e,i].concat(r))},{once:!0}),i.addEventListener("load",function(e){return n.onLoadFinished.emit(n)},{once:!0}),i.addEventListener("error",function(e){return n.onError.emit(e,i)},{once:!0}),i.addEventListener("abort",function(e){return n.onAbort.emit(e,i)},{once:!0}),i.crossOrigin=this._determineCrossOrigin(e.url),i.src=e.url):(console.error("Failed to create Image Object"),this.onError.emit(event,i)),i},Resource.prototype._determineCrossOrigin=function(e){if(0===e.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";var t=window.location;Resource.tempAnchor||(Resource.tempAnchor=document.createElement("a")),Resource.tempAnchor.href=e;var n=!Resource.tempAnchor.port&&""===t.port||Resource.tempAnchor.port===t.port,r=Resource.tempAnchor.protocol?Resource.tempAnchor.protocol+":":"";return Resource.tempAnchor.host===t.hostname&&n&&r===t.protocol?"":"anonymous"},Resource.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];switch(this.options.loadType){case T.IMAGE:return this.request=this.loadImage.apply(this,[this.options].concat(e)),this;case T.XHR:return this.request=this.loadXhr.apply(this,[this.options].concat(e)),this}return this},Resource.prototype.abort=function(){return this.request instanceof XMLHttpRequest?this.request.abort():this.request instanceof HTMLImageElement&&(this.request.src=""),this},Resource}();(P||(P={})).LOAD_COMPLETE="LOAD_COMPLETE";var k={_emitter:function(){return new R},onLoad:function(){return new x((void 0)._emitter,P.LOAD_COMPLETE)}},D={transform:function(){return B.prototype.transform},add:function(){return B.prototype.add},addResourceToQueue:function(){return B.prototype.addResourceToQueue},_queueCallback:function(){return B.prototype._queueCallback}},B=function(){function Middleware(e){this._emitter=new R,this.onLoad=new x(this._emitter,P.LOAD_COMPLETE),this.type=e}return Middleware.inject=function(e){for(var t in k)void 0!==e[t]&&null!==e[t]||(e[t]=k[t]());for(var n in D)e.constructor&&e.constructor.prototype?void 0!==e.constructor.prototype[n]&&null!==e.constructor.prototype[n]||(e.constructor.prototype[n]=D[n]()):void 0!==e[n]&&null!==e[n]||(e[n]=D[n]())},Middleware.prototype.add=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.addResourceToQueue({resources:[{resource:new L(e),args:t.slice()}]}),this},Middleware.prototype.addResourceToQueue=function(n){var r=this;return this._loader._addResourceToQueue({resources:n.resources,onResourcesLoaded:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r._queueCallback.apply(r,[n.key,r.type].concat(e))},onResourcesLoadedContext:this}),this},Middleware.prototype._queueCallback=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.transform.apply(this,n);this.onLoad.emit({key:e,type:t,data:i})},Middleware.prototype.transform=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.map(function(e){return e.request})},Middleware}();function _noop(){}var I,N,F=function(){function AsyncWorkerQueue(e){this.concurrency=e,this.paused=!1,this.processes=0,this.workers=[],this.tasks=[]}return AsyncWorkerQueue.prototype.process=function(e){var t=this;this.finishCb=e||_noop;for(var n=function(){var e=r.tasks.shift();r.processes++,e.listener.apply(e.listenerContext,[function(){return t.next(e)}]),e.process.apply(e.processContext,e.args)},r=this;!this.paused&&this.processes<this.concurrency&&this.length;)n()},AsyncWorkerQueue.prototype.enqueue=function(e){if(!e.tasks||0===e.tasks.length)throw"Worker needs to have at least one task";e.count=e.count||0,e.onWorkFinished=e.onWorkFinished||_noop,this.workers.push(e);for(var t=0,n=void 0;n=e.tasks[t];t++)n.worker=e,n.completed=n.completed||!1,this.tasks.push(n)},AsyncWorkerQueue.prototype.dequeue=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=void 0;r=e[n];n++){var i=this.workers.indexOf(r);if(-1!=i){for(var o=0,a=void 0;a=r.tasks[o];o++){var s=this.tasks.indexOf(a);-1!=s&&this.tasks.splice(s,1)}this.workers.splice(i,1)}}},AsyncWorkerQueue.prototype.idle=function(){return this.length+this.processes+this.workers.length===0},AsyncWorkerQueue.prototype.next=function(e){this.processes--,e.completed=!0,this.workerFinished(e.worker),this.onQueueFinished(),this.process(this.finishCb)},AsyncWorkerQueue.prototype.workerFinished=function(e){e.count+=1;var t=this.workers.indexOf(e);if(e.count===e.tasks.length&&-1!=t){var n=e.tasks.map(function(e){return e.resource});e.onWorkFinished.apply(e.onWorkFinishedContext,n),this.workers.splice(t,1)}},AsyncWorkerQueue.prototype.onQueueFinished=function(){this.idle()&&this.finishCb()},AsyncWorkerQueue.prototype.abort=function(){for(var e=0,t=void 0;t=this.workers[e];e++)for(var n=0,r=void 0;r=t.tasks[n];n++)r.resource.abort()},AsyncWorkerQueue.prototype.stop=function(){this.finishCb=_noop,this.abort(),this.workers.length=0,this.tasks.length=0,this.processes=0},AsyncWorkerQueue.prototype.pause=function(){this.paused=!0},AsyncWorkerQueue.prototype.resume=function(){!1!==this.paused&&(this.paused=!1,this.process())},Object.defineProperty(AsyncWorkerQueue.prototype,"length",{get:function(){return this.tasks.length},enumerable:!0,configurable:!0}),Object.defineProperty(AsyncWorkerQueue.prototype,"running",{get:function(){return!!this.processes},enumerable:!0,configurable:!0}),AsyncWorkerQueue}();(N=I||(I={})).PRE="PRE",N.AFTER="AFTER",N.PROGRESS="PROGRESS",N.LOAD_START="LOAD_START",N.LOAD_COMPLETE="LOAD_COMPLETE",N.LOADER_FINISHED="LOADER_FINISHED",N.ERROR="ERROR";var U,j,G=function(){function ResourceLoader(e){void 0===e&&(e=10),this._emitter=new R,this.middleware=Object.create(null),this.resourceQueue=new F(e),this._preSignal=new x(this._emitter,I.PRE),this._afterSignal=new x(this._emitter,I.AFTER),this.onProgress=new x(this._emitter,I.PROGRESS),this.onLoadStart=new x(this._emitter,I.LOAD_START),this.onLoadComplete=new x(this._emitter,I.LOAD_COMPLETE),this.onError=new x(this._emitter,I.ERROR),this.onComplete=new x(this._emitter,I.LOADER_FINISHED)}return ResourceLoader.prototype._callAfter=function(e){this.onLoadComplete.emit(e),this._afterSignal.emit(e)},ResourceLoader.prototype.get=function(e){return e&&"string"==typeof e?this.middleware[e]:e&&"string"!=typeof e?this.middleware[e.prototype.constructor.name]:void 0},ResourceLoader.prototype.addMiddleware=function(e,t){return B.inject(e),e._loader=this,t&&"string"==typeof t?this.middleware[t]=e:t&&"string"!=typeof t&&(this.middleware[t.prototype.constructor.name]=e),e.onLoad.on(this._callAfter,this),e},ResourceLoader.prototype.removeMiddleware=function(e){e&&"string"==typeof e?delete this.middleware[e]:e&&"string"!=typeof e&&delete this.middleware[e.prototype.constructor.name]},ResourceLoader.prototype._onResourceLoadStart=function(e){this._preSignal.emit(e.resource),this.onLoadStart.emit(e.resource)},ResourceLoader.prototype._addResourceToQueue=function(e){var t=this;return e.resources.forEach(function(e){e.resource.onProgress.on(function(e){return t.onProgress.emit(e)}),e.resource.onError.on(function(e){return t.onError.emit(e)}),e.resource.onLoadStart.on(function(){return t._onResourceLoadStart(e)})}),this.resourceQueue.enqueue({tasks:e.resources.map(function(e){return{resource:e.resource,process:e.resource.load,processContext:e.resource,listener:e.resource.onLoadFinished.once,listenerContext:e.resource.onLoadFinished,args:e.args}}),onWorkFinished:e.onResourcesLoaded,onWorkFinishedContext:e.onResourcesLoadedContext}),this},ResourceLoader.prototype.pre=function(e){return this._preSignal.on(e),this},ResourceLoader.prototype.after=function(e){return this._afterSignal.on(e),this},ResourceLoader.prototype._onLoadComplete=function(){this._preSignal.removeAllListeners(),this._afterSignal.removeAllListeners(),this.onComplete.emit(this)},ResourceLoader.prototype.load=function(e){var t=this;return e&&"function"==typeof e&&this.onComplete.once(e),this.resourceQueue.process(function(){return t._onLoadComplete()}),this},ResourceLoader.prototype.stop=function(){this.resourceQueue.stop()},ResourceLoader.prototype.pause=function(){this.resourceQueue.pause()},ResourceLoader.prototype.resume=function(){this.resourceQueue.resume()},ResourceLoader}();(j=U||(U={}))[j.BYTE=5120]="BYTE",j[j.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",j[j.SHORT=5122]="SHORT",j[j.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",j[j.INT=5124]="INT",j[j.UNSIGNED_INT=5125]="UNSIGNED_INT",j[j.FLOAT=5126]="FLOAT";var V,H,z,Y,W,X,q,K,Q,$,J,Z;function GLTexture_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(H=V||(V={})).POSITION="POSITION",H.NORMAL="NORMAL",H.TANGENT="TANGENT",H.TEXCOORD_0="TEXCOORD_0",H.TEXCOORD_1="TEXCOORD_1",H.COLOR_0="COLOR_0",H.JOINTS_0="JOINTS_0",H.WEIGHTS_0="WEIGHTS_0",H.JOINTS_1="JOINTS_1",H.WEIGHTS_1="WEIGHTS_1",(Y=z||(z={}))[Y.STATIC_DRAW=35044]="STATIC_DRAW",Y[Y.STREAM_DRAW=35040]="STREAM_DRAW",Y[Y.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",Y[Y.ARRAY_BUFFER=34962]="ARRAY_BUFFER",Y[Y.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",(X=W||(W={}))[X.NEAREST=9728]="NEAREST",X[X.LINEAR=9729]="LINEAR",(K=q||(q={}))[K.NEAREST=9728]="NEAREST",K[K.LINEAR=9729]="LINEAR",K[K.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",K[K.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",K[K.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",K[K.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",($=Q||(Q={}))[$.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",$[$.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",$[$.REPEAT=10497]="REPEAT",(Z=J||(J={}))[Z.RGB=6407]="RGB",Z[Z.RGBA=6408]="RGBA",Z[Z.R8=33321]="R8",Z[Z.R16F=33325]="R16F",Z[Z.R32F=33326]="R32F",Z[Z.R8UI=33330]="R8UI",Z[Z.RG8=33323]="RG8",Z[Z.RG16F=33327]="RG16F",Z[Z.RG=33319]="RG",Z[Z.RG32F=33328]="RG32F",Z[Z.RGB8=32849]="RGB8",Z[Z.SRGB=35904]="SRGB",Z[Z.SRGB8=35905]="SRGB8",Z[Z.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",Z[Z.RGB565=36194]="RGB565",Z[Z.R11F_G11F_B10F=35898]="R11F_G11F_B10F",Z[Z.RGB9_E5=35901]="RGB9_E5",Z[Z.RGB16F=34843]="RGB16F",Z[Z.RGB32F=34837]="RGB32F",Z[Z.RGB8UI=36221]="RGB8UI",Z[Z.RGBA8=32856]="RGBA8",Z[Z.RGB5_A1=32855]="RGB5_A1",Z[Z.RGBA16F=34842]="RGBA16F",Z[Z.RGBA32F=34836]="RGBA32F",Z[Z.RGBA8UI=36220]="RGBA8UI";var ee=function(){function GLTexture(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:-1,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:e.RGBA,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:e.RGBA,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:e.UNSIGNED_BYTE;this.gl=e,this._textureID=t,this._texture=e.createTexture(),this.mipmap=!1,this._premultiplyAlpha=!1,this._width=n,this._height=r,this.internalformat=i,this.format=o,this.type=a,this.miplevel=0}var e=GLTexture.prototype;return e.upload=function upload(e){this.bind();var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha);var n=e.width,r=e.height;r!==this._height||n!==this._width?t.texImage2D(t.TEXTURE_2D,this.miplevel,this.internalformat,this.format,this.type,e):t.texSubImage2D(t.TEXTURE_2D,this.miplevel,0,0,this.format,this.type,e),this._width=n,this._height=r,this.unbind()},e.uploadData=function uploadData(e,t,n){this.bind();var r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha),t!==this._width||n!==this._height?r.texImage2D(r.TEXTURE_2D,this.miplevel,this.internalformat,t,n,0,this.format,this.type,e||null):r.texSubImage2D(r.TEXTURE_2D,this.miplevel,0,0,t,n,this.format,this.type,e||null),this._width=t,this._height=n,this.unbind()},e.bind=function bind(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._textureID,t=this.gl;return void 0!==e&&t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._texture),this},e.unbind=function unbind(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._textureID,t=this.gl;return void 0!==e&&t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,null),this},e.minFilter=function minFilter(e){this.bind();var t=this.gl;this.mipmap?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e?t.LINEAR:t.NEAREST),this.unbind()},e.setMinFilter=function setMinFilter(e){this.mipmap||e!==q.LINEAR_MIPMAP_LINEAR&&e!==q.LINEAR_MIPMAP_NEAREST&&e!==q.NEAREST_MIPMAP_LINEAR&&e!==q.NEAREST_MIPMAP_NEAREST||this.enableMipmap(),this.bind();var t=this.gl;if(this.mipmap)t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e);else{var n=e===q.LINEAR||q.LINEAR_MIPMAP_LINEAR||q.LINEAR_MIPMAP_NEAREST;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n?t.LINEAR:t.NEAREST)}this.unbind()},e.magFilter=function magFilter(e){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e?t.LINEAR:t.NEAREST),this.unbind()},e.setMagFilter=function setMagFilter(e){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),this.unbind()},e.enableMipmap=function enableMipmap(){if(GLTexture.isPowerOf2(this._width)&&GLTexture.isPowerOf2(this._height)&&(this.internalformat===this.gl.RGB||this.internalformat===this.gl.RGBA)){var e=this.gl;this.bind(),this.mipmap=!0,e.generateMipmap(e.TEXTURE_2D),this.unbind()}},e.enableLinearScaling=function enableLinearScaling(){this.minFilter(!0),this.magFilter(!0)},e.enableNearestScaling=function enableNearestScaling(){this.minFilter(!1),this.magFilter(!1)},e.enableWrapClamp=function enableWrapClamp(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.unbind()},e.enableWrapRepeat=function enableWrapRepeat(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),this.unbind()},e.enableWrapMirrorRepeat=function enableWrapMirrorRepeat(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT),this.unbind()},e.setWrapS=function setWrapS(e){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e),this.unbind()},e.setWrapT=function setWrapT(e){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e),this.unbind()},e.flipY=function flipY(e){var t=this.gl;this.bind(),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.unbind()},e.destroy=function destroy(){this.gl.deleteTexture(this._texture)},GLTexture.isPowerOf2=function isPowerOf2(e){return 0==(e&e-1)},GLTexture.nextHighestPowerOfTwo=function nextHighestPowerOfTwo(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},GLTexture.fromSource=function fromSource(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=new GLTexture(e,3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,null,null,4<arguments.length?arguments[4]:void 0,5<arguments.length?arguments[5]:void 0,6<arguments.length?arguments[6]:void 0);return r._premultiplyAlpha=n,r.upload(t),r},GLTexture.fromData=function fromData(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length?arguments[5]:void 0,a=6<arguments.length?arguments[6]:void 0,s=7<arguments.length?arguments[7]:void 0,u=8<arguments.length?arguments[8]:void 0,c=new GLTexture(e,i,null,null,o,a,s);return c._premultiplyAlpha=u,c.uploadData(t,n,r),c},function GLTexture_createClass(e,t,n){return t&&GLTexture_defineProperties(e.prototype,t),n&&GLTexture_defineProperties(e,n),e}(GLTexture,[{key:"textureID",get:function get(){return this._textureID},set:function set(e){this._textureID=e}},{key:"texture",get:function get(){return this._texture},set:function set(e){this._texture=e}},{key:"premultiplyAlpha",get:function get(){return this._premultiplyAlpha},set:function set(e){this._premultiplyAlpha=e}},{key:"width",get:function get(){return this._width}},{key:"height",get:function get(){return this._height}}]),GLTexture}();function GLCubemap_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var te=function(u){function GLCubemap(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:-1,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:e.RGBA,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:e.RGBA,s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:e.UNSIGNED_BYTE;return(t=u.call(this,e,n,r,i,o,a,s)||this).gl=e,t._textureID=n,t._texture=e.createTexture(),t.mipmap=!1,t.premultiplyAlpha=!1,t._width=r,t._height=i,t.format=a,t.type=s,t}!function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(GLCubemap,u);var e=GLCubemap.prototype;return e.upload=function upload(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;this.bind();var i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,this.internalformat,this.format,this.type,e),0===r&&(this._width=e.width,this._height=e.height),this.unbind()},e.uploadData=function uploadData(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._width,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this._height,i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;this.bind();var a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,o,this.internalformat,n,r,0,this.format,this.type,e||null),0===o&&(this._width=n,this._height=r),this.unbind()},e.bind=function bind(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._textureID,t=this.gl;return void 0!==e&&t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_CUBE_MAP,this._texture),this},e.unbind=function unbind(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._textureID,t=this.gl;return void 0!==e&&t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_CUBE_MAP,null),this},e.enableLinearScaling=function enableLinearScaling(){this.minFilter(!0),this.magFilter(!0)},e.enableNearestScaling=function enableNearestScaling(){this.minFilter(!1),this.magFilter(!1)},e.minFilter=function minFilter(e){this.bind();var t=this.gl;this.mipmap?t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,e?t.LINEAR:t.NEAREST),this.unbind()},e.magFilter=function magFilter(e){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,e?t.LINEAR:t.NEAREST),this.unbind()},e.enableMipmap=function enableMipmap(){var e=this.gl;this.bind(),this.mipmap=!0,e.generateMipmap(e.TEXTURE_CUBE_MAP),this.unbind()},e.enableWrapClamp=function enableWrapClamp(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),this.unbind()},e.enableWrapRepeat=function enableWrapRepeat(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,e.REPEAT),this.unbind()},e.enableWrapMirrorRepeat=function enableWrapMirrorRepeat(){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,e.MIRRORED_REPEAT),this.unbind()},e.destroy=function destroy(){this.gl.deleteTexture(this._texture)},GLCubemap.cubemapFromSource=function cubemapFromSource(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=new GLCubemap(e,4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,null,null,5<arguments.length?arguments[5]:void 0,6<arguments.length?arguments[6]:void 0,7<arguments.length?arguments[7]:void 0),o=[].concat(t);i.premultiplyAlpha=r;for(var a=Math.floor(o.length/6),s=0;s<a;s++)for(var u=0;u<6;u++)i.upload(o[6*s+u],n,u,s);return ee.isPowerOf2(t[0].width)&&ee.isPowerOf2(t[0].height)?(i.enableMipmap(),i.enableWrapRepeat()):i.enableWrapClamp(),i.enableLinearScaling(),i},GLCubemap.cubemapFromData=function cubemapFromData(e,t,n,r){for(var i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,a=(6<arguments.length&&arguments[6],new GLCubemap(e,o,null,null,7<arguments.length?arguments[7]:void 0,8<arguments.length?arguments[8]:void 0)),s=[].concat(t),u=0;u<6;u++)a.uploadData(s[u],u,n,r,i);return a},function GLCubemap_createClass(e,t,n){return t&&GLCubemap_defineProperties(e.prototype,t),n&&GLCubemap_defineProperties(e,n),e}(GLCubemap,[{key:"width",get:function get(){return this._width}},{key:"height",get:function get(){return this._height}}]),GLCubemap}(ee);function GLBuffer_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function GLBuffer(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.ARRAY_BUFFER,n=2<arguments.length?arguments[2]:void 0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:e.STATIC_DRAW;this.gl=e,this.type=t,this.arrayBuffers=[],this._byteLength=0,this.buffer=e.createBuffer(),this.drawType=r,n&&this.upload(n)}var e=GLBuffer.prototype;return e.addData=function addData(e){this.arrayBuffers.push(e),this._byteLength+=e.byteLength},e.removeData=function removeData(e){var t=this.arrayBuffers.indexOf(e);if(-1<t){var n=this.arrayBuffers[t];this._byteLength-=n.byteLength,this.arrayBuffers.splice(t,1)}},e.upload=function upload(e){e&&this.addData(e),this.bind();var t=this.gl;t.bufferData(this.type,this._byteLength,this.drawType);for(var n,r=0,i=0;n=this.arrayBuffers[i];i++)t.bufferSubData(this.type,r,n),r+=n.byteLength;return this.unbind(),this._byteLength},e.bind=function bind(){this.gl.bindBuffer(this.type,this.buffer)},e.unbind=function unbind(){this.gl.bindBuffer(this.type,null)},e.destroy=function destroy(){this.gl.isBuffer(this.buffer)&&this.gl.deleteBuffer(this.buffer),this.gl=null,this.buffer=null},GLBuffer.createVertexBuffer=function createVertexBuffer(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e.STATIC_DRAW;return new GLBuffer(e,e.ARRAY_BUFFER,t,n)},GLBuffer.createIndexBuffer=function createIndexBuffer(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e.STATIC_DRAW;return new GLBuffer(e,e.ELEMENT_ARRAY_BUFFER,t,n)},GLBuffer.create=function create(e,t){return new GLBuffer(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,3<arguments.length&&void 0!==arguments[3]?arguments[3]:e.STATIC_DRAW)},function GLBuffer_createClass(e,t,n){return t&&GLBuffer_defineProperties(e.prototype,t),n&&GLBuffer_defineProperties(e,n),e}(GLBuffer,[{key:"byteLength",get:function get(){return this._byteLength}},{key:"length",get:function get(){return this.arrayBuffers.length}}]),GLBuffer}(),re=function(){function GLVertexArrayObject(e){this.gl=e,this.vao=this.gl.createVertexArray(),this.attributes=[],this.dirty=!1}var e=GLVertexArrayObject.prototype;return e.bind=function bind(){return this.vao&&(this.gl.bindVertexArray(this.vao),this.dirty&&(this.activate(),this.dirty=!1,this.bind())),this},e.activate=function activate(){var e=this.gl,t=null;this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null);for(var n,r=0;n=this.attributes[r];r++)t!==n.buffer&&(t&&t.unbind(),n.buffer.bind(),t=n.buffer),GLVertexArrayObject.setVertexAttribArray(e,n);return t&&t.unbind(),this.indexBuffer.bind(),this},e.deactivate=function deactivate(){for(var e,t=this.gl,n=null,r=0;e=this.attributes[r];r++)n!==e.buffer&&(e.buffer.unbind(),n=e.buffer),GLVertexArrayObject.setVertexAttribArray(t,e,!0);return this.indexBuffer.unbind(),this},e.unbind=function unbind(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this.vao?this.gl.bindVertexArray(null):this.vao&&!e||this.deactivate(),this},e.addAttribute=function addAttribute(e,t,n,r,i,o,a){var s=!(7<arguments.length&&void 0!==arguments[7])||arguments[7];return this.attributes.push({buffer:e,attribute:t,size:n,type:r,normalized:i,stride:o,offset:a,initialize:s}),this.dirty=!0,this},e.setIndexBuffer=function setIndexBuffer(e){return this.indexBuffer=e,this},e.draw=function draw(e,t,n,r){return this.gl.drawElements(e,t,n,r),this},e.clear=function clear(){this.vao&&this.gl.bindVertexArray(this.vao),this.deactivate(),this.attributes.length=0,this.indexBuffer=null,this.vao&&this.gl.bindVertexArray(null)},e.destroy=function destroy(){this.clear(),this.vao&&this.gl.deleteVertexArray(this.vao),this.gl=void 0,this.indexBuffer=void 0,this.attributes=void 0,this.vao=void 0},GLVertexArrayObject.setVertexAttribArrays=function setVertexAttribArrays(e,t){for(var n,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=0;n=t[i];i++)GLVertexArrayObject.setVertexAttribArray(e,n,r)},GLVertexArrayObject.setVertexAttribArray=function setVertexAttribArray(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];t.initialize&&t.attribute&&(e.vertexAttribPointer(t.attribute.location,t.size,t.type,t.normalized,t.stride,t.offset),t.initialize=!1),n&&t.attribute?e.disableVertexAttribArray(t.attribute.location):t.attribute&&e.enableVertexAttribArray(t.attribute.location)},GLVertexArrayObject}(),ie=1e-6,oe="undefined"!=typeof Float32Array?Float32Array:Array,ae=Math.random;Math.PI;function mat4_create(){var e=new oe(16);return oe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function clone(e){var t=new oe(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fromValues(e,t,n,r,i,o,a,s,u,c,l,d,f,h,p,m){var _=new oe(16);return _[0]=e,_[1]=t,_[2]=n,_[3]=r,_[4]=i,_[5]=o,_[6]=a,_[7]=s,_[8]=u,_[9]=c,_[10]=l,_[11]=d,_[12]=f,_[13]=h,_[14]=p,_[15]=m,_}function mat4_set(e,t,n,r,i,o,a,s,u,c,l,d,f,h,p,m,_){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=d,e[11]=f,e[12]=h,e[13]=p,e[14]=m,e[15]=_,e}function identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function transpose(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function invert(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],_=t[14],g=t[15],y=n*s-r*a,v=n*u-i*a,b=n*c-o*a,E=r*u-i*s,S=r*c-o*s,A=i*c-o*u,C=l*m-d*p,T=l*_-f*p,w=l*g-h*p,M=d*_-f*m,R=d*g-h*m,x=f*g-h*_,O=y*x-v*R+b*M+E*w-S*T+A*C;return O?(O=1/O,e[0]=(s*x-u*R+c*M)*O,e[1]=(i*R-r*x-o*M)*O,e[2]=(m*A-_*S+g*E)*O,e[3]=(f*S-d*A-h*E)*O,e[4]=(u*w-a*x-c*T)*O,e[5]=(n*x-i*w+o*T)*O,e[6]=(_*b-p*A-g*v)*O,e[7]=(l*A-f*b+h*v)*O,e[8]=(a*R-s*w+c*C)*O,e[9]=(r*w-n*R-o*C)*O,e[10]=(p*S-m*b+g*y)*O,e[11]=(d*b-l*S-h*y)*O,e[12]=(s*T-a*M-u*C)*O,e[13]=(n*M-r*T+i*C)*O,e[14]=(m*v-p*E-_*y)*O,e[15]=(l*E-d*v+f*y)*O,e):null}function adjoint(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],_=t[14],g=t[15];return e[0]=s*(f*g-h*_)-d*(u*g-c*_)+m*(u*h-c*f),e[1]=-(r*(f*g-h*_)-d*(i*g-o*_)+m*(i*h-o*f)),e[2]=r*(u*g-c*_)-s*(i*g-o*_)+m*(i*c-o*u),e[3]=-(r*(u*h-c*f)-s*(i*h-o*f)+d*(i*c-o*u)),e[4]=-(a*(f*g-h*_)-l*(u*g-c*_)+p*(u*h-c*f)),e[5]=n*(f*g-h*_)-l*(i*g-o*_)+p*(i*h-o*f),e[6]=-(n*(u*g-c*_)-a*(i*g-o*_)+p*(i*c-o*u)),e[7]=n*(u*h-c*f)-a*(i*h-o*f)+l*(i*c-o*u),e[8]=a*(d*g-h*m)-l*(s*g-c*m)+p*(s*h-c*d),e[9]=-(n*(d*g-h*m)-l*(r*g-o*m)+p*(r*h-o*d)),e[10]=n*(s*g-c*m)-a*(r*g-o*m)+p*(r*c-o*s),e[11]=-(n*(s*h-c*d)-a*(r*h-o*d)+l*(r*c-o*s)),e[12]=-(a*(d*_-f*m)-l*(s*_-u*m)+p*(s*f-u*d)),e[13]=n*(d*_-f*m)-l*(r*_-i*m)+p*(r*f-i*d),e[14]=-(n*(s*_-u*m)-a*(r*_-i*m)+p*(r*u-i*s)),e[15]=n*(s*f-u*d)-a*(r*f-i*d)+l*(r*u-i*s),e}function determinant(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],h=e[12],p=e[13],m=e[14],_=e[15];return(t*a-n*o)*(d*_-f*m)-(t*s-r*o)*(l*_-f*p)+(t*u-i*o)*(l*m-d*p)+(n*s-r*a)*(c*_-f*h)-(n*u-i*a)*(c*m-d*h)+(r*u-i*s)*(c*p-l*h)}function multiply(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=t[9],h=t[10],p=t[11],m=t[12],_=t[13],g=t[14],y=t[15],v=n[0],b=n[1],E=n[2],S=n[3];return e[0]=v*r+b*s+E*d+S*m,e[1]=v*i+b*u+E*f+S*_,e[2]=v*o+b*c+E*h+S*g,e[3]=v*a+b*l+E*p+S*y,v=n[4],b=n[5],E=n[6],S=n[7],e[4]=v*r+b*s+E*d+S*m,e[5]=v*i+b*u+E*f+S*_,e[6]=v*o+b*c+E*h+S*g,e[7]=v*a+b*l+E*p+S*y,v=n[8],b=n[9],E=n[10],S=n[11],e[8]=v*r+b*s+E*d+S*m,e[9]=v*i+b*u+E*f+S*_,e[10]=v*o+b*c+E*h+S*g,e[11]=v*a+b*l+E*p+S*y,v=n[12],b=n[13],E=n[14],S=n[15],e[12]=v*r+b*s+E*d+S*m,e[13]=v*i+b*u+E*f+S*_,e[14]=v*o+b*c+E*h+S*g,e[15]=v*a+b*l+E*p+S*y,e}function translate(e,t,n){var r,i,o,a,s,u,c,l,d,f,h,p,m=n[0],_=n[1],g=n[2];return e[15]=t===e?(e[12]=t[0]*m+t[4]*_+t[8]*g+t[12],e[13]=t[1]*m+t[5]*_+t[9]*g+t[13],e[14]=t[2]*m+t[6]*_+t[10]*g+t[14],t[3]*m+t[7]*_+t[11]*g+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=t[9],h=t[10],p=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=d,e[9]=f,e[10]=h,e[11]=p,e[12]=r*m+s*_+d*g+t[12],e[13]=i*m+u*_+f*g+t[13],e[14]=o*m+c*_+h*g+t[14],a*m+l*_+p*g+t[15]),e}function mat4_scale(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function mat4_rotate(e,t,n,r){var i,o,a,s,u,c,l,d,f,h,p,m,_,g,y,v,b,E,S,A,C,T,w,M,R=r[0],x=r[1],O=r[2],P=Math.sqrt(R*R+x*x+O*O);return P<ie?null:(R*=P=1/P,x*=P,O*=P,i=Math.sin(n),a=1-(o=Math.cos(n)),s=t[0],u=t[1],c=t[2],l=t[3],d=t[4],f=t[5],h=t[6],p=t[7],m=t[8],_=t[9],g=t[10],y=t[11],v=R*R*a+o,b=x*R*a+O*i,E=O*R*a-x*i,S=R*x*a-O*i,A=x*x*a+o,C=O*x*a+R*i,T=R*O*a+x*i,w=x*O*a-R*i,M=O*O*a+o,e[0]=s*v+d*b+m*E,e[1]=u*v+f*b+_*E,e[2]=c*v+h*b+g*E,e[3]=l*v+p*b+y*E,e[4]=s*S+d*A+m*C,e[5]=u*S+f*A+_*C,e[6]=c*S+h*A+g*C,e[7]=l*S+p*A+y*C,e[8]=s*T+d*w+m*M,e[9]=u*T+f*w+_*M,e[10]=c*T+h*w+g*M,e[11]=l*T+p*w+y*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function rotateX(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=a*i+l*r,e[6]=s*i+d*r,e[7]=u*i+f*r,e[8]=c*i-o*r,e[9]=l*i-a*r,e[10]=d*i-s*r,e[11]=f*i-u*r,e}function rotateY(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[8],l=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=a*i-l*r,e[2]=s*i-d*r,e[3]=u*i-f*r,e[8]=o*r+c*i,e[9]=a*r+l*i,e[10]=s*r+d*i,e[11]=u*r+f*i,e}function rotateZ(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[4],l=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=a*i+l*r,e[2]=s*i+d*r,e[3]=u*i+f*r,e[4]=c*i-o*r,e[5]=l*i-a*r,e[6]=d*i-s*r,e[7]=f*i-u*r,e}function fromTranslation(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fromScaling(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotation(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.sqrt(a*a+s*s+u*u);return c<ie?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function fromXRotation(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromYRotation(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromZRotation(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotationTranslation(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,c=o+o,l=r*s,d=r*u,f=r*c,h=i*u,p=i*c,m=o*c,_=a*s,g=a*u,y=a*c;return e[0]=1-(h+m),e[1]=d+y,e[2]=f-g,e[3]=0,e[4]=d-y,e[5]=1-(l+m),e[6]=p+_,e[7]=0,e[8]=f+g,e[9]=p-_,e[10]=1-(l+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function fromQuat2(e,t){var n=new oe(3),r=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],d=r*r+i*i+o*o+a*a;return n[2]=0<d?(n[0]=2*(s*a+l*r+u*o-c*i)/d,n[1]=2*(u*a+l*i+c*r-s*o)/d,2*(c*a+l*o+s*i-u*r)/d):(n[0]=2*(s*a+l*r+u*o-c*i),n[1]=2*(u*a+l*i+c*r-s*o),2*(c*a+l*o+s*i-u*r)),fromRotationTranslation(e,t,n),e}function getTranslation(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function getScaling(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(o*o+a*a+s*s),e[2]=Math.sqrt(u*u+c*c+l*l),e}function getRotation(e,t){var n=t[0]+t[5]+t[10],r=0;return 0<n?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function fromRotationTranslationScale(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,c=o+o,l=a+a,d=i*u,f=i*c,h=i*l,p=o*c,m=o*l,_=a*l,g=s*u,y=s*c,v=s*l,b=r[0],E=r[1],S=r[2];return e[0]=(1-(p+_))*b,e[1]=(f+v)*b,e[2]=(h-y)*b,e[3]=0,e[4]=(f-v)*E,e[5]=(1-(d+_))*E,e[6]=(m+g)*E,e[7]=0,e[8]=(h+y)*S,e[9]=(m-g)*S,e[10]=(1-(d+p))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function fromRotationTranslationScaleOrigin(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],c=o+o,l=a+a,d=s+s,f=o*c,h=o*l,p=o*d,m=a*l,_=a*d,g=s*d,y=u*c,v=u*l,b=u*d,E=r[0],S=r[1],A=r[2],C=i[0],T=i[1],w=i[2],M=(1-(m+g))*E,R=(h+b)*E,x=(p-v)*E,O=(h-b)*S,P=(1-(f+g))*S,L=(_+y)*S,k=(p+v)*A,D=(_-y)*A,B=(1-(f+m))*A;return e[0]=M,e[1]=R,e[2]=x,e[3]=0,e[4]=O,e[5]=P,e[6]=L,e[7]=0,e[8]=k,e[9]=D,e[10]=B,e[11]=0,e[12]=n[0]+C-(M*C+O*T+k*w),e[13]=n[1]+T-(R*C+P*T+D*w),e[14]=n[2]+w-(x*C+L*T+B*w),e[15]=1,e}function fromQuat(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,d=r*s,f=i*a,h=i*s,p=i*u,m=o*a,_=o*s,g=o*u;return e[0]=1-d-p,e[1]=l+g,e[2]=f-_,e[3]=0,e[4]=l-g,e[5]=1-c-p,e[6]=h+m,e[7]=0,e[8]=f+_,e[9]=h-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function frustum(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e}function mat4_perspective(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,e[14]=null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,2*i*r*o):(e[10]=-1,-2*r),e}function perspectiveFromFieldOfView(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function ortho(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*c,e[15]=1,e}function lookAt(e,t,n,r){var i,o,a,s,u,c,l,d,f,h,p=t[0],m=t[1],_=t[2],g=r[0],y=r[1],v=r[2],b=n[0],E=n[1],S=n[2];return Math.abs(p-b)<ie&&Math.abs(m-E)<ie&&Math.abs(_-S)<ie?identity(e):(l=p-b,d=m-E,f=_-S,i=y*(f*=h=1/Math.sqrt(l*l+d*d+f*f))-v*(d*=h),o=v*(l*=h)-g*f,a=g*d-y*l,(h=Math.sqrt(i*i+o*o+a*a))?(i*=h=1/h,o*=h,a*=h):a=o=i=0,s=d*a-f*o,u=f*i-l*a,c=l*o-d*i,(h=Math.sqrt(s*s+u*u+c*c))?(s*=h=1/h,u*=h,c*=h):c=u=s=0,e[0]=i,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=d,e[7]=0,e[8]=a,e[9]=c,e[10]=f,e[11]=0,e[12]=-(i*p+o*m+a*_),e[13]=-(s*p+u*m+c*_),e[14]=-(l*p+d*m+f*_),e[15]=1,e)}function targetTo(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],c=r[2],l=i-n[0],d=o-n[1],f=a-n[2],h=l*l+d*d+f*f;0<h&&(l*=h=1/Math.sqrt(h),d*=h,f*=h);var p=u*f-c*d,m=c*l-s*f,_=s*d-u*l;return 0<(h=p*p+m*m+_*_)&&(p*=h=1/Math.sqrt(h),m*=h,_*=h),e[0]=p,e[1]=m,e[2]=_,e[3]=0,e[4]=d*_-f*m,e[5]=f*p-l*_,e[6]=l*m-d*p,e[7]=0,e[8]=l,e[9]=d,e[10]=f,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e}function str(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function frob(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function mat4_add(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function subtract(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function multiplyScalar(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function multiplyScalarAndAdd(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function mat4_equals(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],d=e[9],f=e[10],h=e[11],p=e[12],m=e[13],_=e[14],g=e[15],y=t[0],v=t[1],b=t[2],E=t[3],S=t[4],A=t[5],C=t[6],T=t[7],w=t[8],M=t[9],R=t[10],x=t[11],O=t[12],P=t[13],L=t[14],k=t[15];return Math.abs(n-y)<=ie*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-v)<=ie*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-b)<=ie*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-E)<=ie*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-S)<=ie*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-A)<=ie*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-C)<=ie*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(c-T)<=ie*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(l-w)<=ie*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(d-M)<=ie*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(f-R)<=ie*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(h-x)<=ie*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(p-O)<=ie*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-P)<=ie*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(_-L)<=ie*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(g-k)<=ie*Math.max(1,Math.abs(g),Math.abs(k))}var se=multiply,ue=subtract;function vec3_create(){var e=new oe(3);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function vec3_clone(e){var t=new oe(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function vec3_length(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function vec3_fromValues(e,t,n){var r=new oe(3);return r[0]=e,r[1]=t,r[2]=n,r}function vec3_copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function vec3_set(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function vec3_add(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function vec3_subtract(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function vec3_multiply(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function divide(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function vec3_min(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function vec3_max(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function round(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function vec3_scale(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function scaleAndAdd(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function distance(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function squaredDistance(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function squaredLength(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function negate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function normalize(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return 0<o&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function vec3_dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cross(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function vec3_lerp(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}function hermite(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*c+i[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+i[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+i[2]*l,e}function bezier(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,d=3*u*a,f=u*o;return e[0]=t[0]*c+n[0]*l+r[0]*d+i[0]*f,e[1]=t[1]*c+n[1]*l+r[1]*d+i[1]*f,e[2]=t[2]*c+n[2]*l+r[2]*d+i[2]*f,e}function random(e,t){t=t||1;var n=2*ae()*Math.PI,r=2*ae()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}function transformMat4(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function transformMat3(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function transformQuat(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],c=t[2],l=i*c-o*u,d=o*s-r*c,f=r*u-i*s,h=i*f-o*d,p=o*l-r*f,m=r*d-i*l,_=2*a;return l*=_,d*=_,f*=_,h*=2,p*=2,m*=2,e[0]=s+l+h,e[1]=u+d+p,e[2]=c+f+m,e}function vec3_rotateX(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function vec3_rotateY(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function vec3_rotateZ(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function vec3_angle(e,t){var n=vec3_fromValues(e[0],e[1],e[2]),r=vec3_fromValues(t[0],t[1],t[2]);normalize(n,n),normalize(r,r);var i=vec3_dot(n,r);return 1<i?0:i<-1?Math.PI:Math.acos(i)}function zero(e){return e[0]=0,e[1]=0,e[2]=0,e}function vec3_str(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function vec3_exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function vec3_equals(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=ie*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=ie*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=ie*Math.max(1,Math.abs(i),Math.abs(s))}var ce,le=vec3_subtract,de=vec3_multiply,fe=divide,he=distance,pe=squaredDistance,me=vec3_length,_e=squaredLength,ge=(ce=vec3_create(),function(e,t,n,r,i,o){var a,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)ce[0]=e[a],ce[1]=e[a+1],ce[2]=e[a+2],i(ce,ce,o),e[a]=ce[0],e[a+1]=ce[1],e[a+2]=ce[2];return e});function vec4_create(){var e=new oe(4);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function vec4_clone(e){var t=new oe(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function vec4_fromValues(e,t,n,r){var i=new oe(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function vec4_copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function vec4_set(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function vec4_add(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function vec4_subtract(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function vec4_multiply(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function vec4_divide(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function vec4_ceil(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function vec4_floor(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function vec4_min(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function vec4_max(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function vec4_round(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function vec4_scale(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function vec4_scaleAndAdd(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function vec4_distance(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+o*o)}function vec4_squaredDistance(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o}function vec4_length(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function vec4_squaredLength(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function vec4_negate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function vec4_inverse(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function vec4_normalize(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o;return 0<a&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=o*a,e}function vec4_dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function vec4_cross(e,t,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],l=t[0],d=t[1],f=t[2],h=t[3];return e[0]=d*c-f*u+h*s,e[1]=-l*c+f*a-h*o,e[2]=l*u-d*a+h*i,e[3]=-l*s+d*o-f*i,e}function vec4_lerp(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e[3]=s+r*(n[3]-s),e}function vec4_random(e,t){var n,r,i,o,a,s;for(t=t||1;1<=(a=(n=2*ae()-1)*n+(r=2*ae()-1)*r););for(;1<=(s=(i=2*ae()-1)*i+(o=2*ae()-1)*o););var u=Math.sqrt((1-a)/s);return e[0]=t*n,e[1]=t*r,e[2]=t*i*u,e[3]=t*o*u,e}function vec4_transformMat4(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}function vec4_transformQuat(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2],c=n[3],l=c*r+s*o-u*i,d=c*i+u*r-a*o,f=c*o+a*i-s*r,h=-a*r-s*i-u*o;return e[0]=l*c+h*-a+d*-u-f*-s,e[1]=d*c+h*-s+f*-a-l*-u,e[2]=f*c+h*-u+l*-s-d*-a,e[3]=t[3],e}function vec4_zero(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function vec4_str(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function vec4_exactEquals(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vec4_equals(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=t[0],s=t[1],u=t[2],c=t[3];return Math.abs(n-a)<=ie*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=ie*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=ie*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=ie*Math.max(1,Math.abs(o),Math.abs(c))}var ye,ve=vec4_subtract,be=vec4_multiply,Ee=vec4_divide,Se=vec4_distance,Ae=vec4_squaredDistance,Ce=vec4_length,Te=vec4_squaredLength,we=(ye=vec4_create(),function(e,t,n,r,i,o){var a,s;for(t||(t=4),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)ye[0]=e[a],ye[1]=e[a+1],ye[2]=e[a+2],ye[3]=e[a+3],i(ye,ye,o),e[a]=ye[0],e[a+1]=ye[1],e[a+2]=ye[2],e[a+3]=ye[3];return e});function quat_create(){var e=new oe(4);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function quat_identity(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function setAxisAngle(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function getAxisAngle(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return e[2]=ie<r?(e[0]=t[0]/r,e[1]=t[1]/r,t[2]/r):(e[0]=1,e[1]=0),n}function quat_multiply(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+a*s+i*c-o*u,e[1]=i*l+a*u+o*s-r*c,e[2]=o*l+a*c+r*u-i*s,e[3]=a*l-r*s-i*u-o*c,e}function quat_rotateX(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+a*s,e[1]=i*u+o*s,e[2]=o*u-i*s,e[3]=a*u-r*s,e}function quat_rotateY(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u-o*s,e[1]=i*u+a*s,e[2]=o*u+r*s,e[3]=a*u-i*s,e}function quat_rotateZ(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+i*s,e[1]=i*u-r*s,e[2]=o*u+a*s,e[3]=a*u-o*s,e}function calculateW(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e}function slerp(e,t,n,r){var i,o,a,s,u,c=t[0],l=t[1],d=t[2],f=t[3],h=n[0],p=n[1],m=n[2],_=n[3];return(o=c*h+l*p+d*m+f*_)<0&&(o=-o,h=-h,p=-p,m=-m,_=-_),u=ie<1-o?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,Math.sin(r*i)/a):(s=1-r,r),e[0]=s*c+u*h,e[1]=s*l+u*p,e[2]=s*d+u*m,e[3]=s*f+u*_,e}function quat_random(e){var t=ae(),n=ae(),r=ae(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*n),e[1]=i*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*r),e[3]=o*Math.cos(2*Math.PI*r),e}function quat_invert(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e}function conjugate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function fromMat3(e,t){var n,r=t[0]+t[4]+t[8];if(0<r)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*a+a]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*o+a]-t[3*a+o])*n,e[o]=(t[3*o+i]+t[3*i+o])*n,e[a]=(t[3*a+i]+t[3*i+a])*n}return e}function fromEuler(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return e[0]=o*u*l-a*s*c,e[1]=a*s*l+o*u*c,e[2]=a*u*c-o*s*l,e[3]=a*u*l+o*s*c,e}function quat_str(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Me,Re,xe,Oe,Pe,Le,ke=vec4_clone,De=vec4_fromValues,Be=vec4_copy,Ie=vec4_set,Ne=vec4_add,Fe=quat_multiply,Ue=vec4_scale,je=vec4_dot,Ge=vec4_lerp,Ve=vec4_length,He=Ve,ze=vec4_squaredLength,Ye=ze,We=vec4_normalize,Xe=vec4_exactEquals,qe=vec4_equals,Ke=(Me=vec3_create(),Re=vec3_fromValues(1,0,0),xe=vec3_fromValues(0,1,0),function(e,t,n){var r=vec3_dot(t,n);return r<-.999999?(cross(Me,Re,t),me(Me)<1e-6&&cross(Me,xe,t),normalize(Me,Me),setAxisAngle(e,Me,Math.PI),e):.999999<r?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(cross(Me,t,n),e[0]=Me[0],e[1]=Me[1],e[2]=Me[2],e[3]=1+r,We(e,e))}),Qe=(Oe=quat_create(),Pe=quat_create(),function(e,t,n,r,i,o){return slerp(Oe,t,i,o),slerp(Pe,n,r,o),slerp(e,Oe,Pe,2*o*(1-o)),e}),$e=(Le=function mat3_create(){var e=new oe(9);return oe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}(),function(e,t,n,r){return Le[0]=n[0],Le[3]=n[1],Le[6]=n[2],Le[1]=r[0],Le[4]=r[1],Le[7]=r[2],Le[2]=-t[0],Le[5]=-t[1],Le[8]=-t[2],We(e,fromMat3(e,Le))});function GLCube_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Je=function(){function GLCube(e){this.gl=e,this.createVertexData()}var e=GLCube.prototype;return e.calcVertexData=function calcVertexData(){var e,t,n,r=[1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1],i=[];i[0]=0,i[1]=1,i[2]=2,i[3]=1,i[4]=2,i[5]=3,i[6]=4,i[7]=5,i[8]=6,i[9]=4,i[10]=6,i[11]=7,i[12]=5,i[13]=6,i[14]=0,i[15]=0,i[16]=6,i[17]=1,i[18]=7,i[19]=2,i[20]=3,i[21]=7,i[22]=2,i[23]=4,i[24]=7,i[25]=6,i[26]=3,i[27]=6,i[28]=3,i[29]=1,i[30]=5,i[31]=4,i[32]=0,i[33]=0,i[34]=4,i[35]=2;for(var o=[],a=0;a<i.length;a+=3){e=b.fromValues(r[3*i[a]],r[3*i[a]+1],r[3*i[a]+2]),t=b.fromValues(r[3*i[a+1]],r[3*i[a+1]+1],r[3*i[a+1]+2]),n=b.fromValues(r[3*i[a+2]],r[3*i[a+2]+1],r[3*i[a+2]+2]);var s=b.create();b.subtract(s,t,e);var u=b.create();b.subtract(u,n,e);var c=b.create();b.cross(c,s,u),b.normalize(c,c),o.push(e[0],e[1],e[2],c[0],c[1],c[2]),o.push(t[0],t[1],t[2],c[0],c[1],c[2]),o.push(n[0],n[1],n[2],c[0],c[1],c[2])}return new Float32Array(o)},e.createVertexData=function createVertexData(){for(var e=this.calcVertexData(),t=new Uint8Array(36),n=0;n<36;n++)t[n]=n;if(this._vertexBuffer=ne.createVertexBuffer(this.gl,e,this.gl.STATIC_DRAW),!this._vertexBuffer)throw"Failed to create VertexBuffer Object";if(this._indexBuffer=ne.createIndexBuffer(this.gl,t,this.gl.STATIC_DRAW),!this._indexBuffer)throw"Failed to create IndexBuffer Object!";this._vertexArrayObject=new re(this.gl),this.vertexArrayObject.setIndexBuffer(this._indexBuffer)},e.draw=function draw(){this.vertexArrayObject.bind(),this.gl.drawElements(this.gl.TRIANGLES,GLCube.INDEX_LENGTH,this.gl.UNSIGNED_BYTE,0),this.vertexArrayObject.unbind()},function GLCube_createClass(e,t,n){return t&&GLCube_defineProperties(e.prototype,t),n&&GLCube_defineProperties(e,n),e}(GLCube,[{key:"vertexBuffer",get:function get(){return this._vertexBuffer},set:function set(e){this._vertexBuffer=e}},{key:"indexBuffer",get:function get(){return this._indexBuffer},set:function set(e){this._indexBuffer=e}},{key:"vertexArrayObject",get:function get(){return this._vertexArrayObject},set:function set(e){this._vertexArrayObject=e}}]),GLCube}();Je.INDEX_LENGTH=36;function GLQuad_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(function(){function GLQuad(e){this.gl=e,this.createVertexData()}var e=GLQuad.prototype;return e.createVertexData=function createVertexData(){var e=new Float32Array([-1,1,0,1,-1,-1,0,0,1,1,1,1,1,-1,1,0]),t=new Uint8Array(6);if(t[0]=0,t[1]=1,t[2]=2,t[3]=1,t[4]=2,t[5]=3,this._vertexBuffer=ne.createVertexBuffer(this.gl,e,this.gl.STATIC_DRAW),!this._vertexBuffer)throw"Failed to create VertexBuffer Object";if(this._indexBuffer=ne.createIndexBuffer(this.gl,t,this.gl.STATIC_DRAW),!this._indexBuffer)throw"Failed to create IndexBuffer Object!";this._vertexArrayObject=new re(this.gl),this.vertexArrayObject.setIndexBuffer(this._indexBuffer)},e.draw=function draw(){this.vertexArrayObject.bind(),this.gl.drawElements(this.gl.TRIANGLES,GLQuad.INDEX_LENGTH,this.gl.UNSIGNED_BYTE,0),this.vertexArrayObject.unbind()},function GLQuad_createClass(e,t,n){return t&&GLQuad_defineProperties(e.prototype,t),n&&GLQuad_defineProperties(e,n),e}(GLQuad,[{key:"vertexBuffer",get:function get(){return this._vertexBuffer},set:function set(e){this._vertexBuffer=e}},{key:"indexBuffer",get:function get(){return this._indexBuffer},set:function set(e){this._indexBuffer=e}},{key:"vertexArrayObject",get:function get(){return this._vertexArrayObject},set:function set(e){this._vertexArrayObject=e}}]),GLQuad})().INDEX_LENGTH=6;function GLUniformBufferObject_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ze,et,tt,nt=function(){function GLUniformBufferObject(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e.DYNAMIC_DRAW;this.gl=e,this.type=e.UNIFORM_BUFFER,this.buffer=e.createBuffer(),this.items={},this.drawType=n,this._bindingPoint=t,this._byteLength=0}var e=GLUniformBufferObject.prototype;return e.addItem=function addItem(e,t,n){this.items[e]={type:t,offset:0,blockSize:0,alignedByteLength:0,data:n}},e.addBlock=function addBlock(e){for(var t,n=0;t=e[n];n++)this.addItem(t.name,t.type,t.data)},e.updateItem=function updateItem(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.items[e].data=t,n&&this.updateGL(e)},e.hasItem=function hasItem(e){return!!this.items[e]},e.removeItem=function removeItem(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1];delete this.items[e],this.upload()},e.updateGL=function updateGL(e){var t=this.items[e];t.data&&(this.bind(),this.gl.bufferSubData(this.type,t.offset,t.data),this.unbind())},e.uploadBuffer=function uploadBuffer(e,t,n){this._byteLength=e;var r=this.gl;return this.bind(),r.bufferData(this.type,this._byteLength,this.drawType),t&&r.bufferSubData(this.type,0,t,n),this.unbind(),this._byteLength},e.upload=function upload(){this._byteLength=this.updateItemAlignment(),this.bind();var e=this.gl;e.bufferData(this.type,this._byteLength,this.drawType);for(var t,n=0;t=this.items[n];n++)t.data&&e.bufferSubData(this.type,t.offset,t.data);return this.unbind(),this._byteLength},e.bindUBO=function bindUBO(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._bindingPoint,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._byteLength;0===t&&n===this._byteLength?this.gl.bindBufferBase(this.type,e,this.buffer):this.gl.bindBufferRange(this.type,e,this.buffer,t,n)},e.bind=function bind(){this.gl.bindBuffer(this.type,this.buffer)},e.unbind=function unbind(){this.gl.bindBuffer(this.type,null)},e.destroy=function destroy(){this.gl.isBuffer(this.buffer)&&this.gl.deleteBuffer(this.buffer),this.gl=null,this.buffer=null},e.updateItemAlignment=function updateItemAlignment(){for(var e,t=null,n=0,r=Object.keys(this.items),i=0;e=this.items[r[i]];i++)if(e.data){var o=GLUniformBufferObject.TYPE_TO_SIZE[e.type];if(e.alignment=e.alignedByteLength=o[0],e.blockSize=o[1],e.data.byteLength!==e.blockSize){var a=e.data.byteLength/e.blockSize;e.alignedByteLength=e.alignment*a}t&&(e.offset=t.alignedByteLength+t.offset),n+=(t=e).alignedByteLength}return n},function GLUniformBufferObject_createClass(e,t,n){return t&&GLUniformBufferObject_defineProperties(e.prototype,t),n&&GLUniformBufferObject_defineProperties(e,n),e}(GLUniformBufferObject,[{key:"bindingPoint",get:function get(){return this._bindingPoint},set:function set(e){this._bindingPoint=e}},{key:"byteLength",get:function get(){return this._byteLength},set:function set(e){this._byteLength=e}}]),GLUniformBufferObject}();function uniform_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function uniform_createClass(e,t,n){return t&&uniform_defineProperties(e.prototype,t),n&&uniform_defineProperties(e,n),e}function GLShader_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}nt.TYPE_TO_SIZE={float:[4,4],int:[4,4],bool:[4,4],boolean:[4,4],mat4:[64,64],mat3:[48,48],vec4:[16,16],vec3:[16,12],vec2:[8,8]},function(e){var s=function(){function AttributeMap(){this.attributeMap={}}var e=AttributeMap.prototype;return e.add=function add(e,t){this.attributeMap[e]=t},e.remove=function remove(e){this.attributeMap[e]&&(this.attributeMap[e]=void 0)},e.hasAttribute=function hasAttribute(e){return!!this.attributeMap[e]},e.getAttribute=function getAttribute(e){return this.attributeMap[e]},AttributeMap}();e.AttributeMap=s;var u=function(){function GLAttribute(e,t,n,r){this.gl=e,this.type=t,this.size=n,this.location=r}return GLAttribute.prototype.pointer=function pointer(e,t,n,r){this.gl.vertexAttribPointer(this.location,this.size,e||this.gl.FLOAT,t||!1,n||0,r||0)},GLAttribute}();e.GLAttribute=u,e.extract=function extract(e,t){for(var n=new s,r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var o=e.getActiveAttrib(t,i),a=S.map(e,o.type);n.add(o.name,new u(e,a,c.map(a),e.getAttribLocation(t,o.name)))}return n}}(Ze||(Ze={})),function(e){function compileShader(e,t,n){var r=e.createShader(t);return null==r?(console.error("Unable to create shader"),null):(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error("Failed to compile shader: "+e.getShaderInfoLog(r)),e.deleteShader(r),null))}(et||(et={})).compile=function compile(e,t,n){var r=compileShader(e,e.VERTEX_SHADER,t),i=compileShader(e,e.FRAGMENT_SHADER,n);if(r&&i){var o=e.createProgram();return o?(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||(console.error("Shader Program Linking failed. Could not initialize Shader."),console.error("gl.VALIDATE_STATUS "+e.getProgramParameter(o,e.VALIDATE_STATUS)),console.error("gl.getError(): "+e.getError()),""!==e.getProgramInfoLog(o)&&console.warn("gl.getProgramInfoLog(): "+e.getProgramInfoLog(o)),e.deleteProgram(o),o=null),e.deleteShader(r),e.deleteShader(i),o):(console.error("Failed to create Programm"),null)}}}(),function(e){var h=["return this.data.%%.value;"].join("\n"),p=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),m={float:"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])",int:"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)",samplerCube:"uniform1i(location, value)",ubo:"uniformBlockBinding(this.program, location, value)"},_={float:"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)",int:"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)",samplerCube:"uniform1iv(location, value)"},f=function Uniform(e,t,n,r){this.type=e,this.size=t,this.location=n,this.value=r};e.Uniform=f;var g=function(){function UniformMap(){this.uniformMap={}}var e=UniformMap.prototype;return e.add=function add(e,t){this.uniformMap[e]=t},e.get=function get(e){return this.uniformMap[e]},e.remove=function remove(e){this.uniformMap[e]&&(this.uniformMap[e]=void 0)},uniform_createClass(UniformMap,[{key:"keys",get:function get(){return Object.keys(this.uniformMap)}}]),UniformMap}();e.UniformMap=g;var y=function(){function UniformAccessObject(e,t){this.data={},this._gl=e,this._program=t}return uniform_createClass(UniformAccessObject,[{key:"gl",get:function get(){return this._gl},set:function set(e){this._gl=e}},{key:"program",get:function get(){return this._program},set:function set(e){this._program=e}}]),UniformAccessObject}();function getUniformGroup(e,t){for(var n=t,r=0;r<e.length-1;r++){var i=n[e[r]]||{data:{}};n[e[r]]=i,n=i}return n}e.UniformAccessObject=y,e.extract=function extract(e,t){for(var n=new g,r=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS),i=0;i<r;i++){var o=e.getActiveUniformBlockName(t,i);o=o.replace(/\[.*?\]/,""),n.add(o,new f("ubo",1,i,null))}for(var a=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),s=0;s<a;s++){var u=e.getActiveUniform(t,s),c=u.name.replace(/\[.*?\]/,""),l=S.map(e,u.type),d=e.getUniformLocation(t,c);null!=d&&n.add(c,new f(l,u.size,e.getUniformLocation(t,c),v.value(l,u.size)))}return n},e.generateUniformAccessObject=function generateUniformAccessObject(e,t,n){for(var r,i,o=new y(e,n),a=t.keys,s=0;s<a.length;s++){var u=a[s],c=u.split("."),l=c[c.length-1],d=getUniformGroup(c,o),f=t.get(u);d.data[l]=f,d.gl=e,Object.defineProperty(d,l,(i=f,{get:function generateGetter(e){var t=h.replace("%%",e);return new Function(t)}(r=l),set:function generateSetter(e,t){var n,r=p.replace(/%%/g,e);return(n=1===t.size?m[t.type]:_[t.type])&&(r+="\nthis.gl."+n+";"),new Function("value",r)}(r,i)}))}return o}}(tt||(tt={}));var rt,it,ot=function(){function GLShader(e,t,n){this.gl=e,this._defines=Object.create(null),this._vertexSrc=t,this._fragmentSrc=n}var e=GLShader.prototype;return e.getDefinesString=function getDefinesString(){var e="";for(var t in this._defines)e+="#define "+t+" "+this._defines[t]+"\n";return e},e.getShaderSrcWithDefines=function getShaderSrcWithDefines(e){var t=this.getDefinesString(),n=e.indexOf("\n"),r=e.substr(0,n),i=e.substr(n);return-1!=r.indexOf("#version")?r+t+i:t+r+i},e.upload=function upload(){var e=this.gl,t=this.getShaderSrcWithDefines(this._vertexSrc),n=this.getShaderSrcWithDefines(this._fragmentSrc);this._program=et.compile(e,t,n),this._attributes=Ze.extract(e,this._program);var r=tt.extract(e,this._program);return this._uniforms=tt.generateUniformAccessObject(e,r,this._program),this},e.addDefine=function addDefine(e,t){this._defines[e]=t},e.removeDefine=function removeDefine(e,t){delete this._defines[e]},e.bind=function bind(){return this.gl.useProgram(this.program),this},e.unbind=function unbind(){return this.gl.useProgram(null),this},e.unload=function unload(){this.gl.deleteProgram(this.program),this._program=null,this._attributes=null,this._uniforms=null,this._defines=Object.create(null)},e.destroy=function destroy(){this.gl.deleteProgram(this.program),this.gl=null,this._program=null,this._attributes=null,this._uniforms=null,this._defines=null,this._vertexSrc=null,this._fragmentSrc=null},function GLShader_createClass(e,t,n){return t&&GLShader_defineProperties(e.prototype,t),n&&GLShader_defineProperties(e,n),e}(GLShader,[{key:"program",get:function get(){return this._program},set:function set(e){this._program=e}},{key:"attributes",set:function set(e){this._attributes=e},get:function get(){return this._attributes}},{key:"uniforms",set:function set(e){this.uniforms=e},get:function get(){return this._uniforms}},{key:"defines",get:function get(){return this._defines},set:function set(e){this._defines=e}},{key:"vertexSrc",get:function get(){return this._vertexSrc},set:function set(e){this._vertexSrc=e}},{key:"fragmentSrc",get:function get(){return this._fragmentSrc},set:function set(e){this._fragmentSrc=e}}]),GLShader}();(it=rt||(rt={}))[it.TEXTURE=0]="TEXTURE",it[it.MESH=1]="MESH",it[it.SCENE=2]="SCENE",it[it.ANIMATION=3]="ANIMATION",it[it.MATERIAL=4]="MATERIAL",it[it.SHADER=5]="SHADER",it[it.NOOP=6]="NOOP";var at=function(){function Cache(){this.caches=[]}var e=Cache.prototype;return e.addCache=function addCache(e,t){this.caches[e]=t},e.removeCache=function removeCache(e){this.caches.splice(e,1)},e.getCache=function getCache(e){return this.caches[e]},e.add=function add(e,t,n){this.caches[e]&&this.caches[e].add(t,n)},e.get=function get(e,t){if(this.caches[e])return this.caches[e].get(t)},e.has=function has(e,t){return!!this.caches[e]&&!!this.caches[e].get(t)},Cache}();function EmitSignal_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var st,ut,ct=function(){function EmitSignal(e,t){this._type=t,this._emitter=e}var e=EmitSignal.prototype;return e.emit=function emit(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this._emitter).emit.apply(e,[this._type].concat(n))},e.dispatch=function dispatch(){return this.emit.apply(this,arguments)},e.on=function on(e,t){return this._emitter.on(this._type,e,t),this},e.add=function add(e,t){return this.on(e,t)},e.once=function once(e,t){return this._emitter.once(this._type,e,t),this},e.addOnce=function addOnce(e,t){return this.once(e,t)},e.removeAllListeners=function removeAllListeners(){return this._emitter.removeAllListeners(this._type),this},e.removeListener=function removeListener(e,t,n){return this._emitter.removeListener(this._type,e,t,n),this},function EmitSignal_createClass(e,t,n){return t&&EmitSignal_defineProperties(e.prototype,t),n&&EmitSignal_defineProperties(e,n),e}(EmitSignal,[{key:"type",get:function get(){return this._type}},{key:"emitter",get:function get(){return this._emitter}}]),EmitSignal}();function baseCache_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(ut=st||(st={})).ADDED="ADDED",ut.REMOVED="REMOVED";var lt=function(){function BaseCache(){this.cache={},this.emitter=new R,this._onAdded=new ct(this.emitter,st.ADDED),this._onRemoved=new ct(this.emitter,st.REMOVED)}var e=BaseCache.prototype;return e.add=function add(e,t){this.cache[e]=t,this._onAdded.emit(e,t)},e.addMultiple=function addMultiple(e,t){for(var n,r=0;n=e[r];r++){var i=t(n);this.add(i.key,i.data)}},e.remove=function remove(e){var t=this.cache[e];delete this.cache[e],this._onRemoved.emit(e,t)},e.get=function get(e){return this.cache[e]},e.getAll=function getAll(){return this.cache},function baseCache_createClass(e,t,n){return t&&baseCache_defineProperties(e.prototype,t),n&&baseCache_defineProperties(e,n),e}(BaseCache,[{key:"onAdded",get:function get(){return this._onAdded}},{key:"onRemoved",get:function get(){return this._onRemoved}}]),BaseCache}();var dt=function(n){function CubemapLoader(e){var t;return(t=n.call(this,rt.TEXTURE)||this).gl=e,t}!function CubemapLoader_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(CubemapLoader,n);var e=CubemapLoader.prototype;return e.add=function add(e,t){for(var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{id:0},i=[],o=0;n=t[o];o++)for(var a,s=Object.keys(n),u=0;a=n[s[u]];u++)i.push({resource:new L({url:a,loadType:T.IMAGE},Object.assign({},r,{face:u,level:o}))});return this.addResourceToQueue({key:e,resources:i})},e.transform=function transform(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.sort(function(e,t){return e.config.face-t.config.face+6*(e.config.level-t.config.level)}).map(function(e){return e.request}),i=t[0].config,o=te.cubemapFromSource(this.gl,r,i.flipY,i.premultiplyAlpha,i.id,i.internalFormat,i.format,i.type);return i.flipY&&o.flipY(1),i.sampler&&(i.sampler.minFilter===q.LINEAR||i.sampler.minFilter===q.NEAREST||i.sampler.minFilter===q.LINEAR_MIPMAP_LINEAR||i.sampler.minFilter===q.LINEAR_MIPMAP_NEAREST||i.sampler.minFilter===q.NEAREST_MIPMAP_LINEAR||i.sampler.minFilter===q.NEAREST_MIPMAP_NEAREST?o.setMinFilter(i.sampler.minFilter):ee.isPowerOf2(o.width)&&ee.isPowerOf2(o.height)?o.setMinFilter(q.LINEAR_MIPMAP_LINEAR):o.setMinFilter(q.LINEAR),i.sampler.magFilter===W.LINEAR||i.sampler.magFilter===W.NEAREST?o.setMagFilter(i.sampler.magFilter):o.setMagFilter(W.LINEAR),i.sampler.wrapS===Q.CLAMP_TO_EDGE||i.sampler.wrapS===Q.MIRRORED_REPEAT||i.sampler.wrapS===Q.REPEAT?o.setWrapS(i.sampler.wrapS):o.setWrapS(Q.REPEAT),i.sampler.wrapT===Q.CLAMP_TO_EDGE||i.sampler.wrapT===Q.MIRRORED_REPEAT||i.sampler.wrapT===Q.REPEAT?o.setWrapT(i.sampler.wrapT):o.setWrapT(Q.REPEAT)),o},CubemapLoader}(B);var ft,ht,pt,mt,_t=function(n){function TextureLoader(e){var t;return(t=n.call(this,rt.TEXTURE)||this).gl=e,t}!function TextureLoader_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(TextureLoader,n);var e=TextureLoader.prototype;return e.add=function add(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{id:0,sampler:{wrapS:Q.REPEAT,wrapT:Q.REPEAT}};return this.addResourceToQueue({key:e,resources:[{resource:new L({url:t,loadType:T.IMAGE},n)}]})},e.transform=function transform(e){var t=e.config,n=e.request,r=ee.fromSource(this.gl,n,t.premultiplyAlpha,t.id,t.internalFormat,t.format,t.type);return t.flipY&&r.flipY(1),t.sampler&&(t.sampler.minFilter===q.LINEAR||t.sampler.minFilter===q.NEAREST||t.sampler.minFilter===q.LINEAR_MIPMAP_LINEAR||t.sampler.minFilter===q.LINEAR_MIPMAP_NEAREST||t.sampler.minFilter===q.NEAREST_MIPMAP_LINEAR||t.sampler.minFilter===q.NEAREST_MIPMAP_NEAREST?r.setMinFilter(t.sampler.minFilter):ee.isPowerOf2(r.width)&&ee.isPowerOf2(r.height)?r.setMinFilter(q.LINEAR_MIPMAP_LINEAR):r.setMinFilter(q.LINEAR),t.sampler.magFilter===W.LINEAR||t.sampler.magFilter===W.NEAREST?r.setMagFilter(t.sampler.magFilter):r.setMagFilter(W.LINEAR),t.sampler.wrapS===Q.CLAMP_TO_EDGE||t.sampler.wrapS===Q.MIRRORED_REPEAT||t.sampler.wrapS===Q.REPEAT?r.setWrapS(t.sampler.wrapS):r.setWrapS(Q.REPEAT),t.sampler.wrapT===Q.CLAMP_TO_EDGE||t.sampler.wrapT===Q.MIRRORED_REPEAT||t.sampler.wrapT===Q.REPEAT?r.setWrapT(t.sampler.wrapT):r.setWrapT(Q.REPEAT)),r},TextureLoader}(B);function material_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(ht=ft||(ft={}))[ht.PBR=0]="PBR",(mt=pt||(pt={}))[mt.ALBEDO=0]="ALBEDO",mt[mt.NORMAL=1]="NORMAL",mt[mt.OCCLUSION=2]="OCCLUSION",mt[mt.EMISSIVE=3]="EMISSIVE",mt[mt.METAL_ROUGHNESS=4]="METAL_ROUGHNESS";var gt=function(){function Material(e,t){this._type=ft.PBR,this.name=e,this._maps=[],this._model=t}return Material.prototype.hasMap=function hasMap(e){return!!this._maps[e]},function material_createClass(e,t,n){return t&&material_defineProperties(e.prototype,t),n&&material_defineProperties(e,n),e}(Material,[{key:"name",get:function get(){return this._name},set:function set(e){this._name=e}},{key:"maps",get:function get(){return this._maps},set:function set(e){this._maps=e}},{key:"model",get:function get(){return this._model},set:function set(e){this._model=e}},{key:"type",get:function get(){return this._type},set:function set(e){this._type=e}}]),Material}();function materialmap_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var yt=function(){function Materialmap(e,t){this._texture=e,this._sampler=t}return function materialmap_createClass(e,t,n){return t&&materialmap_defineProperties(e.prototype,t),n&&materialmap_defineProperties(e,n),e}(Materialmap,[{key:"texture",get:function get(){return this._texture},set:function set(e){this._texture=e}},{key:"sampler",get:function get(){return this._sampler},set:function set(e){this._sampler=e}}]),Materialmap}();function metallicRoughness_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var vt=function(){function MetallicRoughness(){this._baseColorFactor=a.fromValues(1,1,1,1),this._metallicFactor=1,this._roughnessFactor=1,this._normalScale=1,this._occlusionStrength=1,this._emissiveFactor=b.create()}return function metallicRoughness_createClass(e,t,n){return t&&metallicRoughness_defineProperties(e.prototype,t),n&&metallicRoughness_defineProperties(e,n),e}(MetallicRoughness,[{key:"baseColorFactor",get:function get(){return this._baseColorFactor},set:function set(e){this._baseColorFactor=e}},{key:"metallicFactor",get:function get(){return this._metallicFactor},set:function set(e){this._metallicFactor=e}},{key:"roughnessFactor",get:function get(){return this._roughnessFactor},set:function set(e){this._roughnessFactor=e}},{key:"emissiveFactor",get:function get(){return this._emissiveFactor},set:function set(e){this._emissiveFactor=e}},{key:"normalScale",get:function get(){return this._normalScale},set:function set(e){this._normalScale=e}},{key:"occlusionStrength",get:function get(){return this._occlusionStrength},set:function set(e){this._occlusionStrength=e}}]),MetallicRoughness}(),bt=function(){function GLTFMaterialProcessor(e){this.model=e,this.materialCache=this.model.cache.getCache(rt.MATERIAL)}var e=GLTFMaterialProcessor.prototype;return e.processMaterial=function processMaterial(e){var t,n=this.model.gltf,r=this.model.gl,i=n.materials[e],o=this.materialCache.get(i.name);if(o)return o;if(i.name=i.name||"material"+e,i.extensions&&i.extensions.KHR_materials_pbrSpecularGlossiness)throw"specular glossiness gltf is not supported";return t=new gt(i.name),this.parsePBRMaterial(i,t),i.emissiveFactor&&t.model.emissiveFactor.set(i.emissiveFactor),i.emissiveTexture&&this.parseTexture(t,i.emissiveTexture.index,pt.EMISSIVE,{premultiplyAlpha:!1,internalFormat:r.SRGB8_ALPHA8,format:r.RGBA,type:r.UNSIGNED_BYTE}),i.normalTexture&&(t.model.normalScale=i.normalTexture.scale||1,this.parseTexture(t,i.normalTexture.index,pt.NORMAL,{premultiplyAlpha:!1,internalFormat:r.RGBA,format:r.RGBA,type:r.UNSIGNED_BYTE})),i.occlusionTexture&&(t.model.occlusionStrength=i.occlusionTexture.strength||1,this.parseTexture(t,i.occlusionTexture.index,pt.OCCLUSION,{premultiplyAlpha:!1,internalFormat:r.RGBA,format:r.RGBA,type:r.UNSIGNED_BYTE})),this.materialCache.add(t.name,t),t},e.parsePBRMaterial=function parsePBRMaterial(e,t){var n=e.pbrMetallicRoughness;t.type=ft.PBR;var r=this.model.gl;t.model||(t.model=new vt),n.baseColorFactor&&t.model.baseColorFactor.set(n.baseColorFactor),null!==n.metallicFactor&&void 0!==n.metallicFactor&&(t.model.metallicFactor=n.metallicFactor),null!==n.roughnessFactor&&void 0!==n.roughnessFactor&&(t.model.roughnessFactor=n.roughnessFactor),void 0!==n.baseColorTexture&&null!==n.baseColorTexture&&this.parseTexture(t,n.baseColorTexture.index,pt.ALBEDO,{premultiplyAlpha:!1,internalFormat:r.SRGB8_ALPHA8,format:r.RGBA,type:r.UNSIGNED_BYTE}),void 0!==n.metallicRoughnessTexture&&null!==n.metallicRoughnessTexture&&this.parseTexture(t,n.metallicRoughnessTexture.index,pt.METAL_ROUGHNESS,{premultiplyAlpha:!1,internalFormat:r.RGBA,format:r.RGBA,type:r.UNSIGNED_BYTE})},e.parseTexture=function parseTexture(e,t,n,r){if(null!=t){var i,o=this.model.gltf,a=this.model.loader,s=this.model.path;void 0!==o.textures[t].source&&null!==o.textures[t].source&&(i=o.images[o.textures[t].source]),void 0!==o.textures[t].sampler&&null!==o.textures[t].sampler?r.sampler=o.samplers[o.textures[t].sampler]:r.sampler={wrapS:Q.REPEAT,wrapT:Q.REPEAT},a.get(_t).add(i.name||i.uri,s+i.uri,r),e.maps[n]=new yt(i.name||i.uri),e.maps[n].sampler=r.sampler}},GLTFMaterialProcessor}();function mesh_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Et=function(){function Mesh(){this._primitives=[],this._bufferViews=Object.create(null)}var e=Mesh.prototype;return e.init=function init(e,t,n){return this.initBuffers(e,t,n),this.setIndexBuffers(e),this},e.initBuffers=function initBuffers(e,t,n){for(var r,i=Object.keys(this._bufferViews),o=0;r=this._bufferViews[i[o]];o++)if(null===r.buffer||void 0===r.buffer){var a=void 0;a=r.target===z.ARRAY_BUFFER?t||ne.create(e,r.target,null,r.drawType):n||ne.create(e,r.target,null,r.drawType),r.bufferOffset=a.byteLength,a.addData(r.data),r.buffer=a}},e.setIndexBuffers=function setIndexBuffers(e){for(var t,n=0;t=this._primitives[n];n++)if(t.indices&&void 0!==t.indices.bufferView&&null!==t.indices.bufferView){var r=this._bufferViews[t.indices.bufferView];t.initVertexArrayObject(e,r.buffer)}},e.upload=function upload(){for(var e,t=Object.keys(this._bufferViews),n=0;e=this._bufferViews[t[n]];n++){if(!e.buffer)throw"Failed to upload buffer for bufferView, did you forget to initialize the buffer first?";e.buffer.upload()}return this},e.draw=function draw(e,t){e.applyMesh(this);for(var n,r=0;n=this._primitives[r];r++){var i=this._bufferViews[n.indices.bufferView].bufferOffset+n.indices.byteOffset;e.applyMaterial(t.get(rt.MATERIAL,n.material)),n.draw(n.draw_mode,n.indices.count,n.indices.componentType,i)}},e.addAttribute=function addAttribute(e,t){for(var n,r=0;n=this._primitives[r];r++){var i=n.attributes[e];if(null!=i){var o=this._bufferViews[i.bufferView],a=o.buffer,s=o.bufferOffset+i.byteOffset;n.vertexArrayObject.addAttribute(a,t,i.componentTypeCount,i.componentType,i.normalized,i.stride,s)}}},e.hasAttribute=function hasAttribute(e){for(var t,n=0;t=this._primitives[n];n++)if(t.hasAttribute(e))return!0;return!1},e.hasMap=function hasMap(e,t){for(var n,r=0;n=this._primitives[r];r++){var i=e.get(rt.MATERIAL,n.material);if(i)return i.hasMap(t)}},e.unload=function unload(){},e.addPrimitive=function addPrimitive(e){return this._primitives.push(e),e},e.addBufferView=function addBufferView(e,t){this._bufferViews[e]=t},function mesh_createClass(e,t,n){return t&&mesh_defineProperties(e.prototype,t),n&&mesh_defineProperties(e,n),e}(Mesh,[{key:"primitives",get:function get(){return this._primitives},set:function set(e){this._primitives=e}},{key:"name",get:function get(){return this._name},set:function set(e){this._name=e}}]),Mesh}();function scene_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var St=function(){function Scene(){this._nodes=[],this._meshes=[],this._animations=[]}var e=Scene.prototype;return e.init=function init(e,t,n){for(var r,i=0;r=this._nodes[i];i++)r.init(e,t,n);return this},e.upload=function upload(){for(var e,t=0;e=this._nodes[t];t++)e.upload();return this},e.draw=function draw(e,t){for(var n,r=0;n=this._nodes[r];r++)e.applyScene(this),n.draw(e,t)},e.addAttribute=function addAttribute(e,t){for(var n,r=0;n=this._nodes[r];r++)n.addAttribute(e,t)},e.addNode=function addNode(){for(var e,t=0;e=t<0||arguments.length<=t?void 0:arguments[t];t++)this._nodes.push(e)},function scene_createClass(e,t,n){return t&&scene_defineProperties(e.prototype,t),n&&scene_defineProperties(e,n),e}(Scene,[{key:"name",get:function get(){return this._name},set:function set(e){this._name=e}},{key:"meshes",get:function get(){return this._meshes},set:function set(e){this._meshes=e}},{key:"animations",get:function get(){return this._animations},set:function set(e){this._animations=e}},{key:"root",get:function get(){return this._nodes[0]}}]),Scene}(),At=function(){function SceneNode(){this.children=[]}var e=SceneNode.prototype;return e.init=function init(e,t,n){this.mesh&&this.mesh.init(e,t,n),this.skin&&this.skin.init(e);for(var r,i=0;r=this.children[i];i++)r.init(e,t,n);return this},e.upload=function upload(){this.mesh&&this.mesh.upload();for(var e,t=0;e=this.children[t];t++)e.upload();return this},e.draw=function draw(e,t){this.mesh&&(e.applyNode(this),this.mesh.draw(e,t));for(var n,r=0;n=this.children[r];r++)n.draw(e,t)},e.addAttribute=function addAttribute(e,t){this.mesh&&this.mesh.addAttribute(e,t);for(var n,r=0;n=this.children[r];r++)n.addAttribute(e,t)},e.addChild=function addChild(e){this.children.push(e)},SceneNode}();var Ct=function(r){function Shader(e,t,n){return r.call(this,e,t,n)||this}!function shader_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(Shader,r);var e=Shader.prototype;return e.apply=function apply(){},e.applyMaterial=function applyMaterial(e){},e.applyMesh=function applyMesh(e){},e.applyNode=function applyNode(e){},e.applyScene=function applyScene(e){},Shader}(ot);function transform_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Tt=function(){function Transform(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}};this.init(e)}var e=Transform.prototype;return e.init=function init(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}};this._localMatrix=u.create(),e||(e=Object.create(null)),e.position||(e.position={x:0,y:0,z:0}),e.rotation||(e.rotation={x:0,y:0,z:0,w:1}),e.scale||(e.scale={x:1,y:1,z:1}),this._rotation=E.fromValues(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),this._translation=b.fromValues(e.position.x,e.position.y,e.position.z),this._scale=b.fromValues(e.scale.x,e.scale.y,e.scale.z),this._children=[],this._level=0,this._dirty=!0,this._worldMatrix=u.create(),this.apply()},e.addChild=function addChild(e){e._parent&&e._parent.removeChild(e),e._parent=this,e._level=this._level+1,this._children.push(e)},e.removeChild=function removeChild(e){var t=this._children.indexOf(e);-1<t&&(e._level=0,e._parent=void 0,this._children.splice(t,1))},e.apply=function apply(){return this._dirty&&(u.fromRotationTranslationScale(this._localMatrix,this._rotation,this._translation,this._scale),this._dirty=!1),this._localMatrix},function transform_createClass(e,t,n){return t&&transform_defineProperties(e.prototype,t),n&&transform_defineProperties(e,n),e}(Transform,[{key:"worldMatrix",get:function get(){return this._parent?u.multiply(this._worldMatrix,this._parent.worldMatrix,this.localMatrix):this.apply()}},{key:"modelMatrix",get:function get(){return this.worldMatrix}},{key:"localMatrix",get:function get(){return this.apply()},set:function set(e){u.getRotation(this._rotation,e),u.getTranslation(this._translation,e),u.getScaling(this._scale,e),this._dirty=!0}},{key:"translation",get:function get(){return this._dirty=!0,this._translation},set:function set(e){this._dirty=!0,this._translation=e}},{key:"rotation",get:function get(){return this._dirty=!0,this._rotation},set:function set(e){this._dirty=!0,this._rotation=e}},{key:"scale",get:function get(){return this._dirty=!0,this._scale},set:function set(e){this._dirty=!0,this._scale=e}},{key:"level",get:function get(){return this._level}},{key:"parent",get:function get(){return this._parent},set:function set(e){this._parent=e}},{key:"children",get:function get(){return this._children},set:function set(e){this._children=e}},{key:"dirty",get:function get(){return this._dirty}}]),Transform}();function animation_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var wt,Mt,Rt=function(){function Animation(){this.samplers=[],this.channels=[],this._duration=0}var e=Animation.prototype;return e.addSampler=function addSampler(e){this.samplers.push(e)},e.addChannel=function addChannel(e){this.channels.push(e)},e.animate=function animate(e){for(var t,n=.001*e,r=0;t=this.samplers[r];r++)t.update(n);for(var i,o=0;i=this.channels[o];o++){var a=this.samplers[i.sampler],s=i.node;switch(i.path){case"rotation":E.copy(s.transform.rotation,a.value);break;case"translation":b.copy(s.transform.translation,a.value);break;case"scale":b.copy(s.transform.scale,a.value)}}},function animation_createClass(e,t,n){return t&&animation_defineProperties(e.prototype,t),n&&animation_defineProperties(e,n),e}(Animation,[{key:"duration",get:function get(){return this._duration},set:function set(e){this._duration=e}},{key:"durationMS",get:function get(){return 1e3*this._duration},set:function set(e){this._duration=.001*e}}]),Animation}(),xt=function AnimationChannel(){};function animationSampler_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(Mt=wt||(wt={})).LINEAR="LINEAR",Mt.STEP="STEP",Mt.CUBICSPLINE="CUBICSPLINE";var Ot,Pt,Lt,kt=function(){function AnimationSampler(){this._interpolation=wt.LINEAR,this.prevValue=a.create(),this.nextValue=a.create(),this._value=a.create(),this._duration=0}var e=AnimationSampler.prototype;return e.updateValue=function updateValue(e,t){var n=this._componentTypeCount,r=e*n,i=r+n+2<=this._outputData.length?r+n:r,o=4===n?E.slerp:a.lerp;a.set(this.prevValue,this._outputData[r],this._outputData[r+1],this._outputData[r+2],3===n?0:this._outputData[r+3]),a.set(this.nextValue,this._outputData[i],this._outputData[i+1],this._outputData[i+2],3===n?0:this._outputData[i+3]),o(this._value,this.prevValue,this.nextValue,t)},e.update=function update(e){for(var t=0;t<this._inputData.length-2&&e>=this._inputData[t+1];)t++;var n=this._inputData[t],r=this._inputData[t+1],i=Math.min(Math.max(0,(e-n)/(r-n)),1);this.updateValue(t,i)},function animationSampler_createClass(e,t,n){return t&&animationSampler_defineProperties(e.prototype,t),n&&animationSampler_defineProperties(e,n),e}(AnimationSampler,[{key:"value",get:function get(){return this._value}},{key:"duration",get:function get(){return this._duration},set:function set(e){this._duration=e}},{key:"interpolation",get:function get(){return this._interpolation},set:function set(e){this._interpolation=e}},{key:"inputData",get:function get(){return this._inputData},set:function set(e){this._inputData=e}},{key:"outputData",get:function get(){return this._outputData},set:function set(e){this._outputData=e}},{key:"componentTypeCount",get:function get(){return this._componentTypeCount},set:function set(e){this._componentTypeCount=e}}]),AnimationSampler}();function accessor_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(Lt=Pt||(Pt={})).SCALAR="SCALAR",Lt.VEC2="VEC2",Lt.VEC3="VEC3",Lt.VEC4="VEC4",Lt.MAT2="MAT2",Lt.MAT3="MAT3",Lt.MAT4="MAT4";var Dt=(_defineProperty(Ot={},Pt.SCALAR,1),_defineProperty(Ot,Pt.VEC2,2),_defineProperty(Ot,Pt.VEC3,3),_defineProperty(Ot,Pt.VEC4,4),_defineProperty(Ot,Pt.MAT2,4),_defineProperty(Ot,Pt.MAT3,9),_defineProperty(Ot,Pt.MAT4,16),Ot),Bt=function(){function Accessor(){this._byteOffset=0,this._componentType=U.FLOAT,this._stride=0,this._normalized=!1,this._max=[],this._min=[]}return function accessor_createClass(e,t,n){return t&&accessor_defineProperties(e.prototype,t),n&&accessor_defineProperties(e,n),e}(Accessor,[{key:"bufferView",get:function get(){return this._bufferView},set:function set(e){this._bufferView=e}},{key:"byteOffset",get:function get(){return this._byteOffset},set:function set(e){this._byteOffset=e}},{key:"componentType",get:function get(){return this._componentType},set:function set(e){this._componentType=e}},{key:"stride",get:function get(){return this._stride},set:function set(e){this._stride=e}},{key:"normalized",get:function get(){return this._normalized},set:function set(e){this._normalized=e}},{key:"componentTypeCount",get:function get(){return Dt[this._type]}},{key:"count",get:function get(){return this._count},set:function set(e){this._count=e}},{key:"max",get:function get(){return this._max},set:function set(e){this._max=e}},{key:"min",get:function get(){return this._min},set:function set(e){this._min=e}},{key:"type",get:function get(){return this._type},set:function set(e){this._type=e}}]),Accessor}(),It=function BufferView(){this.bufferOffset=0,this.drawType=z.STATIC_DRAW};function primitive_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Nt=function(){function Primitive(){this._attributes=Object.create(null),this._draw_mode=4,this._material="__default__"}var e=Primitive.prototype;return e.hasAttribute=function hasAttribute(e){return!!this._attributes[e]},e.addAttribute=function addAttribute(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,a=6<arguments.length?arguments[6]:void 0,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[],u=8<arguments.length&&void 0!==arguments[8]?arguments[8]:[],c=new Bt;return c.bufferView=a,c.type=t,c.componentType=n,c.normalized=r,c.stride=i,c.byteOffset=o,c.min=s,c.max=u,this._attributes[e]=c,this._attributes[e]},e.setIndices=function setIndices(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length?arguments[3]:void 0;return this._indices=new Bt,this._indices.bufferView=r,this._indices.count=e,this._indices.componentType=t,this._indices.byteOffset=n,this._indices},e.initVertexArrayObject=function initVertexArrayObject(e,t,n){this._vertexArrayObject=n||new re(e),this._vertexArrayObject.setIndexBuffer(t)},e.draw=function draw(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._draw_mode,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._indices.count,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._indices.componentType,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this._indices.byteOffset;this._vertexArrayObject&&(this._vertexArrayObject.bind(),this._vertexArrayObject.draw(e,t,n,r),this._vertexArrayObject.unbind())},function primitive_createClass(e,t,n){return t&&primitive_defineProperties(e.prototype,t),n&&primitive_defineProperties(e,n),e}(Primitive,[{key:"name",get:function get(){return this._name},set:function set(e){this._name=e}},{key:"draw_mode",get:function get(){return this._draw_mode},set:function set(e){this._draw_mode=e}},{key:"attributes",get:function get(){return this._attributes},set:function set(e){this._attributes=e}},{key:"indices",get:function get(){return this._indices},set:function set(e){this._indices=e}},{key:"material",get:function get(){return this._material},set:function set(e){this._material=e}},{key:"vertexArrayObject",get:function get(){return this._vertexArrayObject},set:function set(e){this._vertexArrayObject=e}}]),Primitive}();function skin_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ft=function(){function Skin(){this._joints=[],this._inverseBindMatrices=[],this._jointMatrices=[],this._data=new Float32Array(1040),this._dirty=!0}var e=Skin.prototype;return e.init=function init(e){for(var t=0;t<this._joints.length;t++)this._jointMatrices.push(u.create());this._ubo=new nt(e,i.SKIN),this._ubo.addItem("matrix","mat4",this._data),this._ubo.upload(),this._ubo.bindUBO()},e.update=function update(){if(this._dirty){for(var e,t=0;e=this._jointMatrices[t];t++)this._data.set(e,16*t);this._ubo.updateItem("matrix",this._data,!0),this._dirty=!1}},function skin_createClass(e,t,n){return t&&skin_defineProperties(e.prototype,t),n&&skin_defineProperties(e,n),e}(Skin,[{key:"joints",get:function get(){return this._joints},set:function set(e){this._joints=e}},{key:"skeleton",get:function get(){return this._skeleton},set:function set(e){this._skeleton=e}},{key:"inverseBindMatrices",get:function get(){return this._inverseBindMatrices},set:function set(e){this._inverseBindMatrices=e}},{key:"jointMatrices",get:function get(){return this._dirty=!0,this._jointMatrices},set:function set(e){this._dirty=!0,this._jointMatrices=e}},{key:"ubo",get:function get(){return this._ubo},set:function set(e){this._ubo=e}}]),Skin}();function GLTFMeshProcessor_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ut=function(){function GLTFMeshProcessor(e){this.model=e,this._meshes=[],this.cache=this.model.cache.getCache(rt.MESH)}var e=GLTFMeshProcessor.prototype;return e.processMesh=function processMesh(e){if(this._meshes[e])return this._meshes[e];var t=new Et,n=this.model.gltf.meshes[e];t.name=n.name||"mesh"+e;for(var r,i=0;r=n.primitives[i];i++)t.addPrimitive(this.parsePrimitives(t,r));return this._meshes[e]=t,this.cache.add(t.name,t),t},e.parsePrimitives=function parsePrimitives(e,t){var n=this.model.gltf,r=new Nt;for(var i in t.attributes){var o=n.accessors[t.attributes[i]];this.addAttribute(r,i,o),e.addBufferView(o.bufferView,this.model.getBufferView(o.bufferView))}if(void 0!==t.indices&&null!==t.indices){var a=n.accessors[t.indices];this.setIndices(r,a),e.addBufferView(a.bufferView,this.model.getBufferView(a.bufferView,!0))}return r.draw_mode=t.mode||4,this.setMeshMaterial(r,t.material),r},e.addAttribute=function addAttribute(e,t,n){var r=this.model.gltf.bufferViews[n.bufferView];e.addAttribute(t,n.type,n.componentType,n.normalized,r.byteStride||0,n.byteOffset,n.bufferView,n.min,n.max)},e.setMeshMaterial=function setMeshMaterial(e,t){e.material=null!=t?this.model.getMaterial(t).name:"__default__"},e.setIndices=function setIndices(e,t){e.setIndices(t.count,t.componentType,t.byteOffset||0,t.bufferView)},function GLTFMeshProcessor_createClass(e,t,n){return t&&GLTFMeshProcessor_defineProperties(e.prototype,t),n&&GLTFMeshProcessor_defineProperties(e,n),e}(GLTFMeshProcessor,[{key:"meshes",get:function get(){return this._meshes},set:function set(e){this._meshes=e}}]),GLTFMeshProcessor}(),jt=function(){function GLTFNodeProcessor(e){this.model=e,this.nodes=[]}var e=GLTFNodeProcessor.prototype;return e.processNode=function processNode(e){return this.nodes[e]?this.nodes[e]:this.parseNode(e,this.nodes)},e.parseNode=function parseNode(e,t,n){var r=this.model.gltf.nodes[e];if(t[e])return t[e];var i=new At;i.name=r.name||"node"+e,(t[e]=i).transform=this.parseTransform(r,n),null!==r.mesh&&void 0!==r.mesh&&(i.mesh=this.model.getMesh(r.mesh)),null!==r.skin&&void 0!==r.skin&&(i.skin=this.model.getSkin(r.skin)),r.children=r.children||[];for(var o,a=0;o=r.children[a];a++){var s=this.parseNode(o,t,i);i.addChild(s)}return i},e.parseTransform=function parseTransform(e,t){var n=new Tt;return void 0!==e.matrix&&null!==e.matrix&&(n.localMatrix=u.clone(e.matrix),u.getTranslation(n.translation,n.localMatrix),u.getRotation(n.rotation,n.localMatrix),u.getScaling(n.scale,n.localMatrix)),void 0!==e.translation&&null!==e.translation&&(n.translation=b.clone(e.translation)),void 0!==e.rotation&&null!==e.rotation&&(n.rotation=E.clone(e.rotation)),void 0!==e.scale&&null!==e.scale&&(n.scale=b.clone(e.scale)),t&&t.transform.addChild(n),n},GLTFNodeProcessor}(),Gt=function(){function GLTFAccessorProcessor(e){this.buffers=[],this.model=e}var e=GLTFAccessorProcessor.prototype;return e.getBufferView=function getBufferView(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=this.model.gltf;this.buffers[e]||(this.buffers[e]=this.createBufferView(n.bufferViews[e]));var r=this.buffers[e];return r.target=t?r.target||z.ELEMENT_ARRAY_BUFFER:r.target||z.ARRAY_BUFFER,r},e.getAccessorData=function getAccessorData(e){return this.accessor2TypedArray(this.getBufferView(e.bufferView).data,e.byteOffset,Dt[e.type]*e.count,e.componentType)},e.createBufferView=function createBufferView(e){var t=new It;return t.data=this.sliceBuffer(e),t.target=e.target,t},e.sliceBuffer=function sliceBuffer(e){var t=this.model.data[e.buffer],n=e.byteOffset||0;return t instanceof ArrayBuffer?t.slice(n,n+e.byteLength):t.buffer.slice(n,n+e.byteLength)},e.accessor2TypedArray=function accessor2TypedArray(e,t,n,r){switch(r){case U.BYTE:return new Int8Array(e,t,n);case U.UNSIGNED_BYTE:return new Uint8Array(e,t,n);case U.SHORT:case U.UNSIGNED_SHORT:return new Int16Array(e,t,n);case U.INT:case U.UNSIGNED_INT:return new Int32Array(e,t,n);case U.FLOAT:return new Float32Array(e,t,n)}},GLTFAccessorProcessor}(),Vt=function(){function GLTFSkinProcessor(e){this.model=e,this.skins=[]}return GLTFSkinProcessor.prototype.processSkin=function processSkin(e){if(this.skins[e])return this.skins[e];var t=new Ft,n=this.model.gltf,r=n.skins[e],i=n.accessors[r.inverseBindMatrices];void 0!==r.skeleton&&null!==r.skeleton&&(t.skeleton=this.model.getNode(r.skeleton));for(var o=0;o<r.joints.length;o++)t.joints.push(this.model.getNode(r.joints[o]));if(i)for(var a=this.model.getAccessorData(i),s=0;s<a.length;s+=16)t.inverseBindMatrices.push(u.fromValues(a[s],a[s+1],a[s+2],a[s+3],a[s+4],a[s+5],a[s+6],a[s+7],a[s+8],a[s+9],a[s+10],a[s+11],a[s+12],a[s+13],a[s+14],a[s+15]));return this.skins[e]=t},GLTFSkinProcessor}();function GLTFAnimationProcessor_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ht=function(){function GLTFAnimationProcessor(e){this.model=e,this.cache=this.model.cache.getCache(rt.ANIMATION)}var e=GLTFAnimationProcessor.prototype;return e.processAnimations=function processAnimations(){this._animations=[];var e=this.model.gltf;e.animations=e.animations||[];for(var t=0;t<e.animations.length;t++)this._animations.push(this.processAnimation(t));return this._animations},e.processAnimation=function processAnimation(e){var t=new Rt,n=this.model.gltf.animations[e];t.name=n.name||"animation"+e;for(var r,i=0;r=n.samplers[i];i++){var o=this.processSampler(r);t.addSampler(o),t.duration=t.duration<o.duration?o.duration:t.duration}for(var a,s=0;a=n.channels[s];s++)t.addChannel(this.processChannel(a));return this.cache.add(t.name,t),t},e.processSampler=function processSampler(e){var t=this.model.gltf,n=new kt;n.interpolation=e.interpolation||wt.LINEAR;var r=this.createAccessor(t.accessors[e.input]),i=this.createAccessor(t.accessors[e.output]);return n.inputData=this.model.getAccessorData(r),n.outputData=this.model.getAccessorData(i),n.componentTypeCount=i.componentTypeCount,n.duration=n.inputData[n.inputData.length-1],n},e.processChannel=function processChannel(e){var t=new xt;return t.sampler=e.sampler,t.node=this.model.getNode(e.target.node),t.path=e.target.path,t},e.createAccessor=function createAccessor(e){var t=this.model.gltf,n=new Bt;return n.bufferView=e.bufferView,n.byteOffset=e.byteOffset||0,n.normalized=e.normalized,n.type=e.type,n.componentType=e.componentType,n.count=e.count,n.min=e.min||[],n.max=e.max||[],n.stride=t.bufferViews[e.bufferView].byteStride||0,n},function GLTFAnimationProcessor_createClass(e,t,n){return t&&GLTFAnimationProcessor_defineProperties(e.prototype,t),n&&GLTFAnimationProcessor_defineProperties(e,n),e}(GLTFAnimationProcessor,[{key:"animations",get:function get(){return this._animations},set:function set(e){this._animations=e}}]),GLTFAnimationProcessor}(),zt=function(){function GLTFSceneProcessor(e){this.model=e,this.cache=this.model.cache.getCache(rt.SCENE)}var e=GLTFSceneProcessor.prototype;return e.processScenes=function processScenes(){for(var e,t=this.model.gltf,n=[],r=0;e=t.scenes[r];r++)n.push(this.processScene(e,r));return n[0]},e.processScene=function processScene(e,t){var n=new St;n.name=e.name||"scene"+t;for(var r=0;r<e.nodes.length;r++)n.addNode(this.model.getNode(e.nodes[r]));return this.cache.add(n.name,n),n},GLTFSceneProcessor}(),Yt=function(){function GLTFModel(e,t,n){this.gltf=e,this.data=t,this.cache=n.cache,this.loader=n.loader,this.gl=n.gl,this.path=n.path,this.accessorProcessor=new Gt(this),this.meshProcessor=new Ut(this),this.nodeProcessor=new jt(this),this.materialProcessor=new bt(this),this.skinProcessor=new Vt(this)}var e=GLTFModel.prototype;return e.process=function process(){var e=new zt(this).processScenes();return e.animations=new Ht(this).processAnimations(),e.meshes=this.meshProcessor.meshes,e},e.getSkin=function getSkin(e){return this.skinProcessor.processSkin(e)},e.getMaterial=function getMaterial(e){return this.materialProcessor.processMaterial(e)},e.getNode=function getNode(e){return this.nodeProcessor.processNode(e)},e.getMesh=function getMesh(e){return this.meshProcessor.processMesh(e)},e.getBufferView=function getBufferView(e,t){return this.accessorProcessor.getBufferView(e,t)},e.getAccessorData=function getAccessorData(e){return this.accessorProcessor.getAccessorData(e)},GLTFModel}(),Wt=function(){function Base64Binary(){}return Base64Binary.decodeArrayBuffer=function decodeArrayBuffer(e){var t=e.length/4*3,n=new ArrayBuffer(t);return Base64Binary.decode(e,null,n),n},Base64Binary.removePaddingChars=function removePaddingChars(e){return 64===Base64Binary._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e},Base64Binary.decode=function decode(e,t,n){e=Base64Binary.removePaddingChars(e);var r=parseInt(e.length/4*3,10),i=void 0!==t?r-t:0,o=n?new Uint8Array(n):new Uint8Array(r);e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var a=0,s=0;a<r;a+=3){var u=Base64Binary._keyStr.indexOf(e.charAt(s++)),c=Base64Binary._keyStr.indexOf(e.charAt(s++)),l=Base64Binary._keyStr.indexOf(e.charAt(s++)),d=Base64Binary._keyStr.indexOf(e.charAt(s++)),f=u<<2|c>>4,h=(15&c)<<4|l>>2,p=(3&l)<<6|d;o[a]=f,64!=l&&(o[a+1]=h),64!=d&&(o[a+2]=p)}return o.slice(i,r)},Base64Binary}();function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function GLTFParser_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Wt._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var Xt=function(){function GLTF_Parser(e,t,n){this._path="",this.loader=e,this.gl=t,this.cache=n}var e=GLTF_Parser.prototype;return e.parse=function parse(e,t){var n=[];return t?n.push(t):n.push.apply(n,_toConsumableArray(this.parseBuffers(e))),new Yt(e,n,{path:this._path,gl:this.gl,cache:this.cache,loader:this.loader}).process()},e.parseBuffers=function parseBuffers(e){for(var t=[],n=0;n<e.buffers.length;n++){var r=e.buffers[n],i=Wt.decode(r.uri,r.byteLength);t.push(i)}return t},function GLTFParser_createClass(e,t,n){return t&&GLTFParser_defineProperties(e.prototype,t),n&&GLTFParser_defineProperties(e,n),e}(GLTF_Parser,[{key:"path",get:function get(){return this._path},set:function set(e){this._path=e}}]),GLTF_Parser}();var qt=function(r){function GLTFLoader(e,t){var n;return(n=r.call(this,rt.SCENE)||this).gl=e,n.cache=t,n}!function GLTFLoader_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(GLTFLoader,r);var e=GLTFLoader.prototype;return e.add=function add(e,t,n){var r=n?{resource:new L({url:n,loadType:T.XHR,responseType:"arraybuffer"},{type:"buffer"})}:null,i={resource:new L({url:t,loadType:T.XHR,responseType:"json"},{type:"json"})},o=r?[i,r]:[i];return this.addResourceToQueue({key:e,resources:o})},e.transform=function transform(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.find(function(e){return"json"===e.config.type}),i=t.find(function(e){return"buffer"===e.config.type}),o=r.options.url,a=o.match(/[\w\.]+/g),s=new Xt(this._loader,this.gl,this.cache);return s.path=o.replace(a[a.length-1],""),s.parse(r.request.response,i?i.request.response:void 0)},GLTFLoader}(B),Kt=n(0);var Qt=function(n){function GLSLLoader(e){var t;return(t=n.call(this,rt.SHADER)||this).gl=e,t}!function GLSLLoader_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(GLSLLoader,n);var e=GLSLLoader.prototype;return e.add=function add(e,t,n,r){return this.addResourceToQueue({key:e,resources:[{resource:new L({url:t,loadType:T.XHR,responseType:"text"},{type:"vertex",shader:r})},{resource:new L({url:n,loadType:T.XHR,responseType:"text"},{type:"fragment",shader:r})}]})},e.transform=function transform(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.find(function(e){return"vertex"===e.config.type}),i=t.find(function(e){return"fragment"===e.config.type});if(r.config.shader){var o=r.config.shader;return o.vertexSrc=r.request.response,o.fragmentSrc=i.request.response,o}return new Ct(this.gl,r.request.response,i.request.response)},GLSLLoader}(B);var $t=0,Jt=1,Zt=2,en=3,tn=4,nn=5,rn=6,on=7,an=function(r){function KhronosPbrShader(e,t){var n;return(n=r.call(this,e)||this).cache=t,n}!function khronosPbrShader_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(KhronosPbrShader,r);var e=KhronosPbrShader.prototype;return e.initializeDefines=function initializeDefines(e){e.hasAttribute(V.NORMAL)&&this.addDefine("HAS_NORMALS",1),e.hasAttribute(V.TANGENT)&&this.addDefine("HAS_TANGENTS",1),e.hasAttribute(V.TEXCOORD_0)&&this.addDefine("HAS_UV",1),e.hasAttribute(V.JOINTS_0)&&e.hasAttribute(V.WEIGHTS_0)&&this.addDefine("HAS_SKIN",1),e.hasAttribute(V.JOINTS_1)&&e.hasAttribute(V.WEIGHTS_1)&&this.addDefine("SKIN_VEC8",1),e.hasMap(this.cache,pt.ALBEDO)&&this.addDefine("HAS_BASECOLORMAP",1),e.hasMap(this.cache,pt.METAL_ROUGHNESS)&&this.addDefine("HAS_METALROUGHNESSMAP",1),e.hasMap(this.cache,pt.NORMAL)&&this.addDefine("HAS_NORMALMAP",1),e.hasMap(this.cache,pt.EMISSIVE)&&this.addDefine("HAS_EMISSIVEMAP",1),e.hasMap(this.cache,pt.OCCLUSION)&&this.addDefine("HAS_OCCLUSIONMAP",1);var t=this.cache.get(rt.TEXTURE,m),n=this.cache.get(rt.TEXTURE,_),r=this.cache.get(rt.TEXTURE,g);t&&n&&r&&this.addDefine("USE_IBL",1)},e.applyMesh=function applyMesh(e){},e.applyNode=function applyNode(e){if(this.uniforms.u_ModelMatrix=e.transform.modelMatrix,e.skin){var t=u.create();u.invert(t,e.transform.modelMatrix);for(var n,r=0;n=e.skin.joints[r];r++){var i=e.skin.jointMatrices[r];u.mul(i,n.transform.modelMatrix,e.skin.inverseBindMatrices[r]),u.mul(i,t,i)}e.skin.update()}},e.applyScene=function applyScene(e){},e.applyMaterial=function applyMaterial(e){this.applyCamera(),this.applyTextures(e),this.applyIBL(),this.uniforms.u_BaseColorFactor=e.model.baseColorFactor,this.uniforms.u_RoughnessFactor=e.model.roughnessFactor,this.uniforms.u_MetallicFactor=e.model.metallicFactor},e.applyIBL=function applyIBL(){var e=this.cache.get(rt.TEXTURE,m);e&&(e.bind(Zt),this.uniforms.u_brdfLUT=Zt);var t=this.cache.get(rt.TEXTURE,_);t&&(t.bind($t),this.uniforms.u_DiffuseEnvSampler=$t);var n=this.cache.get(rt.TEXTURE,g);n&&(n.bind(Jt),this.uniforms.u_SpecularEnvSampler=Jt)},e.applyTextures=function applyTextures(e){e.maps[pt.ALBEDO]&&this.cache.get(rt.TEXTURE,e.maps[pt.ALBEDO].texture)&&(this.cache.get(rt.TEXTURE,e.maps[pt.ALBEDO].texture).bind(en),this.uniforms.u_BaseColorSampler=en);e.maps[pt.METAL_ROUGHNESS]&&this.cache.get(rt.TEXTURE,e.maps[pt.METAL_ROUGHNESS].texture)&&(this.cache.get(rt.TEXTURE,e.maps[pt.METAL_ROUGHNESS].texture).bind(tn),this.uniforms.u_MetallicRoughnessSampler=tn);e.maps[pt.NORMAL]&&this.cache.get(rt.TEXTURE,e.maps[pt.NORMAL].texture)&&(this.cache.get(rt.TEXTURE,e.maps[pt.NORMAL].texture).bind(nn),this.uniforms.u_NormalSampler=nn,this.uniforms.u_NormalScale=e.model.normalScale);e.maps[pt.EMISSIVE]&&this.cache.get(rt.TEXTURE,e.maps[pt.EMISSIVE].texture)&&(this.cache.get(rt.TEXTURE,e.maps[pt.EMISSIVE].texture).bind(rn),this.uniforms.u_EmissiveSampler=rn,this.uniforms.u_EmissiveFactor=e.model.emissiveFactor);e.maps[pt.OCCLUSION]&&this.cache.get(rt.TEXTURE,e.maps[pt.OCCLUSION].texture)&&(this.cache.get(rt.TEXTURE,e.maps[pt.OCCLUSION].texture).bind(on),this.uniforms.u_OcclusionSampler=on,this.uniforms.u_OcclusionStrength=e.model.occlusionStrength)},e.applyCamera=function applyCamera(){this.uniforms.Matrices=i.CAMERA,this.uniforms.JointMatrix=i.SKIN},KhronosPbrShader}(Ct);var sn=function(r){function SkyboxShader(e,t){var n;return(n=r.call(this,e)||this).cache=t,n}!function SkyboxShader_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(SkyboxShader,r);var e=SkyboxShader.prototype;return e.apply=function apply(){this.applyCamera(),this.cache.get(rt.TEXTURE,y).bind(0),this.uniforms.u_Skybox=0},e.applyCamera=function applyCamera(){this.uniforms.Matrices=i.CAMERA},SkyboxShader}(Ct);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var un=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},cn=function(n){function SkyboxPass(e){var t;return(t=n.call(this)||this).gl=e.gl,t.cache=e.cache,t.shader=e.shader,t.cube=new Je(t.gl),t}!function SkyboxPass_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(SkyboxPass,n);var e=SkyboxPass.prototype;return e.setUp=function setUp(){this.shader.bind(),this.cube.vertexArrayObject.bind(),this.cube.vertexArrayObject.addAttribute(this.cube.vertexBuffer,this.shader.attributes.getAttribute("a_Position"),3,this.gl.FLOAT,!1,24,0),this.cube.vertexArrayObject.unbind(),this.shader.unbind()},e.tearDown=function tearDown(){},e.render=function render(){this.cache.has(rt.TEXTURE,y)&&(this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.shader.bind(),this.shader.apply(),this.cube.draw(),this.shader.unbind(),this.gl.depthFunc(this.gl.LESS),this.gl.disable(this.gl.DEPTH_TEST))},SkyboxPass}(Kt.System);function cameraComponent_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cameraComponent_typeof(e){return(cameraComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cn=un([Kt.ECS.System()],cn);var ln=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":cameraComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},dn=function(){function CameraComponent(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{fovy:.785,aspect:16/9,near:.01,far:100};this.init(e)}var e=CameraComponent.prototype;return e.init=function init(e){e.projMatrix?this._viewMatrix=e.viewMatrix:this._viewMatrix=u.create(),e.projMatrix?this._projMatrix=e.projMatrix:(this._projMatrix=u.create(),u.perspective(this._projMatrix,e.fovy||.785,e.aspect||16/9,e.near||.01,e.far||100))},e.remove=function remove(){u.identity(this._viewMatrix),u.identity(this._projMatrix)},function cameraComponent_createClass(e,t,n){return t&&cameraComponent_defineProperties(e.prototype,t),n&&cameraComponent_defineProperties(e,n),e}(CameraComponent,[{key:"viewMatrix",get:function get(){return this._viewMatrix},set:function set(e){this._viewMatrix=e}},{key:"projMatrix",get:function get(){return this._projMatrix},set:function set(e){this._projMatrix=e}}]),CameraComponent}();function lookAtCameraComponent_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lookAtCameraComponent_typeof(e){return(lookAtCameraComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}dn=ln([Kt.ECS.Component("CameraComponent")],dn);var fn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":lookAtCameraComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},hn=function(){function LookAtCameraComponent(e){this.init(e)}var e=LookAtCameraComponent.prototype;return e.init=function init(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{target:b.create(),up:b.fromValues(0,1,0),panning:b.create(),zoom:b.create()};this._target=e.target||b.create(),this._up=e.up||b.fromValues(0,1,0),this._panning=e.panning||b.create(),this._zooming=e.zoom||b.create(),this._zoomPos=0},e.remove=function remove(){},function lookAtCameraComponent_createClass(e,t,n){return t&&lookAtCameraComponent_defineProperties(e.prototype,t),n&&lookAtCameraComponent_defineProperties(e,n),e}(LookAtCameraComponent,[{key:"target",get:function get(){return this._target},set:function set(e){this._target=e}},{key:"up",get:function get(){return this._up},set:function set(e){this._up=e}},{key:"panning",get:function get(){return this._panning},set:function set(e){this._panning=e}},{key:"zooming",get:function get(){return this._zooming},set:function set(e){this._zooming=e}},{key:"zoomPos",get:function get(){return this._zoomPos},set:function set(e){this._zoomPos=e}}]),LookAtCameraComponent}();function GUIComponent_typeof(e){return(GUIComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}hn=fn([Kt.ECS.Component()],hn);var pn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":GUIComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},mn=function(){function GUIComponent(e){this.init(e)}var e=GUIComponent.prototype;return e.init=function init(e){this.config=e},e.remove=function remove(){},GUIComponent}();function color_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}mn=pn([Kt.ECS.Component()],mn);var _n,gn,yn,vn=function(){function Color(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;this._elements=new Float32Array([e,t,n,r])}var e=Color.prototype;return e.set=function set(e){this._elements[3]=e},e.mult=function mult(e){return"number"==typeof e?(e=e,new Color(this.r*e,this.g*e,this.b*e,Math.abs(Math.min(this.a*e,1)))):new Color(this.r*e.r,this.g*e.g,this.b*e.b,Math.abs(Math.min(this.a*e.a,1)))},e.div=function div(e){if("number"==typeof e)return e=e,this.mult(1/e);var t=new Color(1/e.r,1/e.g,1/e.b,Math.min(1/e.a,1));return this.mult(t)},e.plus=function plus(e){return new Color(this.r+e.r,this.g+e.g,this.b+e.b,Math.abs(Math.min(this.a+e.a,1)))},e.minus=function minus(e){return new Color(this.r-e.r,this.g-e.g,this.b-e.b,Math.abs(Math.min(this.a-e.a,1)))},e.toString=function toString(){return"{Color: [R: "+this.r+" G: "+this.g+" B: "+this.b+" A: "+this.a+"]}"},function color_createClass(e,t,n){return t&&color_defineProperties(e.prototype,t),n&&color_defineProperties(e,n),e}(Color,[{key:"r",get:function get(){return this._elements[0]},set:function set(e){this._elements[0]=e}},{key:"g",get:function get(){return this._elements[1]},set:function set(e){this._elements[1]=e}},{key:"b",get:function get(){return this._elements[2]},set:function set(e){this._elements[2]=e}},{key:"a",get:function get(){return this._elements[3]}},{key:"elements",get:function get(){return this._elements},set:function set(e){this._elements=e}}]),Color}();function lightComponent_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lightComponent_typeof(e){return(lightComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}(gn=_n||(_n={})).getVSpherePos=function getVSpherePos(e,t,n,r){var i=b.fromValues(1*e/n*2-1,-(1*t/r*2-1),0);b.squaredLength(i);var o=b.squaredLength(i);return o<=1?b.add(i,i,[0,0,Math.sqrt(1-o)]):b.normalize(i,i),i},gn.rotateAxisAngle=function rotateAxisAngle(e,t,n){var r=Math.cos(n),i=Math.sin(n),o=b.create(),a=b.fromValues(t[0]*t[0]*(1-r)+r,t[0]*t[1]*(1-r)-t[2]*i,t[0]*t[2]*(1-r)+t[1]*i),s=b.fromValues(t[0]*t[1]*(1-r)+t[2]*i,t[1]*t[1]*(1-r)+r,t[1]*t[2]*(1-r)-t[0]*i),u=b.fromValues(t[0]*t[2]*(1-r)-t[1]*i,t[2]*t[1]*(1-r)+t[0]*i,t[2]*t[2]*(1-r)+r);return o[0]=b.dot(a,e),o[1]=b.dot(s,e),o[2]=b.dot(u,e),o},gn.radians=function radians(e){return e*Math.PI/180},gn.degrees=function degrees(e){return 180*e/Math.PI},(yn||(yn={})).lerp=function lerp(e,t,n){return e+n*(t-e)};var bn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":lightComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},En=function(){function LightComponent(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{lightColor:[255,255,255],lightScale:1,lightRotation:75,lightPitch:40};this.init(e)}var e=LightComponent.prototype;return e.init=function init(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{lightColor:[255,255,255],lightScale:1,lightRotation:75,lightPitch:40};this._direction=b.create(),this._color=new vn,this._lightColor=e.lightColor,this._lightScale=e.lightScale,this._lightRotation=e.lightRotation,this._lightPitch=e.lightPitch,this.updateLight()},e.remove=function remove(){},e.updateLight=function updateLight(){this._color.r=this._lightScale*this._lightColor[0]/255,this._color.g=this._lightScale*this._lightColor[1]/255,this._color.b=this._lightScale*this._lightColor[2]/255;var e=this._lightRotation*Math.PI/180,t=this._lightPitch*Math.PI/180;b.set(this._direction,Math.sin(e)*Math.cos(t),Math.sin(t),Math.cos(e)*Math.cos(t))},function lightComponent_createClass(e,t,n){return t&&lightComponent_defineProperties(e.prototype,t),n&&lightComponent_defineProperties(e,n),e}(LightComponent,[{key:"lightColor",get:function get(){return this._lightColor},set:function set(e){this._lightColor=e}},{key:"lightScale",get:function get(){return this._lightScale},set:function set(e){this._lightScale=e}},{key:"lightRotation",get:function get(){return this._lightRotation},set:function set(e){this._lightRotation=e}},{key:"lightPitch",get:function get(){return this._lightPitch},set:function set(e){this._lightPitch=e}},{key:"color",get:function get(){return this._color},set:function set(e){this._color=e}},{key:"direction",get:function get(){return this._direction},set:function set(e){this._direction=e}}]),LightComponent}();function skyboxComponent_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function skyboxComponent_typeof(e){return(skyboxComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}En=bn([Kt.ECS.Component()],En);var Sn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":skyboxComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},An=function(){function SkyboxComponent(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.init(e)}var e=SkyboxComponent.prototype;return e.init=function init(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._texture=e.texture},e.remove=function remove(){this._texture=void 0},function skyboxComponent_createClass(e,t,n){return t&&skyboxComponent_defineProperties(e.prototype,t),n&&skyboxComponent_defineProperties(e,n),e}(SkyboxComponent,[{key:"texture",get:function get(){return this._texture},set:function set(e){this._texture=e}}]),SkyboxComponent}();function animationComponent_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function animationComponent_typeof(e){return(animationComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}An=Sn([Kt.ECS.Component()],An);var Cn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":animationComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Tn=function(){function AnimationComponent(e){this.init(e)}var e=AnimationComponent.prototype;return e.init=function init(e){this._key=e.key,this._running=!1,this._paused=!1,this._startTime=0,this._pauseStart=0,this._pauseEnd=0,this._autoStart=!0,this._loop=!0},e.remove=function remove(){},e.start=function start(){this._running=!0,this._startTime=performance.now()},e.stop=function stop(){this._running=!1},e.pause=function pause(){this.paused=!0},e.resume=function resume(){this.paused=!1},function animationComponent_createClass(e,t,n){return t&&animationComponent_defineProperties(e.prototype,t),n&&animationComponent_defineProperties(e,n),e}(AnimationComponent,[{key:"key",get:function get(){return this._key},set:function set(e){this._key=e}},{key:"running",get:function get(){return this._running}},{key:"paused",get:function get(){return this._paused},set:function set(e){this._paused!==e&&(!0===e?this._pauseStart=performance.now():this._pauseEnd=performance.now(),this._paused=e)}},{key:"pauseStart",get:function get(){return this._pauseStart}},{key:"pauseEnd",get:function get(){return this._pauseEnd}},{key:"startTime",get:function get(){return this._startTime}},{key:"loop",get:function get(){return this._loop},set:function set(e){this._loop=e}},{key:"autoStart",get:function get(){return this._autoStart},set:function set(e){this._autoStart=e}}]),AnimationComponent}();function sceneComponent_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sceneComponent_typeof(e){return(sceneComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Tn=Cn([Kt.ECS.Component()],Tn);var wn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":sceneComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Mn=function(){function SceneComponent(e){this._key=e.key}var e=SceneComponent.prototype;return e.init=function init(e){this._key=e.key},e.remove=function remove(){},function sceneComponent_createClass(e,t,n){return t&&sceneComponent_defineProperties(e.prototype,t),n&&sceneComponent_defineProperties(e,n),e}(SceneComponent,[{key:"key",get:function get(){return this._key},set:function set(e){this._key=e}}]),SceneComponent}();function transformComponent_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function transformComponent_typeof(e){return(transformComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Mn=wn([Kt.ECS.Component()],Mn);var Rn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":transformComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},xn=function(){function TransformComponent(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}};this.init(e)}var e=TransformComponent.prototype;return e.init=function init(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}};this._localMatrix=u.create(),e||(e=Object.create(null)),e.position||(e.position={x:0,y:0,z:0}),e.rotation||(e.rotation={x:0,y:0,z:0,w:1}),e.scale||(e.scale={x:1,y:1,z:1}),this._rotation=E.fromValues(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),this._translation=b.fromValues(e.position.x,e.position.y,e.position.z),this._scale=b.fromValues(e.scale.x,e.scale.y,e.scale.z),this._children=[],this._level=0,this._dirty=!0,this.apply()},e.remove=function remove(){},e.addChild=function addChild(e){e._parent&&e._parent.removeChild(e),e._parent=this,e._level=this._level+1,this._children.push(e)},e.removeChild=function removeChild(e){var t=this._children.indexOf(e);-1<t&&(e._level=0,e._parent=void 0,this._children.splice(t,1))},e.apply=function apply(){return this._dirty&&(u.fromRotationTranslationScale(this._localMatrix,this._rotation,this._translation,this._scale),this._dirty=!1),this._localMatrix},function transformComponent_createClass(e,t,n){return t&&transformComponent_defineProperties(e.prototype,t),n&&transformComponent_defineProperties(e,n),e}(TransformComponent,[{key:"globalMatrix",get:function get(){return this._parent?u.multiply(u.create(),this._parent.localMatrix,this._localMatrix):this.apply()}},{key:"modelMatrix",get:function get(){return this.globalMatrix}},{key:"localMatrix",get:function get(){return this.apply()},set:function set(e){this._localMatrix=e}},{key:"translation",get:function get(){return this._dirty=!0,this._translation},set:function set(e){this._dirty=!0,this._translation=e}},{key:"rotation",get:function get(){return this._dirty=!0,this._rotation},set:function set(e){this._dirty=!0,this._rotation=e}},{key:"scale",get:function get(){return this._dirty=!0,this._scale},set:function set(e){this._dirty=!0,this._scale=e}},{key:"level",get:function get(){return this._level}},{key:"parent",get:function get(){return this._parent},set:function set(e){this._parent=e}},{key:"children",get:function get(){return this._children},set:function set(e){this._children=e}}]),TransformComponent}();xn=Rn([Kt.ECS.Component()],xn);var On=n(2);function ForwardScenePass_typeof(e){return(ForwardScenePass_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Pn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":ForwardScenePass_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Ln=function(n){function ForwardScenePass(e){var t;return(t=n.call(this)||this).gl=e.gl,t.cache=e.cache,t.shader=e.shader,t}!function ForwardScenePass_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(ForwardScenePass,n);var e=ForwardScenePass.prototype;return e.setUp=function setUp(){this.events.on(On.SYSTEM_EVENTS.ENTITY_ADDED,this.initEntity,this)},e.initEntity=function initEntity(e){var t=e.get(Mn),n=this.cache.get(rt.SCENE,t.key);n?(n.init(this.gl),n.upload(),this.initShaderAttributes(n)):console.warn("Their is no scene for key "+t.key+" in the cache.")},e.initShaderAttributes=function initShaderAttributes(e){e.addAttribute(V.POSITION,this.shader.attributes.getAttribute("a_Position")),e.addAttribute(V.NORMAL,this.shader.attributes.getAttribute("a_Normal")),e.addAttribute(V.TANGENT,this.shader.attributes.getAttribute("a_Tangent")),e.addAttribute(V.TEXCOORD_0,this.shader.attributes.getAttribute("a_UV")),e.addAttribute(V.JOINTS_0,this.shader.attributes.getAttribute("a_Joint0")),e.addAttribute(V.WEIGHTS_0,this.shader.attributes.getAttribute("a_Weight0"))},e.draw=function draw(){for(var e,t=0;e=this.entities[t];t++)this.drawScene(e)},e.drawScene=function drawScene(e){var t=e.get(Mn).key,n=this.cache.get(rt.SCENE,t);this.shader.apply(),n.draw(this.shader,this.cache)},ForwardScenePass}(Kt.System);function ForwardLightPass_typeof(e){return(ForwardLightPass_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Ln=Pn([Kt.ECS.System(Mn)],Ln);var kn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":ForwardLightPass_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Dn=function(n){function ForwardLightPass(e){var t;return(t=n.call(this)||this).gl=e.gl,t.cache=e.cache,t.shader=e.shader,t}!function ForwardLightPass_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(ForwardLightPass,n);var e=ForwardLightPass.prototype;return e.setUp=function setUp(){this.scenePass=Kt.ECS.addSystem(new Ln({gl:this.gl,cache:this.cache,shader:this.shader}))},e.tearDown=function tearDown(){Kt.ECS.removeSystem(this.scenePass)},e.render=function render(){this.gl.enable(this.gl.DEPTH_TEST),this.shader.bind();for(var e,t=0;e=this.entities[t];t++)this.shader.uniforms.u_LightColor=e.get(En).color.elements,this.shader.uniforms.u_LightDirection=e.get(En).direction,this.scenePass.draw();this.shader.unbind(),this.gl.disable(this.gl.DEPTH_TEST)},ForwardLightPass}(Kt.System);function ForwardShadingSystem_typeof(e){return(ForwardShadingSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Dn=kn([Kt.ECS.System(En)],Dn);var Bn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":ForwardShadingSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},In=function(n){function ForwardShadingSystem(e){var t;return(t=n.call(this)||this).gl=e.gl,t.cache=e.cache,t.shader=e.shader,t}!function ForwardShadingSystem_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(ForwardShadingSystem,n);var e=ForwardShadingSystem.prototype;return e.setUp=function setUp(){this.forwardLightningPass=Kt.ECS.addSystem(new Dn({gl:this.gl,cache:this.cache,shader:this.shader}))},e.tearDown=function tearDown(){Kt.ECS.removeSystem(this.forwardLightningPass),Kt.ECS.removeSystem(this)},ForwardShadingSystem}(Kt.System);function PrePass_typeof(e){return(PrePass_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}In=Bn([Kt.ECS.System()],In);var Nn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":PrePass_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Fn=function(n){function PrePass(e){var t;return(t=n.call(this)||this).gl=e,t}!function PrePass_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(PrePass,n);var e=PrePass.prototype;return e.clearContext=function clearContext(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{r:0,g:0,b:0,a:1};this.gl.clearColor(n.r,n.g,n.b,n.a),e&&t?this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT):e?this.gl.clear(this.gl.COLOR_BUFFER_BIT):t&&this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},e.render=function render(){this.clearContext(!0,!0,{r:.2,g:.2,b:.2,a:1})},PrePass}(Kt.System);function colorToString(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),o=Math.round(e.b),a=e.a,s=Math.round(e.h),u=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var l=e.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}return"CSS_RGB"===n?"rgb("+r+","+i+","+o+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+o+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+o+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+",a:"+a+"}":"unknown format"}Fn=Nn([Kt.ECS.System()],Fn);var Un=Array.prototype.forEach,jn=Array.prototype.slice,Gn={BREAK:{},extend:function extend(n){return this.each(jn.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function defaults(n){return this.each(jn.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function compose(){var n=jn.call(arguments);return function(){for(var e=jn.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function each(e,t,n){if(e)if(Un&&e.forEach&&e.forEach===Un)e.forEach(t,n);else if(e.length===e.length+0){var r,i=void 0;for(i=0,r=e.length;i<r;i++)if(i in e&&t.call(n,e[i],i)===this.BREAK)return}else for(var o in e)if(t.call(n,e[o],o)===this.BREAK)return},defer:function defer(e){setTimeout(e,0)},debounce:function debounce(r,i,o){var a=void 0;return function(){var e=this,t=arguments;var n=o||!a;clearTimeout(a),a=setTimeout(function delayed(){a=null,o||r.apply(e,t)},i),n&&r.apply(e,t)}},toArray:function toArray(e){return e.toArray?e.toArray():jn.call(e)},isUndefined:function isUndefined(e){return void 0===e},isNull:function isNull(e){return null===e},isNaN:function(t){function isNaN(e){return t.apply(this,arguments)}return isNaN.toString=function(){return t.toString()},isNaN}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function isObject(e){return e===Object(e)},isNumber:function isNumber(e){return e===e+0},isString:function isString(e){return e===e+""},isBoolean:function isBoolean(e){return!1===e||!0===e},isFunction:function isFunction(e){return"[object Function]"===Object.prototype.toString.call(e)}},Vn=[{litmus:Gn.isString,conversions:{THREE_CHAR_HEX:{read:function read(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:colorToString},SIX_CHAR_HEX:{read:function read(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:colorToString},CSS_RGB:{read:function read(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:colorToString},CSS_RGBA:{read:function read(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:colorToString}}},{litmus:Gn.isNumber,conversions:{HEX:{read:function read(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function write(e){return e.hex}}}},{litmus:Gn.isArray,conversions:{RGB_ARRAY:{read:function read(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function write(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function read(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function write(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Gn.isObject,conversions:{RGBA_OBJ:{read:function read(e){return!!(Gn.isNumber(e.r)&&Gn.isNumber(e.g)&&Gn.isNumber(e.b)&&Gn.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function write(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function read(e){return!!(Gn.isNumber(e.r)&&Gn.isNumber(e.g)&&Gn.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function write(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function read(e){return!!(Gn.isNumber(e.h)&&Gn.isNumber(e.s)&&Gn.isNumber(e.v)&&Gn.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function write(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function read(e){return!!(Gn.isNumber(e.h)&&Gn.isNumber(e.s)&&Gn.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function write(e){return{h:e.h,s:e.s,v:e.v}}}}}],Hn=void 0,zn=void 0,Yn=function interpret(){zn=!1;var n=1<arguments.length?Gn.toArray(arguments):arguments[0];return Gn.each(Vn,function(e){if(e.litmus(n))return Gn.each(e.conversions,function(e,t){if(Hn=e.read(n),!1===zn&&!1!==Hn)return(zn=Hn).conversionName=t,Hn.conversion=e,Gn.BREAK}),Gn.BREAK}),zn},Wn=void 0,Xn={hsv_to_rgb:function hsv_to_rgb(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=n*(1-t),a=n*(1-i*t),s=n*(1-(1-i)*t),u=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function rgb_to_hsv(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),o=i-r,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-n)/o:t===i?2+(n-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/i,v:i/255})},rgb_to_hex:function rgb_to_hex(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function component_from_hex(e,t){return e>>8*t&255},hex_with_component:function hex_with_component(e,t,n){return n<<(Wn=8*t)|e&~(255<<Wn)}},qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Qn=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),$n=function get(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:get(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},Jn=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Zn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},er=function(){function Color(){if(Kn(this,Color),this.__state=Yn.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Qn(Color,[{key:"toString",value:function toString(){return colorToString(this)}},{key:"toHexString",value:function toHexString(){return colorToString(this,!0)}},{key:"toOriginal",value:function toOriginal(){return this.__state.conversion.write(this)}}]),Color}();function defineRGBComponent(e,t,n){Object.defineProperty(e,t,{get:function get$$1(){return"RGB"===this.__state.space||er.recalculateRGB(this,t,n),this.__state[t]},set:function set$$1(e){"RGB"!==this.__state.space&&(er.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function defineHSVComponent(e,t){Object.defineProperty(e,t,{get:function get$$1(){return"HSV"===this.__state.space||er.recalculateHSV(this),this.__state[t]},set:function set$$1(e){"HSV"!==this.__state.space&&(er.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}er.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=Xn.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Gn.extend(e.__state,Xn.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},er.recalculateHSV=function(e){var t=Xn.rgb_to_hsv(e.r,e.g,e.b);Gn.extend(e.__state,{s:t.s,v:t.v}),Gn.isNaN(t.h)?Gn.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},er.COMPONENTS=["r","g","b","h","s","v","hex","a"],defineRGBComponent(er.prototype,"r",2),defineRGBComponent(er.prototype,"g",1),defineRGBComponent(er.prototype,"b",0),defineHSVComponent(er.prototype,"h"),defineHSVComponent(er.prototype,"s"),defineHSVComponent(er.prototype,"v"),Object.defineProperty(er.prototype,"a",{get:function get$$1(){return this.__state.a},set:function set$$1(e){this.__state.a=e}}),Object.defineProperty(er.prototype,"hex",{get:function get$$1(){return"HEX"!==!this.__state.space&&(this.__state.hex=Xn.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function set$$1(e){this.__state.space="HEX",this.__state.hex=e}});var tr=function(){function Controller(e,t){Kn(this,Controller),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return Qn(Controller,[{key:"onChange",value:function onChange(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function onFinishChange(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function setValue(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function getValue(){return this.object[this.property]}},{key:"updateDisplay",value:function updateDisplay(){return this}},{key:"isModified",value:function isModified(){return this.initialValue!==this.getValue()}}]),Controller}(),nr={};Gn.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){Gn.each(e,function(e){nr[e]=t})});var rr=/(\d+(\.\d+)?)px/;function cssValueToPixels(e){if("0"===e||Gn.isUndefined(e))return 0;var t=e.match(rr);return Gn.isNull(t)?0:parseFloat(t[1])}var ir={makeSelectable:function makeSelectable(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function makeFullscreen(e,t,n){var r=n,i=t;Gn.isUndefined(i)&&(i=!0),Gn.isUndefined(r)&&(r=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function fakeEvent(e,t,n,r){var i=n||{},o=nr[t];if(!o)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(o);switch(o){case"MouseEvents":var s=i.x||i.clientX||0,u=i.y||i.clientY||0;a.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,s,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;Gn.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:a.initEvent(t,i.bubbles||!1,i.cancelable||!0)}Gn.defaults(a,r),e.dispatchEvent(a)},bind:function bind(e,t,n,r){var i=r||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),ir},unbind:function unbind(e,t,n,r){var i=r||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),ir},addClass:function addClass(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return ir},removeClass:function removeClass(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return ir},hasClass:function hasClass(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function getWidth(e){var t=getComputedStyle(e);return cssValueToPixels(t["border-left-width"])+cssValueToPixels(t["border-right-width"])+cssValueToPixels(t["padding-left"])+cssValueToPixels(t["padding-right"])+cssValueToPixels(t.width)},getHeight:function getHeight(e){var t=getComputedStyle(e);return cssValueToPixels(t["border-top-width"])+cssValueToPixels(t["border-bottom-width"])+cssValueToPixels(t["padding-top"])+cssValueToPixels(t["padding-bottom"])+cssValueToPixels(t.height)},getOffset:function getOffset(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;);return n},isActive:function isActive(e){return e===document.activeElement&&(e.type||e.href)}},or=function(e){function BooleanController(e,t){Kn(this,BooleanController);var n=Zn(this,(BooleanController.__proto__||Object.getPrototypeOf(BooleanController)).call(this,e,t)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),ir.bind(n.__checkbox,"change",function onChange(){r.setValue(!r.__prev)},!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return Jn(BooleanController,tr),Qn(BooleanController,[{key:"setValue",value:function setValue(e){var t=$n(BooleanController.prototype.__proto__||Object.getPrototypeOf(BooleanController.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),t}},{key:"updateDisplay",value:function updateDisplay(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),$n(BooleanController.prototype.__proto__||Object.getPrototypeOf(BooleanController.prototype),"updateDisplay",this).call(this)}}]),BooleanController}(),ar=function(e){function OptionController(e,t,n){Kn(this,OptionController);var r=Zn(this,(OptionController.__proto__||Object.getPrototypeOf(OptionController)).call(this,e,t)),i=n,o=r;if(r.__select=document.createElement("select"),Gn.isArray(i)){var a={};Gn.each(i,function(e){a[e]=e}),i=a}return Gn.each(i,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),o.__select.appendChild(n)}),r.updateDisplay(),ir.bind(r.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)}),r.domElement.appendChild(r.__select),r}return Jn(OptionController,tr),Qn(OptionController,[{key:"setValue",value:function setValue(e){var t=$n(OptionController.prototype.__proto__||Object.getPrototypeOf(OptionController.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),t}},{key:"updateDisplay",value:function updateDisplay(){return ir.isActive(this.__select)?this:(this.__select.value=this.getValue(),$n(OptionController.prototype.__proto__||Object.getPrototypeOf(OptionController.prototype),"updateDisplay",this).call(this))}}]),OptionController}(),sr=function(e){function StringController(e,t){Kn(this,StringController);var n=Zn(this,(StringController.__proto__||Object.getPrototypeOf(StringController)).call(this,e,t)),r=n;function onChange(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),ir.bind(n.__input,"keyup",onChange),ir.bind(n.__input,"change",onChange),ir.bind(n.__input,"blur",function onBlur(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),ir.bind(n.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return Jn(StringController,tr),Qn(StringController,[{key:"updateDisplay",value:function updateDisplay(){return ir.isActive(this.__input)||(this.__input.value=this.getValue()),$n(StringController.prototype.__proto__||Object.getPrototypeOf(StringController.prototype),"updateDisplay",this).call(this)}}]),StringController}();function numDecimals(e){var t=e.toString();return-1<t.indexOf(".")?t.length-t.indexOf(".")-1:0}var ur=function(e){function NumberController(e,t,n){Kn(this,NumberController);var r=Zn(this,(NumberController.__proto__||Object.getPrototypeOf(NumberController)).call(this,e,t)),i=n||{};return r.__min=i.min,r.__max=i.max,r.__step=i.step,Gn.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=numDecimals(r.__impliedStep),r}return Jn(NumberController,tr),Qn(NumberController,[{key:"setValue",value:function setValue(e){var t=e;return void 0!==this.__min&&t<this.__min?t=this.__min:void 0!==this.__max&&t>this.__max&&(t=this.__max),void 0!==this.__step&&t%this.__step!=0&&(t=Math.round(t/this.__step)*this.__step),$n(NumberController.prototype.__proto__||Object.getPrototypeOf(NumberController.prototype),"setValue",this).call(this,t)}},{key:"min",value:function min(e){return this.__min=e,this}},{key:"max",value:function max(e){return this.__max=e,this}},{key:"step",value:function step(e){return this.__step=e,this.__impliedStep=e,this.__precision=numDecimals(e),this}}]),NumberController}();var cr=function(e){function NumberControllerBox(e,t,n){Kn(this,NumberControllerBox);var r=Zn(this,(NumberControllerBox.__proto__||Object.getPrototypeOf(NumberControllerBox)).call(this,e,t,n));r.__truncationSuspended=!1;var i=r,o=void 0;function onFinish(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function onMouseDrag(e){var t=o-e.clientY;i.setValue(i.getValue()+t*i.__impliedStep),o=e.clientY}function onMouseUp(){ir.unbind(window,"mousemove",onMouseDrag),ir.unbind(window,"mouseup",onMouseUp),onFinish()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),ir.bind(r.__input,"change",function onChange(){var e=parseFloat(i.__input.value);Gn.isNaN(e)||i.setValue(e)}),ir.bind(r.__input,"blur",function onBlur(){onFinish()}),ir.bind(r.__input,"mousedown",function onMouseDown(e){ir.bind(window,"mousemove",onMouseDrag),ir.bind(window,"mouseup",onMouseUp),o=e.clientY}),ir.bind(r.__input,"keydown",function(e){13===e.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1,onFinish())}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Jn(NumberControllerBox,ur),Qn(NumberControllerBox,[{key:"updateDisplay",value:function updateDisplay(){return this.__input.value=this.__truncationSuspended?this.getValue():function roundToDecimal(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}(this.getValue(),this.__precision),$n(NumberControllerBox.prototype.__proto__||Object.getPrototypeOf(NumberControllerBox.prototype),"updateDisplay",this).call(this)}}]),NumberControllerBox}();function dat_gui_module_map(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var lr=function(e){function NumberControllerSlider(e,t,n,r,i){Kn(this,NumberControllerSlider);var o=Zn(this,(NumberControllerSlider.__proto__||Object.getPrototypeOf(NumberControllerSlider)).call(this,e,t,{min:n,max:r,step:i})),a=o;function onMouseDrag(e){e.preventDefault();var t=a.__background.getBoundingClientRect();return a.setValue(dat_gui_module_map(e.clientX,t.left,t.right,a.__min,a.__max)),!1}function onMouseUp(){ir.unbind(window,"mousemove",onMouseDrag),ir.unbind(window,"mouseup",onMouseUp),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function onTouchMove(e){var t=e.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(dat_gui_module_map(t,n.left,n.right,a.__min,a.__max))}function onTouchEnd(){ir.unbind(window,"touchmove",onTouchMove),ir.unbind(window,"touchend",onTouchEnd),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),ir.bind(o.__background,"mousedown",function onMouseDown(e){document.activeElement.blur(),ir.bind(window,"mousemove",onMouseDrag),ir.bind(window,"mouseup",onMouseUp),onMouseDrag(e)}),ir.bind(o.__background,"touchstart",function onTouchStart(e){if(1!==e.touches.length)return;ir.bind(window,"touchmove",onTouchMove),ir.bind(window,"touchend",onTouchEnd),onTouchMove(e)}),ir.addClass(o.__background,"slider"),ir.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return Jn(NumberControllerSlider,ur),Qn(NumberControllerSlider,[{key:"updateDisplay",value:function updateDisplay(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",$n(NumberControllerSlider.prototype.__proto__||Object.getPrototypeOf(NumberControllerSlider.prototype),"updateDisplay",this).call(this)}}]),NumberControllerSlider}(),dr=function(e){function FunctionController(e,t,n){Kn(this,FunctionController);var r=Zn(this,(FunctionController.__proto__||Object.getPrototypeOf(FunctionController)).call(this,e,t)),i=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,ir.bind(r.__button,"click",function(e){return e.preventDefault(),i.fire(),!1}),ir.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return Jn(FunctionController,tr),Qn(FunctionController,[{key:"fire",value:function fire(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),FunctionController}(),fr=function(e){function ColorController(e,t){Kn(this,ColorController);var n=Zn(this,(ColorController.__proto__||Object.getPrototypeOf(ColorController)).call(this,e,t));n.__color=new er(n.getValue()),n.__temp=new er(0);var s=n;n.domElement=document.createElement("div"),ir.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",ir.bind(n.__input,"keydown",function(e){13===e.keyCode&&onBlur.call(this)}),ir.bind(n.__input,"blur",onBlur),ir.bind(n.__selector,"mousedown",function(){ir.addClass(this,"drag").bind(window,"mouseup",function(){ir.removeClass(s.__selector,"drag")})}),ir.bind(n.__selector,"touchstart",function(){ir.addClass(this,"drag").bind(window,"touchend",function(){ir.removeClass(s.__selector,"drag")})});var r=document.createElement("div");function fieldDown(e){setSV(e),ir.bind(window,"mousemove",setSV),ir.bind(window,"touchmove",setSV),ir.bind(window,"mouseup",fieldUpSV),ir.bind(window,"touchend",fieldUpSV)}function fieldDownH(e){setH(e),ir.bind(window,"mousemove",setH),ir.bind(window,"touchmove",setH),ir.bind(window,"mouseup",fieldUpH),ir.bind(window,"touchend",fieldUpH)}function fieldUpSV(){ir.unbind(window,"mousemove",setSV),ir.unbind(window,"touchmove",setSV),ir.unbind(window,"mouseup",fieldUpSV),ir.unbind(window,"touchend",fieldUpSV),onFinish()}function fieldUpH(){ir.unbind(window,"mousemove",setH),ir.unbind(window,"touchmove",setH),ir.unbind(window,"mouseup",fieldUpH),ir.unbind(window,"touchend",fieldUpH),onFinish()}function onBlur(){var e=Yn(this.value);!1!==e?(s.__color.__state=e,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function onFinish(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}function setSV(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=s.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,i=n.clientY,o=(r-t.left)/(t.right-t.left),a=1-(i-t.top)/(t.bottom-t.top);return 1<a?a=1:a<0&&(a=0),1<o?o=1:o<0&&(o=0),s.__color.v=a,s.__color.s=o,s.setValue(s.__color.toOriginal()),!1}function setH(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=s.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<n?n=1:n<0&&(n=0),s.__color.h=360*n,s.setValue(s.__color.toOriginal()),!1}return Gn.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Gn.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Gn.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Gn.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Gn.extend(r.style,{width:"100%",height:"100%",background:"none"}),linearGradient(r,"top","rgba(0,0,0,0)","#000"),Gn.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),function hueGradient(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}(n.__hue_field),Gn.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),ir.bind(n.__saturation_field,"mousedown",fieldDown),ir.bind(n.__saturation_field,"touchstart",fieldDown),ir.bind(n.__field_knob,"mousedown",fieldDown),ir.bind(n.__field_knob,"touchstart",fieldDown),ir.bind(n.__hue_field,"mousedown",fieldDownH),ir.bind(n.__hue_field,"touchstart",fieldDownH),n.__saturation_field.appendChild(r),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return Jn(ColorController,tr),Qn(ColorController,[{key:"updateDisplay",value:function updateDisplay(){var t=Yn(this.getValue());if(!1!==t){var n=!1;Gn.each(er.COMPONENTS,function(e){if(!Gn.isUndefined(t[e])&&!Gn.isUndefined(this.__color.__state[e])&&t[e]!==this.__color.__state[e])return n=!0,{}},this),n&&Gn.extend(this.__color.__state,t)}Gn.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,r=255-e;Gn.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Gn.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),ColorController}(),hr=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(t,n,r,i){t.style.background="",Gn.each(hr,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+r+" 0%, "+i+" 100%); "})}var pr=function inject(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(e){}},mr=function ControllerFactory(e,t){var n=e[t];return Gn.isArray(arguments[2])||Gn.isObject(arguments[2])?new ar(e,t,arguments[2]):Gn.isNumber(n)?Gn.isNumber(arguments[2])&&Gn.isNumber(arguments[3])?Gn.isNumber(arguments[4])?new lr(e,t,arguments[2],arguments[3],arguments[4]):new lr(e,t,arguments[2],arguments[3]):Gn.isNumber(arguments[4])?new cr(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new cr(e,t,{min:arguments[2],max:arguments[3]}):Gn.isString(n)?new sr(e,t):Gn.isFunction(n)?new dr(e,t,""):Gn.isBoolean(n)?new or(e,t):null};var _r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function dat_gui_module_requestAnimationFrame(e){setTimeout(e,1e3/60)},gr=function(){function CenteredDiv(){Kn(this,CenteredDiv),this.backgroundElement=document.createElement("div"),Gn.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),ir.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Gn.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;ir.bind(this.backgroundElement,"click",function(){e.hide()})}return Qn(CenteredDiv,[{key:"show",value:function show(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Gn.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function hide(){var e=this,hide=function hide(){e.domElement.style.display="none",e.backgroundElement.style.display="none",ir.unbind(e.domElement,"webkitTransitionEnd",hide),ir.unbind(e.domElement,"transitionend",hide),ir.unbind(e.domElement,"oTransitionEnd",hide)};ir.bind(this.domElement,"webkitTransitionEnd",hide),ir.bind(this.domElement,"transitionend",hide),ir.bind(this.domElement,"oTransitionEnd",hide),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function layout(){this.domElement.style.left=window.innerWidth/2-ir.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-ir.getHeight(this.domElement)/2+"px"}}]),CenteredDiv}();pr(function ___$insertStyle(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var yr="Default",vr=function(){try{return!!window.localStorage}catch(e){return!1}}(),br=void 0,Er=!0,Sr=void 0,Ar=!1,Cr=[],Tr=function GUI(e){var t=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),ir.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=Gn.defaults(n,{closeOnTop:!1,autoPlace:!0,width:GUI.DEFAULT_WIDTH}),n=Gn.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),Gn.isUndefined(n.load)?n.load={preset:yr}:n.preset&&(n.load.preset=n.preset),Gn.isUndefined(n.parent)&&n.hideable&&Cr.push(this),n.resizable=Gn.isUndefined(n.parent)&&n.resizable,n.autoPlace&&Gn.isUndefined(n.scrollable)&&(n.scrollable=!0);var r=vr&&"true"===localStorage.getItem(getLocalStorageHash(this,"isLocal")),i=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function get$$1(){return n.parent}},scrollable:{get:function get$$1(){return n.scrollable}},autoPlace:{get:function get$$1(){return n.autoPlace}},closeOnTop:{get:function get$$1(){return n.closeOnTop}},preset:{get:function get$$1(){return t.parent?t.getRoot().preset:n.load.preset},set:function set$$1(e){t.parent?t.getRoot().preset=e:n.load.preset=e,function setPresetSelectIndex(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),t.revert()}},width:{get:function get$$1(){return n.width},set:function set$$1(e){n.width=e,setWidth(t,e)}},name:{get:function get$$1(){return n.name},set:function set$$1(e){n.name=e,o&&(o.innerHTML=n.name)}},closed:{get:function get$$1(){return n.closed},set:function set$$1(e){n.closed=e,n.closed?ir.addClass(t.__ul,GUI.CLASS_CLOSED):ir.removeClass(t.__ul,GUI.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=e?GUI.TEXT_OPEN:GUI.TEXT_CLOSED)}},load:{get:function get$$1(){return n.load}},useLocalStorage:{get:function get$$1(){return r},set:function set$$1(e){vr&&((r=e)?ir.bind(window,"unload",i):ir.unbind(window,"unload",i),localStorage.setItem(getLocalStorageHash(t,"isLocal"),e))}}}),Gn.isUndefined(n.parent)){if(this.closed=n.closed||!1,ir.addClass(this.domElement,GUI.CLASS_MAIN),ir.makeSelectable(this.domElement,!1),vr&&r){t.useLocalStorage=!0;var a=localStorage.getItem(getLocalStorageHash(this,"gui"));a&&(n.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=GUI.TEXT_CLOSED,ir.addClass(this.__closeButton,GUI.CLASS_CLOSE_BUTTON),n.closeOnTop?(ir.addClass(this.__closeButton,GUI.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(ir.addClass(this.__closeButton,GUI.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),ir.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{void 0===n.closed&&(n.closed=!0);var s=document.createTextNode(n.name);ir.addClass(s,"controller-name"),o=addRow(t,s);ir.addClass(this.__ul,GUI.CLASS_CLOSED),ir.addClass(o,"title"),ir.bind(o,"click",function onClickTitle(e){return e.preventDefault(),t.closed=!t.closed,!1}),n.closed||(this.closed=!1)}n.autoPlace&&(Gn.isUndefined(n.parent)&&(Er&&(Sr=document.createElement("div"),ir.addClass(Sr,"dg"),ir.addClass(Sr,GUI.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Sr),Er=!1),Sr.appendChild(this.domElement),ir.addClass(this.domElement,GUI.CLASS_AUTO_PLACE)),this.parent||setWidth(t,n.width)),this.__resizeHandler=function(){t.onResizeDebounced()},ir.bind(window,"resize",this.__resizeHandler),ir.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),ir.bind(this.__ul,"transitionend",this.__resizeHandler),ir.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&function addResizeHandle(t){var n=void 0;function drag(e){return e.preventDefault(),t.width+=n-e.clientX,t.onResize(),n=e.clientX,!1}function dragStop(){ir.removeClass(t.__closeButton,Tr.CLASS_DRAG),ir.unbind(window,"mousemove",drag),ir.unbind(window,"mouseup",dragStop)}function dragStart(e){return e.preventDefault(),n=e.clientX,ir.addClass(t.__closeButton,Tr.CLASS_DRAG),ir.bind(window,"mousemove",drag),ir.bind(window,"mouseup",dragStop),!1}t.__resize_handle=document.createElement("div"),Gn.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),ir.bind(t.__resize_handle,"mousedown",dragStart),ir.bind(t.__closeButton,"mousedown",dragStart),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}(this),i=function saveToLocalStorage(){vr&&"true"===localStorage.getItem(getLocalStorageHash(t,"isLocal"))&&localStorage.setItem(getLocalStorageHash(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=i,n.parent||function resetWidth(){var e=t.getRoot();e.width+=1,Gn.defer(function(){e.width-=1})}()};function addRow(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function removeListeners(e){ir.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&ir.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function markPresetModified(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function recallSavedValue(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[e.preset])a=o[e.preset];else{if(!o[yr])return;a=o[yr]}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function _add(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new fr(t,n);else{var o=[t,n].concat(r.factoryArgs);i=mr.apply(e,o)}r.before instanceof tr&&(r.before=r.before.__li),recallSavedValue(e,i),ir.addClass(i.domElement,"c");var a=document.createElement("span");ir.addClass(a,"property-name"),a.innerHTML=i.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(i.domElement);var u=addRow(e,s,r.before);return ir.addClass(u,Tr.CLASS_CONTROLLER_ROW),i instanceof fr?ir.addClass(u,"color"):ir.addClass(u,qn(i.getValue())),function augmentController(o,t,a){if(a.__li=t,a.__gui=o,Gn.extend(a,{options:function options(e){if(1<arguments.length){var t=a.__li.nextElementSibling;return a.remove(),_add(o,a.object,a.property,{before:t,factoryArgs:[Gn.toArray(arguments)]})}if(Gn.isArray(e)||Gn.isObject(e)){var n=a.__li.nextElementSibling;return a.remove(),_add(o,a.object,a.property,{before:n,factoryArgs:[e]})}},name:function name(e){return a.__li.firstElementChild.firstElementChild.innerHTML=e,a},listen:function listen(){return a.__gui.listen(a),a},remove:function remove(){return a.__gui.remove(a),a}}),a instanceof lr){var i=new cr(a.object,a.property,{min:a.__min,max:a.__max,step:a.__step});Gn.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=a[e],n=i[e];a[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(i,e),t.apply(a,e)}}),ir.addClass(t,"has-slider"),a.domElement.insertBefore(i.domElement,a.domElement.firstElementChild)}else if(a instanceof cr){var e=function r(e){if(Gn.isNumber(a.__min)&&Gn.isNumber(a.__max)){var t=a.__li.firstElementChild.firstElementChild.innerHTML,n=-1<a.__gui.__listening.indexOf(a);a.remove();var i=_add(o,a.object,a.property,{before:a.__li.nextElementSibling,factoryArgs:[a.__min,a.__max,a.__step]});return i.name(t),n&&i.listen(),i}return e};a.min=Gn.compose(e,a.min),a.max=Gn.compose(e,a.max)}else a instanceof or?(ir.bind(t,"click",function(){ir.fakeEvent(a.__checkbox,"click")}),ir.bind(a.__checkbox,"click",function(e){e.stopPropagation()})):a instanceof dr?(ir.bind(t,"click",function(){ir.fakeEvent(a.__button,"click")}),ir.bind(t,"mouseover",function(){ir.addClass(a.__button,"hover")}),ir.bind(t,"mouseout",function(){ir.removeClass(a.__button,"hover")})):a instanceof fr&&(ir.addClass(t,"color"),a.updateDisplay=Gn.compose(function(e){return t.style.borderLeftColor=a.__color.toString(),e},a.updateDisplay),a.updateDisplay());a.setValue=Gn.compose(function(e){return o.getRoot().__preset_select&&a.isModified()&&markPresetModified(o.getRoot(),!0),e},a.setValue)}(e,u,i),e.__controllers.push(i),i}function getLocalStorageHash(e,t){return document.location.href+"."+t}function addPresetOption(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function showHideExplain(e,t){t.style.display=e.useLocalStorage?"block":"none"}function setWidth(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function getCurrentPreset(i,o){var a={};return Gn.each(i.__rememberedObjects,function(e,t){var n={},r=i.__rememberedObjectIndecesToControllers[t];Gn.each(r,function(e,t){n[t]=o?e.initialValue:e.getValue()}),a[t]=n}),a}Tr.toggleHide=function(){Ar=!Ar,Gn.each(Cr,function(e){e.domElement.style.display=Ar?"none":""})},Tr.CLASS_AUTO_PLACE="a",Tr.CLASS_AUTO_PLACE_CONTAINER="ac",Tr.CLASS_MAIN="main",Tr.CLASS_CONTROLLER_ROW="cr",Tr.CLASS_TOO_TALL="taller-than-window",Tr.CLASS_CLOSED="closed",Tr.CLASS_CLOSE_BUTTON="close-button",Tr.CLASS_CLOSE_TOP="close-top",Tr.CLASS_CLOSE_BOTTOM="close-bottom",Tr.CLASS_DRAG="drag",Tr.DEFAULT_WIDTH=245,Tr.TEXT_CLOSED="Close Controls",Tr.TEXT_OPEN="Open Controls",Tr._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Tr.toggleHide()},ir.bind(window,"keydown",Tr._keydownHandler,!1),Gn.extend(Tr.prototype,{add:function add(e,t){return _add(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function addColor(e,t){return _add(this,e,t,{color:!0})},remove:function remove(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Gn.defer(function(){t.onResize()})},destroy:function destroy(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Sr.removeChild(this.domElement);var t=this;Gn.each(this.__folders,function(e){t.removeFolder(e)}),ir.unbind(window,"keydown",Tr._keydownHandler,!1),removeListeners(this)},addFolder:function addFolder(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Tr(t);this.__folders[e]=n;var r=addRow(this,n.domElement);return ir.addClass(r,"folder"),n},removeFolder:function removeFolder(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],removeListeners(t);var e=this;Gn.each(t.__folders,function(e){t.removeFolder(e)}),Gn.defer(function(){e.onResize()})},open:function open(){this.closed=!1},close:function close(){this.closed=!0},onResize:function onResize(){var t=this.getRoot();if(t.scrollable){var e=ir.getOffset(t.__ul).top,n=0;Gn.each(t.__ul.childNodes,function(e){t.autoPlace&&e===t.__save_row||(n+=ir.getHeight(e))}),window.innerHeight-e-20<n?(ir.addClass(t.domElement,Tr.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(ir.removeClass(t.domElement,Tr.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&Gn.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:Gn.debounce(function(){this.onResize()},50),remember:function remember(){if(Gn.isUndefined(br)&&((br=new gr).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;Gn.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function addSaveMenu(n){var e=n.__save_row=document.createElement("li");ir.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),ir.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",ir.addClass(t,"button gears");var r=document.createElement("span");r.innerHTML="Save",ir.addClass(r,"button"),ir.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",ir.addClass(i,"button"),ir.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",ir.addClass(o,"button"),ir.addClass(o,"revert");var a=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?Gn.each(n.load.remembered,function(e,t){addPresetOption(n,t,t===n.preset)}):addPresetOption(n,yr,!1);if(ir.bind(a,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(r),e.appendChild(i),e.appendChild(o),vr){var s=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block","true"===localStorage.getItem(getLocalStorageHash(n,"isLocal"))&&u.setAttribute("checked","checked"),showHideExplain(n,s),ir.bind(u,"change",function(){n.useLocalStorage=!n.useLocalStorage,showHideExplain(n,s)})}var l=document.getElementById("dg-new-constructor");ir.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||br.hide()}),ir.bind(t,"click",function(){l.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),br.show(),l.focus(),l.select()}),ir.bind(r,"click",function(){n.save()}),ir.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),ir.bind(o,"click",function(){n.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&setWidth(this,this.width)},getRoot:function getRoot(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function getSaveObject(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=getCurrentPreset(this)),n.folders={},Gn.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function save(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=getCurrentPreset(this),markPresetModified(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function saveAs(e){this.load.remembered||(this.load.remembered={},this.load.remembered[yr]=getCurrentPreset(this,!0)),this.load.remembered[e]=getCurrentPreset(this),this.preset=e,addPresetOption(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function revert(t){Gn.each(this.__controllers,function(e){this.getRoot().load.remembered?recallSavedValue(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),Gn.each(this.__folders,function(e){e.revert(e)}),t||markPresetModified(this.getRoot(),!1)},listen:function listen(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function updateDisplays(e){0!==e.length&&_r.call(window,function(){updateDisplays(e)});Gn.each(e,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function updateDisplay(){Gn.each(this.__controllers,function(e){e.updateDisplay()}),Gn.each(this.__folders,function(e){e.updateDisplay()})}});var wr=Tr;function GUISystem_typeof(e){return(GUISystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Mr,Rr,xr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":GUISystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Or=function(t){function GUISystem(){var e;return(e=t.call(this)||this).gui=new wr,e}!function GUISystem_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(GUISystem,t);var e=GUISystem.prototype;return e.setUp=function setUp(){this.events.on(On.SYSTEM_EVENTS.ENTITY_ADDED,this.onEntityAdded,this)},e.onEntityAdded=function onEntityAdded(e){var t=e.get(mn).config,n=this.gui;t.folder&&(n=this.gui.addFolder(t.folder));var r=!0,i=!1,o=void 0;try{for(var a,s=t.properties[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;(u.isColor?n.addColor(u.prop,u.propName):u.items?n.add(u.prop,u.propName,u.items):n.add(u.prop,u.propName,u.min,u.max)).onChange(u.onChange).onFinishChange(u.onFinishChange)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}},GUISystem}(Kt.System);Or=xr([Kt.ECS.System(mn)],Or),(Rr=Mr||(Mr={})).KEYDOWN="KEY_DOWN",Rr.KEYPRESS="KEY_PRESS",Rr.KEYUP="KEY_UP",Rr.MOUSECLICK="MOUSE_CLICK",Rr.CONTEXTMENU="CONTEXT_MENU",Rr.DOUBLECLICK="DOUBLE_CLICK",Rr.MOUSEDOWN="MOUSE_DOWN",Rr.MOUSEOUT="MOUSE_OUT",Rr.MOUSEOVER="MOUSE_OVER",Rr.MOUSEUP="MOUSE_UP",Rr.MOUSEMOVE="MOUSE_MOVE",Rr.WHEEL="WHEEL";var Pr=new R,Lr={onKeyDown:new ct(Pr,Mr.KEYDOWN),onKeyPress:new ct(Pr,Mr.KEYPRESS),onKeyUp:new ct(Pr,Mr.KEYUP),onClick:new ct(Pr,Mr.MOUSECLICK),onContextMenu:new ct(Pr,Mr.CONTEXTMENU),onDoubleClick:new ct(Pr,Mr.DOUBLECLICK),onMouseDown:new ct(Pr,Mr.MOUSEDOWN),onMouseOut:new ct(Pr,Mr.MOUSEOUT),onMouseOver:new ct(Pr,Mr.MOUSEOVER),onMouseUp:new ct(Pr,Mr.MOUSEUP),onMouseMove:new ct(Pr,Mr.MOUSEMOVE),onWheel:new ct(Pr,Mr.WHEEL)};function LookAtCameraControlSystem_typeof(e){return(LookAtCameraControlSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}document.onkeydown=function(e){Lr.onKeyDown.dispatch(e)},document.onkeypress=function(e){Lr.onKeyPress.dispatch(e)},document.onkeyup=function(e){Lr.onKeyUp.dispatch(e)},document.onclick=function(e){Lr.onClick.dispatch(e)},document.oncontextmenu=function(e){Lr.onContextMenu.dispatch(e)},document.ondblclick=function(e){Lr.onDoubleClick.dispatch(e)},document.onmousedown=function(e){Lr.onMouseDown.dispatch(e)},document.onmouseout=function(e){Lr.onMouseOut.dispatch(e)},document.onmouseover=function(e){Lr.onMouseOver.dispatch(e)},document.onmouseup=function(e){Lr.onMouseUp.dispatch(e)},document.onmousemove=function(e){Lr.onMouseMove.dispatch(e)},document.onwheel=function(e){Lr.onWheel.dispatch(e)};var kr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":LookAtCameraControlSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Dr=function(n){function LookAtCameraControlSystem(e){var t;return(t=n.call(this)||this).canvas=e,t.lastMouseX=-1,t.lastMouseY=-1,t.drag=!1,t}!function LookAtCameraControlSystem_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(LookAtCameraControlSystem,n);var e=LookAtCameraControlSystem.prototype;return e.setUp=function setUp(){var t=this;this.canvas.element.addEventListener("mousedown",function(e){return t.onMouseDown(e)}),this.canvas.element.addEventListener("mouseup",function(e){return t.onMouseUp(e)}),this.canvas.element.addEventListener("mousemove",function(e){return t.onMouseMove(e)}),Lr.onWheel.add(this.onMouseWheel,this),Lr.onKeyDown.add(this.onKeyDown,this)},e.onMouseDown=function onMouseDown(e){this.drag=!0,-1===this.lastMouseX&&(this.lastMouseX=e.x),-1===this.lastMouseY&&(this.lastMouseY=e.y)},e.calcTranslation=function calcTranslation(e,t,n){var r=b.create();b.add(r,r,e),b.add(r,r,t);var i=b.fromValues(n[0]/n[3],n[1]/n[3],n[2]/n[3]);return b.add(r,r,i)},e.onMouseUp=function onMouseUp(e){for(var t,n=0;t=this.entities[n];n++){var r=t.get(xn),i=t.get(hn),o=this.calcTranslation(i.panning,i.zooming,r.rotation);b.add(r.translation,r.translation,o),b.add(i.target,i.target,i.panning),E.set(r.rotation,0,0,0,r.rotation[3]),b.set(i.panning,0,0,0),b.set(i.zooming,0,0,0)}this.drag=!1,this.lastMouseX=-1,this.lastMouseY=-1},e.onMouseWheel=function onMouseWheel(e){for(var t,n=0;t=this.entities[n];n++){var r=t.get(xn),i=t.get(hn);this.zoom(t,e.deltaY,.001);var o=this.calcTranslation(i.panning,i.zooming,r.rotation);b.add(r.translation,r.translation,o),b.set(i.zooming,0,0,0)}},e.onMouseMove=function onMouseMove(e){if(this.drag)for(var t,n=0;t=this.entities[n];n++)this.rotate(t,e.x,e.y),this.lastMouseX=e.x,this.lastMouseY=e.y},e.onKeyDown=function onKeyDown(e){var t=0,n=0;"w"===e.key&&(t+=.1),"s"===e.key&&(t-=.1),"a"===e.key&&(n+=.1),"d"===e.key&&(n-=.1);for(var r,i=0;r=this.entities[i];i++){var o=r.get(hn),a=r.get(xn);this.pan(r,n,t);var s=this.calcTranslation(o.panning,o.zooming,a.rotation);b.add(a.translation,a.translation,s),b.add(o.target,o.target,o.panning),b.set(o.panning,0,0,0)}},e.pan=function pan(e,t,n){var r=e.get(hn),i=e.get(xn),o=b.create();b.subtract(o,r.target,i.translation),b.normalize(o,o);var a=b.create();b.cross(a,o,r.up),b.normalize(a,a);var s=b.create();b.cross(s,o,a),b.scale(a,a,t),b.scale(s,s,n),b.add(r.panning,a,s)},e.zoom=function zoom(e,t,n){var r=e.get(hn),i=e.get(xn),o=(r.zoomPos-t)*n,a=b.create();b.subtract(a,r.target,i.translation);var s=b.length(a);b.normalize(a,a),s-o<=1?b.scale(r.zooming,a,s-1):b.scale(r.zooming,a,o)},e.rotate=function rotate(e,t,n){var r=e.get(hn),i=e.get(xn),o=_n.getVSpherePos(this.lastMouseX,this.lastMouseY,this.canvas.width,this.canvas.height),a=_n.getVSpherePos(t,n,this.canvas.width,this.canvas.height),s=b.create();if(b.subtract(s,o,a),!(b.squaredLength(s)<1e-4)){var u=b.dot(o,a);1<u?u=1:u<-1&&(u=-1);var c=Math.acos(u),l=b.create();b.cross(l,a,o),b.normalize(l,l);var d=b.create();b.subtract(d,i.translation,r.target);var f=b.fromValues(0,0,b.length(d)),h=_n.rotateAxisAngle(f,l,c),p=b.create();b.subtract(p,r.target,i.translation),b.normalize(p,p);var m=b.create();b.cross(m,p,r.up),b.normalize(m,m);var _=b.create();b.cross(_,m,p);var g=b.fromValues(m[0]*h[0]+_[0]*h[1]+-p[0]*h[2],m[1]*h[0]+_[1]*h[1]+-p[1]*h[2],m[2]*h[0]+_[2]*h[1]+-p[2]*h[2]),y=b.create();b.subtract(y,g,b.subtract(y,i.translation,r.target));var v=i.rotation[3];E.set(i.rotation,y[0]/v,y[1]/v,y[2]/v,v)}},e.update=function update(){for(var e,t=0;e=this.entities[t];t++){var n=e.get(dn),r=e.get(xn),i=e.get(hn),o=this.calcTranslation(i.panning,i.zooming,r.rotation);b.add(r.translation,r.translation,o),b.add(i.target,i.target,i.panning),E.set(r.rotation,0,0,0,r.rotation[3]),b.set(i.panning,0,0,0),b.set(i.zooming,0,0,0);var a=b.create();b.add(a,i.target,i.panning);var s=b.create();b.add(s,i.panning,i.zooming),b.add(s,s,r.translation),u.lookAt(n.viewMatrix,s,a,i.up)}},LookAtCameraControlSystem}(Kt.System);function CameraSystem_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function CameraSystem_typeof(e){return(CameraSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Dr=kr([Kt.ECS.System(xn,dn,hn)],Dr);var Br=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":CameraSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Ir=function(n){function CameraSystem(e){var t;return(t=n.call(this)||this).gl=e.gl,t.translation=b.create(),t}!function CameraSystem_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(CameraSystem,n);var e=CameraSystem.prototype;return e.setUp=function setUp(){var e=u.create();this.cameraUBO=new nt(this.gl,i.CAMERA),this.cameraUBO.addItem("projectionMatrix","mat4"),this.cameraUBO.addItem("viewMatrix","mat4"),this.cameraUBO.addItem("viewPos","vec3"),this.cameraUBO.updateItem("projectionMatrix",e),this.cameraUBO.updateItem("viewMatrix",e),this.cameraUBO.updateItem("viewPos",this.translation),this.cameraUBO.upload(),this.cameraUBO.bindUBO(),this.events.on(On.SYSTEM_EVENTS.ENTITY_ADDED,this.initEntity,this),this.events.on(On.SYSTEM_EVENTS.ENTITY_REMOVED,this.removeEntity,this)},e.initEntity=function initEntity(e){if(!this._camera){this._camera=e;var t=this._camera.get(dn),n=this._camera.get(xn);this.cameraUBO.updateItem("projectionMatrix",t.projMatrix),this.cameraUBO.updateItem("viewMatrix",t.viewMatrix),this.cameraUBO.updateItem("viewPos",u.getTranslation(this.translation,n.modelMatrix)),this.cameraUBO.upload(),this.cameraUBO.bindUBO()}},e.removeEntity=function removeEntity(e){e===this._camera&&(this._camera=void 0)},e.render=function render(){if(this._camera){var e=this._camera.get(dn),t=this._camera.get(xn);this.cameraUBO.updateItem("projectionMatrix",e.projMatrix,!0),this.cameraUBO.updateItem("viewMatrix",e.viewMatrix,!0),this.cameraUBO.updateItem("viewPos",u.getTranslation(this.translation,t.modelMatrix),!0)}},function CameraSystem_createClass(e,t,n){return t&&CameraSystem_defineProperties(e.prototype,t),n&&CameraSystem_defineProperties(e,n),e}(CameraSystem,[{key:"camera",get:function get(){return this._camera},set:function set(e){this._camera=e}}]),CameraSystem}(Kt.System);function AnimationSystem_typeof(e){return(AnimationSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Ir=Br([Kt.ECS.System(xn,dn)],Ir);var Nr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":AnimationSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Fr=function(n){function AnimationSystem(e){var t;return(t=n.call(this)||this).cache=e,t}!function AnimationSystem_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(AnimationSystem,n);var e=AnimationSystem.prototype;return e.setUp=function setUp(){},e.tearDown=function tearDown(){},e.update=function update(e){for(var t,n=0;t=this.entities[n];n++){var r=t.get(Tn);r.autoStart&&r.loop&&!r.running&&r.start();var i=this.cache.get(rt.ANIMATION,r.key),o=r.pauseEnd-r.pauseStart,a=e-r.startTime-o;!r.paused&&r.running&&i.animate(a),a>=i.durationMS&&r.stop()}},AnimationSystem}(Kt.System);function worldScene_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Fr=Nr([Kt.ECS.System(Tn)],Fr);var Ur=function(){function WorldScene(e){this.entities={},this._destroyOnTearDown=e.destroyOnTearDown||!1,this._name=e.name}var e=WorldScene.prototype;return e.setUp=function setUp(e,t){this._loader=e,this._cache=t,this._active=!0,this.preload(),this._loader.onComplete.once(this.create,this),this._loader.load()},e.tearDown=function tearDown(){if(this.shutdown(),this._active=!1,this._destroyOnTearDown)for(var e,t=Object.keys(this.entities),n=0;e=this.entities[t[n]];n++)Kt.ECS.destroyEntity(e);else for(var r,i=Object.keys(this.entities),o=0;r=this.entities[i[o]];o++)Kt.ECS.removeEntity(r)},e.restore=function restore(){for(var e,t=0;e=this.entities[t];t++)Kt.ECS.addEntity(e)},e.add=function add(e){return this.entities[e.id]=Kt.ECS.addEntity(e),e},e.remove=function remove(e){return delete this.entities[e.id],Kt.ECS.removeEntity(e)},e.destroy=function destroy(e){return delete this.entities[e.id],Kt.ECS.destroyEntity(e)},function worldScene_createClass(e,t,n){return t&&worldScene_defineProperties(e.prototype,t),n&&worldScene_defineProperties(e,n),e}(WorldScene,[{key:"name",get:function get(){return this._name}},{key:"destroyOnTearDown",get:function get(){return this._destroyOnTearDown},set:function set(e){this._destroyOnTearDown=e}},{key:"active",get:function get(){return this._active},set:function set(e){this._active=e}},{key:"loader",get:function get(){return this._loader},set:function set(e){this._loader=e}},{key:"cache",get:function get(){return this._cache},set:function set(e){this._cache=e}}]),WorldScene}();function worldSystem_typeof(e){return(worldSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var jr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":worldSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},Gr=function(n){function WorldSystem(e){var t;return(t=n.call(this)||this)._loader=e.loader,t._cache=e.cache,t}!function worldSystem_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(WorldSystem,n);var e=WorldSystem.prototype;return e.setUp=function setUp(){this._scenes=Object.create(null)},e.tearDown=function tearDown(){for(var e,t=Object.keys(this._scenes),n=0;e=this._scenes[t[n]];n++)this.removeScene(e)},e.update=function update(){for(var e,t=Object.keys(this._scenes),n=0;e=this._scenes[t[n]];n++)e.active&&e.update()},e.getKey=function getKey(e){var t=e;return e instanceof Ur&&(t=e.name),t},e.addScene=function addScene(e){return this._scenes[e.name]=e},e.removeScene=function removeScene(e){var t=this.getKey(e),n=this._scenes[t];return n.tearDown(),delete this._scenes[t],n},e.start=function start(e){var t=this.getKey(e);return this._scenes[t].setUp(this._loader,this._cache),this._scenes[t]},e.stop=function stop(e){var t=this.getKey(e);return this._scenes[t].tearDown(),this._scenes[t]},e.restore=function restore(e){var t=this.getKey(e);return this._scenes[t].restore(),this._scenes[t]},WorldSystem}(Kt.System);function Viewer_defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Gr=jr([Kt.ECS.System()],Gr);var Vr,Hr,zr=function(){function Viewer(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{width:1280,height:720};this._canvas=new M({width:e.width,height:e.height}),this._loader=new G,this._cache=new at}var e=Viewer.prototype;return e.init=function init(e){var t=this;this._canvas.appendCanvas("root");var n=this._canvas.context;this._gl=n,this._cache.addCache(rt.MATERIAL,new lt),this._cache.addCache(rt.MESH,new lt),this._cache.addCache(rt.TEXTURE,new lt),this._cache.addCache(rt.SCENE,new lt),this._cache.addCache(rt.ANIMATION,new lt),this._loader.addMiddleware(new dt(n),dt),this._loader.addMiddleware(new _t(n),_t),this._loader.addMiddleware(new qt(n,this._cache),qt),this._loader.addMiddleware(new Qt(n),Qt),this._loader.onLoadComplete.on(function(e){t._cache.add(e.type,e.key,e.data)}),this.defaultMaterial(),this._shader=new an(this._gl,this._cache),this._skyboxShader=new sn(this._gl,this._cache),this._loader.get(Qt).add("shader","../assets/shader/pbr-vert.glsl","../assets/shader/pbr-frag.glsl",this._shader),this._loader.get(Qt).add("skyboxShader","../assets/shader/skybox-vert.glsl","../assets/shader/skybox-frag.glsl",this._skyboxShader),this.load(e)},e.defaultMaterial=function defaultMaterial(){var e=this._gl,t=ee.fromData(e,new Uint8Array([128,128,128,255]),1,1,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE);t.enableNearestScaling(),t.enableWrapClamp(),this._cache.getCache(rt.TEXTURE).add("__default__",t);var n=new vt;n.baseColorFactor=a.fromValues(.5,.5,.5,1);var r=new gt(name,n);r.maps[pt.ALBEDO]=new yt("__default__"),this._cache.getCache(rt.MATERIAL).add("__default__",r)},e.createSystems=function createSystems(){Kt.ECS.systemUpdateMethods=["update","render"],this._world=Kt.ECS.addSystem(new Gr({loader:this._loader,cache:this._cache})),Kt.ECS.addSystem(new Ir({gl:this._gl})),Kt.ECS.addSystem(new Dr(this._canvas)),Kt.ECS.addSystem(new Or),Kt.ECS.addSystem(new Fr(this._cache)),Kt.ECS.addSystem(new Fn(this._gl)),Kt.ECS.addSystem(new In({gl:this._gl,cache:this._cache,shader:this._shader})),Kt.ECS.addSystem(new cn({gl:this._gl,cache:this._cache,shader:this._skyboxShader}))},e.load=function load(e){var t=this;this._loader.load(function(){t._shader.upload(),t._skyboxShader.upload(),t.createSystems(),e(),t.update(0)})},e.update=function update(e){var t=this;Kt.ECS.update(e),requestAnimationFrame(function(e){t.update(e)})},function Viewer_createClass(e,t,n){return t&&Viewer_defineProperties(e.prototype,t),n&&Viewer_defineProperties(e,n),e}(Viewer,[{key:"cache",get:function get(){return this._cache},set:function set(e){this._cache=e}},{key:"canvas",get:function get(){return this._canvas},set:function set(e){this._canvas=e}},{key:"loader",get:function get(){return this._loader},set:function set(e){this._loader=e}},{key:"gl",get:function get(){return this._gl},set:function set(e){this._gl=e}},{key:"shader",get:function get(){return this._shader},set:function set(e){this._shader=e}},{key:"skyboxShader",get:function get(){return this._skyboxShader},set:function set(e){this._skyboxShader=e}},{key:"world",get:function get(){return this._world},set:function set(e){this._world=e}}]),Viewer}();(Hr=Vr||(Vr={})).OPAQUE="OPAQUE",Hr.MASK="MASK",Hr.BLEND="BLEND";var Yr=function(e){function EnvironmentScene(){return e.apply(this,arguments)||this}!function EnvironmentScene_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(EnvironmentScene,e);var t=EnvironmentScene.prototype;return t.preload=function preload(){this.loader.get(dt).add(y,[{right:"./assets/ibl/environment/environment_right_0.jpg",left:"./assets/ibl/environment/environment_left_0.jpg",top:"./assets/ibl/environment/environment_top_0.jpg",bottom:"./assets/ibl/environment/environment_bottom_0.jpg",front:"./assets/ibl/environment/environment_front_0.jpg",back:"./assets/ibl/environment/environment_back_0.jpg"}]),this.loader.get(dt).add(_,[{right:"./assets/ibl/diffuse/diffuse_right_0.jpg",left:"./assets/ibl/diffuse/diffuse_left_0.jpg",top:"./assets/ibl/diffuse/diffuse_top_0.jpg",bottom:"./assets/ibl/diffuse/diffuse_bottom_0.jpg",front:"./assets/ibl/diffuse/diffuse_front_0.jpg",back:"./assets/ibl/diffuse/diffuse_back_0.jpg"}],{premultiplyAlpha:!1,internalFormat:J.SRGB8_ALPHA8,format:J.RGBA,type:U.UNSIGNED_BYTE});for(var e=[],t=0;t<10;t++)e.push({right:"./assets/ibl/specular/specular_right_"+t+".jpg",left:"./assets/ibl/specular/specular_left_"+t+".jpg",top:"./assets/ibl/specular/specular_top_"+t+".jpg",bottom:"./assets/ibl/specular/specular_bottom_"+t+".jpg",front:"./assets/ibl/specular/specular_front_"+t+".jpg",back:"./assets/ibl/specular/specular_back_"+t+".jpg"});this.loader.get(dt).add(g,e,{premultiplyAlpha:!1,internalFormat:J.SRGB8_ALPHA8,format:J.RGBA,type:U.UNSIGNED_BYTE}),this.loader.get(_t).add(m,"./assets/ibl/brdfLUT.png",{premultiplyAlpha:!1,internalFormat:J.SRGB8_ALPHA8,format:J.RGBA,type:U.UNSIGNED_BYTE,sampler:{magFilter:W.LINEAR,minFilter:q.LINEAR,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE}})},t.create=function create(){var e=Kt.ECS.createEntity(),t=new En({lightColor:[255,255,255],lightScale:1,lightRotation:75,lightPitch:40});e.add(t),e.add(new mn({folder:"Directional Light",properties:[{prop:t,propName:"lightColor",isColor:!0,onChange:function onChange(){return t.updateLight()}},{prop:t,propName:"lightScale",min:0,max:10,onChange:function onChange(){return t.updateLight()}},{prop:t,propName:"lightRotation",min:0,max:360,onChange:function onChange(){return t.updateLight()}},{prop:t,propName:"lightPitch",min:-90,max:90,onChange:function onChange(){return t.updateLight()}}]})),this.add(e)},t.shutdown=function shutdown(){},t.update=function update(){},EnvironmentScene}(Ur);var Wr=function(n){function ModelScene(e){var t;return(t=n.call(this,e)||this).gltfJson=void 0,t.gltfBin=void 0,t.shader=void 0,t.gltfJson=e.gltfJson,t.gltfBin=e.gltfBin,t.shader=e.shader,t}!function ModelScene_inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(ModelScene,n);var e=ModelScene.prototype;return e.preload=function preload(){this.loader.get(qt).add("ExampleScene",this.gltfJson,this.gltfBin)},e.create=function create(){var e=this.cache.get(rt.SCENE,"ExampleScene");this.shader.unload(),this.shader.initializeDefines(e.meshes[0]),this.shader.upload();var t=Kt.ECS.createEntity();if(t.add(new Mn({key:"ExampleScene"})),t.add(new xn({position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}})),e.animations[0]){var n=e.animations[0].name;t.add(new Tn({key:n}))}this.add(t)},e.shutdown=function shutdown(){},e.update=function update(){},ModelScene}(Ur),Xr={BoxAnimated:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BoxAnimated/glTF/BoxAnimated.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BoxAnimated/glTF/BoxAnimated0.bin"},RiggedSimple:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/RiggedSimple/glTF/RiggedSimple.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/RiggedSimple/glTF/RiggedSimple0.bin"},BrainStem:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BrainStem/glTF/BrainStem.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BrainStem/glTF/BrainStem0.bin"},WaterBottle:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/WaterBottle/glTF/WaterBottle.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/WaterBottle/glTF/WaterBottle.bin"},Sponza:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Sponza/glTF/Sponza.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Sponza/glTF/Sponza.bin"},DamagedHelmet:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF/DamagedHelmet.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF/DamagedHelmet.bin"},MetalRoughSpheres:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/MetalRoughSpheres/glTF/MetalRoughSpheres.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/MetalRoughSpheres/glTF/MetalRoughSpheres0.bin"}},qr=function(){function Example(){var e=this;this.camera=void 0,this.viewer=void 0,this.scene=void 0,this.scene="DamagedHelmet",this.viewer=new zr({width:window.innerWidth,height:window.innerHeight}),this.viewer.init(function(){return e.init()})}var e=Example.prototype;return e.init=function init(){this.createSceneSelector(),this.createCamera(),this.viewer.world.addScene(new Yr({name:"Environment"})),this.viewer.world.addScene(new Wr({name:"ModelScene",gltfJson:Xr[this.scene].gltfJson,gltfBin:Xr[this.scene].gltfBin,shader:this.viewer.shader})),this.viewer.world.start("Environment"),this.viewer.world.start("ModelScene")},e.reloadModelScene=function reloadModelScene(){this.viewer.loader.stop(),this.viewer.world.removeScene("ModelScene"),this.viewer.world.addScene(new Wr({name:"ModelScene",gltfJson:Xr[this.scene].gltfJson,gltfBin:Xr[this.scene].gltfBin,shader:this.viewer.shader})),this.viewer.world.start("ModelScene")},e.createCamera=function createCamera(){var e=this;this.camera=Kt.ECS.createEntity(),this.camera.add(new dn({aspect:window.innerWidth/window.innerHeight,fovy:45*Math.PI/180,near:.01,far:100})),this.camera.add(new xn({position:{x:0,y:0,z:-4},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}})),this.camera.add(new hn),Kt.ECS.addEntity(this.camera),window.addEventListener("resize",function(){return e.onResize()})},e.onResize=function onResize(){this.camera&&u.perspective(this.camera.get(dn).projMatrix,45*Math.PI/180,window.innerWidth/window.innerHeight,.01,100)},e.createSceneSelector=function createSceneSelector(){var e=this,t=Kt.ECS.createEntity();t.add(new mn({properties:[{prop:this,propName:"scene",items:Object.keys(Xr),onChange:function onChange(){return e.reloadModelScene()}}]})),Kt.ECS.addEntity(t)},Example}();window.onload=function(){new qr}}]);