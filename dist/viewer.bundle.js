!function(n){var r={};function __webpack_require__(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,__webpack_require__),e.l=!0,e.exports}__webpack_require__.m=n,__webpack_require__.c=r,__webpack_require__.d=function(t,e,n){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)__webpack_require__.d(n,r,function(t){return e[t]}.bind(null,r));return n},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=25)}([function(t,e,n){"use strict";n.r(e),n.d(e,"glMatrix",function(){return r}),n.d(e,"mat2",function(){return o}),n.d(e,"mat2d",function(){return i}),n.d(e,"mat3",function(){return a}),n.d(e,"mat4",function(){return s}),n.d(e,"quat",function(){return l}),n.d(e,"quat2",function(){return f}),n.d(e,"vec2",function(){return d}),n.d(e,"vec3",function(){return u}),n.d(e,"vec4",function(){return c});var r={};n.r(r),n.d(r,"EPSILON",function(){return I}),n.d(r,"ARRAY_TYPE",function(){return v}),n.d(r,"RANDOM",function(){return h}),n.d(r,"setMatrixArrayType",function(){return setMatrixArrayType}),n.d(r,"toRadian",function(){return toRadian}),n.d(r,"equals",function(){return equals});var o={};n.r(o),n.d(o,"create",function(){return create}),n.d(o,"clone",function(){return clone}),n.d(o,"copy",function(){return copy}),n.d(o,"identity",function(){return identity}),n.d(o,"fromValues",function(){return fromValues}),n.d(o,"set",function(){return set}),n.d(o,"transpose",function(){return transpose}),n.d(o,"invert",function(){return invert}),n.d(o,"adjoint",function(){return adjoint}),n.d(o,"determinant",function(){return determinant}),n.d(o,"multiply",function(){return multiply}),n.d(o,"rotate",function(){return rotate}),n.d(o,"scale",function(){return mat2_scale}),n.d(o,"fromRotation",function(){return fromRotation}),n.d(o,"fromScaling",function(){return fromScaling}),n.d(o,"str",function(){return str}),n.d(o,"frob",function(){return frob}),n.d(o,"LDU",function(){return LDU}),n.d(o,"add",function(){return add}),n.d(o,"subtract",function(){return subtract}),n.d(o,"exactEquals",function(){return exactEquals}),n.d(o,"equals",function(){return mat2_equals}),n.d(o,"multiplyScalar",function(){return multiplyScalar}),n.d(o,"multiplyScalarAndAdd",function(){return multiplyScalarAndAdd}),n.d(o,"mul",function(){return m}),n.d(o,"sub",function(){return _});var i={};n.r(i),n.d(i,"create",function(){return mat2d_create}),n.d(i,"clone",function(){return mat2d_clone}),n.d(i,"copy",function(){return mat2d_copy}),n.d(i,"identity",function(){return mat2d_identity}),n.d(i,"fromValues",function(){return mat2d_fromValues}),n.d(i,"set",function(){return mat2d_set}),n.d(i,"invert",function(){return mat2d_invert}),n.d(i,"determinant",function(){return mat2d_determinant}),n.d(i,"multiply",function(){return mat2d_multiply}),n.d(i,"rotate",function(){return mat2d_rotate}),n.d(i,"scale",function(){return mat2d_scale}),n.d(i,"translate",function(){return translate}),n.d(i,"fromRotation",function(){return mat2d_fromRotation}),n.d(i,"fromScaling",function(){return mat2d_fromScaling}),n.d(i,"fromTranslation",function(){return fromTranslation}),n.d(i,"str",function(){return mat2d_str}),n.d(i,"frob",function(){return mat2d_frob}),n.d(i,"add",function(){return mat2d_add}),n.d(i,"subtract",function(){return mat2d_subtract}),n.d(i,"multiplyScalar",function(){return mat2d_multiplyScalar}),n.d(i,"multiplyScalarAndAdd",function(){return mat2d_multiplyScalarAndAdd}),n.d(i,"exactEquals",function(){return mat2d_exactEquals}),n.d(i,"equals",function(){return mat2d_equals}),n.d(i,"mul",function(){return y}),n.d(i,"sub",function(){return g});var a={};n.r(a),n.d(a,"create",function(){return mat3_create}),n.d(a,"fromMat4",function(){return fromMat4}),n.d(a,"clone",function(){return mat3_clone}),n.d(a,"copy",function(){return mat3_copy}),n.d(a,"fromValues",function(){return mat3_fromValues}),n.d(a,"set",function(){return mat3_set}),n.d(a,"identity",function(){return mat3_identity}),n.d(a,"transpose",function(){return mat3_transpose}),n.d(a,"invert",function(){return mat3_invert}),n.d(a,"adjoint",function(){return mat3_adjoint}),n.d(a,"determinant",function(){return mat3_determinant}),n.d(a,"multiply",function(){return mat3_multiply}),n.d(a,"translate",function(){return mat3_translate}),n.d(a,"rotate",function(){return mat3_rotate}),n.d(a,"scale",function(){return mat3_scale}),n.d(a,"fromTranslation",function(){return mat3_fromTranslation}),n.d(a,"fromRotation",function(){return mat3_fromRotation}),n.d(a,"fromScaling",function(){return mat3_fromScaling}),n.d(a,"fromMat2d",function(){return fromMat2d}),n.d(a,"fromQuat",function(){return fromQuat}),n.d(a,"normalFromMat4",function(){return normalFromMat4}),n.d(a,"projection",function(){return projection}),n.d(a,"str",function(){return mat3_str}),n.d(a,"frob",function(){return mat3_frob}),n.d(a,"add",function(){return mat3_add}),n.d(a,"subtract",function(){return mat3_subtract}),n.d(a,"multiplyScalar",function(){return mat3_multiplyScalar}),n.d(a,"multiplyScalarAndAdd",function(){return mat3_multiplyScalarAndAdd}),n.d(a,"exactEquals",function(){return mat3_exactEquals}),n.d(a,"equals",function(){return mat3_equals}),n.d(a,"mul",function(){return b}),n.d(a,"sub",function(){return E});var s={};n.r(s),n.d(s,"create",function(){return mat4_create}),n.d(s,"clone",function(){return mat4_clone}),n.d(s,"copy",function(){return mat4_copy}),n.d(s,"fromValues",function(){return mat4_fromValues}),n.d(s,"set",function(){return mat4_set}),n.d(s,"identity",function(){return mat4_identity}),n.d(s,"transpose",function(){return mat4_transpose}),n.d(s,"invert",function(){return mat4_invert}),n.d(s,"adjoint",function(){return mat4_adjoint}),n.d(s,"determinant",function(){return mat4_determinant}),n.d(s,"multiply",function(){return mat4_multiply}),n.d(s,"translate",function(){return mat4_translate}),n.d(s,"scale",function(){return mat4_scale}),n.d(s,"rotate",function(){return mat4_rotate}),n.d(s,"rotateX",function(){return rotateX}),n.d(s,"rotateY",function(){return rotateY}),n.d(s,"rotateZ",function(){return rotateZ}),n.d(s,"fromTranslation",function(){return mat4_fromTranslation}),n.d(s,"fromScaling",function(){return mat4_fromScaling}),n.d(s,"fromRotation",function(){return mat4_fromRotation}),n.d(s,"fromXRotation",function(){return fromXRotation}),n.d(s,"fromYRotation",function(){return fromYRotation}),n.d(s,"fromZRotation",function(){return fromZRotation}),n.d(s,"fromRotationTranslation",function(){return fromRotationTranslation}),n.d(s,"fromQuat2",function(){return fromQuat2}),n.d(s,"getTranslation",function(){return getTranslation}),n.d(s,"getScaling",function(){return getScaling}),n.d(s,"getRotation",function(){return getRotation}),n.d(s,"fromRotationTranslationScale",function(){return fromRotationTranslationScale}),n.d(s,"fromRotationTranslationScaleOrigin",function(){return fromRotationTranslationScaleOrigin}),n.d(s,"fromQuat",function(){return mat4_fromQuat}),n.d(s,"frustum",function(){return frustum}),n.d(s,"perspective",function(){return perspective}),n.d(s,"perspectiveFromFieldOfView",function(){return perspectiveFromFieldOfView}),n.d(s,"ortho",function(){return ortho}),n.d(s,"lookAt",function(){return lookAt}),n.d(s,"targetTo",function(){return targetTo}),n.d(s,"str",function(){return mat4_str}),n.d(s,"frob",function(){return mat4_frob}),n.d(s,"add",function(){return mat4_add}),n.d(s,"subtract",function(){return mat4_subtract}),n.d(s,"multiplyScalar",function(){return mat4_multiplyScalar}),n.d(s,"multiplyScalarAndAdd",function(){return mat4_multiplyScalarAndAdd}),n.d(s,"exactEquals",function(){return mat4_exactEquals}),n.d(s,"equals",function(){return mat4_equals}),n.d(s,"mul",function(){return T}),n.d(s,"sub",function(){return M});var u={};n.r(u),n.d(u,"create",function(){return vec3_create}),n.d(u,"clone",function(){return vec3_clone}),n.d(u,"length",function(){return vec3_length}),n.d(u,"fromValues",function(){return vec3_fromValues}),n.d(u,"copy",function(){return vec3_copy}),n.d(u,"set",function(){return vec3_set}),n.d(u,"add",function(){return vec3_add}),n.d(u,"subtract",function(){return vec3_subtract}),n.d(u,"multiply",function(){return vec3_multiply}),n.d(u,"divide",function(){return divide}),n.d(u,"ceil",function(){return ceil}),n.d(u,"floor",function(){return floor}),n.d(u,"min",function(){return min}),n.d(u,"max",function(){return max}),n.d(u,"round",function(){return round}),n.d(u,"scale",function(){return vec3_scale}),n.d(u,"scaleAndAdd",function(){return scaleAndAdd}),n.d(u,"distance",function(){return distance}),n.d(u,"squaredDistance",function(){return squaredDistance}),n.d(u,"squaredLength",function(){return squaredLength}),n.d(u,"negate",function(){return negate}),n.d(u,"inverse",function(){return inverse}),n.d(u,"normalize",function(){return normalize}),n.d(u,"dot",function(){return vec3_dot}),n.d(u,"cross",function(){return cross}),n.d(u,"lerp",function(){return lerp}),n.d(u,"hermite",function(){return hermite}),n.d(u,"bezier",function(){return bezier}),n.d(u,"random",function(){return random}),n.d(u,"transformMat4",function(){return transformMat4}),n.d(u,"transformMat3",function(){return transformMat3}),n.d(u,"transformQuat",function(){return transformQuat}),n.d(u,"rotateX",function(){return vec3_rotateX}),n.d(u,"rotateY",function(){return vec3_rotateY}),n.d(u,"rotateZ",function(){return vec3_rotateZ}),n.d(u,"angle",function(){return angle}),n.d(u,"zero",function(){return zero}),n.d(u,"str",function(){return vec3_str}),n.d(u,"exactEquals",function(){return vec3_exactEquals}),n.d(u,"equals",function(){return vec3_equals}),n.d(u,"sub",function(){return S}),n.d(u,"mul",function(){return w}),n.d(u,"div",function(){return R}),n.d(u,"dist",function(){return x}),n.d(u,"sqrDist",function(){return C}),n.d(u,"len",function(){return L}),n.d(u,"sqrLen",function(){return O}),n.d(u,"forEach",function(){return P});var c={};n.r(c),n.d(c,"create",function(){return vec4_create}),n.d(c,"clone",function(){return vec4_clone}),n.d(c,"fromValues",function(){return vec4_fromValues}),n.d(c,"copy",function(){return vec4_copy}),n.d(c,"set",function(){return vec4_set}),n.d(c,"add",function(){return vec4_add}),n.d(c,"subtract",function(){return vec4_subtract}),n.d(c,"multiply",function(){return vec4_multiply}),n.d(c,"divide",function(){return vec4_divide}),n.d(c,"ceil",function(){return vec4_ceil}),n.d(c,"floor",function(){return vec4_floor}),n.d(c,"min",function(){return vec4_min}),n.d(c,"max",function(){return vec4_max}),n.d(c,"round",function(){return vec4_round}),n.d(c,"scale",function(){return vec4_scale}),n.d(c,"scaleAndAdd",function(){return vec4_scaleAndAdd}),n.d(c,"distance",function(){return vec4_distance}),n.d(c,"squaredDistance",function(){return vec4_squaredDistance}),n.d(c,"length",function(){return vec4_length}),n.d(c,"squaredLength",function(){return vec4_squaredLength}),n.d(c,"negate",function(){return vec4_negate}),n.d(c,"inverse",function(){return vec4_inverse}),n.d(c,"normalize",function(){return vec4_normalize}),n.d(c,"dot",function(){return vec4_dot}),n.d(c,"cross",function(){return vec4_cross}),n.d(c,"lerp",function(){return vec4_lerp}),n.d(c,"random",function(){return vec4_random}),n.d(c,"transformMat4",function(){return vec4_transformMat4}),n.d(c,"transformQuat",function(){return vec4_transformQuat}),n.d(c,"zero",function(){return vec4_zero}),n.d(c,"str",function(){return vec4_str}),n.d(c,"exactEquals",function(){return vec4_exactEquals}),n.d(c,"equals",function(){return vec4_equals}),n.d(c,"sub",function(){return D}),n.d(c,"mul",function(){return F}),n.d(c,"div",function(){return B}),n.d(c,"dist",function(){return N}),n.d(c,"sqrDist",function(){return G}),n.d(c,"len",function(){return U}),n.d(c,"sqrLen",function(){return j}),n.d(c,"forEach",function(){return W});var l={};n.r(l),n.d(l,"create",function(){return quat_create}),n.d(l,"identity",function(){return quat_identity}),n.d(l,"setAxisAngle",function(){return setAxisAngle}),n.d(l,"getAxisAngle",function(){return getAxisAngle}),n.d(l,"getAngle",function(){return getAngle}),n.d(l,"multiply",function(){return quat_multiply}),n.d(l,"rotateX",function(){return quat_rotateX}),n.d(l,"rotateY",function(){return quat_rotateY}),n.d(l,"rotateZ",function(){return quat_rotateZ}),n.d(l,"calculateW",function(){return calculateW}),n.d(l,"exp",function(){return exp}),n.d(l,"ln",function(){return ln}),n.d(l,"pow",function(){return pow}),n.d(l,"slerp",function(){return slerp}),n.d(l,"random",function(){return quat_random}),n.d(l,"invert",function(){return quat_invert}),n.d(l,"conjugate",function(){return conjugate}),n.d(l,"fromMat3",function(){return fromMat3}),n.d(l,"fromEuler",function(){return fromEuler}),n.d(l,"str",function(){return quat_str}),n.d(l,"clone",function(){return Q}),n.d(l,"fromValues",function(){return K}),n.d(l,"copy",function(){return $}),n.d(l,"set",function(){return Z}),n.d(l,"add",function(){return J}),n.d(l,"mul",function(){return tt}),n.d(l,"scale",function(){return et}),n.d(l,"dot",function(){return nt}),n.d(l,"lerp",function(){return rt}),n.d(l,"length",function(){return ot}),n.d(l,"len",function(){return it}),n.d(l,"squaredLength",function(){return at}),n.d(l,"sqrLen",function(){return st}),n.d(l,"normalize",function(){return ut}),n.d(l,"exactEquals",function(){return ct}),n.d(l,"equals",function(){return lt}),n.d(l,"rotationTo",function(){return ft}),n.d(l,"sqlerp",function(){return dt}),n.d(l,"setAxes",function(){return ht});var f={};n.r(f),n.d(f,"create",function(){return quat2_create}),n.d(f,"clone",function(){return quat2_clone}),n.d(f,"fromValues",function(){return quat2_fromValues}),n.d(f,"fromRotationTranslationValues",function(){return fromRotationTranslationValues}),n.d(f,"fromRotationTranslation",function(){return quat2_fromRotationTranslation}),n.d(f,"fromTranslation",function(){return quat2_fromTranslation}),n.d(f,"fromRotation",function(){return quat2_fromRotation}),n.d(f,"fromMat4",function(){return quat2_fromMat4}),n.d(f,"copy",function(){return quat2_copy}),n.d(f,"identity",function(){return quat2_identity}),n.d(f,"set",function(){return quat2_set}),n.d(f,"getReal",function(){return pt}),n.d(f,"getDual",function(){return getDual}),n.d(f,"setReal",function(){return mt}),n.d(f,"setDual",function(){return setDual}),n.d(f,"getTranslation",function(){return quat2_getTranslation}),n.d(f,"translate",function(){return quat2_translate}),n.d(f,"rotateX",function(){return quat2_rotateX}),n.d(f,"rotateY",function(){return quat2_rotateY}),n.d(f,"rotateZ",function(){return quat2_rotateZ}),n.d(f,"rotateByQuatAppend",function(){return rotateByQuatAppend}),n.d(f,"rotateByQuatPrepend",function(){return rotateByQuatPrepend}),n.d(f,"rotateAroundAxis",function(){return rotateAroundAxis}),n.d(f,"add",function(){return quat2_add}),n.d(f,"multiply",function(){return quat2_multiply}),n.d(f,"mul",function(){return _t}),n.d(f,"scale",function(){return quat2_scale}),n.d(f,"dot",function(){return vt}),n.d(f,"lerp",function(){return quat2_lerp}),n.d(f,"invert",function(){return quat2_invert}),n.d(f,"conjugate",function(){return quat2_conjugate}),n.d(f,"length",function(){return yt}),n.d(f,"len",function(){return gt}),n.d(f,"squaredLength",function(){return bt}),n.d(f,"sqrLen",function(){return Et}),n.d(f,"normalize",function(){return quat2_normalize}),n.d(f,"str",function(){return quat2_str}),n.d(f,"exactEquals",function(){return quat2_exactEquals}),n.d(f,"equals",function(){return quat2_equals});var d={};n.r(d),n.d(d,"create",function(){return vec2_create}),n.d(d,"clone",function(){return vec2_clone}),n.d(d,"fromValues",function(){return vec2_fromValues}),n.d(d,"copy",function(){return vec2_copy}),n.d(d,"set",function(){return vec2_set}),n.d(d,"add",function(){return vec2_add}),n.d(d,"subtract",function(){return vec2_subtract}),n.d(d,"multiply",function(){return vec2_multiply}),n.d(d,"divide",function(){return vec2_divide}),n.d(d,"ceil",function(){return vec2_ceil}),n.d(d,"floor",function(){return vec2_floor}),n.d(d,"min",function(){return vec2_min}),n.d(d,"max",function(){return vec2_max}),n.d(d,"round",function(){return vec2_round}),n.d(d,"scale",function(){return vec2_scale}),n.d(d,"scaleAndAdd",function(){return vec2_scaleAndAdd}),n.d(d,"distance",function(){return vec2_distance}),n.d(d,"squaredDistance",function(){return vec2_squaredDistance}),n.d(d,"length",function(){return vec2_length}),n.d(d,"squaredLength",function(){return vec2_squaredLength}),n.d(d,"negate",function(){return vec2_negate}),n.d(d,"inverse",function(){return vec2_inverse}),n.d(d,"normalize",function(){return vec2_normalize}),n.d(d,"dot",function(){return vec2_dot}),n.d(d,"cross",function(){return vec2_cross}),n.d(d,"lerp",function(){return vec2_lerp}),n.d(d,"random",function(){return vec2_random}),n.d(d,"transformMat2",function(){return transformMat2}),n.d(d,"transformMat2d",function(){return transformMat2d}),n.d(d,"transformMat3",function(){return vec2_transformMat3}),n.d(d,"transformMat4",function(){return vec2_transformMat4}),n.d(d,"rotate",function(){return vec2_rotate}),n.d(d,"angle",function(){return vec2_angle}),n.d(d,"zero",function(){return vec2_zero}),n.d(d,"str",function(){return vec2_str}),n.d(d,"exactEquals",function(){return vec2_exactEquals}),n.d(d,"equals",function(){return vec2_equals}),n.d(d,"len",function(){return Mt}),n.d(d,"sub",function(){return At}),n.d(d,"mul",function(){return St}),n.d(d,"div",function(){return wt}),n.d(d,"dist",function(){return Rt}),n.d(d,"sqrDist",function(){return xt}),n.d(d,"sqrLen",function(){return Ct}),n.d(d,"forEach",function(){return Lt});var I=1e-6,v="undefined"!=typeof Float32Array?Float32Array:Array,h=Math.random;function setMatrixArrayType(t){v=t}var p=Math.PI/180;function toRadian(t){return t*p}function equals(t,e){return Math.abs(t-e)<=I*Math.max(1,Math.abs(t),Math.abs(e))}function create(){var t=new v(4);return v!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function clone(t){var e=new v(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function fromValues(t,e,n,r){var o=new v(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o}function set(t,e,n,r,o){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t}function transpose(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function invert(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n*i-o*r;return a?(a=1/a,t[0]=i*a,t[1]=-r*a,t[2]=-o*a,t[3]=n*a,t):null}function adjoint(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function determinant(t){return t[0]*t[3]-t[2]*t[1]}function multiply(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*s+i*u,t[1]=o*s+a*u,t[2]=r*c+i*l,t[3]=o*c+a*l,t}function rotate(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=o*u+a*s,t[2]=r*-s+i*u,t[3]=o*-s+a*u,t}function mat2_scale(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[0],u=n[1];return t[0]=r*s,t[1]=o*s,t[2]=i*u,t[3]=a*u,t}function fromRotation(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function fromScaling(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function str(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function frob(t){return Math.hypot(t[0],t[1],t[2],t[3])}function LDU(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function add(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function subtract(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function mat2_equals(t,e){var n=t[0],r=t[1],o=t[2],i=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-a)<=I*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=I*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-u)<=I*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-c)<=I*Math.max(1,Math.abs(i),Math.abs(c))}function multiplyScalar(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function multiplyScalarAndAdd(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var m=multiply,_=subtract;function mat2d_create(){var t=new v(6);return v!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function mat2d_clone(t){var e=new v(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function mat2d_copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function mat2d_identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function mat2d_fromValues(t,e,n,r,o,i){var a=new v(6);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a[4]=o,a[5]=i,a}function mat2d_set(t,e,n,r,o,i,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t}function mat2d_invert(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=n*i-r*o;return u?(u=1/u,t[0]=i*u,t[1]=-r*u,t[2]=-o*u,t[3]=n*u,t[4]=(o*s-i*a)*u,t[5]=(r*a-n*s)*u,t):null}function mat2d_determinant(t){return t[0]*t[3]-t[1]*t[2]}function mat2d_multiply(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=n[0],l=n[1],f=n[2],d=n[3],h=n[4],p=n[5];return t[0]=r*c+i*l,t[1]=o*c+a*l,t[2]=r*f+i*d,t[3]=o*f+a*d,t[4]=r*h+i*p+s,t[5]=o*h+a*p+u,t}function mat2d_rotate(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*c,t[1]=o*l+a*c,t[2]=r*-c+i*l,t[3]=o*-c+a*l,t[4]=s,t[5]=u,t}function mat2d_scale(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=n[0],l=n[1];return t[0]=r*c,t[1]=o*c,t[2]=i*l,t[3]=a*l,t[4]=s,t[5]=u,t}function translate(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=n[0],l=n[1];return t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=r*c+i*l+s,t[5]=o*c+a*l+u,t}function mat2d_fromRotation(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function mat2d_fromScaling(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function fromTranslation(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function mat2d_str(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function mat2d_frob(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function mat2d_add(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function mat2d_subtract(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function mat2d_multiplyScalar(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function mat2d_multiplyScalarAndAdd(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function mat2d_exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function mat2d_equals(t,e){var n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],s=t[5],u=e[0],c=e[1],l=e[2],f=e[3],d=e[4],h=e[5];return Math.abs(n-u)<=I*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-c)<=I*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(o-l)<=I*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(i-f)<=I*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-d)<=I*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-h)<=I*Math.max(1,Math.abs(s),Math.abs(h))}var y=mat2d_multiply,g=mat2d_subtract;function mat3_create(){var t=new v(9);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function fromMat4(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function mat3_clone(t){var e=new v(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function mat3_copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function mat3_fromValues(t,e,n,r,o,i,a,s,u){var c=new v(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=o,c[5]=i,c[6]=a,c[7]=s,c[8]=u,c}function mat3_set(t,e,n,r,o,i,a,s,u,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t}function mat3_identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function mat3_transpose(t,e){if(t===e){var n=e[1],r=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function mat3_invert(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=l*a-s*c,d=-l*i+s*u,h=c*i-a*u,p=n*f+r*d+o*h;return p?(p=1/p,t[0]=f*p,t[1]=(-l*r+o*c)*p,t[2]=(s*r-o*a)*p,t[3]=d*p,t[4]=(l*n-o*u)*p,t[5]=(-s*n+o*i)*p,t[6]=h*p,t[7]=(-c*n+r*u)*p,t[8]=(a*n-r*i)*p,t):null}function mat3_adjoint(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8];return t[0]=a*l-s*c,t[1]=o*c-r*l,t[2]=r*s-o*a,t[3]=s*u-i*l,t[4]=n*l-o*u,t[5]=o*i-n*s,t[6]=i*c-a*u,t[7]=r*u-n*c,t[8]=n*a-r*i,t}function mat3_determinant(t){var e=t[0],n=t[1],r=t[2],o=t[3],i=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*(c*i-a*u)+n*(-c*o+a*s)+r*(u*o-i*s)}function mat3_multiply(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=n[0],h=n[1],p=n[2],m=n[3],_=n[4],v=n[5],y=n[6],g=n[7],b=n[8];return t[0]=d*r+h*a+p*c,t[1]=d*o+h*s+p*l,t[2]=d*i+h*u+p*f,t[3]=m*r+_*a+v*c,t[4]=m*o+_*s+v*l,t[5]=m*i+_*u+v*f,t[6]=y*r+g*a+b*c,t[7]=y*o+g*s+b*l,t[8]=y*i+g*u+b*f,t}function mat3_translate(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=n[0],h=n[1];return t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=s,t[5]=u,t[6]=d*r+h*a+c,t[7]=d*o+h*s+l,t[8]=d*i+h*u+f,t}function mat3_rotate(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=Math.sin(n),h=Math.cos(n);return t[0]=h*r+d*a,t[1]=h*o+d*s,t[2]=h*i+d*u,t[3]=h*a-d*r,t[4]=h*s-d*o,t[5]=h*u-d*i,t[6]=c,t[7]=l,t[8]=f,t}function mat3_scale(t,e,n){var r=n[0],o=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=o*e[3],t[4]=o*e[4],t[5]=o*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function mat3_fromTranslation(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function mat3_fromRotation(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function mat3_fromScaling(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function fromMat2d(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function fromQuat(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n+n,s=r+r,u=o+o,c=n*a,l=r*a,f=r*s,d=o*a,h=o*s,p=o*u,m=i*a,_=i*s,v=i*u;return t[0]=1-f-p,t[3]=l-v,t[6]=d+_,t[1]=l+v,t[4]=1-c-p,t[7]=h-m,t[2]=d-_,t[5]=h+m,t[8]=1-c-f,t}function normalFromMat4(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],d=e[10],h=e[11],p=e[12],m=e[13],_=e[14],v=e[15],y=n*s-r*a,g=n*u-o*a,b=n*c-i*a,E=r*u-o*s,T=r*c-i*s,M=o*c-i*u,A=l*m-f*p,S=l*_-d*p,w=l*v-h*p,R=f*_-d*m,x=f*v-h*m,C=d*v-h*_,L=y*C-g*x+b*R+E*w-T*S+M*A;return L?(L=1/L,t[0]=(s*C-u*x+c*R)*L,t[1]=(u*w-a*C-c*S)*L,t[2]=(a*x-s*w+c*A)*L,t[3]=(o*x-r*C-i*R)*L,t[4]=(n*C-o*w+i*S)*L,t[5]=(r*w-n*x-i*A)*L,t[6]=(m*M-_*T+v*E)*L,t[7]=(_*b-p*M-v*g)*L,t[8]=(p*T-m*b+v*y)*L,t):null}function projection(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function mat3_str(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function mat3_frob(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function mat3_add(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function mat3_subtract(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function mat3_multiplyScalar(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function mat3_multiplyScalarAndAdd(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function mat3_exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function mat3_equals(t,e){var n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=e[0],d=e[1],h=e[2],p=e[3],m=e[4],_=e[5],v=e[6],y=e[7],g=e[8];return Math.abs(n-f)<=I*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=I*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-h)<=I*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(i-p)<=I*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-m)<=I*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-_)<=I*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(u-v)<=I*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(c-y)<=I*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(l-g)<=I*Math.max(1,Math.abs(l),Math.abs(g))}var b=mat3_multiply,E=mat3_subtract;function mat4_create(){var t=new v(16);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function mat4_clone(t){var e=new v(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function mat4_copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function mat4_fromValues(t,e,n,r,o,i,a,s,u,c,l,f,d,h,p,m){var _=new v(16);return _[0]=t,_[1]=e,_[2]=n,_[3]=r,_[4]=o,_[5]=i,_[6]=a,_[7]=s,_[8]=u,_[9]=c,_[10]=l,_[11]=f,_[12]=d,_[13]=h,_[14]=p,_[15]=m,_}function mat4_set(t,e,n,r,o,i,a,s,u,c,l,f,d,h,p,m,_){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=l,t[10]=f,t[11]=d,t[12]=h,t[13]=p,t[14]=m,t[15]=_,t}function mat4_identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mat4_transpose(t,e){if(t===e){var n=e[1],r=e[2],o=e[3],i=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=o,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function mat4_invert(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],d=e[10],h=e[11],p=e[12],m=e[13],_=e[14],v=e[15],y=n*s-r*a,g=n*u-o*a,b=n*c-i*a,E=r*u-o*s,T=r*c-i*s,M=o*c-i*u,A=l*m-f*p,S=l*_-d*p,w=l*v-h*p,R=f*_-d*m,x=f*v-h*m,C=d*v-h*_,L=y*C-g*x+b*R+E*w-T*S+M*A;return L?(L=1/L,t[0]=(s*C-u*x+c*R)*L,t[1]=(o*x-r*C-i*R)*L,t[2]=(m*M-_*T+v*E)*L,t[3]=(d*T-f*M-h*E)*L,t[4]=(u*w-a*C-c*S)*L,t[5]=(n*C-o*w+i*S)*L,t[6]=(_*b-p*M-v*g)*L,t[7]=(l*M-d*b+h*g)*L,t[8]=(a*x-s*w+c*A)*L,t[9]=(r*w-n*x-i*A)*L,t[10]=(p*T-m*b+v*y)*L,t[11]=(f*b-l*T-h*y)*L,t[12]=(s*S-a*R-u*A)*L,t[13]=(n*R-r*S+o*A)*L,t[14]=(m*g-p*E-_*y)*L,t[15]=(l*E-f*g+d*y)*L,t):null}function mat4_adjoint(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],d=e[10],h=e[11],p=e[12],m=e[13],_=e[14],v=e[15];return t[0]=s*(d*v-h*_)-f*(u*v-c*_)+m*(u*h-c*d),t[1]=-(r*(d*v-h*_)-f*(o*v-i*_)+m*(o*h-i*d)),t[2]=r*(u*v-c*_)-s*(o*v-i*_)+m*(o*c-i*u),t[3]=-(r*(u*h-c*d)-s*(o*h-i*d)+f*(o*c-i*u)),t[4]=-(a*(d*v-h*_)-l*(u*v-c*_)+p*(u*h-c*d)),t[5]=n*(d*v-h*_)-l*(o*v-i*_)+p*(o*h-i*d),t[6]=-(n*(u*v-c*_)-a*(o*v-i*_)+p*(o*c-i*u)),t[7]=n*(u*h-c*d)-a*(o*h-i*d)+l*(o*c-i*u),t[8]=a*(f*v-h*m)-l*(s*v-c*m)+p*(s*h-c*f),t[9]=-(n*(f*v-h*m)-l*(r*v-i*m)+p*(r*h-i*f)),t[10]=n*(s*v-c*m)-a*(r*v-i*m)+p*(r*c-i*s),t[11]=-(n*(s*h-c*f)-a*(r*h-i*f)+l*(r*c-i*s)),t[12]=-(a*(f*_-d*m)-l*(s*_-u*m)+p*(s*d-u*f)),t[13]=n*(f*_-d*m)-l*(r*_-o*m)+p*(r*d-o*f),t[14]=-(n*(s*_-u*m)-a*(r*_-o*m)+p*(r*u-o*s)),t[15]=n*(s*d-u*f)-a*(r*d-o*f)+l*(r*u-o*s),t}function mat4_determinant(t){var e=t[0],n=t[1],r=t[2],o=t[3],i=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],d=t[11],h=t[12],p=t[13],m=t[14],_=t[15];return(e*a-n*i)*(f*_-d*m)-(e*s-r*i)*(l*_-d*p)+(e*u-o*i)*(l*m-f*p)+(n*s-r*a)*(c*_-d*h)-(n*u-o*a)*(c*m-f*h)+(r*u-o*s)*(c*p-l*h)}function mat4_multiply(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=e[9],h=e[10],p=e[11],m=e[12],_=e[13],v=e[14],y=e[15],g=n[0],b=n[1],E=n[2],T=n[3];return t[0]=g*r+b*s+E*f+T*m,t[1]=g*o+b*u+E*d+T*_,t[2]=g*i+b*c+E*h+T*v,t[3]=g*a+b*l+E*p+T*y,g=n[4],b=n[5],E=n[6],T=n[7],t[4]=g*r+b*s+E*f+T*m,t[5]=g*o+b*u+E*d+T*_,t[6]=g*i+b*c+E*h+T*v,t[7]=g*a+b*l+E*p+T*y,g=n[8],b=n[9],E=n[10],T=n[11],t[8]=g*r+b*s+E*f+T*m,t[9]=g*o+b*u+E*d+T*_,t[10]=g*i+b*c+E*h+T*v,t[11]=g*a+b*l+E*p+T*y,g=n[12],b=n[13],E=n[14],T=n[15],t[12]=g*r+b*s+E*f+T*m,t[13]=g*o+b*u+E*d+T*_,t[14]=g*i+b*c+E*h+T*v,t[15]=g*a+b*l+E*p+T*y,t}function mat4_translate(t,e,n){var r,o,i,a,s,u,c,l,f,d,h,p,m=n[0],_=n[1],v=n[2];return e===t?(t[12]=e[0]*m+e[4]*_+e[8]*v+e[12],t[13]=e[1]*m+e[5]*_+e[9]*v+e[13],t[14]=e[2]*m+e[6]*_+e[10]*v+e[14],t[15]=e[3]*m+e[7]*_+e[11]*v+e[15]):(r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=e[9],h=e[10],p=e[11],t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=f,t[9]=d,t[10]=h,t[11]=p,t[12]=r*m+s*_+f*v+e[12],t[13]=o*m+u*_+d*v+e[13],t[14]=i*m+c*_+h*v+e[14],t[15]=a*m+l*_+p*v+e[15]),t}function mat4_scale(t,e,n){var r=n[0],o=n[1],i=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function mat4_rotate(t,e,n,r){var o,i,a,s,u,c,l,f,d,h,p,m,_,v,y,g,b,E,T,M,A,S,w,R,x=r[0],C=r[1],L=r[2],O=Math.hypot(x,C,L);return O<I?null:(x*=O=1/O,C*=O,L*=O,o=Math.sin(n),a=1-(i=Math.cos(n)),s=e[0],u=e[1],c=e[2],l=e[3],f=e[4],d=e[5],h=e[6],p=e[7],m=e[8],_=e[9],v=e[10],y=e[11],g=x*x*a+i,b=C*x*a+L*o,E=L*x*a-C*o,T=x*C*a-L*o,M=C*C*a+i,A=L*C*a+x*o,S=x*L*a+C*o,w=C*L*a-x*o,R=L*L*a+i,t[0]=s*g+f*b+m*E,t[1]=u*g+d*b+_*E,t[2]=c*g+h*b+v*E,t[3]=l*g+p*b+y*E,t[4]=s*T+f*M+m*A,t[5]=u*T+d*M+_*A,t[6]=c*T+h*M+v*A,t[7]=l*T+p*M+y*A,t[8]=s*S+f*w+m*R,t[9]=u*S+d*w+_*R,t[10]=c*S+h*w+v*R,t[11]=l*S+p*w+y*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function rotateX(t,e,n){var r=Math.sin(n),o=Math.cos(n),i=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*o+c*r,t[5]=a*o+l*r,t[6]=s*o+f*r,t[7]=u*o+d*r,t[8]=c*o-i*r,t[9]=l*o-a*r,t[10]=f*o-s*r,t[11]=d*o-u*r,t}function rotateY(t,e,n){var r=Math.sin(n),o=Math.cos(n),i=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],f=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*o-c*r,t[1]=a*o-l*r,t[2]=s*o-f*r,t[3]=u*o-d*r,t[8]=i*r+c*o,t[9]=a*r+l*o,t[10]=s*r+f*o,t[11]=u*r+d*o,t}function rotateZ(t,e,n){var r=Math.sin(n),o=Math.cos(n),i=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],f=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*o+c*r,t[1]=a*o+l*r,t[2]=s*o+f*r,t[3]=u*o+d*r,t[4]=c*o-i*r,t[5]=l*o-a*r,t[6]=f*o-s*r,t[7]=d*o-u*r,t}function mat4_fromTranslation(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function mat4_fromScaling(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mat4_fromRotation(t,e,n){var r,o,i,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<I?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(e),i=1-(o=Math.cos(e)),t[0]=a*a*i+o,t[1]=s*a*i+u*r,t[2]=u*a*i-s*r,t[3]=0,t[4]=a*s*i-u*r,t[5]=s*s*i+o,t[6]=u*s*i+a*r,t[7]=0,t[8]=a*u*i+s*r,t[9]=s*u*i-a*r,t[10]=u*u*i+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function fromXRotation(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fromYRotation(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fromZRotation(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fromRotationTranslation(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=r+r,u=o+o,c=i+i,l=r*s,f=r*u,d=r*c,h=o*u,p=o*c,m=i*c,_=a*s,v=a*u,y=a*c;return t[0]=1-(h+m),t[1]=f+y,t[2]=d-v,t[3]=0,t[4]=f-y,t[5]=1-(l+m),t[6]=p+_,t[7]=0,t[8]=d+v,t[9]=p-_,t[10]=1-(l+h),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function fromQuat2(t,e){var n=new v(3),r=-e[0],o=-e[1],i=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=r*r+o*o+i*i+a*a;return 0<f?(n[0]=2*(s*a+l*r+u*i-c*o)/f,n[1]=2*(u*a+l*o+c*r-s*i)/f,n[2]=2*(c*a+l*i+s*o-u*r)/f):(n[0]=2*(s*a+l*r+u*i-c*o),n[1]=2*(u*a+l*o+c*r-s*i),n[2]=2*(c*a+l*i+s*o-u*r)),fromRotationTranslation(t,e,n),t}function getTranslation(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function getScaling(t,e){var n=e[0],r=e[1],o=e[2],i=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10];return t[0]=Math.hypot(n,r,o),t[1]=Math.hypot(i,a,s),t[2]=Math.hypot(u,c,l),t}function getRotation(t,e){var n=new v(3);getScaling(n,e);var r=1/n[0],o=1/n[1],i=1/n[2],a=e[0]*r,s=e[1]*o,u=e[2]*i,c=e[4]*r,l=e[5]*o,f=e[6]*i,d=e[8]*r,h=e[9]*o,p=e[10]*i,m=a+l+p,_=0;return 0<m?(_=2*Math.sqrt(1+m),t[3]=.25*_,t[0]=(f-h)/_,t[1]=(d-u)/_,t[2]=(s-c)/_):l<a&&p<a?(_=2*Math.sqrt(1+a-l-p),t[3]=(f-h)/_,t[0]=.25*_,t[1]=(s+c)/_,t[2]=(d+u)/_):p<l?(_=2*Math.sqrt(1+l-a-p),t[3]=(d-u)/_,t[0]=(s+c)/_,t[1]=.25*_,t[2]=(f+h)/_):(_=2*Math.sqrt(1+p-a-l),t[3]=(s-c)/_,t[0]=(d+u)/_,t[1]=(f+h)/_,t[2]=.25*_),t}function fromRotationTranslationScale(t,e,n,r){var o=e[0],i=e[1],a=e[2],s=e[3],u=o+o,c=i+i,l=a+a,f=o*u,d=o*c,h=o*l,p=i*c,m=i*l,_=a*l,v=s*u,y=s*c,g=s*l,b=r[0],E=r[1],T=r[2];return t[0]=(1-(p+_))*b,t[1]=(d+g)*b,t[2]=(h-y)*b,t[3]=0,t[4]=(d-g)*E,t[5]=(1-(f+_))*E,t[6]=(m+v)*E,t[7]=0,t[8]=(h+y)*T,t[9]=(m-v)*T,t[10]=(1-(f+p))*T,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function fromRotationTranslationScaleOrigin(t,e,n,r,o){var i=e[0],a=e[1],s=e[2],u=e[3],c=i+i,l=a+a,f=s+s,d=i*c,h=i*l,p=i*f,m=a*l,_=a*f,v=s*f,y=u*c,g=u*l,b=u*f,E=r[0],T=r[1],M=r[2],A=o[0],S=o[1],w=o[2],R=(1-(m+v))*E,x=(h+b)*E,C=(p-g)*E,L=(h-b)*T,O=(1-(d+v))*T,P=(_+y)*T,k=(p+g)*M,I=(_-y)*M,D=(1-(d+m))*M;return t[0]=R,t[1]=x,t[2]=C,t[3]=0,t[4]=L,t[5]=O,t[6]=P,t[7]=0,t[8]=k,t[9]=I,t[10]=D,t[11]=0,t[12]=n[0]+A-(R*A+L*S+k*w),t[13]=n[1]+S-(x*A+O*S+I*w),t[14]=n[2]+w-(C*A+P*S+D*w),t[15]=1,t}function mat4_fromQuat(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n+n,s=r+r,u=o+o,c=n*a,l=r*a,f=r*s,d=o*a,h=o*s,p=o*u,m=i*a,_=i*s,v=i*u;return t[0]=1-f-p,t[1]=l+v,t[2]=d-_,t[3]=0,t[4]=l-v,t[5]=1-c-p,t[6]=h+m,t[7]=0,t[8]=d+_,t[9]=h-m,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function frustum(t,e,n,r,o,i,a){var s=1/(n-e),u=1/(o-r),c=1/(i-a);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(o+r)*u,t[10]=(a+i)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*c,t[15]=0,t}function perspective(t,e,n,r,o){var i,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(i=1/(r-o),t[10]=(o+r)*i,t[14]=2*o*r*i):(t[10]=-1,t[14]=-2*r),t}function perspectiveFromFieldOfView(t,e,n,r){var o=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(o+i);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(o-i)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function ortho(t,e,n,r,o,i,a){var s=1/(e-n),u=1/(r-o),c=1/(i-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(o+r)*u,t[14]=(a+i)*c,t[15]=1,t}function lookAt(t,e,n,r){var o,i,a,s,u,c,l,f,d,h,p=e[0],m=e[1],_=e[2],v=r[0],y=r[1],g=r[2],b=n[0],E=n[1],T=n[2];return Math.abs(p-b)<I&&Math.abs(m-E)<I&&Math.abs(_-T)<I?mat4_identity(t):(l=p-b,f=m-E,d=_-T,o=y*(d*=h=1/Math.hypot(l,f,d))-g*(f*=h),i=g*(l*=h)-v*d,a=v*f-y*l,(h=Math.hypot(o,i,a))?(o*=h=1/h,i*=h,a*=h):a=i=o=0,s=f*a-d*i,u=d*o-l*a,c=l*i-f*o,(h=Math.hypot(s,u,c))?(s*=h=1/h,u*=h,c*=h):c=u=s=0,t[0]=o,t[1]=s,t[2]=l,t[3]=0,t[4]=i,t[5]=u,t[6]=f,t[7]=0,t[8]=a,t[9]=c,t[10]=d,t[11]=0,t[12]=-(o*p+i*m+a*_),t[13]=-(s*p+u*m+c*_),t[14]=-(l*p+f*m+d*_),t[15]=1,t)}function targetTo(t,e,n,r){var o=e[0],i=e[1],a=e[2],s=r[0],u=r[1],c=r[2],l=o-n[0],f=i-n[1],d=a-n[2],h=l*l+f*f+d*d;0<h&&(l*=h=1/Math.sqrt(h),f*=h,d*=h);var p=u*d-c*f,m=c*l-s*d,_=s*f-u*l;return 0<(h=p*p+m*m+_*_)&&(p*=h=1/Math.sqrt(h),m*=h,_*=h),t[0]=p,t[1]=m,t[2]=_,t[3]=0,t[4]=f*_-d*m,t[5]=d*p-l*_,t[6]=l*m-f*p,t[7]=0,t[8]=l,t[9]=f,t[10]=d,t[11]=0,t[12]=o,t[13]=i,t[14]=a,t[15]=1,t}function mat4_str(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function mat4_frob(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function mat4_add(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function mat4_subtract(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function mat4_multiplyScalar(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function mat4_multiplyScalarAndAdd(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function mat4_exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function mat4_equals(t,e){var n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],d=t[10],h=t[11],p=t[12],m=t[13],_=t[14],v=t[15],y=e[0],g=e[1],b=e[2],E=e[3],T=e[4],M=e[5],A=e[6],S=e[7],w=e[8],R=e[9],x=e[10],C=e[11],L=e[12],O=e[13],P=e[14],k=e[15];return Math.abs(n-y)<=I*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-g)<=I*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(o-b)<=I*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-E)<=I*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-T)<=I*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(s-M)<=I*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-A)<=I*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-S)<=I*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-w)<=I*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(f-R)<=I*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(d-x)<=I*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(h-C)<=I*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-L)<=I*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(m-O)<=I*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(_-P)<=I*Math.max(1,Math.abs(_),Math.abs(P))&&Math.abs(v-k)<=I*Math.max(1,Math.abs(v),Math.abs(k))}var T=mat4_multiply,M=mat4_subtract;function vec3_create(){var t=new v(3);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function vec3_clone(t){var e=new v(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function vec3_length(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function vec3_fromValues(t,e,n){var r=new v(3);return r[0]=t,r[1]=e,r[2]=n,r}function vec3_copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function vec3_set(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function vec3_add(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function vec3_subtract(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function vec3_multiply(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function divide(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function min(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function max(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function vec3_scale(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function scaleAndAdd(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function distance(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return Math.hypot(n,r,o)}function squaredDistance(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return n*n+r*r+o*o}function squaredLength(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function normalize(t,e){var n=e[0],r=e[1],o=e[2],i=n*n+r*r+o*o;return 0<i&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function vec3_dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cross(t,e,n){var r=e[0],o=e[1],i=e[2],a=n[0],s=n[1],u=n[2];return t[0]=o*u-i*s,t[1]=i*a-r*u,t[2]=r*s-o*a,t}function lerp(t,e,n,r){var o=e[0],i=e[1],a=e[2];return t[0]=o+r*(n[0]-o),t[1]=i+r*(n[1]-i),t[2]=a+r*(n[2]-a),t}function hermite(t,e,n,r,o,i){var a=i*i,s=a*(2*i-3)+1,u=a*(i-2)+i,c=a*(i-1),l=a*(3-2*i);return t[0]=e[0]*s+n[0]*u+r[0]*c+o[0]*l,t[1]=e[1]*s+n[1]*u+r[1]*c+o[1]*l,t[2]=e[2]*s+n[2]*u+r[2]*c+o[2]*l,t}function bezier(t,e,n,r,o,i){var a=1-i,s=a*a,u=i*i,c=s*a,l=3*i*s,f=3*u*a,d=u*i;return t[0]=e[0]*c+n[0]*l+r[0]*f+o[0]*d,t[1]=e[1]*c+n[1]*l+r[1]*f+o[1]*d,t[2]=e[2]*c+n[2]*l+r[2]*f+o[2]*d,t}function random(t,e){e=e||1;var n=2*h()*Math.PI,r=2*h()-1,o=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=r*e,t}function transformMat4(t,e,n){var r=e[0],o=e[1],i=e[2],a=n[3]*r+n[7]*o+n[11]*i+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*o+n[8]*i+n[12])/a,t[1]=(n[1]*r+n[5]*o+n[9]*i+n[13])/a,t[2]=(n[2]*r+n[6]*o+n[10]*i+n[14])/a,t}function transformMat3(t,e,n){var r=e[0],o=e[1],i=e[2];return t[0]=r*n[0]+o*n[3]+i*n[6],t[1]=r*n[1]+o*n[4]+i*n[7],t[2]=r*n[2]+o*n[5]+i*n[8],t}function transformQuat(t,e,n){var r=n[0],o=n[1],i=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=o*c-i*u,f=i*s-r*c,d=r*u-o*s,h=o*d-i*f,p=i*l-r*d,m=r*f-o*l,_=2*a;return l*=_,f*=_,d*=_,h*=2,p*=2,m*=2,t[0]=s+l+h,t[1]=u+f+p,t[2]=c+d+m,t}function vec3_rotateX(t,e,n,r){var o=[],i=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],i[0]=o[0],i[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),i[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function vec3_rotateY(t,e,n,r){var o=[],i=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],i[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),i[1]=o[1],i[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function vec3_rotateZ(t,e,n,r){var o=[],i=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],i[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),i[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),i[2]=o[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function angle(t,e){var n=vec3_fromValues(t[0],t[1],t[2]),r=vec3_fromValues(e[0],e[1],e[2]);normalize(n,n),normalize(r,r);var o=vec3_dot(n,r);return 1<o?0:o<-1?Math.PI:Math.acos(o)}function zero(t){return t[0]=0,t[1]=0,t[2]=0,t}function vec3_str(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function vec3_exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function vec3_equals(t,e){var n=t[0],r=t[1],o=t[2],i=e[0],a=e[1],s=e[2];return Math.abs(n-i)<=I*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-a)<=I*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-s)<=I*Math.max(1,Math.abs(o),Math.abs(s))}var A,S=vec3_subtract,w=vec3_multiply,R=divide,x=distance,C=squaredDistance,L=vec3_length,O=squaredLength,P=(A=vec3_create(),function(t,e,n,r,o,i){var a,s;for(e=e||3,n=n||0,s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)A[0]=t[a],A[1]=t[a+1],A[2]=t[a+2],o(A,A,i),t[a]=A[0],t[a+1]=A[1],t[a+2]=A[2];return t});function vec4_create(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function vec4_clone(t){var e=new v(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function vec4_fromValues(t,e,n,r){var o=new v(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o}function vec4_copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function vec4_set(t,e,n,r,o){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t}function vec4_add(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function vec4_subtract(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function vec4_multiply(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function vec4_divide(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function vec4_ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function vec4_floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function vec4_min(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function vec4_max(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function vec4_round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function vec4_scale(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function vec4_scaleAndAdd(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function vec4_distance(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2],i=e[3]-t[3];return Math.hypot(n,r,o,i)}function vec4_squaredDistance(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2],i=e[3]-t[3];return n*n+r*r+o*o+i*i}function vec4_length(t){var e=t[0],n=t[1],r=t[2],o=t[3];return Math.hypot(e,n,r,o)}function vec4_squaredLength(t){var e=t[0],n=t[1],r=t[2],o=t[3];return e*e+n*n+r*r+o*o}function vec4_negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function vec4_inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function vec4_normalize(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n*n+r*r+o*o+i*i;return 0<a&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=o*a,t[3]=i*a,t}function vec4_dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function vec4_cross(t,e,n,r){var o=n[0]*r[1]-n[1]*r[0],i=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],l=e[0],f=e[1],d=e[2],h=e[3];return t[0]=f*c-d*u+h*s,t[1]=-l*c+d*a-h*i,t[2]=l*u-f*a+h*o,t[3]=-l*s+f*i-d*o,t}function vec4_lerp(t,e,n,r){var o=e[0],i=e[1],a=e[2],s=e[3];return t[0]=o+r*(n[0]-o),t[1]=i+r*(n[1]-i),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function vec4_random(t,e){var n,r,o,i,a,s;for(e=e||1;1<=(a=(n=2*h()-1)*n+(r=2*h()-1)*r););for(;1<=(s=(o=2*h()-1)*o+(i=2*h()-1)*i););var u=Math.sqrt((1-a)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*o*u,t[3]=e*i*u,t}function vec4_transformMat4(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3];return t[0]=n[0]*r+n[4]*o+n[8]*i+n[12]*a,t[1]=n[1]*r+n[5]*o+n[9]*i+n[13]*a,t[2]=n[2]*r+n[6]*o+n[10]*i+n[14]*a,t[3]=n[3]*r+n[7]*o+n[11]*i+n[15]*a,t}function vec4_transformQuat(t,e,n){var r=e[0],o=e[1],i=e[2],a=n[0],s=n[1],u=n[2],c=n[3],l=c*r+s*i-u*o,f=c*o+u*r-a*i,d=c*i+a*o-s*r,h=-a*r-s*o-u*i;return t[0]=l*c+h*-a+f*-u-d*-s,t[1]=f*c+h*-s+d*-a-l*-u,t[2]=d*c+h*-u+l*-s-f*-a,t[3]=e[3],t}function vec4_zero(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function vec4_str(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function vec4_exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function vec4_equals(t,e){var n=t[0],r=t[1],o=t[2],i=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-a)<=I*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=I*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-u)<=I*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-c)<=I*Math.max(1,Math.abs(i),Math.abs(c))}var k,D=vec4_subtract,F=vec4_multiply,B=vec4_divide,N=vec4_distance,G=vec4_squaredDistance,U=vec4_length,j=vec4_squaredLength,W=(k=vec4_create(),function(t,e,n,r,o,i){var a,s;for(e=e||4,n=n||0,s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)k[0]=t[a],k[1]=t[a+1],k[2]=t[a+2],k[3]=t[a+3],o(k,k,i),t[a]=k[0],t[a+1]=k[1],t[a+2]=k[2],t[a+3]=k[3];return t});function quat_create(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function quat_identity(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function setAxisAngle(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function getAxisAngle(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return I<r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function getAngle(t,e){var n=nt(t,e);return Math.acos(2*n*n-1)}function quat_multiply(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*l+a*s+o*c-i*u,t[1]=o*l+a*u+i*s-r*c,t[2]=i*l+a*c+r*u-o*s,t[3]=a*l-r*s-o*u-i*c,t}function quat_rotateX(t,e,n){n*=.5;var r=e[0],o=e[1],i=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=o*u+i*s,t[2]=i*u-o*s,t[3]=a*u-r*s,t}function quat_rotateY(t,e,n){n*=.5;var r=e[0],o=e[1],i=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-i*s,t[1]=o*u+a*s,t[2]=i*u+r*s,t[3]=a*u-o*s,t}function quat_rotateZ(t,e,n){n*=.5;var r=e[0],o=e[1],i=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=o*u-r*s,t[2]=i*u+a*s,t[3]=a*u-i*s,t}function calculateW(t,e){var n=e[0],r=e[1],o=e[2];return t[0]=n,t[1]=r,t[2]=o,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-o*o)),t}function exp(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=Math.sqrt(n*n+r*r+o*o),s=Math.exp(i),u=0<a?s*Math.sin(a)/a:0;return t[0]=n*u,t[1]=r*u,t[2]=o*u,t[3]=s*Math.cos(a),t}function ln(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=Math.sqrt(n*n+r*r+o*o),s=0<a?Math.atan2(a,i)/a:0;return t[0]=n*s,t[1]=r*s,t[2]=o*s,t[3]=.5*Math.log(n*n+r*r+o*o+i*i),t}function pow(t,e,n){return ln(t,e),et(t,t,n),exp(t,t),t}function slerp(t,e,n,r){var o,i,a,s,u,c=e[0],l=e[1],f=e[2],d=e[3],h=n[0],p=n[1],m=n[2],_=n[3];return(i=c*h+l*p+f*m+d*_)<0&&(i=-i,h=-h,p=-p,m=-m,_=-_),u=I<1-i?(o=Math.acos(i),a=Math.sin(o),s=Math.sin((1-r)*o)/a,Math.sin(r*o)/a):(s=1-r,r),t[0]=s*c+u*h,t[1]=s*l+u*p,t[2]=s*f+u*m,t[3]=s*d+u*_,t}function quat_random(t){var e=h(),n=h(),r=h(),o=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=o*Math.sin(2*Math.PI*n),t[1]=o*Math.cos(2*Math.PI*n),t[2]=i*Math.sin(2*Math.PI*r),t[3]=i*Math.cos(2*Math.PI*r),t}function quat_invert(t,e){var n=e[0],r=e[1],o=e[2],i=e[3],a=n*n+r*r+o*o+i*i,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-o*s,t[3]=i*s,t}function conjugate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function fromMat3(t,e){var n,r=e[0]+e[4]+e[8];if(0<r)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var i=(o+1)%3,a=(o+2)%3;n=Math.sqrt(e[3*o+o]-e[3*i+i]-e[3*a+a]+1),t[o]=.5*n,n=.5/n,t[3]=(e[3*i+a]-e[3*a+i])*n,t[i]=(e[3*i+o]+e[3*o+i])*n,t[a]=(e[3*a+o]+e[3*o+a])*n}return t}function fromEuler(t,e,n,r){var o=.5*Math.PI/180;e*=o,n*=o,r*=o;var i=Math.sin(e),a=Math.cos(e),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),l=Math.cos(r);return t[0]=i*u*l-a*s*c,t[1]=a*s*l+i*u*c,t[2]=a*u*c-i*s*l,t[3]=a*u*l+i*s*c,t}function quat_str(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var V,X,q,H,z,Y,Q=vec4_clone,K=vec4_fromValues,$=vec4_copy,Z=vec4_set,J=vec4_add,tt=quat_multiply,et=vec4_scale,nt=vec4_dot,rt=vec4_lerp,ot=vec4_length,it=ot,at=vec4_squaredLength,st=at,ut=vec4_normalize,ct=vec4_exactEquals,lt=vec4_equals,ft=(V=vec3_create(),X=vec3_fromValues(1,0,0),q=vec3_fromValues(0,1,0),function(t,e,n){var r=vec3_dot(e,n);return r<-.999999?(cross(V,X,e),L(V)<1e-6&&cross(V,q,e),normalize(V,V),setAxisAngle(t,V,Math.PI),t):.999999<r?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(cross(V,e,n),t[0]=V[0],t[1]=V[1],t[2]=V[2],t[3]=1+r,ut(t,t))}),dt=(H=quat_create(),z=quat_create(),function(t,e,n,r,o,i){return slerp(H,e,o,i),slerp(z,n,r,i),slerp(t,H,z,2*i*(1-i)),t}),ht=(Y=mat3_create(),function(t,e,n,r){return Y[0]=n[0],Y[3]=n[1],Y[6]=n[2],Y[1]=r[0],Y[4]=r[1],Y[7]=r[2],Y[2]=-e[0],Y[5]=-e[1],Y[8]=-e[2],ut(t,fromMat3(t,Y))});function quat2_create(){var t=new v(8);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function quat2_clone(t){var e=new v(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function quat2_fromValues(t,e,n,r,o,i,a,s){var u=new v(8);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=o,u[5]=i,u[6]=a,u[7]=s,u}function fromRotationTranslationValues(t,e,n,r,o,i,a){var s=new v(8);s[0]=t,s[1]=e,s[2]=n,s[3]=r;var u=.5*o,c=.5*i,l=.5*a;return s[4]=u*r+c*n-l*e,s[5]=c*r+l*t-u*n,s[6]=l*r+u*e-c*t,s[7]=-u*t-c*e-l*n,s}function quat2_fromRotationTranslation(t,e,n){var r=.5*n[0],o=.5*n[1],i=.5*n[2],a=e[0],s=e[1],u=e[2],c=e[3];return t[0]=a,t[1]=s,t[2]=u,t[3]=c,t[4]=r*c+o*u-i*s,t[5]=o*c+i*a-r*u,t[6]=i*c+r*s-o*a,t[7]=-r*a-o*s-i*u,t}function quat2_fromTranslation(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function quat2_fromRotation(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function quat2_fromMat4(t,e){var n=quat_create();getRotation(n,e);var r=new v(3);return getTranslation(r,e),quat2_fromRotationTranslation(t,n,r),t}function quat2_copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function quat2_identity(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function quat2_set(t,e,n,r,o,i,a,s,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t[6]=s,t[7]=u,t}var pt=$;function getDual(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var mt=$;function setDual(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function quat2_getTranslation(t,e){var n=e[4],r=e[5],o=e[6],i=e[7],a=-e[0],s=-e[1],u=-e[2],c=e[3];return t[0]=2*(n*c+i*a+r*u-o*s),t[1]=2*(r*c+i*s+o*a-n*u),t[2]=2*(o*c+i*u+n*s-r*a),t}function quat2_translate(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=.5*n[0],u=.5*n[1],c=.5*n[2],l=e[4],f=e[5],d=e[6],h=e[7];return t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=a*s+o*c-i*u+l,t[5]=a*u+i*s-r*c+f,t[6]=a*c+r*u-o*s+d,t[7]=-r*s-o*u-i*c+h,t}function quat2_rotateX(t,e,n){var r=-e[0],o=-e[1],i=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=s*a+l*r+u*i-c*o,d=u*a+l*o+c*r-s*i,h=c*a+l*i+s*o-u*r,p=l*a-s*r-u*o-c*i;return quat_rotateX(t,e,n),r=t[0],o=t[1],i=t[2],a=t[3],t[4]=f*a+p*r+d*i-h*o,t[5]=d*a+p*o+h*r-f*i,t[6]=h*a+p*i+f*o-d*r,t[7]=p*a-f*r-d*o-h*i,t}function quat2_rotateY(t,e,n){var r=-e[0],o=-e[1],i=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=s*a+l*r+u*i-c*o,d=u*a+l*o+c*r-s*i,h=c*a+l*i+s*o-u*r,p=l*a-s*r-u*o-c*i;return quat_rotateY(t,e,n),r=t[0],o=t[1],i=t[2],a=t[3],t[4]=f*a+p*r+d*i-h*o,t[5]=d*a+p*o+h*r-f*i,t[6]=h*a+p*i+f*o-d*r,t[7]=p*a-f*r-d*o-h*i,t}function quat2_rotateZ(t,e,n){var r=-e[0],o=-e[1],i=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=s*a+l*r+u*i-c*o,d=u*a+l*o+c*r-s*i,h=c*a+l*i+s*o-u*r,p=l*a-s*r-u*o-c*i;return quat_rotateZ(t,e,n),r=t[0],o=t[1],i=t[2],a=t[3],t[4]=f*a+p*r+d*i-h*o,t[5]=d*a+p*o+h*r-f*i,t[6]=h*a+p*i+f*o-d*r,t[7]=p*a-f*r-d*o-h*i,t}function rotateByQuatAppend(t,e,n){var r=n[0],o=n[1],i=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=e[3];return t[0]=s*a+l*r+u*i-c*o,t[1]=u*a+l*o+c*r-s*i,t[2]=c*a+l*i+s*o-u*r,t[3]=l*a-s*r-u*o-c*i,s=e[4],u=e[5],c=e[6],l=e[7],t[4]=s*a+l*r+u*i-c*o,t[5]=u*a+l*o+c*r-s*i,t[6]=c*a+l*i+s*o-u*r,t[7]=l*a-s*r-u*o-c*i,t}function rotateByQuatPrepend(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*l+a*s+o*c-i*u,t[1]=o*l+a*u+i*s-r*c,t[2]=i*l+a*c+r*u-o*s,t[3]=a*l-r*s-o*u-i*c,s=n[4],u=n[5],c=n[6],l=n[7],t[4]=r*l+a*s+o*c-i*u,t[5]=o*l+a*u+i*s-r*c,t[6]=i*l+a*c+r*u-o*s,t[7]=a*l-r*s-o*u-i*c,t}function rotateAroundAxis(t,e,n,r){if(Math.abs(r)<I)return quat2_copy(t,e);var o=Math.hypot(n[0],n[1],n[2]);r*=.5;var i=Math.sin(r),a=i*n[0]/o,s=i*n[1]/o,u=i*n[2]/o,c=Math.cos(r),l=e[0],f=e[1],d=e[2],h=e[3];t[0]=l*c+h*a+f*u-d*s,t[1]=f*c+h*s+d*a-l*u,t[2]=d*c+h*u+l*s-f*a,t[3]=h*c-l*a-f*s-d*u;var p=e[4],m=e[5],_=e[6],v=e[7];return t[4]=p*c+v*a+m*u-_*s,t[5]=m*c+v*s+_*a-p*u,t[6]=_*c+v*u+p*s-m*a,t[7]=v*c-p*a-m*s-_*u,t}function quat2_add(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function quat2_multiply(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],s=n[4],u=n[5],c=n[6],l=n[7],f=e[4],d=e[5],h=e[6],p=e[7],m=n[0],_=n[1],v=n[2],y=n[3];return t[0]=r*y+a*m+o*v-i*_,t[1]=o*y+a*_+i*m-r*v,t[2]=i*y+a*v+r*_-o*m,t[3]=a*y-r*m-o*_-i*v,t[4]=r*l+a*s+o*c-i*u+f*y+p*m+d*v-h*_,t[5]=o*l+a*u+i*s-r*c+d*y+p*_+h*m-f*v,t[6]=i*l+a*c+r*u-o*s+h*y+p*v+f*_-d*m,t[7]=a*l-r*s-o*u-i*c+p*y-f*m-d*_-h*v,t}var _t=quat2_multiply;function quat2_scale(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var vt=nt;function quat2_lerp(t,e,n,r){var o=1-r;return vt(e,n)<0&&(r=-r),t[0]=e[0]*o+n[0]*r,t[1]=e[1]*o+n[1]*r,t[2]=e[2]*o+n[2]*r,t[3]=e[3]*o+n[3]*r,t[4]=e[4]*o+n[4]*r,t[5]=e[5]*o+n[5]*r,t[6]=e[6]*o+n[6]*r,t[7]=e[7]*o+n[7]*r,t}function quat2_invert(t,e){var n=bt(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function quat2_conjugate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var yt=ot,gt=yt,bt=at,Et=bt;function quat2_normalize(t,e){var n=bt(e);if(0<n){n=Math.sqrt(n);var r=e[0]/n,o=e[1]/n,i=e[2]/n,a=e[3]/n,s=e[4],u=e[5],c=e[6],l=e[7],f=r*s+o*u+i*c+a*l;t[0]=r,t[1]=o,t[2]=i,t[3]=a,t[4]=(s-r*f)/n,t[5]=(u-o*f)/n,t[6]=(c-i*f)/n,t[7]=(l-a*f)/n}return t}function quat2_str(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function quat2_exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function quat2_equals(t,e){var n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=e[0],f=e[1],d=e[2],h=e[3],p=e[4],m=e[5],_=e[6],v=e[7];return Math.abs(n-l)<=I*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-f)<=I*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(o-d)<=I*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(i-h)<=I*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-p)<=I*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-m)<=I*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-_)<=I*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(c-v)<=I*Math.max(1,Math.abs(c),Math.abs(v))}function vec2_create(){var t=new v(2);return v!=Float32Array&&(t[0]=0,t[1]=0),t}function vec2_clone(t){var e=new v(2);return e[0]=t[0],e[1]=t[1],e}function vec2_fromValues(t,e){var n=new v(2);return n[0]=t,n[1]=e,n}function vec2_copy(t,e){return t[0]=e[0],t[1]=e[1],t}function vec2_set(t,e,n){return t[0]=e,t[1]=n,t}function vec2_add(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function vec2_subtract(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function vec2_multiply(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function vec2_divide(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function vec2_ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function vec2_floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function vec2_min(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function vec2_max(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function vec2_round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function vec2_scale(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function vec2_scaleAndAdd(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function vec2_distance(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function vec2_squaredDistance(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function vec2_length(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function vec2_squaredLength(t){var e=t[0],n=t[1];return e*e+n*n}function vec2_negate(t,e){return t[0]=-e[0],t[1]=-e[1],t}function vec2_inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function vec2_normalize(t,e){var n=e[0],r=e[1],o=n*n+r*r;return 0<o&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function vec2_dot(t,e){return t[0]*e[0]+t[1]*e[1]}function vec2_cross(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function vec2_lerp(t,e,n,r){var o=e[0],i=e[1];return t[0]=o+r*(n[0]-o),t[1]=i+r*(n[1]-i),t}function vec2_random(t,e){e=e||1;var n=2*h()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function transformMat2(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[2]*o,t[1]=n[1]*r+n[3]*o,t}function transformMat2d(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[2]*o+n[4],t[1]=n[1]*r+n[3]*o+n[5],t}function vec2_transformMat3(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[3]*o+n[6],t[1]=n[1]*r+n[4]*o+n[7],t}function vec2_transformMat4(t,e,n){var r=e[0],o=e[1];return t[0]=n[0]*r+n[4]*o+n[12],t[1]=n[1]*r+n[5]*o+n[13],t}function vec2_rotate(t,e,n,r){var o=e[0]-n[0],i=e[1]-n[1],a=Math.sin(r),s=Math.cos(r);return t[0]=o*s-i*a+n[0],t[1]=o*a+i*s+n[1],t}function vec2_angle(t,e){var n=t[0],r=t[1],o=e[0],i=e[1],a=n*n+r*r;0<a&&(a=1/Math.sqrt(a));var s=o*o+i*i;0<s&&(s=1/Math.sqrt(s));var u=(n*o+r*i)*a*s;return 1<u?0:u<-1?Math.PI:Math.acos(u)}function vec2_zero(t){return t[0]=0,t[1]=0,t}function vec2_str(t){return"vec2("+t[0]+", "+t[1]+")"}function vec2_exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]}function vec2_equals(t,e){var n=t[0],r=t[1],o=e[0],i=e[1];return Math.abs(n-o)<=I*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-i)<=I*Math.max(1,Math.abs(r),Math.abs(i))}var Tt,Mt=vec2_length,At=vec2_subtract,St=vec2_multiply,wt=vec2_divide,Rt=vec2_distance,xt=vec2_squaredDistance,Ct=vec2_squaredLength,Lt=(Tt=vec2_create(),function(t,e,n,r,o,i){var a,s;for(e=e||2,n=n||0,s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)Tt[0]=t[a],Tt[1]=t[a+1],o(Tt,Tt,i),t[a]=Tt[0],t[a+1]=Tt[1];return t})},function(t,n,e){"use strict";function __export(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0}),__export(e(3)),__export(e(13)),__export(e(14)),__export(e(15)),__export(e(16)),__export(e(17)),__export(e(5)),__export(e(18)),__export(e(4)),__export(e(19)),__export(e(20)),__export(e(23))},function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,h="~";function Events(){}function EE(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function addListener(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var i=new EE(n,r||t,o),a=h?h+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],i]:t._events[a].push(i):(t._events[a]=i,t._eventsCount++),t}function clearEvent(t,e){0==--t._eventsCount?t._events=new Events:delete t._events[e]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(h=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(h?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},EventEmitter.prototype.listeners=function listeners(t){var e=h?h+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,i=new Array(o);r<o;r++)i[r]=n[r].fn;return i},EventEmitter.prototype.listenerCount=function listenerCount(t){var e=h?h+t:t,n=this._events[e];return n?n.fn?1:n.length:0},EventEmitter.prototype.emit=function emit(t,e,n,r,o,i){var a=h?h+t:t;if(!this._events[a])return!1;var s,u,c=this._events[a],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,r),!0;case 5:return c.fn.call(c.context,e,n,r,o),!0;case 6:return c.fn.call(c.context,e,n,r,o,i),!0}for(u=1,s=new Array(l-1);u<l;u++)s[u-1]=arguments[u];c.fn.apply(c.context,s)}else{var f,d=c.length;for(u=0;u<d;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),l){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,n);break;case 4:c[u].fn.call(c[u].context,e,n,r);break;default:if(!s)for(f=1,s=new Array(l-1);f<l;f++)s[f-1]=arguments[f];c[u].fn.apply(c[u].context,s)}}return!0},EventEmitter.prototype.on=function on(t,e,n){return addListener(this,t,e,n,!1)},EventEmitter.prototype.once=function once(t,e,n){return addListener(this,t,e,n,!0)},EventEmitter.prototype.removeListener=function removeListener(t,e,n,r){var o=h?h+t:t;if(!this._events[o])return this;if(!e)return clearEvent(this,o),this;var i=this._events[o];if(i.fn)i.fn!==e||r&&!i.once||n&&i.context!==n||clearEvent(this,o);else{for(var a=0,s=[],u=i.length;a<u;a++)(i[a].fn!==e||r&&!i[a].once||n&&i[a].context!==n)&&s.push(i[a]);s.length?this._events[o]=1===s.length?s[0]:s:clearEvent(this,o)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var e;return t?(e=h?h+t:t,this._events[e]&&clearEvent(this,e)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=h,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(GLBuffer.prototype.addData=function(t){this.arrayBuffers.push(t),this._byteLength+=t.byteLength},GLBuffer.prototype.removeData=function(t){var e=this.arrayBuffers.indexOf(t);if(-1<e){var n=this.arrayBuffers[e];this._byteLength-=n.byteLength,this.arrayBuffers.splice(e,1)}},GLBuffer.prototype.upload=function(t){t&&this.addData(t),this.bind();var e=this.gl;e.bufferData(this.type,this._byteLength,this.drawType);for(var n,r=0,o=0;n=this.arrayBuffers[o];o++)e.bufferSubData(this.type,r,n),r+=n.byteLength;return this.unbind(),this._byteLength},GLBuffer.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},GLBuffer.prototype.unbind=function(){this.gl.bindBuffer(this.type,null)},GLBuffer.prototype.destroy=function(){this.gl.isBuffer(this.buffer)&&this.gl.deleteBuffer(this.buffer),this.gl=null,this.buffer=null},Object.defineProperty(GLBuffer.prototype,"byteLength",{get:function(){return this._byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(GLBuffer.prototype,"length",{get:function(){return this.arrayBuffers.length},enumerable:!0,configurable:!0}),GLBuffer.createVertexBuffer=function(t,e,n){return void 0===e&&(e=null),void 0===n&&(n=t.STATIC_DRAW),new GLBuffer(t,t.ARRAY_BUFFER,e,n)},GLBuffer.createIndexBuffer=function(t,e,n){return void 0===e&&(e=null),void 0===n&&(n=t.STATIC_DRAW),new GLBuffer(t,t.ELEMENT_ARRAY_BUFFER,e,n)},GLBuffer.create=function(t,e,n,r){return void 0===n&&(n=null),void 0===r&&(r=t.STATIC_DRAW),new GLBuffer(t,e,n,r)},GLBuffer);function GLBuffer(t,e,n,r){void 0===e&&(e=t.ARRAY_BUFFER),void 0===r&&(r=t.STATIC_DRAW),this.gl=t,this.type=e,this.arrayBuffers=[],this._byteLength=0,this.buffer=t.createBuffer(),this.drawType=r,n&&this.upload(n)}e.GLBuffer=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(GLVertexArrayObject.prototype.bind=function(){return this.vao&&(this.gl.bindVertexArray(this.vao),this.dirty&&(this.activate(),this.dirty=!1,this.bind())),this},GLVertexArrayObject.prototype.activate=function(){var t=this.gl,e=null;this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null);for(var n=0,r=void 0;r=this.attributes[n];n++)e!==r.buffer&&(e&&e.unbind(),r.buffer.bind(),e=r.buffer),GLVertexArrayObject.setVertexAttribArray(t,r);return e&&e.unbind(),this.indexBuffer.bind(),this},GLVertexArrayObject.prototype.deactivate=function(){for(var t=this.gl,e=null,n=0,r=void 0;r=this.attributes[n];n++)e!==r.buffer&&(r.buffer.unbind(),e=r.buffer),GLVertexArrayObject.setVertexAttribArray(t,r,!0);return this.indexBuffer.unbind(),this},GLVertexArrayObject.prototype.unbind=function(t){return void 0===t&&(t=!1),this.vao?this.gl.bindVertexArray(null):this.vao&&!t||this.deactivate(),this},GLVertexArrayObject.prototype.addAttribute=function(t,e,n,r,o,i,a,s){return void 0===s&&(s=!0),this.attributes.push({buffer:t,attribute:e,size:n,type:r,normalized:o,stride:i,offset:a,initialize:s}),this.dirty=!0,this},GLVertexArrayObject.prototype.setIndexBuffer=function(t){return this.indexBuffer=t,this},GLVertexArrayObject.prototype.draw=function(t,e,n,r){return this.gl.drawElements(t,e,n,r),this},GLVertexArrayObject.prototype.clear=function(){this.vao&&this.gl.bindVertexArray(this.vao),this.deactivate(),this.attributes.length=0,this.indexBuffer=null,this.vao&&this.gl.bindVertexArray(null)},GLVertexArrayObject.prototype.destroy=function(){this.clear(),this.vao&&this.gl.deleteVertexArray(this.vao),this.gl=void 0,this.indexBuffer=void 0,this.attributes=void 0,this.vao=void 0},GLVertexArrayObject.setVertexAttribArrays=function(t,e,n){void 0===n&&(n=!1);for(var r=0,o=void 0;o=e[r];r++)GLVertexArrayObject.setVertexAttribArray(t,o,n)},GLVertexArrayObject.setVertexAttribArray=function(t,e,n){void 0===n&&(n=!1),e.initialize&&e.attribute&&(t.vertexAttribPointer(e.attribute.location,e.size,e.type,e.normalized,e.stride,e.offset),e.initialize=!1),n&&e.attribute?t.disableVertexAttribArray(e.attribute.location):e.attribute&&t.enableVertexAttribArray(e.attribute.location)},GLVertexArrayObject);function GLVertexArrayObject(t){this.gl=t,this.vao=this.gl.createVertexArray(),this.attributes=[],this.dirty=!1}e.GLVertexArrayObject=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(7),o=(GLTexture.prototype.upload=function(t){this.bind();var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha);var n=t.width,r=t.height;r!==this._height||n!==this._width?e.texImage2D(e.TEXTURE_2D,this.miplevel,this.internalformat,this.format,this.type,t):e.texSubImage2D(e.TEXTURE_2D,this.miplevel,0,0,this.format,this.type,t),this._width=n,this._height=r,this.unbind()},GLTexture.prototype.uploadData=function(t,e,n){this.bind();var r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha),e!==this._width||n!==this._height?r.texImage2D(r.TEXTURE_2D,this.miplevel,this.internalformat,e,n,0,this.format,this.type,t||null):r.texSubImage2D(r.TEXTURE_2D,this.miplevel,0,0,e,n,this.format,this.type,t||null),this._width=e,this._height=n,this.unbind()},GLTexture.prototype.bind=function(t){void 0===t&&(t=this._textureID);var e=this.gl;return void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._texture),this},GLTexture.prototype.unbind=function(t){void 0===t&&(t=this._textureID);var e=this.gl;return void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null),this},GLTexture.prototype.minFilter=function(t){this.bind();var e=this.gl;this.mipmap?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR:e.NEAREST),this.unbind()},GLTexture.prototype.setMinFilter=function(t){this.mipmap||t!==r.MIN_FILTER.LINEAR_MIPMAP_LINEAR&&t!==r.MIN_FILTER.LINEAR_MIPMAP_NEAREST&&t!==r.MIN_FILTER.NEAREST_MIPMAP_LINEAR&&t!==r.MIN_FILTER.NEAREST_MIPMAP_NEAREST||this.enableMipmap(),this.bind();var e=this.gl;if(this.mipmap)e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t);else{var n=t===r.MIN_FILTER.LINEAR||r.MIN_FILTER.LINEAR_MIPMAP_LINEAR||r.MIN_FILTER.LINEAR_MIPMAP_NEAREST;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n?e.LINEAR:e.NEAREST)}this.unbind()},GLTexture.prototype.magFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t?e.LINEAR:e.NEAREST),this.unbind()},GLTexture.prototype.setMagFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),this.unbind()},GLTexture.prototype.enableMipmap=function(){if(GLTexture.isPowerOf2(this._width)&&GLTexture.isPowerOf2(this._height)&&(this.internalformat===this.gl.RGB||this.internalformat===this.gl.RGBA)){var t=this.gl;this.bind(),this.mipmap=!0,t.generateMipmap(t.TEXTURE_2D),this.unbind()}},GLTexture.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},GLTexture.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},GLTexture.prototype.enableWrapClamp=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.unbind()},GLTexture.prototype.enableWrapRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),this.unbind()},GLTexture.prototype.enableWrapMirrorRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT),this.unbind()},GLTexture.prototype.setWrapS=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t),this.unbind()},GLTexture.prototype.setWrapT=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t),this.unbind()},GLTexture.prototype.flipY=function(t){var e=this.gl;this.bind(),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.unbind()},GLTexture.prototype.destroy=function(){this.gl.deleteTexture(this._texture)},GLTexture.isPowerOf2=function(t){return 0==(t&t-1)},GLTexture.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},Object.defineProperty(GLTexture.prototype,"textureID",{get:function(){return this._textureID},set:function(t){this._textureID=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLTexture.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLTexture.prototype,"premultiplyAlpha",{get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLTexture.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(GLTexture.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),GLTexture.fromSource=function(t,e,n,r,o,i,a){void 0===n&&(n=!1),void 0===r&&(r=0);var s=new GLTexture(t,r,null,null,o,i,a);return s._premultiplyAlpha=n,s.upload(e),s},GLTexture.fromData=function(t,e,n,r,o,i,a,s,u){void 0===o&&(o=0);var c=new GLTexture(t,o,null,null,i,a,s);return c._premultiplyAlpha=u,c.uploadData(e,n,r),c},GLTexture);function GLTexture(t,e,n,r,o,i,a){void 0===e&&(e=0),void 0===n&&(n=-1),void 0===r&&(r=-1),void 0===o&&(o=t.RGBA),void 0===i&&(i=t.RGBA),void 0===a&&(a=t.UNSIGNED_BYTE),this.gl=t,this._textureID=e,this._texture=t.createTexture(),this.mipmap=!1,this._premultiplyAlpha=!1,this._width=n,this._height=r,this.internalformat=o,this.format=i,this.type=a,this.miplevel=0}e.GLTexture=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=null,a={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"};e.map=function map(t,e){if(!i){var n=Object.keys(a);i={};for(var r=0;r<n.length;r++){var o=n[r];i[t[o]]=a[o]}}return i[e]}},function(t,e,n){"use strict";var r,o,i,a,s,u,c;Object.defineProperty(e,"__esModule",{value:!0}),(r=e.GL_TYPES||(e.GL_TYPES={}))[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",e.GL_TYPES_BYTESIZE={5120:1,5121:1,5122:2,5123:2,5124:4,5125:4,5126:4},(o=e.GL_PRIMITIVES||(e.GL_PRIMITIVES={})).POSITION="POSITION",o.NORMAL="NORMAL",o.TANGENT="TANGENT",o.TEXCOORD_0="TEXCOORD_0",o.TEXCOORD_1="TEXCOORD_1",o.COLOR_0="COLOR_0",o.JOINTS_0="JOINTS_0",o.WEIGHTS_0="WEIGHTS_0",o.JOINTS_1="JOINTS_1",o.WEIGHTS_1="WEIGHTS_1",(i=e.GL_BUFFERS||(e.GL_BUFFERS={}))[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",(a=e.MAG_FILTER||(e.MAG_FILTER={}))[a.NEAREST=9728]="NEAREST",a[a.LINEAR=9729]="LINEAR",(s=e.MIN_FILTER||(e.MIN_FILTER={}))[s.NEAREST=9728]="NEAREST",s[s.LINEAR=9729]="LINEAR",s[s.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",s[s.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",s[s.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",s[s.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",(u=e.TEXTURE_WRAP||(e.TEXTURE_WRAP={}))[u.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",u[u.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",u[u.REPEAT=10497]="REPEAT",(c=e.GL_INTERNALFORMAT||(e.GL_INTERNALFORMAT={}))[c.RGB=6407]="RGB",c[c.RGBA=6408]="RGBA",c[c.R8=33321]="R8",c[c.R16F=33325]="R16F",c[c.R32F=33326]="R32F",c[c.R8UI=33330]="R8UI",c[c.RG8=33323]="RG8",c[c.RG16F=33327]="RG16F",c[c.RG=33319]="RG",c[c.RG32F=33328]="RG32F",c[c.RGB8=32849]="RGB8",c[c.SRGB=35904]="SRGB",c[c.SRGB8=35905]="SRGB8",c[c.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",c[c.RGB565=36194]="RGB565",c[c.R11F_G11F_B10F=35898]="R11F_G11F_B10F",c[c.RGB9_E5=35901]="RGB9_E5",c[c.RGB16F=34843]="RGB16F",c[c.RGB32F=34837]="RGB32F",c[c.RGB8UI=36221]="RGB8UI",c[c.RGBA8=32856]="RGBA8",c[c.RGB5_A1=32855]="RGB5_A1",c[c.RGBA16F=34842]="RGBA16F",c[c.RGBA32F=34836]="RGBA32F",c[c.RGBA8UI=36220]="RGBA8UI"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};e.map=function map(t){return r[t]}},function(t,e,n){"use strict";function booleanArray(t){for(var e=new Array(t),n=0;n<e.length;n++)e[n]=!1;return e}Object.defineProperty(e,"__esModule",{value:!0}),e.value=function value(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"samplerCube":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return booleanArray(2*e);case"bvec3":return booleanArray(3*e);case"bvec4":return booleanArray(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);default:console.warn("no default value for type ",t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=n(6),d=n(9),r=["return this.data.%%.value;"].join("\n"),o=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),i={float:"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])",int:"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)",samplerCube:"uniform1i(location, value)",ubo:"uniformBlockBinding(this.program, location, value)"},a={float:"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)",int:"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)",samplerCube:"uniform1iv(location, value)"},h=function Uniform(t,e,n,r){this.type=t,this.size=e,this.location=n,this.value=r};e.Uniform=h;var p=(UniformMap.prototype.add=function(t,e){this.uniformMap[t]=e},UniformMap.prototype.get=function(t){return this.uniformMap[t]},UniformMap.prototype.remove=function(t){this.uniformMap[t]&&(this.uniformMap[t]=void 0)},Object.defineProperty(UniformMap.prototype,"keys",{get:function(){return Object.keys(this.uniformMap)},enumerable:!0,configurable:!0}),UniformMap);function UniformMap(){this.uniformMap={}}e.UniformMap=p;var m=(Object.defineProperty(UniformAccessObject.prototype,"gl",{get:function(){return this._gl},set:function(t){this._gl=t},enumerable:!0,configurable:!0}),Object.defineProperty(UniformAccessObject.prototype,"program",{get:function(){return this._program},set:function(t){this._program=t},enumerable:!0,configurable:!0}),UniformAccessObject);function UniformAccessObject(t,e){this.data={},this._gl=t,this._program=e}function getUniformGroup(t,e){for(var n=e,r=0;r<t.length-1;r++){var o=n[t[r]]||{data:{}};n[t[r]]=o,n=o}return n}function generatePropertyDescriptor(t,e){return{get:function generateGetter(t){var e=r.replace("%%",t);return new Function(e)}(t),set:function generateSetter(t,e){var n,r=o.replace(/%%/g,t);return(n=1===e.size?i[e.type]:a[e.type])&&(r+="\nthis.gl."+n+";"),new Function("value",r)}(t,e)}}e.UniformAccessObject=m,e.extract=function extract(t,e){for(var n=new p,r=t.getProgramParameter(e,t.ACTIVE_UNIFORM_BLOCKS),o=0;o<r;o++){var i=t.getActiveUniformBlockName(e,o);i=i.replace(/\[.*?\]/,""),n.add(i,new h("ubo",1,o,null))}var a=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(o=0;o<a;o++){var s=t.getActiveUniform(e,o),u=s.name.replace(/\[.*?\]/,""),c=f.map(t,s.type),l=t.getUniformLocation(e,u);null!=l&&n.add(u,new h(c,s.size,t.getUniformLocation(e,u),d.value(c,s.size)))}return n},e.generateUniformAccessObject=function generateUniformAccessObject(t,e,n){for(var r=new m(t,n),o=e.keys,i=0;i<o.length;i++){var a=o[i],s=a.split("."),u=s[s.length-1],c=getUniformGroup(s,r),l=e.get(a);c.data[u]=l,c.gl=t,Object.defineProperty(c,u,generatePropertyDescriptor(u,l))}return r}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(6),u=n(8),c=(AttributeMap.prototype.add=function(t,e){this.attributeMap[t]=e},AttributeMap.prototype.remove=function(t){this.attributeMap[t]&&(this.attributeMap[t]=void 0)},AttributeMap.prototype.hasAttribute=function(t){return!!this.attributeMap[t]},AttributeMap.prototype.getAttribute=function(t){return this.attributeMap[t]},AttributeMap);function AttributeMap(){this.attributeMap={}}e.AttributeMap=c;var l=(GLAttribute.prototype.pointer=function(t,e,n,r){this.gl.vertexAttribPointer(this.location,this.size,t||this.gl.FLOAT,e||!1,n||0,r||0)},GLAttribute);function GLAttribute(t,e,n,r){this.gl=t,this.type=e,this.size=n,this.location=r}e.GLAttribute=l,e.extract=function extract(t,e){for(var n=new c,r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var i=t.getActiveAttrib(e,o),a=s.map(t,i.type);n.add(i.name,new l(t,a,u.map(a),t.getAttribLocation(e,i.name)))}return n}},function(t,e,n){"use strict";function compileShader(t,e,n){var r=t.createShader(e);return null==r?(console.error("Unable to create shader"),null):(t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error("Failed to compile shader: "+t.getShaderInfoLog(r)),t.deleteShader(r),null))}Object.defineProperty(e,"__esModule",{value:!0}),e.compile=function compile(t,e,n){var r=compileShader(t,t.VERTEX_SHADER,e),o=compileShader(t,t.FRAGMENT_SHADER,n);if(r&&o){var i=t.createProgram();return i?(t.attachShader(i,r),t.attachShader(i,o),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||(console.error("Shader Program Linking failed. Could not initialize Shader."),console.error("gl.VALIDATE_STATUS "+t.getProgramParameter(i,t.VALIDATE_STATUS)),console.error("gl.getError(): "+t.getError()),""!==t.getProgramInfoLog(i)&&console.warn("gl.getProgramInfoLog(): "+t.getProgramInfoLog(i)),t.deleteProgram(i),i=null),t.deleteShader(r),t.deleteShader(o),i):(console.error("Failed to create Programm"),null)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),o=n(4),l=n(0),i=(GLCube.prototype.calcVertexData=function(){var t,e,n,r=[1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1],o=[];o[0]=0,o[1]=1,o[2]=2,o[3]=1,o[4]=2,o[5]=3,o[6]=4,o[7]=5,o[8]=6,o[9]=4,o[10]=6,o[11]=7,o[12]=5,o[13]=6,o[14]=0,o[15]=0,o[16]=6,o[17]=1,o[18]=7,o[19]=2,o[20]=3,o[21]=7,o[22]=2,o[23]=4,o[24]=7,o[25]=6,o[26]=3,o[27]=6,o[28]=3,o[29]=1,o[30]=5,o[31]=4,o[32]=0,o[33]=0,o[34]=4,o[35]=2;for(var i=[],a=0;a<o.length;a+=3){t=l.vec3.fromValues(r[3*o[a]],r[3*o[a]+1],r[3*o[a]+2]),e=l.vec3.fromValues(r[3*o[a+1]],r[3*o[a+1]+1],r[3*o[a+1]+2]),n=l.vec3.fromValues(r[3*o[a+2]],r[3*o[a+2]+1],r[3*o[a+2]+2]);var s=l.vec3.create();l.vec3.subtract(s,e,t);var u=l.vec3.create();l.vec3.subtract(u,n,t);var c=l.vec3.create();l.vec3.cross(c,s,u),l.vec3.normalize(c,c),i.push(t[0],t[1],t[2],c[0],c[1],c[2]),i.push(e[0],e[1],e[2],c[0],c[1],c[2]),i.push(n[0],n[1],n[2],c[0],c[1],c[2])}return new Float32Array(i)},GLCube.prototype.createVertexData=function(){for(var t=this.calcVertexData(),e=new Uint8Array(36),n=0;n<36;n++)e[n]=n;if(this._vertexBuffer=r.GLBuffer.createVertexBuffer(this.gl,t,this.gl.STATIC_DRAW),!this._vertexBuffer)throw"Failed to create VertexBuffer Object";if(this._indexBuffer=r.GLBuffer.createIndexBuffer(this.gl,e,this.gl.STATIC_DRAW),!this._indexBuffer)throw"Failed to create IndexBuffer Object!";this._vertexArrayObject=new o.GLVertexArrayObject(this.gl),this.vertexArrayObject.setIndexBuffer(this._indexBuffer)},Object.defineProperty(GLCube.prototype,"vertexBuffer",{get:function(){return this._vertexBuffer},set:function(t){this._vertexBuffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLCube.prototype,"indexBuffer",{get:function(){return this._indexBuffer},set:function(t){this._indexBuffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLCube.prototype,"vertexArrayObject",{get:function(){return this._vertexArrayObject},set:function(t){this._vertexArrayObject=t},enumerable:!0,configurable:!0}),GLCube.prototype.draw=function(){this.vertexArrayObject.bind(),this.gl.drawElements(this.gl.TRIANGLES,GLCube.INDEX_LENGTH,this.gl.UNSIGNED_BYTE,0),this.vertexArrayObject.unbind()},GLCube.INDEX_LENGTH=36,GLCube);function GLCube(t){this.gl=t,this.createVertexData()}e.GLCube=i},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function __(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var u,h=n(5),i=(u=h.GLTexture,o(GLCubemap,u),GLCubemap.prototype.upload=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=0),void 0===r&&(r=0),this.bind();var o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,this.internalformat,this.format,this.type,t),0===r&&(this._width=t.width,this._height=t.height),this.unbind()},GLCubemap.prototype.uploadData=function(t,e,n,r,o,i){void 0===n&&(n=this._width),void 0===r&&(r=this._height),void 0===o&&(o=!1),void 0===i&&(i=0),this.bind();var a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,o),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,this.internalformat,n,r,0,this.format,this.type,t||null),0===i&&(this._width=n,this._height=r),this.unbind()},GLCubemap.prototype.bind=function(t){void 0===t&&(t=this._textureID);var e=this.gl;return void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this._texture),this},GLCubemap.prototype.unbind=function(t){void 0===t&&(t=this._textureID);var e=this.gl;return void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,null),this},GLCubemap.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},GLCubemap.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},GLCubemap.prototype.minFilter=function(t){this.bind();var e=this.gl;this.mipmap?e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,t?e.LINEAR:e.NEAREST),this.unbind()},GLCubemap.prototype.magFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,t?e.LINEAR:e.NEAREST),this.unbind()},GLCubemap.prototype.enableMipmap=function(){var t=this.gl;this.bind(),this.mipmap=!0,t.generateMipmap(t.TEXTURE_CUBE_MAP),this.unbind()},GLCubemap.prototype.enableWrapClamp=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),this.unbind()},GLCubemap.prototype.enableWrapRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_R,t.REPEAT),this.unbind()},GLCubemap.prototype.enableWrapMirrorRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_R,t.MIRRORED_REPEAT),this.unbind()},GLCubemap.prototype.destroy=function(){this.gl.deleteTexture(this._texture)},Object.defineProperty(GLCubemap.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(GLCubemap.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),GLCubemap.cubemapFromSource=function(t,e,n,r,o,i,a,s){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=0);var u=new GLCubemap(t,o,null,null,i,a,s),c=[].concat(e);u.premultiplyAlpha=r;for(var l=Math.floor(c.length/6),f=0;f<l;f++)for(var d=0;d<6;d++)u.upload(c[6*f+d],n,d,f);return h.GLTexture.isPowerOf2(c[0].width)&&h.GLTexture.isPowerOf2(c[0].height)?(u.enableMipmap(),u.enableWrapRepeat()):u.enableWrapClamp(),u.enableLinearScaling(),u},GLCubemap.cubemapFromData=function(t,e,n,r,o,i,a,s,u){void 0===o&&(o=!1),void 0===i&&(i=0);for(var c=new GLCubemap(t,i,null,null,a,s,u),l=[].concat(e),f=0;f<6;f++)c.uploadData(l[f],f,n,r,o);return c},GLCubemap);function GLCubemap(t,e,n,r,o,i,a){void 0===e&&(e=0),void 0===n&&(n=-1),void 0===r&&(r=-1),void 0===o&&(o=t.RGBA),void 0===i&&(i=t.RGBA),void 0===a&&(a=t.UNSIGNED_BYTE);var s=u.call(this,t,e,n,r,o,i,a)||this;return s.gl=t,s._textureID=e,s._texture=t.createTexture(),s.mipmap=!1,s.premultiplyAlpha=!1,s._width=n,s._height=r,s.format=i,s.type=a,s}e.GLCubemap=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=n(5),r=(GLFramebuffer.prototype.checkStatus=function(){var t=this.gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);switch(e){case t.FRAMEBUFFER_COMPLETE:return!0;case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return console.warn("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"),!1;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return console.warn("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),!1;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return console.warn("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),!1;case t.FRAMEBUFFER_UNSUPPORTED:return console.warn("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED"),!1;default:return console.warn("Incomplete framebuffer: "+e),!1}},GLFramebuffer.createRGBA=function(t,e,n,r,o,i,a,s){return void 0===r&&(r=0),void 0===o&&(o=t.COLOR_ATTACHMENT0),GLFramebuffer.createFloat32(t,e,n,null,r,o,i,a,s)},GLFramebuffer.createFloat32=function(t,e,n,r,o,i,a,s,u){void 0===o&&(o=0),void 0===i&&(i=t.COLOR_ATTACHMENT0);var c=f.GLTexture.fromData(t,r,e,n,o,a,s,u);c.enableNearestScaling(),c.enableWrapClamp();var l=new GLFramebuffer(t,e,n);return l.addTargetTexture(c,i),l.unbind(),l},GLFramebuffer.prototype.addTargetTexture=function(t,e,n,r){void 0===e&&(e=this.gl.COLOR_ATTACHMENT0),void 0===r&&(r=!0);var o=this.gl;if(-1<this._textures.indexOf(t))return this.bind(),this;this._textures.push(t||new f.GLTexture(o,0));var i=this._textures[this._textures.length-1].bind();return this.bind(),n||0===n?o.framebufferTexture2D(o.FRAMEBUFFER,e,o.TEXTURE_CUBE_MAP_POSITIVE_X+n,i.texture,0):o.framebufferTexture2D(o.FRAMEBUFFER,e,o.TEXTURE_2D,i.texture,0),r&&(this.drawBuffers.push(e),this.gl.drawBuffers(this.drawBuffers)),this},GLFramebuffer.prototype.setDrawBuffer=function(t){void 0===t&&(t=this.drawBuffers),this.gl.drawBuffers(t)},GLFramebuffer.prototype.createRenderbuffer=function(){if(this.renderbuffer)return null;var t=this.gl;return this.bind(),this.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height),this.unbind(),this},GLFramebuffer.prototype.clear=function(t,e,n,r,o,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===o&&(o=!1),void 0===i&&(i=!1),this.bind();var a=this.gl;return a.clearColor(t,e,n,r),o&&i?a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT):o?a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT):i?a.clear(a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT):a.clear(a.COLOR_BUFFER_BIT),this},GLFramebuffer.prototype.bind=function(t){void 0===t&&(t=this.gl.FRAMEBUFFER);for(var e=this.gl,n=0,r=this._textures;n<r.length;n++)r[n].unbind();return e.bindFramebuffer(t,this.framebuffer),this},GLFramebuffer.prototype.unbind=function(t){return void 0===t&&(t=this.gl.FRAMEBUFFER),this.gl.bindFramebuffer(t,null),this},GLFramebuffer.prototype.resize=function(t,e){var n=this.gl;this.width=t,this.height=e;for(var r=0,o=this._textures;r<o.length;r++)o[r].uploadData(null,t,e);return this.renderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,this.renderbuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t,e)),this},GLFramebuffer.prototype.destroy=function(){for(var t=0,e=this._textures;t<e.length;t++)e[t].destroy();this.gl.deleteFramebuffer(this.framebuffer),this.gl=void 0,this.framebuffer=void 0,this.renderbuffer=void 0,this.drawBuffers.length=0,this._textures.length=0},GLFramebuffer.prototype.getTexture=function(t){return void 0===t&&(t=0),this._textures[t]},GLFramebuffer.prototype.setTexture=function(t,e){void 0===e&&(e=0),this._textures[e]=t},Object.defineProperty(GLFramebuffer.prototype,"texture",{get:function(){return this._textures[0]},set:function(t){this._textures[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLFramebuffer.prototype,"textures",{get:function(){return this._textures},set:function(t){this._textures=t},enumerable:!0,configurable:!0}),GLFramebuffer);function GLFramebuffer(t,e,n){void 0===e&&(e=512),void 0===n&&(n=512),this.drawBuffers=[],this.gl=t,this.width=e,this.height=n,this.framebuffer=t.createFramebuffer(),this.renderbuffer=null,this._textures=[]}e.GLFramebuffer=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),o=n(4),i=(GLQuad.prototype.createVertexData=function(){var t=new Float32Array([-1,1,0,1,-1,-1,0,0,1,1,1,1,1,-1,1,0]),e=new Uint8Array(6);if(e[0]=0,e[1]=1,e[2]=2,e[3]=1,e[4]=2,e[5]=3,this._vertexBuffer=r.GLBuffer.createVertexBuffer(this.gl,t,this.gl.STATIC_DRAW),!this._vertexBuffer)throw"Failed to create VertexBuffer Object";if(this._indexBuffer=r.GLBuffer.createIndexBuffer(this.gl,e,this.gl.STATIC_DRAW),!this._indexBuffer)throw"Failed to create IndexBuffer Object!";this._vertexArrayObject=new o.GLVertexArrayObject(this.gl),this.vertexArrayObject.setIndexBuffer(this._indexBuffer)},Object.defineProperty(GLQuad.prototype,"vertexBuffer",{get:function(){return this._vertexBuffer},set:function(t){this._vertexBuffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLQuad.prototype,"indexBuffer",{get:function(){return this._indexBuffer},set:function(t){this._indexBuffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLQuad.prototype,"vertexArrayObject",{get:function(){return this._vertexArrayObject},set:function(t){this._vertexArrayObject=t},enumerable:!0,configurable:!0}),GLQuad.prototype.draw=function(){this.vertexArrayObject.bind(),this.gl.drawElements(this.gl.TRIANGLES,GLQuad.INDEX_LENGTH,this.gl.UNSIGNED_BYTE,0),this.vertexArrayObject.unbind()},GLQuad.INDEX_LENGTH=6,GLQuad);function GLQuad(t){this.gl=t,this.createVertexData()}e.GLQuad=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=n(3),p=n(4),r=(GLSphere.prototype.createVertexData=function(t,e,n){for(var r=1/(e-1),o=1/(n-1),i=new Float32Array(e*n*8),a=new Uint32Array(e*n*6),s=0,u=0;u<e;u++)for(var c=0;c<n;c++){var l=Math.cos(2*Math.PI*c*o)*Math.sin(Math.PI*u*r),f=Math.sin(-Math.PI/2+Math.PI*u*r),d=Math.sin(2*Math.PI*c*o)*Math.sin(Math.PI*u*r);i[s++]=l*t,i[s++]=f*t,i[s++]=d*t,i[s++]=l,i[s++]=f,i[s++]=d,i[s++]=c*o,i[s++]=u*r}for(u=this._indexcount=0;u<e-1;u++)for(c=0;c<n-1;c++)a[this._indexcount++]=u*n+c,a[this._indexcount++]=(u+1)*n+c,a[this._indexcount++]=(u+1)*n+(c+1),a[this._indexcount++]=u*n+c,a[this._indexcount++]=(u+1)*n+(c+1),a[this._indexcount++]=u*n+(c+1);if(this._vertexBuffer=h.GLBuffer.createVertexBuffer(this.gl,i,this.gl.STATIC_DRAW),!this._vertexBuffer)throw"Failed to create VertexBuffer Object";if(this._indexBuffer=h.GLBuffer.createIndexBuffer(this.gl,a,this.gl.STATIC_DRAW),!this._indexBuffer)throw"Failed to create IndexBuffer Object!";this._vertexArrayObject=new p.GLVertexArrayObject(this.gl),this._vertexArrayObject.setIndexBuffer(this._indexBuffer)},GLSphere.prototype.draw=function(){this.vertexArrayObject.bind(),this.gl.drawElements(this.gl.TRIANGLES,this._indexcount,this.gl.UNSIGNED_INT,0),this.vertexArrayObject.unbind()},Object.defineProperty(GLSphere.prototype,"vertexBuffer",{get:function(){return this._vertexBuffer},set:function(t){this._vertexBuffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLSphere.prototype,"indexBuffer",{get:function(){return this._indexBuffer},set:function(t){this._indexBuffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLSphere.prototype,"vertexArrayObject",{get:function(){return this._vertexArrayObject},set:function(t){this._vertexArrayObject=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLSphere.prototype,"indexcount",{get:function(){return this._indexcount},set:function(t){this._indexcount=t},enumerable:!0,configurable:!0}),GLSphere);function GLSphere(t,e,n,r){void 0===e&&(e=1),void 0===n&&(n=12),void 0===r&&(r=12),this.gl=t,this.createVertexData(e,n,r)}e.GLSphere=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(GLUniformBufferObject.prototype.addItem=function(t,e,n){this.items[t]={type:e,offset:0,blockSize:0,alignedByteLength:0,data:n}},GLUniformBufferObject.prototype.addBlock=function(t){for(var e=0,n=void 0;n=t[e];e++)this.addItem(n.name,n.type,n.data)},GLUniformBufferObject.prototype.updateItem=function(t,e,n){void 0===n&&(n=!1),this.items[t].data=e,n&&this.updateGL(t)},GLUniformBufferObject.prototype.hasItem=function(t){return!!this.items[t]},GLUniformBufferObject.prototype.removeItem=function(t){delete this.items[t],this.upload()},GLUniformBufferObject.prototype.updateGL=function(t){var e=this.items[t];e.data&&(this.bind(),this.gl.bufferSubData(this.type,e.offset,e.data),this.unbind())},GLUniformBufferObject.prototype.uploadBuffer=function(t,e,n){this._byteLength=t;var r=this.gl;return this.bind(),r.bufferData(this.type,this._byteLength,this.drawType),e&&r.bufferSubData(this.type,0,e,n),this.unbind(),this._byteLength},GLUniformBufferObject.prototype.upload=function(){this._byteLength=this.updateItemAlignment(),this.bind();var t=this.gl;t.bufferData(this.type,this._byteLength,this.drawType);for(var e=0,n=void 0;n=this.items[e];e++)n.data&&t.bufferSubData(this.type,n.offset,n.data);return this.unbind(),this._byteLength},GLUniformBufferObject.prototype.bindUBO=function(t,e,n){void 0===t&&(t=this._bindingPoint),void 0===e&&(e=0),void 0===n&&(n=this._byteLength),0===e&&n===this._byteLength?this.gl.bindBufferBase(this.type,t,this.buffer):this.gl.bindBufferRange(this.type,t,this.buffer,e,n)},GLUniformBufferObject.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},GLUniformBufferObject.prototype.unbind=function(){this.gl.bindBuffer(this.type,null)},GLUniformBufferObject.prototype.destroy=function(){this.gl.isBuffer(this.buffer)&&this.gl.deleteBuffer(this.buffer),this.gl=null,this.buffer=null},GLUniformBufferObject.prototype.updateItemAlignment=function(){for(var t=null,e=0,n=Object.keys(this.items),r=0,o=void 0;o=this.items[n[r]];r++)if(o.data){var i=GLUniformBufferObject.TYPE_TO_SIZE[o.type];if(o.alignment=o.alignedByteLength=i[0],o.blockSize=i[1],o.data.byteLength!==o.blockSize){var a=o.data.byteLength/o.blockSize;o.alignedByteLength=o.alignment*a}t&&(o.offset=t.alignedByteLength+t.offset),e+=(t=o).alignedByteLength}return e},Object.defineProperty(GLUniformBufferObject.prototype,"bindingPoint",{get:function(){return this._bindingPoint},set:function(t){this._bindingPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLUniformBufferObject.prototype,"byteLength",{get:function(){return this._byteLength},set:function(t){this._byteLength=t},enumerable:!0,configurable:!0}),GLUniformBufferObject.TYPE_TO_SIZE={float:[4,4],int:[4,4],bool:[4,4],boolean:[4,4],mat4:[64,64],mat3:[48,48],vec4:[16,16],vec3:[16,12],vec2:[8,8]},GLUniformBufferObject);function GLUniformBufferObject(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.DYNAMIC_DRAW),this.gl=t,this.type=t.UNIFORM_BUFFER,this.buffer=t.createBuffer(),this.items={},this.drawType=n,this._bindingPoint=e,this._byteLength=0}e.GLUniformBufferObject=r},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function __export(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(e(7))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e(8);n.MapSize=r;var o=e(6);n.MapType=o;var i=e(9);n.DefaultValue=i;var a=e(21);n.WebGLUtil=a,function __export(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(e(22))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function create3DContext(t,e){for(var n=null,r=0,o=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];r<o.length;r++){var i=o[r];try{n=t.getContext(i,e)}catch(t){}if(n)break}return n}e.create3DContext=create3DContext,e.setupWebGL=function setupWebGL(t,e,n){var r=n||function handleCreationError(t){var e=document.getElementsByTagName("body")[0];if(e){var n=window.WebGL2RenderingContext?'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>':'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';t&&(n+="<br/><br/>Status: "+t),e.innerHTML=function makeFailHTML(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"}(n)}};t.addEventListener&&t.addEventListener("webglcontextcreationerr",function(t){r(t.statusMessage)},!1);var o=create3DContext(t,e);return o||(window.WebGL2RenderingContext,r("")),o},window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.clearTimeout)},function(t,e,n){"use strict";function glGetStates(t){return{BLEND:t.BLEND,DEPTH_TEST:t.DEPTH_TEST,DITHER:t.DITHER,SCISSOR_TEST:t.SCISSOR_TEST,STENCIL_TEST:t.STENCIL_TEST,TEXTURE_2D:t.TEXTURE_2D,TEXTURE_3D:t.TEXTURE_3D,TEXTURE_CUBE_MAP:t.TEXTURE_CUBE_MAP}}Object.defineProperty(e,"__esModule",{value:!0}),e.glGetCurrentState=function glGetCurrentState(t){var e=glGetStates(t),n="";for(var r in e)t.isEnabled(e[r])?n+=r+" is enabled!\n":n+=r+" is disabled!\n";return n},e.glResetState=function glResetState(t){var e=glGetStates(t);for(var n in e)t.disable(e[n]);t.enable(t.DITHER)}},function(t,n,e){"use strict";function __export(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0});var r=e(10);n.Uniform=r,__export(e(11)),__export(e(24)),__export(e(12))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(12),i=n(11),a=n(10),r=(GLShader.prototype.getDefinesString=function(){var t="";for(var e in this._defines)t+="#define "+e+" "+this._defines[e]+"\n";return t},GLShader.prototype.getShaderSrcWithDefines=function(t){var e=this.getDefinesString(),n=t.indexOf("\n"),r=t.substr(0,n),o=t.substr(n);return-1!=r.indexOf("#version")?r+e+o:e+r+o},GLShader.prototype.upload=function(){var t=this.gl,e=this.getShaderSrcWithDefines(this._vertexSrc),n=this.getShaderSrcWithDefines(this._fragmentSrc);this._program=o.compile(t,e,n),this._attributes=i.extract(t,this._program);var r=a.extract(t,this._program);return this._uniforms=a.generateUniformAccessObject(t,r,this._program),this},GLShader.prototype.addDefine=function(t,e){this._defines[t]=e},GLShader.prototype.removeDefine=function(t){delete this._defines[t]},Object.defineProperty(GLShader.prototype,"program",{get:function(){return this._program},set:function(t){this._program=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLShader.prototype,"attributes",{get:function(){return this._attributes},set:function(t){this._attributes=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLShader.prototype,"uniforms",{get:function(){return this._uniforms},set:function(t){this.uniforms=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLShader.prototype,"defines",{get:function(){return this._defines},set:function(t){this._defines=t},enumerable:!0,configurable:!0}),GLShader.prototype.bind=function(){return this.gl.useProgram(this.program),this},GLShader.prototype.unbind=function(){return this.gl.useProgram(null),this},GLShader.prototype.unload=function(){this.gl.deleteProgram(this.program),this._program=null,this._attributes=null,this._uniforms=null,this._defines=Object.create(null)},GLShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null,this._program=null,this._attributes=null,this._uniforms=null,this._defines=null,this._vertexSrc=null,this._fragmentSrc=null},Object.defineProperty(GLShader.prototype,"vertexSrc",{get:function(){return this._vertexSrc},set:function(t){this._vertexSrc=t},enumerable:!0,configurable:!0}),Object.defineProperty(GLShader.prototype,"fragmentSrc",{get:function(){return this._fragmentSrc},set:function(t){this._fragmentSrc=t},enumerable:!0,configurable:!0}),GLShader);function GLShader(t,e,n){this.gl=t,this._defines=Object.create(null),this._vertexSrc=e,this._fragmentSrc=n}e.GLShader=r},function(t,n,o){"use strict";o.r(n);var i,a,s="brdfLUT",u="diffuseEnvironment",c="specularEnvironment",l="skybox";(a=i=i||{})[a.CAMERA=0]="CAMERA",a[a.SKIN=1]="SKIN";var f=o(1);function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var d=function(){function Canvas(t){this._defaultWidth=t.width,this._defaultHeight=t.height,this._element=document.createElement("canvas"),this._element.id="viewer_canvas",this._element.width=this._defaultWidth,this._element.height=this._defaultHeight}return Canvas.prototype.appendCanvas=function appendCanvas(t){if(!this._element)throw"canvas failed to initialize";t?document.getElementById(t).appendChild(this._element):document.body.appendChild(this._element)},function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(Canvas,[{key:"context",get:function get(){return this._context||(this._context=f.WebGLUtil.setupWebGL(this._element,{antialias:!0,stencil:!0,alpha:!1})),this._context}},{key:"element",get:function get(){return this._element},set:function set(t){this._element=t}},{key:"width",get:function get(){return this._element.width}},{key:"height",get:function get(){return this._element.height}}]),Canvas}(),h=o(2),p=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},m=(EmitSignal.prototype.emit=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=this._emitter).emit.apply(t,p([this._type],e))},EmitSignal.prototype.dispatch=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.emit.apply(this,t)},EmitSignal.prototype.on=function(t,e){return this._emitter.on(this._type,t,e),this},EmitSignal.prototype.add=function(t,e){return this.on(t,e)},EmitSignal.prototype.once=function(t,e){return this._emitter.once(this._type,t,e),this},EmitSignal.prototype.addOnce=function(t,e){return this.once(t,e)},EmitSignal.prototype.removeAllListeners=function(){return this._emitter.removeAllListeners(this._type),this},EmitSignal.prototype.removeListener=function(t,e,n){return this._emitter.removeListener(this._type,t,e,n),this},Object.defineProperty(EmitSignal.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(EmitSignal.prototype,"emitter",{get:function(){return this._emitter},enumerable:!0,configurable:!0}),EmitSignal);function EmitSignal(t,e){this._type=e,this._emitter=t}var _,v,y,g,b=function(){return(b=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},E=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};(v=_=_||{}).PROGRESS="resource_event_progress",v.LOAD_START="resource_event_loadStart",v.LOAD_COMPLETE="resource_event_load",v.ERROR="resource_event_error",v.ABORT="resource_event_abort",v.TIMEOUT="resource_event_timeout",(g=y=y||{}).XHR="xhr",g.IMAGE="image";var M=(Resource.prototype.loadXhr=function(t){for(var n=this,r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];var o=new XMLHttpRequest;return o.timeout=t.timeout,o.responseType=t.responseType||"text",o.open("GET",t.url,void 0===t.async||!!t.async),o.addEventListener("progress",function(t){return n.onProgress.emit(t,o)},{once:!0}),o.addEventListener("loadstart",function(t){var e;return(e=n.onLoadStart).emit.apply(e,E([t,o],r))},{once:!0}),o.addEventListener("load",function(t){return n.onLoadFinished.emit(n)},{once:!0}),o.addEventListener("error",function(t){return n.onError.emit(t,o)},{once:!0}),o.addEventListener("abort",function(t){return n.onAbort.emit(t,o)},{once:!0}),o.addEventListener("timeout",function(t){return n.onTimeout.emit(t,o)},{once:!0}),o.send(),o},Resource.prototype.loadImage=function(t){for(var n=this,r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];var o=new Image(t.width,t.height);return o?(o.addEventListener("progress",function(t){return n.onProgress.emit(t,o)},{once:!0}),o.addEventListener("loadstart",function(t){var e;return(e=n.onLoadStart).emit.apply(e,E([t,o],r))},{once:!0}),o.addEventListener("load",function(t){return n.onLoadFinished.emit(n)},{once:!0}),o.addEventListener("error",function(t){return n.onError.emit(t,o)},{once:!0}),o.addEventListener("abort",function(t){return n.onAbort.emit(t,o)},{once:!0}),o.crossOrigin=this._determineCrossOrigin(t.url),o.src=t.url):(console.error("Failed to create Image Object"),this.onError.emit(event,o)),o},Resource.prototype._determineCrossOrigin=function(t){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";var e=window.location;Resource.tempAnchor||(Resource.tempAnchor=document.createElement("a")),Resource.tempAnchor.href=t;var n=!Resource.tempAnchor.port&&""===e.port||Resource.tempAnchor.port===e.port,r=Resource.tempAnchor.protocol?Resource.tempAnchor.protocol+":":"";return Resource.tempAnchor.host===e.hostname&&n&&r===e.protocol?"":"anonymous"},Resource.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(this.options.loadType){case y.IMAGE:return this.request=this.loadImage.apply(this,E([this.options],t)),this;case y.XHR:return this.request=this.loadXhr.apply(this,E([this.options],t)),this}return this},Resource.prototype.abort=function(){return this.request instanceof XMLHttpRequest?this.request.abort():this.request instanceof HTMLImageElement&&(this.request.src=""),this},Resource);function Resource(t,e){this.config=e||Object.create(null),this.options="string"==typeof t?{url:t,loadType:y.XHR,responseType:""}:b(b({},t),{url:t.url,loadType:t.loadType||y.XHR,responseType:t.responseType||""}),this._emitter=new h,this.onProgress=new m(this._emitter,_.PROGRESS),this.onLoadStart=new m(this._emitter,_.LOAD_START),this.onLoadFinished=new m(this._emitter,_.LOAD_COMPLETE),this.onError=new m(this._emitter,_.ERROR),this.onAbort=new m(this._emitter,_.ABORT),this.onTimeout=new m(this._emitter,_.TIMEOUT)}var A,S=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};(A||(A={})).LOAD_COMPLETE="LOAD_COMPLETE";var w={_emitter:function(){return new h},onLoad:function(){return new m((void 0)._emitter,A.LOAD_COMPLETE)}},x={transform:function(){return C.prototype.transform},add:function(){return C.prototype.add},addResourceToQueue:function(){return C.prototype.addResourceToQueue},_queueCallback:function(){return C.prototype._queueCallback}},C=(Middleware.inject=function(t){for(var e in w)void 0!==t[e]&&null!==t[e]||(t[e]=w[e]());for(var n in x)t.constructor&&t.constructor.prototype?void 0!==t.constructor.prototype[n]&&null!==t.constructor.prototype[n]||(t.constructor.prototype[n]=x[n]()):void 0!==t[n]&&null!==t[n]||(t[n]=x[n]())},Middleware.prototype.add=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this.addResourceToQueue({resources:[{resource:new M(t),args:S(e)}]}),this},Middleware.prototype.addResourceToQueue=function(n){var r=this;return this._loader._addResourceToQueue({resources:n.resources,onResourcesLoaded:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r._queueCallback.apply(r,S([n.key,r.type],t))},onResourcesLoadedContext:this}),this},Middleware.prototype._queueCallback=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=this.transform.apply(this,n);this.onLoad.emit({key:t,type:e,data:o})},Middleware.prototype.transform=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.map(function(t){return t.request})},Middleware);function Middleware(t){this._emitter=new h,this.onLoad=new m(this._emitter,A.LOAD_COMPLETE),this.type=t}function _noop(){}var L,O,P=(AsyncWorkerQueue.prototype.process=function(t){var e=this;this.finishCb=t||_noop;for(var n=function(){var t=r.tasks.shift();r.processes++,t.listener.apply(t.listenerContext,[function(){return e.next(t)}]),t.process.apply(t.processContext,t.args)},r=this;!this.paused&&this.processes<this.concurrency&&this.length;)n()},AsyncWorkerQueue.prototype.enqueue=function(t){if(!t.tasks||0===t.tasks.length)throw"Worker needs to have at least one task";t.count=t.count||0,t.onWorkFinished=t.onWorkFinished||_noop,this.workers.push(t);for(var e=0,n=void 0;n=t.tasks[e];e++)n.worker=t,n.completed=n.completed||!1,this.tasks.push(n)},AsyncWorkerQueue.prototype.dequeue=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=void 0;r=t[n];n++){var o=this.workers.indexOf(r);if(-1!=o){for(var i=0,a=void 0;a=r.tasks[i];i++){var s=this.tasks.indexOf(a);-1!=s&&this.tasks.splice(s,1)}this.workers.splice(o,1)}}},AsyncWorkerQueue.prototype.idle=function(){return this.length+this.processes+this.workers.length===0},AsyncWorkerQueue.prototype.next=function(t){this.processes--,t.completed=!0,this.workerFinished(t.worker),this.onQueueFinished(),this.process(this.finishCb)},AsyncWorkerQueue.prototype.workerFinished=function(t){t.count+=1;var e=this.workers.indexOf(t);if(t.count===t.tasks.length&&-1!=e){var n=t.tasks.map(function(t){return t.resource});t.onWorkFinished.apply(t.onWorkFinishedContext,n),this.workers.splice(e,1)}},AsyncWorkerQueue.prototype.onQueueFinished=function(){this.idle()&&this.finishCb()},AsyncWorkerQueue.prototype.abort=function(){for(var t=0,e=void 0;e=this.workers[t];t++)for(var n=0,r=void 0;r=e.tasks[n];n++)r.resource.abort()},AsyncWorkerQueue.prototype.stop=function(){this.finishCb=_noop,this.abort(),this.workers.length=0,this.tasks.length=0,this.processes=0},AsyncWorkerQueue.prototype.pause=function(){this.paused=!0},AsyncWorkerQueue.prototype.resume=function(){!1!==this.paused&&(this.paused=!1,this.process())},Object.defineProperty(AsyncWorkerQueue.prototype,"length",{get:function(){return this.tasks.length},enumerable:!0,configurable:!0}),Object.defineProperty(AsyncWorkerQueue.prototype,"running",{get:function(){return!!this.processes},enumerable:!0,configurable:!0}),AsyncWorkerQueue);function AsyncWorkerQueue(t){this.concurrency=t,this.paused=!1,this.processes=0,this.workers=[],this.tasks=[]}(O=L=L||{}).PRE="PRE",O.AFTER="AFTER",O.PROGRESS="PROGRESS",O.LOAD_START="LOAD_START",O.LOAD_COMPLETE="LOAD_COMPLETE",O.LOADER_FINISHED="LOADER_FINISHED",O.ERROR="ERROR";var k,I,D=(ResourceLoader.prototype._callAfter=function(t){this.onLoadComplete.emit(t),this._afterSignal.emit(t)},ResourceLoader.prototype.get=function(t){return t&&"string"==typeof t?this.middleware[t]:t&&"string"!=typeof t?this.middleware[t.prototype.constructor.name]:void 0},ResourceLoader.prototype.addMiddleware=function(t,e){return C.inject(t),t._loader=this,e&&"string"==typeof e?this.middleware[e]=t:e&&"string"!=typeof e&&(this.middleware[e.prototype.constructor.name]=t),t.onLoad.on(this._callAfter,this),t},ResourceLoader.prototype.removeMiddleware=function(t){t&&"string"==typeof t?delete this.middleware[t]:t&&"string"!=typeof t&&delete this.middleware[t.prototype.constructor.name]},ResourceLoader.prototype._onResourceLoadStart=function(t){this._preSignal.emit(t.resource),this.onLoadStart.emit(t.resource)},ResourceLoader.prototype._addResourceToQueue=function(t){var e=this;return t.resources.forEach(function(t){t.resource.onProgress.on(function(t){return e.onProgress.emit(t)}),t.resource.onError.on(function(t){return e.onError.emit(t)}),t.resource.onLoadStart.on(function(){return e._onResourceLoadStart(t)})}),this.resourceQueue.enqueue({tasks:t.resources.map(function(t){return{resource:t.resource,process:t.resource.load,processContext:t.resource,listener:t.resource.onLoadFinished.once,listenerContext:t.resource.onLoadFinished,args:t.args}}),onWorkFinished:t.onResourcesLoaded,onWorkFinishedContext:t.onResourcesLoadedContext}),this},ResourceLoader.prototype.pre=function(t){return this._preSignal.on(t),this},ResourceLoader.prototype.after=function(t){return this._afterSignal.on(t),this},ResourceLoader.prototype._onLoadComplete=function(){this._preSignal.removeAllListeners(),this._afterSignal.removeAllListeners(),this.onComplete.emit(this)},ResourceLoader.prototype.load=function(t){var e=this;return t&&"function"==typeof t&&this.onComplete.once(t),this.resourceQueue.process(function(){return e._onLoadComplete()}),this},ResourceLoader.prototype.stop=function(){this.resourceQueue.stop()},ResourceLoader.prototype.pause=function(){this.resourceQueue.pause()},ResourceLoader.prototype.resume=function(){this.resourceQueue.resume()},ResourceLoader);function ResourceLoader(t){void 0===t&&(t=10),this._emitter=new h,this.middleware=Object.create(null),this.resourceQueue=new P(t),this._preSignal=new m(this._emitter,L.PRE),this._afterSignal=new m(this._emitter,L.AFTER),this.onProgress=new m(this._emitter,L.PROGRESS),this.onLoadStart=new m(this._emitter,L.LOAD_START),this.onLoadComplete=new m(this._emitter,L.LOAD_COMPLETE),this.onError=new m(this._emitter,L.ERROR),this.onComplete=new m(this._emitter,L.LOADER_FINISHED)}(I=k=k||{})[I.TEXTURE=0]="TEXTURE",I[I.MESH=1]="MESH",I[I.SCENE=2]="SCENE",I[I.ANIMATION=3]="ANIMATION",I[I.MATERIAL=4]="MATERIAL",I[I.SHADER=5]="SHADER",I[I.NOOP=6]="NOOP";var F=function(){function Cache(){this.caches=[]}var t=Cache.prototype;return t.addCache=function addCache(t,e){this.caches[t]=e},t.removeCache=function removeCache(t){this.caches.splice(t,1)},t.getCache=function getCache(t){return this.caches[t]},t.add=function add(t,e,n){this.caches[t]&&this.caches[t].add(e,n)},t.get=function get(t,e){if(this.caches[t])return this.caches[t].get(e)},t.has=function has(t,e){return!!this.caches[t]&&!!this.caches[t].get(e)},Cache}();function EmitSignal_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var B,N,G=function(){function EmitSignal(t,e){this._type=e,this._emitter=t}var t=EmitSignal.prototype;return t.emit=function emit(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this._emitter).emit.apply(t,[this._type].concat(n))},t.dispatch=function dispatch(){return this.emit.apply(this,arguments)},t.on=function on(t,e){return this._emitter.on(this._type,t,e),this},t.add=function add(t,e){return this.on(t,e)},t.once=function once(t,e){return this._emitter.once(this._type,t,e),this},t.addOnce=function addOnce(t,e){return this.once(t,e)},t.removeAllListeners=function removeAllListeners(){return this._emitter.removeAllListeners(this._type),this},t.removeListener=function removeListener(t,e,n){return this._emitter.removeListener(this._type,t,e,n),this},function EmitSignal_createClass(t,e,n){return e&&EmitSignal_defineProperties(t.prototype,e),n&&EmitSignal_defineProperties(t,n),t}(EmitSignal,[{key:"type",get:function get(){return this._type}},{key:"emitter",get:function get(){return this._emitter}}]),EmitSignal}();function baseCache_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(N=B=B||{}).ADDED="ADDED",N.REMOVED="REMOVED";var U=function(){function BaseCache(){this.cache={},this.emitter=new h,this._onAdded=new G(this.emitter,B.ADDED),this._onRemoved=new G(this.emitter,B.REMOVED)}var t=BaseCache.prototype;return t.add=function add(t,e){this.cache[t]=e,this._onAdded.emit(t,e)},t.addMultiple=function addMultiple(t,e){for(var n,r=0;n=t[r];r++){var o=e(n);this.add(o.key,o.data)}},t.remove=function remove(t){var e=this.cache[t];delete this.cache[t],this._onRemoved.emit(t,e)},t.get=function get(t){return this.cache[t]},t.getAll=function getAll(){return this.cache},function baseCache_createClass(t,e,n){return e&&baseCache_defineProperties(t.prototype,e),n&&baseCache_defineProperties(t,n),t}(BaseCache,[{key:"onAdded",get:function get(){return this._onAdded}},{key:"onRemoved",get:function get(){return this._onRemoved}}]),BaseCache}();var j=function(n){function CubemapLoader(t){var e;return(e=n.call(this,k.TEXTURE)||this).gl=t,e}!function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(CubemapLoader,n);var t=CubemapLoader.prototype;return t.add=function add(t,e,n){for(var r,o=2<arguments.length&&void 0!==n?n:{id:0},i=[],a=0;r=e[a];a++)for(var s,u=Object.keys(r),c=0;s=r[u[c]];c++)i.push({resource:new M({url:s,loadType:y.IMAGE},Object.assign(Object.assign({},o),{face:c,level:a}))});return this.addResourceToQueue({key:t,resources:i})},t.transform=function transform(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.sort(function(t,e){return t.config.face-e.config.face+6*(t.config.level-e.config.level)}).map(function(t){return t.request}),o=e[0].config,i=f.GLCubemap.cubemapFromSource(this.gl,r,o.flipY,o.premultiplyAlpha,o.id,o.internalFormat,o.format,o.type);return o.flipY&&i.flipY(1),o.sampler&&(o.sampler.minFilter===f.MIN_FILTER.LINEAR||o.sampler.minFilter===f.MIN_FILTER.NEAREST||o.sampler.minFilter===f.MIN_FILTER.LINEAR_MIPMAP_LINEAR||o.sampler.minFilter===f.MIN_FILTER.LINEAR_MIPMAP_NEAREST||o.sampler.minFilter===f.MIN_FILTER.NEAREST_MIPMAP_LINEAR||o.sampler.minFilter===f.MIN_FILTER.NEAREST_MIPMAP_NEAREST?i.setMinFilter(o.sampler.minFilter):f.GLTexture.isPowerOf2(i.width)&&f.GLTexture.isPowerOf2(i.height)?i.setMinFilter(f.MIN_FILTER.LINEAR_MIPMAP_LINEAR):i.setMinFilter(f.MIN_FILTER.LINEAR),o.sampler.magFilter===f.MAG_FILTER.LINEAR||o.sampler.magFilter===f.MAG_FILTER.NEAREST?i.setMagFilter(o.sampler.magFilter):i.setMagFilter(f.MAG_FILTER.LINEAR),o.sampler.wrapS===f.TEXTURE_WRAP.CLAMP_TO_EDGE||o.sampler.wrapS===f.TEXTURE_WRAP.MIRRORED_REPEAT||o.sampler.wrapS===f.TEXTURE_WRAP.REPEAT?i.setWrapS(o.sampler.wrapS):i.setWrapS(f.TEXTURE_WRAP.REPEAT),o.sampler.wrapT===f.TEXTURE_WRAP.CLAMP_TO_EDGE||o.sampler.wrapT===f.TEXTURE_WRAP.MIRRORED_REPEAT||o.sampler.wrapT===f.TEXTURE_WRAP.REPEAT?i.setWrapT(o.sampler.wrapT):i.setWrapT(f.TEXTURE_WRAP.REPEAT)),i},CubemapLoader}(C);var W,V,X,q,H,z,Y=function(n){function TextureLoader(t){var e;return(e=n.call(this,k.TEXTURE)||this).gl=t,e}!function TextureLoader_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(TextureLoader,n);var t=TextureLoader.prototype;return t.add=function add(t,e,n){var r=2<arguments.length&&void 0!==n?n:{id:0,sampler:{wrapS:f.TEXTURE_WRAP.REPEAT,wrapT:f.TEXTURE_WRAP.REPEAT}};return this.addResourceToQueue({key:t,resources:[{resource:new M({url:e,loadType:y.IMAGE},r)}]})},t.transform=function transform(t){var e=t.config,n=t.request,r=f.GLTexture.fromSource(this.gl,n,e.premultiplyAlpha,e.id,e.internalFormat,e.format,e.type);return e.flipY&&r.flipY(1),e.sampler&&(e.sampler.minFilter===f.MIN_FILTER.LINEAR||e.sampler.minFilter===f.MIN_FILTER.NEAREST||e.sampler.minFilter===f.MIN_FILTER.LINEAR_MIPMAP_LINEAR||e.sampler.minFilter===f.MIN_FILTER.LINEAR_MIPMAP_NEAREST||e.sampler.minFilter===f.MIN_FILTER.NEAREST_MIPMAP_LINEAR||e.sampler.minFilter===f.MIN_FILTER.NEAREST_MIPMAP_NEAREST?r.setMinFilter(e.sampler.minFilter):f.GLTexture.isPowerOf2(r.width)&&f.GLTexture.isPowerOf2(r.height)?r.setMinFilter(f.MIN_FILTER.LINEAR_MIPMAP_LINEAR):r.setMinFilter(f.MIN_FILTER.LINEAR),e.sampler.magFilter===f.MAG_FILTER.LINEAR||e.sampler.magFilter===f.MAG_FILTER.NEAREST?r.setMagFilter(e.sampler.magFilter):r.setMagFilter(f.MAG_FILTER.LINEAR),e.sampler.wrapS===f.TEXTURE_WRAP.CLAMP_TO_EDGE||e.sampler.wrapS===f.TEXTURE_WRAP.MIRRORED_REPEAT||e.sampler.wrapS===f.TEXTURE_WRAP.REPEAT?r.setWrapS(e.sampler.wrapS):r.setWrapS(f.TEXTURE_WRAP.REPEAT),e.sampler.wrapT===f.TEXTURE_WRAP.CLAMP_TO_EDGE||e.sampler.wrapT===f.TEXTURE_WRAP.MIRRORED_REPEAT||e.sampler.wrapT===f.TEXTURE_WRAP.REPEAT?r.setWrapT(e.sampler.wrapT):r.setWrapT(f.TEXTURE_WRAP.REPEAT)),r},TextureLoader}(C);function material_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(V=W=W||{})[V.PBR=0]="PBR",(q=X=X||{})[q.ALBEDO=0]="ALBEDO",q[q.NORMAL=1]="NORMAL",q[q.OCCLUSION=2]="OCCLUSION",q[q.EMISSIVE=3]="EMISSIVE",q[q.METAL_ROUGHNESS=4]="METAL_ROUGHNESS",(z=H=H||{}).OPAQUE="OPAQUE",z.MASK="MASK",z.BLEND="BLEND";var Q=function(){function Material(t,e){this._type=W.PBR,this.name=t,this._maps=[],this._model=e,this._alphaMode=H.OPAQUE,this._alphaCutoff=.5,this._doubleSided=!1}return Material.prototype.hasMap=function hasMap(t){return!!this._maps[t]},function material_createClass(t,e,n){return e&&material_defineProperties(t.prototype,e),n&&material_defineProperties(t,n),t}(Material,[{key:"name",get:function get(){return this._name},set:function set(t){this._name=t}},{key:"maps",get:function get(){return this._maps},set:function set(t){this._maps=t}},{key:"model",get:function get(){return this._model},set:function set(t){this._model=t}},{key:"type",get:function get(){return this._type},set:function set(t){this._type=t}},{key:"alphaMode",get:function get(){return this._alphaMode},set:function set(t){this._alphaMode=t}},{key:"alphaCutoff",get:function get(){return this._alphaCutoff},set:function set(t){this._alphaCutoff=t}},{key:"doubleSided",get:function get(){return this._doubleSided},set:function set(t){this._doubleSided=t}}]),Material}();function materialmap_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var K=function(){function Materialmap(t,e){this._texture=t,this._sampler=e}return function materialmap_createClass(t,e,n){return e&&materialmap_defineProperties(t.prototype,e),n&&materialmap_defineProperties(t,n),t}(Materialmap,[{key:"texture",get:function get(){return this._texture},set:function set(t){this._texture=t}},{key:"sampler",get:function get(){return this._sampler},set:function set(t){this._sampler=t}}]),Materialmap}(),$=o(0);function metallicRoughness_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Z=function(){function MetallicRoughness(){this._baseColorFactor=$.vec4.fromValues(1,1,1,1),this._metallicFactor=1,this._roughnessFactor=1,this._normalScale=1,this._occlusionStrength=1,this._emissiveFactor=$.vec3.create()}return function metallicRoughness_createClass(t,e,n){return e&&metallicRoughness_defineProperties(t.prototype,e),n&&metallicRoughness_defineProperties(t,n),t}(MetallicRoughness,[{key:"baseColorFactor",get:function get(){return this._baseColorFactor},set:function set(t){this._baseColorFactor=t}},{key:"metallicFactor",get:function get(){return this._metallicFactor},set:function set(t){this._metallicFactor=t}},{key:"roughnessFactor",get:function get(){return this._roughnessFactor},set:function set(t){this._roughnessFactor=t}},{key:"emissiveFactor",get:function get(){return this._emissiveFactor},set:function set(t){this._emissiveFactor=t}},{key:"normalScale",get:function get(){return this._normalScale},set:function set(t){this._normalScale=t}},{key:"occlusionStrength",get:function get(){return this._occlusionStrength},set:function set(t){this._occlusionStrength=t}}]),MetallicRoughness}(),J=function(){function GLTFMaterialProcessor(t){this.model=t,this.materialCache=this.model.cache.getCache(k.MATERIAL)}var t=GLTFMaterialProcessor.prototype;return t.processMaterial=function processMaterial(t){var e,n=this.model.gltf,r=this.model.gl,o=n.materials[t],i=this.materialCache.get(o.name);if(i)return i;if(o.name=o.name||"material"+t,o.extensions&&o.extensions.KHR_materials_pbrSpecularGlossiness)throw"specular glossiness gltf is not supported";return e=new Q(o.name),this.parsePBRMaterial(o,e),o.emissiveFactor&&e.model.emissiveFactor.set(o.emissiveFactor),e.alphaMode=o.alphaMode||H.OPAQUE,e.alphaCutoff=o.alphaCutoff||.5,e.doubleSided=!!o.doubleSided,o.emissiveTexture&&this.parseTexture(e,o.emissiveTexture.index,X.EMISSIVE,{premultiplyAlpha:!1,internalFormat:r.SRGB8_ALPHA8,format:r.RGBA,type:r.UNSIGNED_BYTE}),o.normalTexture&&(e.model.normalScale=o.normalTexture.scale||1,this.parseTexture(e,o.normalTexture.index,X.NORMAL,{premultiplyAlpha:!1,internalFormat:r.RGBA,format:r.RGBA,type:r.UNSIGNED_BYTE})),o.occlusionTexture&&(e.model.occlusionStrength=o.occlusionTexture.strength||1,this.parseTexture(e,o.occlusionTexture.index,X.OCCLUSION,{premultiplyAlpha:!1,internalFormat:r.RGBA,format:r.RGBA,type:r.UNSIGNED_BYTE})),this.materialCache.add(e.name,e),e},t.parsePBRMaterial=function parsePBRMaterial(t,e){var n=t.pbrMetallicRoughness;e.type=W.PBR;var r=this.model.gl;e.model||(e.model=new Z),n.baseColorFactor&&e.model.baseColorFactor.set(n.baseColorFactor),null!==n.metallicFactor&&void 0!==n.metallicFactor&&(e.model.metallicFactor=n.metallicFactor),null!==n.roughnessFactor&&void 0!==n.roughnessFactor&&(e.model.roughnessFactor=n.roughnessFactor),void 0!==n.baseColorTexture&&null!==n.baseColorTexture&&this.parseTexture(e,n.baseColorTexture.index,X.ALBEDO,{premultiplyAlpha:!1,internalFormat:r.SRGB8_ALPHA8,format:r.RGBA,type:r.UNSIGNED_BYTE}),void 0!==n.metallicRoughnessTexture&&null!==n.metallicRoughnessTexture&&this.parseTexture(e,n.metallicRoughnessTexture.index,X.METAL_ROUGHNESS,{premultiplyAlpha:!1,internalFormat:r.RGBA,format:r.RGBA,type:r.UNSIGNED_BYTE})},t.parseTexture=function parseTexture(t,e,n,r){if(null!=e){var o,i=this.model.gltf,a=this.model.loader,s=this.model.path;void 0!==i.textures[e].source&&null!==i.textures[e].source&&(o=i.images[i.textures[e].source]),void 0!==i.textures[e].sampler&&null!==i.textures[e].sampler?r.sampler=i.samplers[i.textures[e].sampler]:r.sampler={wrapS:f.TEXTURE_WRAP.REPEAT,wrapT:f.TEXTURE_WRAP.REPEAT},a.get(Y).add(o.name||o.uri,s+o.uri,r),t.maps[n]=new K(o.name||o.uri),t.maps[n].sampler=r.sampler}},GLTFMaterialProcessor}();function mesh_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var tt=function(){function Mesh(){this._primitives=[],this._bufferViews=Object.create(null)}var t=Mesh.prototype;return t.init=function init(t,e,n){return this.initBuffers(t,e,n),this.setIndexBuffers(t),this},t.initBuffers=function initBuffers(t,e,n){for(var r,o=Object.keys(this._bufferViews),i=0;r=this._bufferViews[o[i]];i++)if(null===r.buffer||void 0===r.buffer){var a=void 0;a=r.target===f.GL_BUFFERS.ARRAY_BUFFER?e||f.GLBuffer.create(t,r.target,null,r.drawType):n||f.GLBuffer.create(t,r.target,null,r.drawType),r.bufferOffset=a.byteLength,a.addData(r.data),r.buffer=a}},t.setIndexBuffers=function setIndexBuffers(t){for(var e,n=0;e=this._primitives[n];n++)if(e.indices&&void 0!==e.indices.bufferView&&null!==e.indices.bufferView){var r=this._bufferViews[e.indices.bufferView];e.initVertexArrayObject(t,r.buffer)}},t.upload=function upload(){for(var t,e=Object.keys(this._bufferViews),n=0;t=this._bufferViews[e[n]];n++){if(!t.buffer)throw"Failed to upload buffer for bufferView, did you forget to initialize the buffer first?";t.buffer.upload()}return this},t.draw=function draw(t,e){t.applyMesh(this);for(var n,r=0;n=this._primitives[r];r++){var o=this._bufferViews[n.indices.bufferView].bufferOffset+n.indices.byteOffset;t.applyMaterial(e.get(k.MATERIAL,n.material)),n.draw(n.draw_mode,n.indices.count,n.indices.componentType,o)}},t.addAttribute=function addAttribute(t,e){for(var n,r=0;n=this._primitives[r];r++){var o=n.attributes[t];if(null!=o){var i=this._bufferViews[o.bufferView],a=i.buffer,s=i.bufferOffset+o.byteOffset;n.vertexArrayObject.addAttribute(a,e,o.componentTypeCount,o.componentType,o.normalized,o.stride,s)}}},t.hasAttribute=function hasAttribute(t){for(var e,n=0;e=this._primitives[n];n++)if(e.hasAttribute(t))return!0;return!1},t.hasMap=function hasMap(t,e){for(var n,r=0;n=this._primitives[r];r++){var o=t.get(k.MATERIAL,n.material);if(o)return o.hasMap(e)}},t.unload=function unload(){},t.addPrimitive=function addPrimitive(t){return this._primitives.push(t),t},t.addBufferView=function addBufferView(t,e){this._bufferViews[t]=e},function mesh_createClass(t,e,n){return e&&mesh_defineProperties(t.prototype,e),n&&mesh_defineProperties(t,n),t}(Mesh,[{key:"primitives",get:function get(){return this._primitives},set:function set(t){this._primitives=t}},{key:"name",get:function get(){return this._name},set:function set(t){this._name=t}}]),Mesh}();function scene_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var et=function(){function Scene(){this._nodes=[],this._meshes=[],this._animations=[]}var t=Scene.prototype;return t.init=function init(t,e,n){for(var r,o=0;r=this._nodes[o];o++)r.init(t,e,n);return this},t.upload=function upload(){for(var t,e=0;t=this._nodes[e];e++)t.upload();return this},t.draw=function draw(t,e){for(var n,r=0;n=this._nodes[r];r++)t.applyScene(this),n.draw(t,e)},t.addAttribute=function addAttribute(t,e){for(var n,r=0;n=this._nodes[r];r++)n.addAttribute(t,e)},t.addNode=function addNode(){for(var t,e=0;t=e<0||arguments.length<=e?void 0:arguments[e];e++)this._nodes.push(t)},function scene_createClass(t,e,n){return e&&scene_defineProperties(t.prototype,e),n&&scene_defineProperties(t,n),t}(Scene,[{key:"name",get:function get(){return this._name},set:function set(t){this._name=t}},{key:"meshes",get:function get(){return this._meshes},set:function set(t){this._meshes=t}},{key:"animations",get:function get(){return this._animations},set:function set(t){this._animations=t}},{key:"root",get:function get(){return this._nodes[0]}}]),Scene}(),nt=function(){function SceneNode(){this.children=[]}var t=SceneNode.prototype;return t.init=function init(t,e,n){this.mesh&&this.mesh.init(t,e,n),this.skin&&this.skin.init(t);for(var r,o=0;r=this.children[o];o++)r.init(t,e,n);return this},t.upload=function upload(){this.mesh&&this.mesh.upload();for(var t,e=0;t=this.children[e];e++)t.upload();return this},t.draw=function draw(t,e){this.mesh&&(t.applyNode(this),this.mesh.draw(t,e));for(var n,r=0;n=this.children[r];r++)n.draw(t,e)},t.addAttribute=function addAttribute(t,e){this.mesh&&this.mesh.addAttribute(t,e);for(var n,r=0;n=this.children[r];r++)n.addAttribute(t,e)},t.addChild=function addChild(t){this.children.push(t)},SceneNode}();var rt=function(r){function Shader(t,e,n){return r.call(this,t,e,n)||this}!function shader_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(Shader,r);var t=Shader.prototype;return t.apply=function apply(){},t.applyMaterial=function applyMaterial(){},t.applyMesh=function applyMesh(){},t.applyNode=function applyNode(){},t.applyScene=function applyScene(){},Shader}(f.GLShader);function transform_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ot=function(){function Transform(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}};this.init(t)}var t=Transform.prototype;return t.init=function init(t){var e=0<arguments.length&&void 0!==t?t:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}};this._localMatrix=$.mat4.create(),(e=e||Object.create(null)).position||(e.position={x:0,y:0,z:0}),e.rotation||(e.rotation={x:0,y:0,z:0,w:1}),e.scale||(e.scale={x:1,y:1,z:1}),this._rotation=$.quat.fromValues(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),this._translation=$.vec3.fromValues(e.position.x,e.position.y,e.position.z),this._scale=$.vec3.fromValues(e.scale.x,e.scale.y,e.scale.z),this._children=[],this._level=0,this._dirty=!0,this._worldMatrix=$.mat4.create(),this.apply()},t.addChild=function addChild(t){t._parent&&t._parent.removeChild(t),t._parent=this,t._level=this._level+1,this._children.push(t)},t.removeChild=function removeChild(t){var e=this._children.indexOf(t);-1<e&&(t._level=0,t._parent=void 0,this._children.splice(e,1))},t.apply=function apply(){return this._dirty&&($.mat4.fromRotationTranslationScale(this._localMatrix,this._rotation,this._translation,this._scale),this._dirty=!1),this._localMatrix},function transform_createClass(t,e,n){return e&&transform_defineProperties(t.prototype,e),n&&transform_defineProperties(t,n),t}(Transform,[{key:"worldMatrix",get:function get(){return this._parent?$.mat4.multiply(this._worldMatrix,this._parent.worldMatrix,this.localMatrix):this.apply()}},{key:"modelMatrix",get:function get(){return this.worldMatrix}},{key:"localMatrix",get:function get(){return this.apply()},set:function set(t){$.mat4.getRotation(this._rotation,t),$.mat4.getTranslation(this._translation,t),$.mat4.getScaling(this._scale,t),this._dirty=!0}},{key:"translation",get:function get(){return this._dirty=!0,this._translation},set:function set(t){this._dirty=!0,this._translation=t}},{key:"rotation",get:function get(){return this._dirty=!0,this._rotation},set:function set(t){this._dirty=!0,this._rotation=t}},{key:"scale",get:function get(){return this._dirty=!0,this._scale},set:function set(t){this._dirty=!0,this._scale=t}},{key:"level",get:function get(){return this._level}},{key:"parent",get:function get(){return this._parent},set:function set(t){this._parent=t}},{key:"children",get:function get(){return this._children},set:function set(t){this._children=t}},{key:"dirty",get:function get(){return this._dirty}}]),Transform}();function animation_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function kW(){}var it,at,st=function(){function Animation(){this.samplers=[],this.channels=[],this._duration=0}var t=Animation.prototype;return t.addSampler=function addSampler(t){this.samplers.push(t)},t.addChannel=function addChannel(t){this.channels.push(t)},t.animate=function animate(t){for(var e,n=.001*t,r=0;e=this.samplers[r];r++)e.update(n);for(var o,i=0;o=this.channels[i];i++){var a=this.samplers[o.sampler],s=o.node;switch(o.path){case"rotation":$.quat.copy(s.transform.rotation,a.value);break;case"translation":$.vec3.copy(s.transform.translation,a.value);break;case"scale":$.vec3.copy(s.transform.scale,a.value)}}},function animation_createClass(t,e,n){return e&&animation_defineProperties(t.prototype,e),n&&animation_defineProperties(t,n),t}(Animation,[{key:"duration",get:function get(){return this._duration},set:function set(t){this._duration=t}},{key:"durationMS",get:function get(){return 1e3*this._duration},set:function set(t){this._duration=.001*t}}]),Animation}();function animationSampler_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(at=it=it||{}).LINEAR="LINEAR",at.STEP="STEP",at.CUBICSPLINE="CUBICSPLINE";var ut,ct,lt,ft=function(){function AnimationSampler(){this._interpolation=it.LINEAR,this.prevValue=$.vec4.create(),this.nextValue=$.vec4.create(),this._value=$.vec4.create(),this._duration=0}var t=AnimationSampler.prototype;return t.updateValue=function updateValue(t,e){var n=this._componentTypeCount,r=t*n,o=r+n+2<=this._outputData.length?r+n:r,i=4===n?$.quat.slerp:$.vec4.lerp;$.vec4.set(this.prevValue,this._outputData[r],this._outputData[1+r],this._outputData[2+r],3===n?0:this._outputData[3+r]),$.vec4.set(this.nextValue,this._outputData[o],this._outputData[o+1],this._outputData[o+2],3===n?0:this._outputData[o+3]),i(this._value,this.prevValue,this.nextValue,e)},t.update=function update(t){for(var e=0;e<this._inputData.length-2&&t>=this._inputData[e+1];)e++;var n=this._inputData[e],r=this._inputData[e+1],o=Math.min(Math.max(0,(t-n)/(r-n)),1);this.updateValue(e,o)},function animationSampler_createClass(t,e,n){return e&&animationSampler_defineProperties(t.prototype,e),n&&animationSampler_defineProperties(t,n),t}(AnimationSampler,[{key:"value",get:function get(){return this._value}},{key:"duration",get:function get(){return this._duration},set:function set(t){this._duration=t}},{key:"interpolation",get:function get(){return this._interpolation},set:function set(t){this._interpolation=t}},{key:"inputData",get:function get(){return this._inputData},set:function set(t){this._inputData=t}},{key:"outputData",get:function get(){return this._outputData},set:function set(t){this._outputData=t}},{key:"componentTypeCount",get:function get(){return this._componentTypeCount},set:function set(t){this._componentTypeCount=t}}]),AnimationSampler}();function accessor_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}(lt=ct=ct||{}).SCALAR="SCALAR",lt.VEC2="VEC2",lt.VEC3="VEC3",lt.VEC4="VEC4",lt.MAT2="MAT2",lt.MAT3="MAT3",lt.MAT4="MAT4";function rW(){this.bufferOffset=0,this.drawType=f.GL_BUFFERS.STATIC_DRAW}var dt=(_defineProperty(ut={},ct.SCALAR,1),_defineProperty(ut,ct.VEC2,2),_defineProperty(ut,ct.VEC3,3),_defineProperty(ut,ct.VEC4,4),_defineProperty(ut,ct.MAT2,4),_defineProperty(ut,ct.MAT3,9),_defineProperty(ut,ct.MAT4,16),ut),ht=function(){function Accessor(){this._byteOffset=0,this._componentType=f.GL_TYPES.FLOAT,this._stride=0,this._normalized=!1,this._max=[],this._min=[]}return function accessor_createClass(t,e,n){return e&&accessor_defineProperties(t.prototype,e),n&&accessor_defineProperties(t,n),t}(Accessor,[{key:"bufferView",get:function get(){return this._bufferView},set:function set(t){this._bufferView=t}},{key:"byteOffset",get:function get(){return this._byteOffset},set:function set(t){this._byteOffset=t}},{key:"componentType",get:function get(){return this._componentType},set:function set(t){this._componentType=t}},{key:"stride",get:function get(){return this._stride},set:function set(t){this._stride=t}},{key:"normalized",get:function get(){return this._normalized},set:function set(t){this._normalized=t}},{key:"componentTypeCount",get:function get(){return dt[this._type]}},{key:"count",get:function get(){return this._count},set:function set(t){this._count=t}},{key:"max",get:function get(){return this._max},set:function set(t){this._max=t}},{key:"min",get:function get(){return this._min},set:function set(t){this._min=t}},{key:"type",get:function get(){return this._type},set:function set(t){this._type=t}}]),Accessor}();function primitive_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var pt=function(){function Primitive(){this._attributes=Object.create(null),this._draw_mode=4,this._material="__default__"}var t=Primitive.prototype;return t.hasAttribute=function hasAttribute(t){return!!this._attributes[t]},t.addAttribute=function addAttribute(t,e,n,r,o,i,a,s,u){var c=3<arguments.length&&void 0!==r&&r,l=4<arguments.length&&void 0!==o?o:0,f=5<arguments.length&&void 0!==i?i:0,d=6<arguments.length?a:void 0,h=7<arguments.length&&void 0!==s?s:[],p=8<arguments.length&&void 0!==u?u:[],m=new ht;return m.bufferView=d,m.type=e,m.componentType=n,m.normalized=c,m.stride=l,m.byteOffset=f,m.min=h,m.max=p,this._attributes[t]=m,this._attributes[t]},t.setIndices=function setIndices(t,e,n,r){var o=2<arguments.length&&void 0!==n?n:0,i=3<arguments.length?r:void 0;return this._indices=new ht,this._indices.bufferView=i,this._indices.count=t,this._indices.componentType=e,this._indices.byteOffset=o,this._indices},t.initVertexArrayObject=function initVertexArrayObject(t,e,n){this._vertexArrayObject=n||new f.GLVertexArrayObject(t),this._vertexArrayObject.setIndexBuffer(e)},t.draw=function draw(t,e,n,r){var o=0<arguments.length&&void 0!==t?t:this._draw_mode,i=1<arguments.length&&void 0!==e?e:this._indices.count,a=2<arguments.length&&void 0!==n?n:this._indices.componentType,s=3<arguments.length&&void 0!==r?r:this._indices.byteOffset;this._vertexArrayObject&&(this._vertexArrayObject.bind(),this._vertexArrayObject.draw(o,i,a,s),this._vertexArrayObject.unbind())},function primitive_createClass(t,e,n){return e&&primitive_defineProperties(t.prototype,e),n&&primitive_defineProperties(t,n),t}(Primitive,[{key:"name",get:function get(){return this._name},set:function set(t){this._name=t}},{key:"draw_mode",get:function get(){return this._draw_mode},set:function set(t){this._draw_mode=t}},{key:"attributes",get:function get(){return this._attributes},set:function set(t){this._attributes=t}},{key:"indices",get:function get(){return this._indices},set:function set(t){this._indices=t}},{key:"material",get:function get(){return this._material},set:function set(t){this._material=t}},{key:"vertexArrayObject",get:function get(){return this._vertexArrayObject},set:function set(t){this._vertexArrayObject=t}}]),Primitive}();function skin_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var mt=function(){function Skin(){this._joints=[],this._inverseBindMatrices=[],this._jointMatrices=[],this._data=new Float32Array(1040),this._dirty=!0}var t=Skin.prototype;return t.init=function init(t){for(var e=0;e<this._joints.length;e++)this._jointMatrices.push($.mat4.create());this._ubo=new f.GLUniformBufferObject(t,i.SKIN),this._ubo.addItem("matrix","mat4",this._data),this._ubo.upload(),this._ubo.bindUBO()},t.update=function update(){if(this._dirty){for(var t,e=0;t=this._jointMatrices[e];e++)this._data.set(t,16*e);this._ubo.updateItem("matrix",this._data,!0),this._dirty=!1}},function skin_createClass(t,e,n){return e&&skin_defineProperties(t.prototype,e),n&&skin_defineProperties(t,n),t}(Skin,[{key:"joints",get:function get(){return this._joints},set:function set(t){this._joints=t}},{key:"skeleton",get:function get(){return this._skeleton},set:function set(t){this._skeleton=t}},{key:"inverseBindMatrices",get:function get(){return this._inverseBindMatrices},set:function set(t){this._inverseBindMatrices=t}},{key:"jointMatrices",get:function get(){return this._dirty=!0,this._jointMatrices},set:function set(t){this._dirty=!0,this._jointMatrices=t}},{key:"ubo",get:function get(){return this._ubo},set:function set(t){this._ubo=t}}]),Skin}();function GLTFMeshProcessor_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var _t=function(){function GLTFMeshProcessor(t){this.model=t,this._meshes=[],this.cache=this.model.cache.getCache(k.MESH)}var t=GLTFMeshProcessor.prototype;return t.processMesh=function processMesh(t){if(this._meshes[t])return this._meshes[t];var e=new tt,n=this.model.gltf.meshes[t];e.name=n.name||"mesh"+t;for(var r,o=0;r=n.primitives[o];o++)e.addPrimitive(this.parsePrimitives(e,r));return this._meshes[t]=e,this.cache.add(e.name,e),e},t.parsePrimitives=function parsePrimitives(t,e){var n=this.model.gltf,r=new pt;for(var o in e.attributes){var i=n.accessors[e.attributes[o]];this.addAttribute(r,o,i),t.addBufferView(i.bufferView,this.model.getBufferView(i.bufferView))}if(void 0!==e.indices&&null!==e.indices){var a=n.accessors[e.indices];this.setIndices(r,a),t.addBufferView(a.bufferView,this.model.getBufferView(a.bufferView,!0))}return r.draw_mode=e.mode||4,this.setMeshMaterial(r,e.material),r},t.addAttribute=function addAttribute(t,e,n){var r=this.model.gltf.bufferViews[n.bufferView];t.addAttribute(e,n.type,n.componentType,n.normalized,r.byteStride||0,n.byteOffset,n.bufferView,n.min,n.max)},t.setMeshMaterial=function setMeshMaterial(t,e){t.material=null!=e?this.model.getMaterial(e).name:"__default__"},t.setIndices=function setIndices(t,e){t.setIndices(e.count,e.componentType,e.byteOffset||0,e.bufferView)},function GLTFMeshProcessor_createClass(t,e,n){return e&&GLTFMeshProcessor_defineProperties(t.prototype,e),n&&GLTFMeshProcessor_defineProperties(t,n),t}(GLTFMeshProcessor,[{key:"meshes",get:function get(){return this._meshes},set:function set(t){this._meshes=t}}]),GLTFMeshProcessor}(),vt=function(){function GLTFNodeProcessor(t){this.model=t,this.nodes=[]}var t=GLTFNodeProcessor.prototype;return t.processNode=function processNode(t){return this.nodes[t]?this.nodes[t]:this.parseNode(t,this.nodes)},t.parseNode=function parseNode(t,e,n){var r=this.model.gltf.nodes[t];if(e[t])return e[t];var o=new nt;o.name=r.name||"node"+t,(e[t]=o).transform=this.parseTransform(r,n),null!==r.mesh&&void 0!==r.mesh&&(o.mesh=this.model.getMesh(r.mesh)),null!==r.skin&&void 0!==r.skin&&(o.skin=this.model.getSkin(r.skin)),r.children=r.children||[];for(var i,a=0;i=r.children[a];a++){var s=this.parseNode(i,e,o);o.addChild(s)}return o},t.parseTransform=function parseTransform(t,e){var n=new ot;return void 0!==t.matrix&&null!==t.matrix&&(n.localMatrix=$.mat4.clone(t.matrix),$.mat4.getTranslation(n.translation,n.localMatrix),$.mat4.getRotation(n.rotation,n.localMatrix),$.mat4.getScaling(n.scale,n.localMatrix)),void 0!==t.translation&&null!==t.translation&&(n.translation=$.vec3.clone(t.translation)),void 0!==t.rotation&&null!==t.rotation&&(n.rotation=$.quat.clone(t.rotation)),void 0!==t.scale&&null!==t.scale&&(n.scale=$.vec3.clone(t.scale)),e&&e.transform.addChild(n),n},GLTFNodeProcessor}(),yt=function(){function GLTFAccessorProcessor(t){this.buffers=[],this.model=t}var t=GLTFAccessorProcessor.prototype;return t.getBufferView=function getBufferView(t,e){var n=1<arguments.length&&void 0!==e&&e,r=this.model.gltf;this.buffers[t]||(this.buffers[t]=this.createBufferView(r.bufferViews[t]));var o=this.buffers[t];return o.target=n?o.target||f.GL_BUFFERS.ELEMENT_ARRAY_BUFFER:o.target||f.GL_BUFFERS.ARRAY_BUFFER,o},t.getAccessorData=function getAccessorData(t){return this.accessor2TypedArray(this.getBufferView(t.bufferView).data,t.byteOffset,dt[t.type]*t.count,t.componentType)},t.createBufferView=function createBufferView(t){var e=new rW;return e.data=this.sliceBuffer(t),e.target=t.target,e},t.sliceBuffer=function sliceBuffer(t){var e=this.model.data[t.buffer],n=t.byteOffset||0;return e instanceof ArrayBuffer?e.slice(n,n+t.byteLength):e.buffer.slice(n,n+t.byteLength)},t.accessor2TypedArray=function accessor2TypedArray(t,e,n,r){switch(r){case f.GL_TYPES.BYTE:return new Int8Array(t,e,n);case f.GL_TYPES.UNSIGNED_BYTE:return new Uint8Array(t,e,n);case f.GL_TYPES.SHORT:case f.GL_TYPES.UNSIGNED_SHORT:return new Int16Array(t,e,n);case f.GL_TYPES.INT:case f.GL_TYPES.UNSIGNED_INT:return new Int32Array(t,e,n);case f.GL_TYPES.FLOAT:return new Float32Array(t,e,n)}},GLTFAccessorProcessor}(),gt=function(){function GLTFSkinProcessor(t){this.model=t,this.skins=[]}return GLTFSkinProcessor.prototype.processSkin=function processSkin(t){if(this.skins[t])return this.skins[t];var e=new mt,n=this.model.gltf,r=n.skins[t],o=n.accessors[r.inverseBindMatrices];void 0!==r.skeleton&&null!==r.skeleton&&(e.skeleton=this.model.getNode(r.skeleton));for(var i=0;i<r.joints.length;i++)e.joints.push(this.model.getNode(r.joints[i]));if(o)for(var a=this.model.getAccessorData(o),s=0;s<a.length;s+=16)e.inverseBindMatrices.push($.mat4.fromValues(a[s],a[s+1],a[s+2],a[s+3],a[s+4],a[s+5],a[s+6],a[s+7],a[s+8],a[s+9],a[s+10],a[s+11],a[s+12],a[s+13],a[s+14],a[s+15]));return this.skins[t]=e},GLTFSkinProcessor}();function GLTFAnimationProcessor_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var bt=function(){function GLTFAnimationProcessor(t){this.model=t,this.cache=this.model.cache.getCache(k.ANIMATION)}var t=GLTFAnimationProcessor.prototype;return t.processAnimations=function processAnimations(){this._animations=[];var t=this.model.gltf;t.animations=t.animations||[];for(var e=0;e<t.animations.length;e++)this._animations.push(this.processAnimation(e));return this._animations},t.processAnimation=function processAnimation(t){var e=new st,n=this.model.gltf.animations[t];e.name=n.name||"animation"+t;for(var r,o=0;r=n.samplers[o];o++){var i=this.processSampler(r);e.addSampler(i),e.duration=e.duration<i.duration?i.duration:e.duration}for(var a,s=0;a=n.channels[s];s++)e.addChannel(this.processChannel(a));return this.cache.add(e.name,e),e},t.processSampler=function processSampler(t){var e=this.model.gltf,n=new ft;n.interpolation=t.interpolation||it.LINEAR;var r=this.createAccessor(e.accessors[t.input]),o=this.createAccessor(e.accessors[t.output]);return n.inputData=this.model.getAccessorData(r),n.outputData=this.model.getAccessorData(o),n.componentTypeCount=o.componentTypeCount,n.duration=n.inputData[n.inputData.length-1],n},t.processChannel=function processChannel(t){var e=new kW;return e.sampler=t.sampler,e.node=this.model.getNode(t.target.node),e.path=t.target.path,e},t.createAccessor=function createAccessor(t){var e=this.model.gltf,n=new ht;return n.bufferView=t.bufferView,n.byteOffset=t.byteOffset||0,n.normalized=t.normalized,n.type=t.type,n.componentType=t.componentType,n.count=t.count,n.min=t.min||[],n.max=t.max||[],n.stride=e.bufferViews[t.bufferView].byteStride||0,n},function GLTFAnimationProcessor_createClass(t,e,n){return e&&GLTFAnimationProcessor_defineProperties(t.prototype,e),n&&GLTFAnimationProcessor_defineProperties(t,n),t}(GLTFAnimationProcessor,[{key:"animations",get:function get(){return this._animations},set:function set(t){this._animations=t}}]),GLTFAnimationProcessor}(),Et=function(){function GLTFSceneProcessor(t){this.model=t,this.cache=this.model.cache.getCache(k.SCENE)}var t=GLTFSceneProcessor.prototype;return t.processScenes=function processScenes(){for(var t,e=this.model.gltf,n=[],r=0;t=e.scenes[r];r++)n.push(this.processScene(t,r));return n[0]},t.processScene=function processScene(t,e){var n=new et;n.name=t.name||"scene"+e;for(var r=0;r<t.nodes.length;r++)n.addNode(this.model.getNode(t.nodes[r]));return this.cache.add(n.name,n),n},GLTFSceneProcessor}(),Tt=function(){function GLTFModel(t,e,n){this.gltf=t,this.data=e,this.cache=n.cache,this.loader=n.loader,this.gl=n.gl,this.path=n.path,this.accessorProcessor=new yt(this),this.meshProcessor=new _t(this),this.nodeProcessor=new vt(this),this.materialProcessor=new J(this),this.skinProcessor=new gt(this)}var t=GLTFModel.prototype;return t.process=function process(){var t=new Et(this).processScenes();return t.animations=new bt(this).processAnimations(),t.meshes=this.meshProcessor.meshes,t},t.getSkin=function getSkin(t){return this.skinProcessor.processSkin(t)},t.getMaterial=function getMaterial(t){return this.materialProcessor.processMaterial(t)},t.getNode=function getNode(t){return this.nodeProcessor.processNode(t)},t.getMesh=function getMesh(t){return this.meshProcessor.processMesh(t)},t.getBufferView=function getBufferView(t,e){return this.accessorProcessor.getBufferView(t,e)},t.getAccessorData=function getAccessorData(t){return this.accessorProcessor.getAccessorData(t)},GLTFModel}(),Mt=function(){function Base64Binary(){}return Base64Binary.decodeArrayBuffer=function decodeArrayBuffer(t){var e=t.length/4*3,n=new ArrayBuffer(e);return Base64Binary.decode(t,null,n),n},Base64Binary.removePaddingChars=function removePaddingChars(t){return 64===Base64Binary._keyStr.indexOf(t.charAt(t.length-1))?t.substring(0,t.length-1):t},Base64Binary.decode=function decode(t,e,n){t=Base64Binary.removePaddingChars(t);var r=parseInt(t.length/4*3,10),o=void 0!==e?r-e:0,i=n?new Uint8Array(n):new Uint8Array(r);t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var a=0,s=0;a<r;a+=3){var u=Base64Binary._keyStr.indexOf(t.charAt(s++)),c=Base64Binary._keyStr.indexOf(t.charAt(s++)),l=Base64Binary._keyStr.indexOf(t.charAt(s++)),f=Base64Binary._keyStr.indexOf(t.charAt(s++)),d=u<<2|c>>4,h=(15&c)<<4|l>>2,p=(3&l)<<6|f;i[a]=d,64!=l&&(i[a+1]=h),64!=f&&(i[a+2]=p)}return i.slice(o,r)},Base64Binary}();function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function _unsupportedIterableToArray(t,e){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(t,e)}(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function GLTFParser_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Mt._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var At=function(){function GLTF_Parser(t,e,n){this._path="",this.loader=t,this.gl=e,this.cache=n}var t=GLTF_Parser.prototype;return t.parse=function parse(t,e){var n=[];return e?n.push(e):n.push.apply(n,_toConsumableArray(this.parseBuffers(t))),new Tt(t,n,{path:this._path,gl:this.gl,cache:this.cache,loader:this.loader}).process()},t.parseBuffers=function parseBuffers(t){for(var e=[],n=0;n<t.buffers.length;n++){var r=t.buffers[n],o=Mt.decode(r.uri,r.byteLength);e.push(o)}return e},function GLTFParser_createClass(t,e,n){return e&&GLTFParser_defineProperties(t.prototype,e),n&&GLTFParser_defineProperties(t,n),t}(GLTF_Parser,[{key:"path",get:function get(){return this._path},set:function set(t){this._path=t}}]),GLTF_Parser}();var St=function(r){function GLTFLoader(t,e){var n;return(n=r.call(this,k.SCENE)||this).gl=t,n.cache=e,n}!function GLTFLoader_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(GLTFLoader,r);var t=GLTFLoader.prototype;return t.add=function add(t,e,n){var r=n?{resource:new M({url:n,loadType:y.XHR,responseType:"arraybuffer"},{type:"buffer"})}:null,o={resource:new M({url:e,loadType:y.XHR,responseType:"json"},{type:"json"})},i=r?[o,r]:[o];return this.addResourceToQueue({key:t,resources:i})},t.transform=function transform(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.find(function(t){return"json"===t.config.type}),o=e.find(function(t){return"buffer"===t.config.type}),i=r.options.url,a=i.match(/[\w\.]+/g),s=new At(this._loader,this.gl,this.cache);return s.path=i.replace(a[a.length-1],""),s.parse(r.request.response,o?o.request.response:void 0)},GLTFLoader}(C);function e(t,e,n,r){for(var o in e)null==t[o]&&(t[o]=e[o]());for(var i in r)null==t[i]&&r[i](t);for(var a in n)t.constructor&&t.constructor.prototype?null==t.constructor.prototype[a]&&(t.constructor.prototype[a]=n[a]):null==t[a]&&(t[a]=n[a]);return t}function HW(t){this.id=t||wt.id(),this.components=wt.components(),this.bitmask=wt.bitmask()}var wt={id:function(){return qt.uuid()},components:function(){return this._components||Object.create(null)},bitmask:function(){return 0}},Rt={components:function(t){Object.defineProperty(t,"components",{get:function(){return this._components},set:function(t){this._components=t}})}};HW.prototype.getAll=function(){return this.components};var xt={get:HW.prototype.get=function(t){return"string"==typeof t?this.components[t]:this.components[t.prototype.constructor.name]},getAll:HW.prototype.getAll,has:HW.prototype.has=function(t){return"string"==typeof t?!!this.components[t]:!!this.components[t.prototype.constructor.name]},add:HW.prototype.add=function(t){return qt.addComponent(this,t)},remove:HW.prototype.remove=function(t){return qt.removeComponent(this,t)},dispose:HW.prototype.dispose=function(){return qt.removeEntity(this)}};function r(t){return e(t,wt,xt,Rt)}function PW(){return(""+1e7+-1e3+-4e3+-8e3+-1e11).replace(/1|0/g,function(){return(0|16*Math.random()).toString(16)})}var Ct,Lt,Ot,Pt,kt,It,Dt,Ft,Bt,Nt,Gt;(Gt=Ct=Ct||{}).SYSTEM_ADDED="entitySystemManager.systemAdded",Gt.SYSTEM_REMOVED="entitySystemManager.systemRemoved",(Nt=Lt=Lt||{}).ENTITY_ADDED="system.entityAdded",Nt.ENTITY_REMOVED="system.entityRemoved",(Bt=Ot=Ot||{}).ENTITY_ADDED="entityComponentManager.entityAdded",Bt.ENTITY_REMOVED="entityComponentManager.entityRemoved",Bt.ENTITIES_UPDATED="entityComponentManager.entitiesUpdated",Bt.COMPONENT_ADDED="entityComponentManager.componentAdded",Bt.COMPONENT_REMOVED="entityComponentManager.componentRemoved",(Pt||(Pt={})).SYSTEM_ADDED="worker.entitySystemManager.systemAdded",(Ft=kt=kt||{}).ENTITY_ADDED="worker.entityComponentManager.entityAdded",Ft.ENTITY_REMOVED="worker.entityComponentManager.entityRemoved",Ft.ENTITIES_UPDATED="worker.entityComponentManager.entitiesUpdated",Ft.COMPONENT_ADDED="worker.entityComponentManager.componentAdded",Ft.COMPONENT_REMOVED="worker.entityComponentManager.componentRemoved",(Dt=It=It||{}).INIT_WORKER="worker.entityComponentSystem.init",Dt.UPDATE_WORKER="worker.entityComponentSystem.update";function QW(t,e,n){void 0===n&&(n=PW),this.events=e,this.uuid=n,this.componentBitmask=t,this.entities=Object.create(null)}QW.prototype.createEntity=function(t,e){var n=r(t=t||new HW);return n.components=e||Object.create(null),n.bitmask=0,this.updateComponentBitmask(n),n},QW.prototype.updateComponentBitmask=function(t){for(var e=Object.keys(t.components),n=0,r=void 0;r=t.components[e[n]];n++)t.bitmask=t.bitmask|this.componentBitmask.get(r.id)},QW.prototype.addEntity=function(t,e,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var i=r(t);return(this.entities[i.id]=i).components=e||i.components||Object.create(null),i.bitmask=i.bitmask||0,this.updateComponentBitmask(i),n||this.events.emit(Ot.ENTITY_ADDED,i),o||this.events.emit(kt.ENTITY_ADDED,i),i},QW.prototype.updateEntities=function(t,e,n){for(var r=Object.keys(t),o=0,i=void 0;i=t[r[o]];o++){var a=Object.assign({},i.components);this.hasEntity(i)&&(a=Object.assign({},this.entities[i.id].components,i.components)),this.addEntity(new HW(i.id),a,!0)}e||this.events.emit(Ot.ENTITIES_UPDATED,t),n||this.events.emit(kt.ENTITIES_UPDATED,t)},QW.prototype.getEntitiesByBitmask=function(t){for(var e=[],n=Object.keys(this.entities),r=0,o=void 0;o=this.entities[n[r]];r++)(o.bitmask&t)===t&&e.push(o);return e},QW.prototype.getEntities=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var n=0,r=0,o=void 0;o=t[r];r++)n|=this.componentBitmask.get(o);for(var i=Object.keys(this.entities),a=[],s=0,u=void 0;u=this.entities[i[s]];s++)(u.bitmask&n)===n&&a.push(u);return a},QW.prototype.removeEntity=function(t,e,n){return void 0===e&&(e=!1),this.hasEntity(t)&&(e||this.events.emit(Ot.ENTITY_REMOVED,t),n||this.events.emit(kt.ENTITY_REMOVED,t),delete this.entities[t.id]),t},QW.prototype.removeAllEntities=function(){for(var t=[],e=Object.keys(this.entities),n=0,r=void 0;r=this.entities[e[n]];n++)t.push(this.removeEntity(r));return t},QW.prototype.hasEntity=function(t){return!!this.entities[t.id]},QW.prototype.addComponent=function(t,e,n,r){void 0===n&&(n=!1);var o=R(e);t.components[o.id]=o,t.bitmask=t.bitmask|this.componentBitmask.get(o.id),!n&&this.hasEntity(t)&&this.events.emit(Ot.COMPONENT_ADDED,t,o),!r&&this.hasEntity(t)&&this.events.emit(kt.COMPONENT_ADDED,t,o)},QW.prototype.removeComponent=function(t,e,n,r){var o;return void 0===n&&(n=!1),!!(o="string"==typeof e?t.components[e]:t.components[e.prototype.constructor.name])&&(t.bitmask=t.bitmask^this.componentBitmask.get(o.id),!n&&this.hasEntity(t)&&this.events.emit(Ot.COMPONENT_REMOVED,t,o),!r&&this.hasEntity(t)&&this.events.emit(kt.COMPONENT_REMOVED,t,o),o.remove(),delete t.components[o.id])};function RW(){this.bitmaskMap=Object.create(null)}var Ut={size:{configurable:!0}};RW.prototype.has=function(t){return"string"==typeof t?!!this.bitmaskMap[t]:!!this.bitmaskMap[t.prototype.constructor.name]},RW.prototype.add=function(t){"string"==typeof t?this.bitmaskMap[t]=1<<this.size:this.bitmaskMap[t.prototype.constructor.name]=1<<this.size},RW.prototype.get=function(t){return this.has(t)||this.add(t),"string"==typeof t?this.bitmaskMap[t]||0:this.bitmaskMap[t.prototype.constructor.name]||0},RW.prototype.getCompound=function(t){void 0===t&&(t=[]);for(var e=0,n=0,r=void 0;r=t[n];n++)e|=this.get(r);return e},Ut.size.get=function(){return Object.keys(this.bitmaskMap).length},RW.prototype.set=function(t){this.bitmaskMap=t},Object.defineProperties(RW.prototype,Ut);function UW(){this.entityMap=jt.entityMap(),this.entities=jt.entities(),this.events=jt.events()}var jt={entityMap:function(){return Object.create(null)},entities:function(){return[]},events:function(){return new h}};UW.prototype.setUp=function(){},UW.prototype.tearDown=function(){},UW.prototype.has=function(t){return!!this.entities[this.entityMap[t.id]]},UW.prototype.remove=function(t,e){void 0===e&&(e=!0),e&&qt.removeEntity(t),qt.removeEntityFromSystem(t,this)},UW.prototype.dispose=function(){qt.removeSystem(this)};var Wt={setUp:function(){return qt.noop},tearDown:function(){return qt.noop},has:function(){return UW.prototype.has},remove:function(){return UW.prototype.remove},dispose:function(){return UW.prototype.dispose}},Vt={};function T(t,n){var r=e(t,jt,Wt,Vt);return function(t,e){for(var n=0,r=void 0;r=e[n];n++)t.constructor&&t.constructor.prototype?null==t.constructor.prototype[r]&&(t.constructor.prototype[r]=qt.noop):null==t[r]&&(t[r]=qt.noop)}(t,n),r}function XW(t,e){this.events=e,this._systemUpdateMethods=["update"],this.componentBitmask=t,this.systems=Object.create(null),this.ids=[]}var Xt={systemUpdateMethods:{configurable:!0}};XW.prototype.updateBitmask=function(t,e){void 0===e&&(e=[]);for(var n=0,r=void 0;r=e[n];n++)t.bitmask=t.bitmask|this.componentBitmask.get(r);return t},XW.prototype.add=function(t,e,n){return void 0===e&&(e=[]),void 0===n&&(n=!1),this.has(t)?console.warn("System "+t+" already exists! And can only exists ones"):(T(t,this.systemUpdateMethods),this.systems[t.id]=t,this.ids.push(t.id),this.updateBitmask(t,e),t.setUp(),n||this.events.emit(Ct.SYSTEM_ADDED,t)),t},XW.prototype.has=function(t){return!!this.systems[t.id]},XW.prototype.remove=function(t,e){return void 0===e&&(e=!1),!!this.has(t)&&(e||this.events.emit(Ct.SYSTEM_REMOVED,t),t.tearDown(),this.ids.splice(this.ids.indexOf(t.id),1),delete this.systems[t.id])},XW.prototype.get=function(t){return this.systems[t.prototype.constructor.name]},XW.prototype.addEntity=function(t,e){if(e)0!==e.bitmask&&(t.bitmask&e.bitmask)===e.bitmask&&(e.entityMap[t.id]=e.entities.push(t)-1,e.events.emit(Lt.ENTITY_ADDED,t));else for(var n=this.ids,r=this.systems,o=0,i=void 0;i=r[n[o]];o++)this.addEntity(t,i)},XW.prototype.removeEntity=function(t,e){if(e){var n=e.entityMap[t.id];0<=n&&(e.entities.splice(n,1),delete e.entityMap[t.id]),e.events.emit(Lt.ENTITY_REMOVED,t)}else for(var r=this.ids,o=this.systems,i=0,a=void 0;a=o[r[i]];i++)this.removeEntity(t,a)},XW.prototype.updateEntity=function(t,e){if(e)this.addEntityToSystem(e,t);else for(var n=this.ids,r=this.systems,o=0,i=void 0;i=r[n[o]];o++)this.addEntityToSystem(i,t)},XW.prototype.updateSystemEntity=function(t,e){0!==e.bitmask&&(t.bitmask&e.bitmask)===e.bitmask&&(e.entities[e.entityMap[t.id]]=t)},XW.prototype.addEntityToSystem=function(t,e){(e.bitmask&t.bitmask)===t.bitmask?t.has(e)?this.updateSystemEntity(e,t):this.addEntity(e,t):t.has(e)&&this.removeEntity(e,t)},XW.prototype.callSystemMethod=function(t,e,n,r,o,i,a,s,u,c){for(var l=this.ids,f=this.systems,d=0,h=void 0;h=f[l[d]];d++)h[t](e,n,r,o,i,a,s,u,c)},XW.prototype.update=function(t,e,n,r,o,i,a,s,u){for(var c=0,l=void 0;l=this._systemUpdateMethods[c];c++)this.callSystemMethod(l,t,e,n,r,o,i,a,s,u)},XW.prototype.updateSystemMethods=function(){for(var t=this.ids,e=this.systems,n=this.systemUpdateMethods,r=0,o=void 0;o=e[t[r]];r++)T(o,n)},Xt.systemUpdateMethods.get=function(){return this._systemUpdateMethods},Xt.systemUpdateMethods.set=function(t){this._systemUpdateMethods=t,this.updateSystemMethods()},Object.defineProperties(XW.prototype,Xt);function ZW(){this.componentBitmaskMap=new RW,this.events=new h,this.ecm=new QW(this.componentBitmaskMap,this.events),this.scm=new XW(this.componentBitmaskMap,this.events),this.registerEvents()}ZW.prototype.registerEvents=function(){var e=this;this.events.on(Ot.ENTITY_ADDED,this.onEntityAdded.bind(this)),this.events.on(Ot.ENTITY_REMOVED,this.onEntityRemoved.bind(this)),this.events.on(Ot.COMPONENT_ADDED,this.onComponentAdded.bind(this)),this.events.on(Ot.COMPONENT_REMOVED,this.onComponentRemoved.bind(this)),this.events.on(Ct.SYSTEM_ADDED,this.onSystemAdded.bind(this)),this.events.on(Ot.ENTITIES_UPDATED,this.onEntitiesUpdated.bind(this)),this.events.on(kt.ENTITY_ADDED,this.onEntityAddedToWorker.bind(this)),this.events.on(kt.ENTITY_REMOVED,this.onEntityRemovedFromWorker.bind(this)),this.events.on(kt.COMPONENT_ADDED,this.onComponentAddedToWorker.bind(this)),this.events.on(kt.COMPONENT_REMOVED,this.onComponentRemovedFromWorker.bind(this)),self.addEventListener("message",function(t){return e.delegateWorkerEvents(t)})},ZW.prototype.onEntityAdded=function(t){this.scm.updateEntity(t)},ZW.prototype.onEntityAddedToWorker=function(t){this.sendEventToMaster({message:kt.ENTITY_ADDED,entity:t})},ZW.prototype.onEntityRemoved=function(t){this.scm.removeEntity(t)},ZW.prototype.onEntityRemovedFromWorker=function(t){this.sendEventToMaster({message:kt.ENTITY_REMOVED,entity:t})},ZW.prototype.onComponentAdded=function(t){this.scm.updateEntity(t)},ZW.prototype.onComponentAddedToWorker=function(t,e){this.sendEventToMaster({message:kt.COMPONENT_ADDED,entity:t,component:e})},ZW.prototype.onComponentRemoved=function(t){this.scm.updateEntity(t)},ZW.prototype.onComponentRemovedFromWorker=function(t,e){this.sendEventToMaster({message:kt.COMPONENT_REMOVED,entity:t,component:e})},ZW.prototype.onSystemAdded=function(t){for(var e in this.ecm.entities)this.scm.updateEntity(this.ecm.entities[e],t);this.sendEventToMaster({message:Pt.SYSTEM_ADDED,id:t.id,bitmask:t.bitmask})},ZW.prototype.onEntitiesUpdated=function(t){for(var e=Object.keys(t),n=0,r=void 0;r=t[e[n]];n++)this.scm.updateEntity(r)},ZW.prototype.sendEventToMaster=function(t){self.postMessage(t)},ZW.prototype.triggerInit=function(t){this.initialized||(this.componentBitmaskMap.set(t.data.bitmaskMap),this.initialized=!0,this.initcb&&this.initcb())},ZW.injectComponents=function(t){for(var e=t.components||t._components,n=Object.keys(e),r=0,o=void 0;o=e[n[r]];r++)R(o)},ZW.prototype.delegateWorkerEvents=function(t){var e;switch(t.data.message){case It.INIT_WORKER:this.triggerInit(t);break;case It.UPDATE_WORKER:(e=this).update.apply(e,t.data.args);break;case kt.ENTITY_ADDED:ZW.injectComponents(t.data.entity),this.ecm.addEntity(t.data.entity,t.data.entity.components||t.data.entity._components,!1,!0);break;case kt.ENTITY_REMOVED:ZW.injectComponents(t.data.entity),this.ecm.removeEntity(t.data.entity,!1,!0);break;case kt.COMPONENT_ADDED:ZW.injectComponents(t.data.entity),R(t.data.component),this.ecm.addComponent(t.data.entity,t.data.component,!1,!0);break;case kt.COMPONENT_REMOVED:ZW.injectComponents(t.data.entity),R(t.data.component),this.ecm.removeComponent(t.data.entity,t.data.component.id,!1,!0);break;case Pt.SYSTEM_ADDED:this.componentBitmaskMap.set(t.data.bitmaskMap),this.addEntitiesForSystem(t.data.entities);break;case kt.ENTITIES_UPDATED:this.componentBitmaskMap.set(t.data.bitmaskMap),this.updateEntities(t.data.entities)}},ZW.prototype.updateEntities=function(t){for(var e=Object.keys(t),n=0,r=void 0;r=t[e[n]];n++)ZW.injectComponents(r);this.ecm.updateEntities(t,!1,!0)},ZW.prototype.addEntitiesForSystem=function(t){for(var e=0,n=void 0;n=t[e];e++)ZW.injectComponents(n),this.ecm.addEntity(n,n.components||n._components,!1,!0)},ZW.prototype.addWorker=function(){throw"WebWorkers can only be added to the main thread"},ZW.prototype.update=function(t,e,n,r,o,i,a,s,u){this.scm.update(t,e,n,r,o,i,a,s,u),this.sendEventToMaster({message:It.UPDATE_WORKER,entities:this.ecm.entities})},ZW.prototype.init=function(t){this.initcb=t,this.sendEventToMaster({message:It.INIT_WORKER})};function $W(){this.componentBitmaskMap=new RW,this.events=new h,this.ecm=new QW(this.componentBitmaskMap,this.events),this.scm=new XW(this.componentBitmaskMap,this.events),this.registerEvents(),this.workers=[],this.workerBitmasks=[]}$W.prototype.registerEvents=function(){this.events.on(Ot.ENTITY_ADDED,this.onEntityAdded.bind(this)),this.events.on(Ot.ENTITY_REMOVED,this.onEntityRemoved.bind(this)),this.events.on(Ot.COMPONENT_ADDED,this.onComponentAdded.bind(this)),this.events.on(Ot.COMPONENT_REMOVED,this.onComponentRemoved.bind(this)),this.events.on(Ct.SYSTEM_ADDED,this.onSystemAdded.bind(this)),this.events.on(Ot.ENTITIES_UPDATED,this.onEntitiesUpdated.bind(this)),this.events.on(kt.ENTITY_ADDED,this.onEntityAddedToWorker.bind(this)),this.events.on(kt.ENTITY_REMOVED,this.onEntityRemovedFromWorker.bind(this)),this.events.on(kt.COMPONENT_ADDED,this.onComponentAddedToWorker.bind(this)),this.events.on(kt.COMPONENT_REMOVED,this.onComponentRemovedFromWorker.bind(this)),this.events.on(kt.ENTITIES_UPDATED,this.onEntitiesUpdatedForWorker.bind(this))},$W.prototype.onEntityAdded=function(t){this.scm.updateEntity(t)},$W.prototype.onEntityAddedToWorker=function(t){for(var e=0,n=void 0;n=this.workers[e];e++)0!=(this.workerBitmasks[e]&t.bitmask)&&n.postMessage({message:kt.ENTITY_ADDED,entity:t})},$W.prototype.onEntityRemoved=function(t){this.scm.removeEntity(t)},$W.prototype.onEntityRemovedFromWorker=function(t){for(var e=0,n=void 0;n=this.workers[e];e++)0!=(this.workerBitmasks[e]&t.bitmask)&&n.postMessage({message:kt.ENTITY_REMOVED,entity:t})},$W.prototype.onComponentAdded=function(t){this.scm.updateEntity(t)},$W.prototype.onComponentAddedToWorker=function(t,e){for(var n=0,r=void 0;r=this.workers[n];n++)0!=(this.workerBitmasks[n]&t.bitmask)&&r.postMessage({message:kt.COMPONENT_ADDED,entity:t,component:e})},$W.prototype.onEntitiesUpdated=function(t){for(var e=Object.keys(t),n=0,r=void 0;r=t[e[n]];n++)this.scm.updateEntity(r)},$W.prototype.onEntitiesUpdatedForWorker=function(t){for(var e=Object.keys(t),n=0,r=void 0;r=this.workers[n];n++){for(var o={},i=0,a=void 0;a=t[e[i]];i++)0!=(this.workerBitmasks[i]&a.bitmask)&&(o[a.id]=a);0!==Object.keys(o).length&&r.postMessage({message:kt.ENTITIES_UPDATED,entities:o,bitmaskMap:this.componentBitmaskMap.bitmaskMap})}},$W.prototype.onComponentRemoved=function(t){this.scm.updateEntity(t)},$W.prototype.onComponentRemovedFromWorker=function(t,e){for(var n=0,r=void 0;r=this.workers[n];n++)0!=(this.workerBitmasks[n]&t.bitmask)&&r.postMessage({message:kt.COMPONENT_REMOVED,entity:t,component:e})},$W.prototype.onSystemAdded=function(t){for(var e in this.ecm.entities)this.scm.updateEntity(this.ecm.entities[e],t)},$W.sendEventToWorker=function(t,e){t.postMessage(e)},$W.prototype.sendEventToAllWorkers=function(t){for(var e=0,n=void 0;n=this.workers[e];e++)n.postMessage(t)},$W.injectEntities=function(t){for(var e=Object.keys(t),n=0,r=void 0;r=t[e[n]];n++)$W.injectComponents(r.components)},$W.injectComponents=function(t){for(var e=Object.keys(t),n=0,r=void 0;r=t[e[n]];n++)R(r)},$W.prototype.delegateWorkerEvents=function(t){switch(t.data.message){case It.INIT_WORKER:this.sendInitEvent(t.target);break;case kt.ENTITY_ADDED:$W.injectComponents(t.data.entity.components),this.ecm.addEntity(t.data.entity,t.data.entity.components);break;case kt.ENTITY_REMOVED:$W.injectComponents(t.data.entity.components),R(t.data.component),this.ecm.removeEntity(t.data.entity);break;case kt.COMPONENT_ADDED:$W.injectComponents(t.data.entity.components),R(t.data.component),this.ecm.addComponent(t.data.entity,t.data.component);break;case kt.COMPONENT_REMOVED:$W.injectComponents(t.data.entity.components),R(t.data.component),this.ecm.removeComponent(t.data.entity,t.data.component.id);break;case Pt.SYSTEM_ADDED:this.sendSystemEntitiesToWorker(t);break;case It.UPDATE_WORKER:$W.injectEntities(t.data.entities),this.ecm.updateEntities(t.data.entities)}},$W.prototype.sendSystemEntitiesToWorker=function(t){var e=this.workers.indexOf(t.target);if(-1!==e){this.workerBitmasks[e]=this.workerBitmasks[e]|t.data.bitmask;var n=this.ecm.getEntitiesByBitmask(t.data.bitmask);$W.sendEventToWorker(t.target,{message:Pt.SYSTEM_ADDED,entities:n,bitmaskMap:this.componentBitmaskMap.bitmaskMap})}},$W.prototype.sendInitEvent=function(t){t.postMessage({message:It.INIT_WORKER,bitmaskMap:this.componentBitmaskMap.bitmaskMap})},$W.prototype.registerWorker=function(t){var e=this;t.addEventListener("message",function(t){return e.delegateWorkerEvents(t)}),this.sendInitEvent(t)},$W.prototype.addWorker=function(t){-1===this.workers.indexOf(t)&&(this.workers.push(t),this.workerBitmasks.push(0),this.registerWorker(t))},$W.prototype.update=function(t,e,n,r,o,i,a,s,u){this.scm.update(t,e,n,r,o,i,a,s,u),this.sendEventToAllWorkers({message:It.UPDATE_WORKER,args:[t,e,n,r,o,i,a,s,u]})},$W.prototype.init=function(){throw"init is only used by workers"};var qt=function(){},Ht={systemUpdateMethods:{configurable:!0}};qt.noop=function(){},qt.createEntity=function(t,e){return qt.instance.ecm.createEntity(t,e)},qt.addEntity=function(t,e){return qt.instance.ecm.addEntity(t,e)},qt.getEntities=function(){for(var t,e=[],n=arguments.length;n--;)e[n]=arguments[n];return(t=qt.instance.ecm).getEntities.apply(t,e)},qt.removeEntity=function(t){return qt.instance.ecm.removeEntity(t)},qt.removeAllEntities=function(){return qt.instance.ecm.removeAllEntities()},qt.hasEntity=function(t){return qt.instance.ecm.hasEntity(t)},qt.removeComponent=function(t,e){return qt.instance.ecm.removeComponent(t,e)},qt.addComponent=function(t,e){return qt.instance.ecm.addComponent(t,e)},qt.addSystem=function(t,e){return qt.instance.scm.add(t,e)},qt.hasSystem=function(t){return qt.instance.scm.has(t)},qt.removeSystem=function(t){return qt.instance.scm.remove(t)},qt.removeEntityFromSystem=function(t,e){qt.instance.scm.removeEntity(t,e)},qt.getSystem=function(t){return qt.instance.scm.get(t)},qt.update=function(t,e,n,r,o,i,a,s,u){qt.instance.update(t,e,n,r,o,i,a,s,u)},qt.callSystemMethod=function(t){qt.instance.scm.callSystemMethod(t)},qt.addWorker=function(t){qt.instance.addWorker(t)},qt.init=function(t){qt.instance.init(t)},qt.createComponentsFromDecorator=function(t){for(var e=Object.create(null),n=0,r=t;n<r.length;n+=1){var o=r[n],i=new o.component(o.config);e[i.id]=i}return e},qt.Component=function(t){function Lga(t){this._id=t}var e=t?function(){return this._id||(this._id=t)}:function(){return this._id||(this._id=this.constructor.name)};return function(t){return Object.defineProperty(t.prototype,"id",{get:e,set:Lga}),t}},qt.System=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return function(t){return Object.defineProperty(t.prototype,"id",{get:function(){return this._id||(this._id=this.constructor.name)}}),Object.defineProperty(t.prototype,"bitmask",{get:function(){return this._bitmask||(this._bitmask=qt.instance.componentBitmaskMap.getCompound(e))},set:function(t){this._bitmask=t}}),t}},qt.Entity=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return function(t){return Object.defineProperty(t.prototype,"components",{get:function(){return this._components||(this._components=qt.createComponentsFromDecorator(e))},set:function(t){this._components=t}}),t}},Ht.systemUpdateMethods.get=function(){return qt.instance.scm.systemUpdateMethods},Ht.systemUpdateMethods.set=function(t){qt.instance.scm.systemUpdateMethods=t},Object.defineProperties(qt,Ht),qt.instance=new("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?ZW:$W),qt.uuid=qt.instance.ecm.uuid,qt.events=qt.instance.events;var zt={remove:qt.noop},Yt={id:function(t){Object.defineProperty(t,"id",{get:function(){return this._id||(this._id=this.constructor.name)},set:function(t){this._id=t}})}};function R(t){return e(t,{},zt,Yt)}var Qt=function(n){function GLSLLoader(t){var e;return(e=n.call(this,k.SHADER)||this).gl=t,e}!function GLSLLoader_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(GLSLLoader,n);var t=GLSLLoader.prototype;return t.add=function add(t,e,n,r){return this.addResourceToQueue({key:t,resources:[{resource:new M({url:e,loadType:y.XHR,responseType:"text"},{type:"vertex",shader:r})},{resource:new M({url:n,loadType:y.XHR,responseType:"text"},{type:"fragment",shader:r})}]})},t.transform=function transform(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.find(function(t){return"vertex"===t.config.type}),o=e.find(function(t){return"fragment"===t.config.type});if(r.config.shader){var i=r.config.shader;return i.vertexSrc=r.request.response,i.fragmentSrc=o.request.response,i}return new rt(this.gl,r.request.response,o.request.response)},GLSLLoader}(C);var Kt=0,$t=1,Zt=2,Jt=3,te=4,ee=5,ne=6,re=7,oe=function(r){function KhronosPbrShader(t,e){var n;return(n=r.call(this,t)||this).cache=e,n}!function khronosPbrShader_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(KhronosPbrShader,r);var t=KhronosPbrShader.prototype;return t.initializeDefines=function initializeDefines(t){t.hasAttribute(f.GL_PRIMITIVES.NORMAL)&&this.addDefine("HAS_NORMALS",1),t.hasAttribute(f.GL_PRIMITIVES.TANGENT)&&this.addDefine("HAS_TANGENTS",1),t.hasAttribute(f.GL_PRIMITIVES.TEXCOORD_0)&&this.addDefine("HAS_UV",1),t.hasAttribute(f.GL_PRIMITIVES.JOINTS_0)&&t.hasAttribute(f.GL_PRIMITIVES.WEIGHTS_0)&&this.addDefine("HAS_SKIN",1),t.hasAttribute(f.GL_PRIMITIVES.JOINTS_1)&&t.hasAttribute(f.GL_PRIMITIVES.WEIGHTS_1)&&this.addDefine("SKIN_VEC8",1),t.hasMap(this.cache,X.ALBEDO)&&this.addDefine("HAS_BASECOLORMAP",1),t.hasMap(this.cache,X.METAL_ROUGHNESS)&&this.addDefine("HAS_METALROUGHNESSMAP",1),t.hasMap(this.cache,X.NORMAL)&&this.addDefine("HAS_NORMALMAP",1),t.hasMap(this.cache,X.EMISSIVE)&&this.addDefine("HAS_EMISSIVEMAP",1),t.hasMap(this.cache,X.OCCLUSION)&&this.addDefine("HAS_OCCLUSIONMAP",1);var e=this.cache.get(k.TEXTURE,s),n=this.cache.get(k.TEXTURE,u),r=this.cache.get(k.TEXTURE,c);e&&n&&r&&this.addDefine("USE_IBL",1)},t.applyNode=function applyNode(t){if(this.uniforms.u_ModelMatrix=t.transform.modelMatrix,t.skin){var e=$.mat4.create();$.mat4.invert(e,t.transform.modelMatrix);for(var n,r=0;n=t.skin.joints[r];r++){var o=t.skin.jointMatrices[r];$.mat4.mul(o,n.transform.modelMatrix,t.skin.inverseBindMatrices[r]),$.mat4.mul(o,e,o)}t.skin.update()}},t.applyMaterial=function applyMaterial(t){this.applyCamera(),this.applyTextures(t),this.applyIBL(),this.uniforms.u_BaseColorFactor=t.model.baseColorFactor,this.uniforms.u_RoughnessFactor=t.model.roughnessFactor,this.uniforms.u_MetallicFactor=t.model.metallicFactor,t.doubleSided?this.gl.disable(this.gl.CULL_FACE):this.gl.enable(this.gl.CULL_FACE),this.uniforms.u_AlphaCutoff=t.alphaCutoff,this.uniforms.u_IgnoreAlpha=t.alphaMode===H.OPAQUE?1:0},t.applyIBL=function applyIBL(){var t=this.cache.get(k.TEXTURE,s);t&&(t.bind(Zt),this.uniforms.u_brdfLUT=Zt);var e=this.cache.get(k.TEXTURE,u);e&&(e.bind(Kt),this.uniforms.u_DiffuseEnvSampler=Kt);var n=this.cache.get(k.TEXTURE,c);n&&(n.bind($t),this.uniforms.u_SpecularEnvSampler=$t)},t.applyTextures=function applyTextures(t){t.maps[X.ALBEDO]&&this.cache.get(k.TEXTURE,t.maps[X.ALBEDO].texture)&&(this.cache.get(k.TEXTURE,t.maps[X.ALBEDO].texture).bind(Jt),this.uniforms.u_BaseColorSampler=Jt);t.maps[X.METAL_ROUGHNESS]&&this.cache.get(k.TEXTURE,t.maps[X.METAL_ROUGHNESS].texture)&&(this.cache.get(k.TEXTURE,t.maps[X.METAL_ROUGHNESS].texture).bind(te),this.uniforms.u_MetallicRoughnessSampler=te);t.maps[X.NORMAL]&&this.cache.get(k.TEXTURE,t.maps[X.NORMAL].texture)&&(this.cache.get(k.TEXTURE,t.maps[X.NORMAL].texture).bind(ee),this.uniforms.u_NormalSampler=ee,this.uniforms.u_NormalScale=t.model.normalScale);t.maps[X.EMISSIVE]&&this.cache.get(k.TEXTURE,t.maps[X.EMISSIVE].texture)&&(this.cache.get(k.TEXTURE,t.maps[X.EMISSIVE].texture).bind(ne),this.uniforms.u_EmissiveSampler=ne,this.uniforms.u_EmissiveFactor=t.model.emissiveFactor);t.maps[X.OCCLUSION]&&this.cache.get(k.TEXTURE,t.maps[X.OCCLUSION].texture)&&(this.cache.get(k.TEXTURE,t.maps[X.OCCLUSION].texture).bind(re),this.uniforms.u_OcclusionSampler=re,this.uniforms.u_OcclusionStrength=t.model.occlusionStrength)},t.applyCamera=function applyCamera(){this.uniforms.Matrices=i.CAMERA,this.uniforms.JointMatrix=i.SKIN},KhronosPbrShader}(rt);var ie=function(r){function SkyboxShader(t,e){var n;return(n=r.call(this,t)||this).cache=e,n}!function SkyboxShader_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(SkyboxShader,r);var t=SkyboxShader.prototype;return t.apply=function apply(){this.applyCamera(),this.cache.get(k.TEXTURE,l).bind(0),this.uniforms.u_Skybox=0},t.applyCamera=function applyCamera(){this.uniforms.Matrices=i.CAMERA},SkyboxShader}(rt);function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var ae=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},se=function(n){function SkyboxPass(t){var e;return(e=n.call(this)||this).gl=t.gl,e.cache=t.cache,e.shader=t.shader,e.cube=new f.GLCube(e.gl),e}!function SkyboxPass_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(SkyboxPass,n);var t=SkyboxPass.prototype;return t.setUp=function setUp(){this.shader.bind(),this.cube.vertexArrayObject.bind(),this.cube.vertexArrayObject.addAttribute(this.cube.vertexBuffer,this.shader.attributes.getAttribute("a_Position"),3,this.gl.FLOAT,!1,24,0),this.cube.vertexArrayObject.unbind(),this.shader.unbind()},t.tearDown=function tearDown(){},t.render=function render(){this.cache.has(k.TEXTURE,l)&&(this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.disable(this.gl.CULL_FACE),this.shader.bind(),this.shader.apply(),this.cube.draw(),this.shader.unbind(),this.gl.depthFunc(this.gl.LESS),this.gl.disable(this.gl.DEPTH_TEST))},SkyboxPass}(UW);function cameraComponent_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function cameraComponent_typeof(t){return(cameraComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}se=ae([qt.System()],se);var ue=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":cameraComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},ce=function(){function CameraComponent(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{fovy:.785,aspect:16/9,near:.01,far:100};this.init(t)}var t=CameraComponent.prototype;return t.init=function init(t){t.projMatrix?this._viewMatrix=t.viewMatrix:this._viewMatrix=$.mat4.create(),t.projMatrix?this._projMatrix=t.projMatrix:(this._projMatrix=$.mat4.create(),$.mat4.perspective(this._projMatrix,t.fovy||.785,t.aspect||16/9,t.near||.01,t.far||100))},t.remove=function remove(){$.mat4.identity(this._viewMatrix),$.mat4.identity(this._projMatrix)},function cameraComponent_createClass(t,e,n){return e&&cameraComponent_defineProperties(t.prototype,e),n&&cameraComponent_defineProperties(t,n),t}(CameraComponent,[{key:"viewMatrix",get:function get(){return this._viewMatrix},set:function set(t){this._viewMatrix=t}},{key:"projMatrix",get:function get(){return this._projMatrix},set:function set(t){this._projMatrix=t}}]),CameraComponent}();function lookAtCameraComponent_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lookAtCameraComponent_typeof(t){return(lookAtCameraComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}ce=ue([qt.Component("CameraComponent")],ce);var le=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":lookAtCameraComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},fe=function(){function LookAtCameraComponent(t){this.init(t)}var t=LookAtCameraComponent.prototype;return t.init=function init(t){var e=0<arguments.length&&void 0!==t?t:{target:$.vec3.create(),up:$.vec3.fromValues(0,1,0),panning:$.vec3.create(),zoom:$.vec3.create()};this._target=e.target||$.vec3.create(),this._up=e.up||$.vec3.fromValues(0,1,0),this._panning=e.panning||$.vec3.create(),this._zooming=e.zoom||$.vec3.create(),this._zoomPos=0},t.remove=function remove(){},function lookAtCameraComponent_createClass(t,e,n){return e&&lookAtCameraComponent_defineProperties(t.prototype,e),n&&lookAtCameraComponent_defineProperties(t,n),t}(LookAtCameraComponent,[{key:"target",get:function get(){return this._target},set:function set(t){this._target=t}},{key:"up",get:function get(){return this._up},set:function set(t){this._up=t}},{key:"panning",get:function get(){return this._panning},set:function set(t){this._panning=t}},{key:"zooming",get:function get(){return this._zooming},set:function set(t){this._zooming=t}},{key:"zoomPos",get:function get(){return this._zoomPos},set:function set(t){this._zoomPos=t}}]),LookAtCameraComponent}();function GUIComponent_typeof(t){return(GUIComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}fe=le([qt.Component()],fe);var de=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":GUIComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},he=function(){function GUIComponent(t){this.init(t)}var t=GUIComponent.prototype;return t.init=function init(t){this.config=t},t.remove=function remove(){},GUIComponent}();function color_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}he=de([qt.Component()],he);var pe=function(){function Color(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;this._elements=new Float32Array([t,e,n,r])}var t=Color.prototype;return t.set=function set(t){this._elements[3]=t},t.mult=function mult(t){return"number"==typeof t?new Color(this.r*t,this.g*t,this.b*t,Math.abs(Math.min(this.a*t,1))):new Color(this.r*t.r,this.g*t.g,this.b*t.b,Math.abs(Math.min(this.a*t.a,1)))},t.div=function div(t){if("number"==typeof t)return this.mult(1/t);var e=new Color(1/t.r,1/t.g,1/t.b,Math.min(1/t.a,1));return this.mult(e)},t.plus=function plus(t){return new Color(this.r+t.r,this.g+t.g,this.b+t.b,Math.abs(Math.min(this.a+t.a,1)))},t.minus=function minus(t){return new Color(this.r-t.r,this.g-t.g,this.b-t.b,Math.abs(Math.min(this.a-t.a,1)))},t.toString=function toString(){return"{Color: [R: "+this.r+" G: "+this.g+" B: "+this.b+" A: "+this.a+"]}"},function color_createClass(t,e,n){return e&&color_defineProperties(t.prototype,e),n&&color_defineProperties(t,n),t}(Color,[{key:"r",get:function get(){return this._elements[0]},set:function set(t){this._elements[0]=t}},{key:"g",get:function get(){return this._elements[1]},set:function set(t){this._elements[1]=t}},{key:"b",get:function get(){return this._elements[2]},set:function set(t){this._elements[2]=t}},{key:"a",get:function get(){return this._elements[3]}},{key:"elements",get:function get(){return this._elements},set:function set(t){this._elements=t}}]),Color}();function getVSpherePos(t,e,n,r){var o=$.vec3.fromValues(t/n*2-1,-(e/r*2-1),0);$.vec3.squaredLength(o);var i=$.vec3.squaredLength(o);return i<=1?$.vec3.add(o,o,[0,0,Math.sqrt(1-i)]):$.vec3.normalize(o,o),o}function lightComponent_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lightComponent_typeof(t){return(lightComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var me=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":lightComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},_e=function(){function LightComponent(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{lightColor:[255,255,255],lightScale:1,lightRotation:75,lightPitch:40};this.init(t)}var t=LightComponent.prototype;return t.init=function init(t){var e=0<arguments.length&&void 0!==t?t:{lightColor:[255,255,255],lightScale:1,lightRotation:75,lightPitch:40};this._direction=$.vec3.create(),this._color=new pe,this._lightColor=e.lightColor,this._lightScale=e.lightScale,this._lightRotation=e.lightRotation,this._lightPitch=e.lightPitch,this.updateLight()},t.remove=function remove(){},t.updateLight=function updateLight(){this._color.r=this._lightScale*this._lightColor[0]/255,this._color.g=this._lightScale*this._lightColor[1]/255,this._color.b=this._lightScale*this._lightColor[2]/255;var t=this._lightRotation*Math.PI/180,e=this._lightPitch*Math.PI/180;$.vec3.set(this._direction,Math.sin(t)*Math.cos(e),Math.sin(e),Math.cos(t)*Math.cos(e))},function lightComponent_createClass(t,e,n){return e&&lightComponent_defineProperties(t.prototype,e),n&&lightComponent_defineProperties(t,n),t}(LightComponent,[{key:"lightColor",get:function get(){return this._lightColor},set:function set(t){this._lightColor=t}},{key:"lightScale",get:function get(){return this._lightScale},set:function set(t){this._lightScale=t}},{key:"lightRotation",get:function get(){return this._lightRotation},set:function set(t){this._lightRotation=t}},{key:"lightPitch",get:function get(){return this._lightPitch},set:function set(t){this._lightPitch=t}},{key:"color",get:function get(){return this._color},set:function set(t){this._color=t}},{key:"direction",get:function get(){return this._direction},set:function set(t){this._direction=t}}]),LightComponent}();function skyboxComponent_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function skyboxComponent_typeof(t){return(skyboxComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}_e=me([qt.Component()],_e);var ve=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":skyboxComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},ye=function(){function SkyboxComponent(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.init(t)}var t=SkyboxComponent.prototype;return t.init=function init(t){var e=0<arguments.length&&void 0!==t?t:{};this._texture=e.texture},t.remove=function remove(){this._texture=void 0},function skyboxComponent_createClass(t,e,n){return e&&skyboxComponent_defineProperties(t.prototype,e),n&&skyboxComponent_defineProperties(t,n),t}(SkyboxComponent,[{key:"texture",get:function get(){return this._texture},set:function set(t){this._texture=t}}]),SkyboxComponent}();function animationComponent_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function animationComponent_typeof(t){return(animationComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}ye=ve([qt.Component()],ye);var ge=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":animationComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},be=function(){function AnimationComponent(t){this.init(t)}var t=AnimationComponent.prototype;return t.init=function init(t){this._key=t.key,this._running=!1,this._paused=!1,this._startTime=0,this._pauseStart=0,this._pauseEnd=0,this._autoStart=!0,this._loop=!0},t.remove=function remove(){},t.start=function start(){this._running=!0,this._startTime=performance.now()},t.stop=function stop(){this._running=!1},t.pause=function pause(){this.paused=!0},t.resume=function resume(){this.paused=!1},function animationComponent_createClass(t,e,n){return e&&animationComponent_defineProperties(t.prototype,e),n&&animationComponent_defineProperties(t,n),t}(AnimationComponent,[{key:"key",get:function get(){return this._key},set:function set(t){this._key=t}},{key:"running",get:function get(){return this._running}},{key:"paused",get:function get(){return this._paused},set:function set(t){this._paused!==t&&(!0===t?this._pauseStart=performance.now():this._pauseEnd=performance.now(),this._paused=t)}},{key:"pauseStart",get:function get(){return this._pauseStart}},{key:"pauseEnd",get:function get(){return this._pauseEnd}},{key:"startTime",get:function get(){return this._startTime}},{key:"loop",get:function get(){return this._loop},set:function set(t){this._loop=t}},{key:"autoStart",get:function get(){return this._autoStart},set:function set(t){this._autoStart=t}}]),AnimationComponent}();function sceneComponent_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function sceneComponent_typeof(t){return(sceneComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}be=ge([qt.Component()],be);var Ee=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":sceneComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},Te=function(){function SceneComponent(t){this._key=t.key}var t=SceneComponent.prototype;return t.init=function init(t){this._key=t.key},t.remove=function remove(){},function sceneComponent_createClass(t,e,n){return e&&sceneComponent_defineProperties(t.prototype,e),n&&sceneComponent_defineProperties(t,n),t}(SceneComponent,[{key:"key",get:function get(){return this._key},set:function set(t){this._key=t}}]),SceneComponent}();function transformComponent_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function transformComponent_typeof(t){return(transformComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Te=Ee([qt.Component()],Te);var Me=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":transformComponent_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},Ae=function(){function TransformComponent(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}};this.init(t)}var t=TransformComponent.prototype;return t.init=function init(t){var e=0<arguments.length&&void 0!==t?t:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}};this._localMatrix=$.mat4.create(),(e=e||Object.create(null)).position||(e.position={x:0,y:0,z:0}),e.rotation||(e.rotation={x:0,y:0,z:0,w:1}),e.scale||(e.scale={x:1,y:1,z:1}),this._rotation=$.quat.fromValues(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),this._translation=$.vec3.fromValues(e.position.x,e.position.y,e.position.z),this._scale=$.vec3.fromValues(e.scale.x,e.scale.y,e.scale.z),this._children=[],this._level=0,this._dirty=!0,this.apply()},t.remove=function remove(){},t.addChild=function addChild(t){t._parent&&t._parent.removeChild(t),t._parent=this,t._level=this._level+1,this._children.push(t)},t.removeChild=function removeChild(t){var e=this._children.indexOf(t);-1<e&&(t._level=0,t._parent=void 0,this._children.splice(e,1))},t.apply=function apply(){return this._dirty&&($.mat4.fromRotationTranslationScale(this._localMatrix,this._rotation,this._translation,this._scale),this._dirty=!1),this._localMatrix},function transformComponent_createClass(t,e,n){return e&&transformComponent_defineProperties(t.prototype,e),n&&transformComponent_defineProperties(t,n),t}(TransformComponent,[{key:"globalMatrix",get:function get(){return this._parent?$.mat4.multiply($.mat4.create(),this._parent.localMatrix,this._localMatrix):this.apply()}},{key:"modelMatrix",get:function get(){return this.globalMatrix}},{key:"localMatrix",get:function get(){return this.apply()},set:function set(t){this._localMatrix=t}},{key:"translation",get:function get(){return this._dirty=!0,this._translation},set:function set(t){this._dirty=!0,this._translation=t}},{key:"rotation",get:function get(){return this._dirty=!0,this._rotation},set:function set(t){this._dirty=!0,this._rotation=t}},{key:"scale",get:function get(){return this._dirty=!0,this._scale},set:function set(t){this._dirty=!0,this._scale=t}},{key:"level",get:function get(){return this._level}},{key:"parent",get:function get(){return this._parent},set:function set(t){this._parent=t}},{key:"children",get:function get(){return this._children},set:function set(t){this._children=t}}]),TransformComponent}();function ForwardScenePass_typeof(t){return(ForwardScenePass_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Ae=Me([qt.Component()],Ae);var Se=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":ForwardScenePass_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},we=function(n){function ForwardScenePass(t){var e;return(e=n.call(this)||this).gl=t.gl,e.cache=t.cache,e.shader=t.shader,e}!function ForwardScenePass_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(ForwardScenePass,n);var t=ForwardScenePass.prototype;return t.setUp=function setUp(){this.events.on(Lt.ENTITY_ADDED,this.initEntity,this)},t.initEntity=function initEntity(t){var e=t.get(Te),n=this.cache.get(k.SCENE,e.key);n?(n.init(this.gl),n.upload(),this.initShaderAttributes(n)):console.warn("Their is no scene for key "+e.key+" in the cache.")},t.initShaderAttributes=function initShaderAttributes(t){t.addAttribute(f.GL_PRIMITIVES.POSITION,this.shader.attributes.getAttribute("a_Position")),t.addAttribute(f.GL_PRIMITIVES.NORMAL,this.shader.attributes.getAttribute("a_Normal")),t.addAttribute(f.GL_PRIMITIVES.TANGENT,this.shader.attributes.getAttribute("a_Tangent")),t.addAttribute(f.GL_PRIMITIVES.TEXCOORD_0,this.shader.attributes.getAttribute("a_UV")),t.addAttribute(f.GL_PRIMITIVES.JOINTS_0,this.shader.attributes.getAttribute("a_Joint0")),t.addAttribute(f.GL_PRIMITIVES.WEIGHTS_0,this.shader.attributes.getAttribute("a_Weight0"))},t.draw=function draw(){for(var t,e=0;t=this.entities[e];e++)this.drawScene(t)},t.drawScene=function drawScene(t){var e=t.get(Te).key,n=this.cache.get(k.SCENE,e);this.shader.apply(),n.draw(this.shader,this.cache)},ForwardScenePass}(UW);function ForwardLightPass_typeof(t){return(ForwardLightPass_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}we=Se([qt.System(Te)],we);var Re=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":ForwardLightPass_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},xe=function(n){function ForwardLightPass(t){var e;return(e=n.call(this)||this).gl=t.gl,e.cache=t.cache,e.shader=t.shader,e}!function ForwardLightPass_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(ForwardLightPass,n);var t=ForwardLightPass.prototype;return t.setUp=function setUp(){this.scenePass=qt.addSystem(new we({gl:this.gl,cache:this.cache,shader:this.shader}))},t.tearDown=function tearDown(){qt.removeSystem(this.scenePass)},t.render=function render(){this.gl.enable(this.gl.DEPTH_TEST),this.shader.bind();for(var t,e=0;t=this.entities[e];e++)this.shader.uniforms.u_LightColor=t.get(_e).color.elements,this.shader.uniforms.u_LightDirection=t.get(_e).direction,this.scenePass.draw();this.shader.unbind(),this.gl.disable(this.gl.DEPTH_TEST)},ForwardLightPass}(UW);function ForwardShadingSystem_typeof(t){return(ForwardShadingSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}xe=Re([qt.System(_e)],xe);var Ce=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":ForwardShadingSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},Le=function(n){function ForwardShadingSystem(t){var e;return(e=n.call(this)||this).gl=t.gl,e.cache=t.cache,e.shader=t.shader,e}!function ForwardShadingSystem_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(ForwardShadingSystem,n);var t=ForwardShadingSystem.prototype;return t.setUp=function setUp(){this.forwardLightningPass=qt.addSystem(new xe({gl:this.gl,cache:this.cache,shader:this.shader}))},t.tearDown=function tearDown(){qt.removeSystem(this.forwardLightningPass),qt.removeSystem(this)},ForwardShadingSystem}(UW);function PrePass_typeof(t){return(PrePass_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Le=Ce([qt.System()],Le);var Oe=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":PrePass_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},Pe=function(n){function PrePass(t){var e;return(e=n.call(this)||this).gl=t,e}!function PrePass_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(PrePass,n);var t=PrePass.prototype;return t.clearContext=function clearContext(t,e,n){var r=!(0<arguments.length&&void 0!==t)||t,o=1<arguments.length&&void 0!==e&&e,i=2<arguments.length&&void 0!==n?n:{r:0,g:0,b:0,a:1};this.gl.clearColor(i.r,i.g,i.b,i.a),r&&o?this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT):r?this.gl.clear(this.gl.COLOR_BUFFER_BIT):o&&this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},t.render=function render(){this.clearContext(!0,!0,{r:0,g:0,b:0,a:1})},PrePass}(UW);function colorToString(t,e){var n=t.__state.conversionName.toString(),r=Math.round(t.r),o=Math.round(t.g),i=Math.round(t.b),a=t.a,s=Math.round(t.h),u=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var l=t.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}return"CSS_RGB"===n?"rgb("+r+","+o+","+i+")":"CSS_RGBA"===n?"rgba("+r+","+o+","+i+","+a+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+o+","+i+"]":"RGBA_ARRAY"===n?"["+r+","+o+","+i+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+o+",b:"+i+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+o+",b:"+i+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+",a:"+a+"}":"unknown format"}Pe=Oe([qt.System()],Pe);function OX(t){Ne=!1;var n=1<arguments.length?De.toArray(arguments):t;return De.each(Fe,function(t){if(t.litmus(n))return De.each(t.conversions,function(t,e){if(Be=t.read(n),!1===Ne&&!1!==Be)return(Ne=Be).conversionName=e,Be.conversion=t,De.BREAK}),De.BREAK}),Ne}function SX(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var ke=Array.prototype.forEach,Ie=Array.prototype.slice,De={BREAK:{},extend:function extend(n){return this.each(Ie.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(t){this.isUndefined(e[t])||(n[t]=e[t])}.bind(this))},this),n},defaults:function defaults(n){return this.each(Ie.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(t){this.isUndefined(n[t])&&(n[t]=e[t])}.bind(this))},this),n},compose:function compose(){var n=Ie.call(arguments);return function(){for(var t=Ie.call(arguments),e=n.length-1;0<=e;e--)t=[n[e].apply(this,t)];return t[0]}},each:function each(t,e,n){if(t)if(ke&&t.forEach&&t.forEach===ke)t.forEach(e,n);else if(t.length===t.length+0){var r,o=void 0;for(o=0,r=t.length;o<r;o++)if(o in t&&e.call(n,t[o],o)===this.BREAK)return}else for(var i in t)if(e.call(n,t[i],i)===this.BREAK)return},defer:function defer(t){setTimeout(t,0)},debounce:function debounce(r,o,i){var a=void 0;return function(){var t=this,e=arguments;var n=i||!a;clearTimeout(a),a=setTimeout(function delayed(){a=null,i||r.apply(t,e)},o),n&&r.apply(t,e)}},toArray:function toArray(t){return t.toArray?t.toArray():Ie.call(t)},isUndefined:function isUndefined(t){return void 0===t},isNull:function isNull(t){return null===t},isNaN:function(e){function isNaN(t){return e.apply(this,arguments)}return isNaN.toString=function(){return e.toString()},isNaN}(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function isObject(t){return t===Object(t)},isNumber:function isNumber(t){return t===t+0},isString:function isString(t){return t===t+""},isBoolean:function isBoolean(t){return!1===t||!0===t},isFunction:function isFunction(t){return t instanceof Function}},Fe=[{litmus:De.isString,conversions:{THREE_CHAR_HEX:{read:function read(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:colorToString},SIX_CHAR_HEX:{read:function read(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:colorToString},CSS_RGB:{read:function read(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:colorToString},CSS_RGBA:{read:function read(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:colorToString}}},{litmus:De.isNumber,conversions:{HEX:{read:function read(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function write(t){return t.hex}}}},{litmus:De.isArray,conversions:{RGB_ARRAY:{read:function read(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function write(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function read(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function write(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:De.isObject,conversions:{RGBA_OBJ:{read:function read(t){return!!(De.isNumber(t.r)&&De.isNumber(t.g)&&De.isNumber(t.b)&&De.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function write(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function read(t){return!!(De.isNumber(t.r)&&De.isNumber(t.g)&&De.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function write(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function read(t){return!!(De.isNumber(t.h)&&De.isNumber(t.s)&&De.isNumber(t.v)&&De.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function write(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function read(t){return!!(De.isNumber(t.h)&&De.isNumber(t.s)&&De.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function write(t){return{h:t.h,s:t.s,v:t.v}}}}}],Be=void 0,Ne=void 0,Ge=void 0,Ue={hsv_to_rgb:function hsv_to_rgb(t,e,n){var r=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),i=n*(1-e),a=n*(1-o*e),s=n*(1-(1-o)*e),u=[[n,s,i],[a,n,i],[i,n,s],[i,a,n],[s,i,n],[n,i,a]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function rgb_to_hsv(t,e,n){var r=Math.min(t,e,n),o=Math.max(t,e,n),i=o-r,a=void 0;return 0===o?{h:NaN,s:0,v:0}:(a=t===o?(e-n)/i:e===o?2+(n-t)/i:4+(t-e)/i,(a/=6)<0&&(a+=1),{h:360*a,s:i/o,v:o/255})},rgb_to_hex:function rgb_to_hex(t,e,n){var r=this.hex_with_component(0,2,t);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,n)},component_from_hex:function component_from_hex(t,e){return t>>8*e&255},hex_with_component:function hex_with_component(t,e,n){return n<<(Ge=8*e)|t&~(255<<Ge)}},je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},We=function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t};function defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function UX(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:UX(o,e,n)}if("value"in r)return r.value;var i=r.get;return void 0!==i?i.call(n):void 0}function VX(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function WX(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var Ve=(We(Color,[{key:"toString",value:function toString(){return colorToString(this)}},{key:"toHexString",value:function toHexString(){return colorToString(this,!0)}},{key:"toOriginal",value:function toOriginal(){return this.__state.conversion.write(this)}}]),Color);function Color(){if(SX(this,Color),this.__state=OX.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function defineRGBComponent(t,e,n){Object.defineProperty(t,e,{get:function get$$1(){return"RGB"===this.__state.space||Ve.recalculateRGB(this,e,n),this.__state[e]},set:function set$$1(t){"RGB"!==this.__state.space&&(Ve.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function defineHSVComponent(t,e){Object.defineProperty(t,e,{get:function get$$1(){return"HSV"===this.__state.space||Ve.recalculateHSV(this),this.__state[e]},set:function set$$1(t){"HSV"!==this.__state.space&&(Ve.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}Ve.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=Ue.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");De.extend(t.__state,Ue.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},Ve.recalculateHSV=function(t){var e=Ue.rgb_to_hsv(t.r,t.g,t.b);De.extend(t.__state,{s:e.s,v:e.v}),De.isNaN(e.h)?De.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},Ve.COMPONENTS=["r","g","b","h","s","v","hex","a"],defineRGBComponent(Ve.prototype,"r",2),defineRGBComponent(Ve.prototype,"g",1),defineRGBComponent(Ve.prototype,"b",0),defineHSVComponent(Ve.prototype,"h"),defineHSVComponent(Ve.prototype,"s"),defineHSVComponent(Ve.prototype,"v"),Object.defineProperty(Ve.prototype,"a",{get:function get$$1(){return this.__state.a},set:function set$$1(t){this.__state.a=t}}),Object.defineProperty(Ve.prototype,"hex",{get:function get$$1(){return"HEX"!==this.__state.space&&(this.__state.hex=Ue.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function set$$1(t){this.__state.space="HEX",this.__state.hex=t}});var Xe=(We(Controller,[{key:"onChange",value:function onChange(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function onFinishChange(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function setValue(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function getValue(){return this.object[this.property]}},{key:"updateDisplay",value:function updateDisplay(){return this}},{key:"isModified",value:function isModified(){return this.initialValue!==this.getValue()}}]),Controller);function Controller(t,e){SX(this,Controller),this.initialValue=t[e],this.domElement=document.createElement("div"),this.object=t,this.property=e,this.__onChange=void 0,this.__onFinishChange=void 0}var qe={};De.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,e){De.each(t,function(t){qe[t]=e})});var He=/(\d+(\.\d+)?)px/;function cssValueToPixels(t){if("0"===t||De.isUndefined(t))return 0;var e=t.match(He);return De.isNull(e)?0:parseFloat(e[1])}var ze={makeSelectable:function makeSelectable(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function makeFullscreen(t,e,n){var r=n,o=e;De.isUndefined(o)&&(o=!0),De.isUndefined(r)&&(r=!0),t.style.position="absolute",o&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function fakeEvent(t,e,n,r){var o=n||{},i=qe[e];if(!i)throw new Error("Event type "+e+" not supported.");var a=document.createEvent(i);switch(i){case"MouseEvents":var s=o.x||o.clientX||0,u=o.y||o.clientY||0;a.initMouseEvent(e,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,s,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;De.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:a.initEvent(e,o.bubbles||!1,o.cancelable||!0)}De.defaults(a,r),t.dispatchEvent(a)},bind:function bind(t,e,n,r){var o=r||!1;return t.addEventListener?t.addEventListener(e,n,o):t.attachEvent&&t.attachEvent("on"+e,n),ze},unbind:function unbind(t,e,n,r){var o=r||!1;return t.removeEventListener?t.removeEventListener(e,n,o):t.detachEvent&&t.detachEvent("on"+e,n),ze},addClass:function addClass(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return ze},removeClass:function removeClass(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),r=n.indexOf(e);-1!==r&&(n.splice(r,1),t.className=n.join(" "))}else t.className=void 0;return ze},hasClass:function hasClass(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function getWidth(t){var e=getComputedStyle(t);return cssValueToPixels(e["border-left-width"])+cssValueToPixels(e["border-right-width"])+cssValueToPixels(e["padding-left"])+cssValueToPixels(e["padding-right"])+cssValueToPixels(e.width)},getHeight:function getHeight(t){var e=getComputedStyle(t);return cssValueToPixels(e["border-top-width"])+cssValueToPixels(e["border-bottom-width"])+cssValueToPixels(e["padding-top"])+cssValueToPixels(e["padding-bottom"])+cssValueToPixels(e.height)},getOffset:function getOffset(t){var e=t,n={left:0,top:0};if(e.offsetParent)for(;n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent;);return n},isActive:function isActive(t){return t===document.activeElement&&(t.type||t.href)}},Ye=(VX(BooleanController,Xe),We(BooleanController,[{key:"setValue",value:function setValue(t){var e=UX(BooleanController.prototype.__proto__||Object.getPrototypeOf(BooleanController.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function updateDisplay(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),UX(BooleanController.prototype.__proto__||Object.getPrototypeOf(BooleanController.prototype),"updateDisplay",this).call(this)}}]),BooleanController);function BooleanController(t,e){SX(this,BooleanController);var n=WX(this,(BooleanController.__proto__||Object.getPrototypeOf(BooleanController)).call(this,t,e)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),ze.bind(n.__checkbox,"change",function onChange(){r.setValue(!r.__prev)},!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}var Qe=(VX(OptionController,Xe),We(OptionController,[{key:"setValue",value:function setValue(t){var e=UX(OptionController.prototype.__proto__||Object.getPrototypeOf(OptionController.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function updateDisplay(){return ze.isActive(this.__select)?this:(this.__select.value=this.getValue(),UX(OptionController.prototype.__proto__||Object.getPrototypeOf(OptionController.prototype),"updateDisplay",this).call(this))}}]),OptionController);function OptionController(t,e,n){SX(this,OptionController);var r=WX(this,(OptionController.__proto__||Object.getPrototypeOf(OptionController)).call(this,t,e)),o=n,i=r;if(r.__select=document.createElement("select"),De.isArray(o)){var a={};De.each(o,function(t){a[t]=t}),o=a}return De.each(o,function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),i.__select.appendChild(n)}),r.updateDisplay(),ze.bind(r.__select,"change",function(){var t=this.options[this.selectedIndex].value;i.setValue(t)}),r.domElement.appendChild(r.__select),r}var Ke=(VX(StringController,Xe),We(StringController,[{key:"updateDisplay",value:function updateDisplay(){return ze.isActive(this.__input)||(this.__input.value=this.getValue()),UX(StringController.prototype.__proto__||Object.getPrototypeOf(StringController.prototype),"updateDisplay",this).call(this)}}]),StringController);function StringController(t,e){SX(this,StringController);var n=WX(this,(StringController.__proto__||Object.getPrototypeOf(StringController)).call(this,t,e)),r=n;function onChange(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),ze.bind(n.__input,"keyup",onChange),ze.bind(n.__input,"change",onChange),ze.bind(n.__input,"blur",function onBlur(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),ze.bind(n.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function numDecimals(t){var e=t.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}var $e=(VX(NumberController,Xe),We(NumberController,[{key:"setValue",value:function setValue(t){var e=t;return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),UX(NumberController.prototype.__proto__||Object.getPrototypeOf(NumberController.prototype),"setValue",this).call(this,e)}},{key:"min",value:function min(t){return this.__min=t,this}},{key:"max",value:function max(t){return this.__max=t,this}},{key:"step",value:function step(t){return this.__step=t,this.__impliedStep=t,this.__precision=numDecimals(t),this}}]),NumberController);function NumberController(t,e,n){SX(this,NumberController);var r=WX(this,(NumberController.__proto__||Object.getPrototypeOf(NumberController)).call(this,t,e)),o=n||{};return r.__min=o.min,r.__max=o.max,r.__step=o.step,De.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=numDecimals(r.__impliedStep),r}var Ze=(VX(NumberControllerBox,$e),We(NumberControllerBox,[{key:"updateDisplay",value:function updateDisplay(){return this.__input.value=this.__truncationSuspended?this.getValue():function roundToDecimal(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}(this.getValue(),this.__precision),UX(NumberControllerBox.prototype.__proto__||Object.getPrototypeOf(NumberControllerBox.prototype),"updateDisplay",this).call(this)}}]),NumberControllerBox);function NumberControllerBox(t,e,n){SX(this,NumberControllerBox);var r=WX(this,(NumberControllerBox.__proto__||Object.getPrototypeOf(NumberControllerBox)).call(this,t,e,n));r.__truncationSuspended=!1;var o=r,i=void 0;function onFinish(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function onMouseDrag(t){var e=i-t.clientY;o.setValue(o.getValue()+e*o.__impliedStep),i=t.clientY}function onMouseUp(){ze.unbind(window,"mousemove",onMouseDrag),ze.unbind(window,"mouseup",onMouseUp),onFinish()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),ze.bind(r.__input,"change",function onChange(){var t=parseFloat(o.__input.value);De.isNaN(t)||o.setValue(t)}),ze.bind(r.__input,"blur",function onBlur(){onFinish()}),ze.bind(r.__input,"mousedown",function onMouseDown(t){ze.bind(window,"mousemove",onMouseDrag),ze.bind(window,"mouseup",onMouseUp),i=t.clientY}),ze.bind(r.__input,"keydown",function(t){13===t.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,onFinish())}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}function dat_gui_module_map(t,e,n,r,o){return r+(t-e)/(n-e)*(o-r)}var Je=(VX(NumberControllerSlider,$e),We(NumberControllerSlider,[{key:"updateDisplay",value:function updateDisplay(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",UX(NumberControllerSlider.prototype.__proto__||Object.getPrototypeOf(NumberControllerSlider.prototype),"updateDisplay",this).call(this)}}]),NumberControllerSlider);function NumberControllerSlider(t,e,n,r,o){SX(this,NumberControllerSlider);var i=WX(this,(NumberControllerSlider.__proto__||Object.getPrototypeOf(NumberControllerSlider)).call(this,t,e,{min:n,max:r,step:o})),a=i;function onMouseDrag(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(dat_gui_module_map(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function onMouseUp(){ze.unbind(window,"mousemove",onMouseDrag),ze.unbind(window,"mouseup",onMouseUp),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function onTouchMove(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(dat_gui_module_map(e,n.left,n.right,a.__min,a.__max))}function onTouchEnd(){ze.unbind(window,"touchmove",onTouchMove),ze.unbind(window,"touchend",onTouchEnd),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),ze.bind(i.__background,"mousedown",function onMouseDown(t){document.activeElement.blur(),ze.bind(window,"mousemove",onMouseDrag),ze.bind(window,"mouseup",onMouseUp),onMouseDrag(t)}),ze.bind(i.__background,"touchstart",function onTouchStart(t){if(1!==t.touches.length)return;ze.bind(window,"touchmove",onTouchMove),ze.bind(window,"touchend",onTouchEnd),onTouchMove(t)}),ze.addClass(i.__background,"slider"),ze.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var tn=(VX(FunctionController,Xe),We(FunctionController,[{key:"fire",value:function fire(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),FunctionController);function FunctionController(t,e,n){SX(this,FunctionController);var r=WX(this,(FunctionController.__proto__||Object.getPrototypeOf(FunctionController)).call(this,t,e)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,ze.bind(r.__button,"click",function(t){return t.preventDefault(),o.fire(),!1}),ze.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}var en=(VX(ColorController,Xe),We(ColorController,[{key:"updateDisplay",value:function updateDisplay(){var e=OX(this.getValue());if(!1!==e){var n=!1;De.each(Ve.COMPONENTS,function(t){if(!De.isUndefined(e[t])&&!De.isUndefined(this.__color.__state[t])&&e[t]!==this.__color.__state[t])return n=!0,{}},this),n&&De.extend(this.__color.__state,e)}De.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var t=this.__color.v<.5||.5<this.__color.s?255:0,r=255-t;De.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+t+","+t+","+t+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),De.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+t+","+t+","+t+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),ColorController);function ColorController(t,e){SX(this,ColorController);var n=WX(this,(ColorController.__proto__||Object.getPrototypeOf(ColorController)).call(this,t,e));n.__color=new Ve(n.getValue()),n.__temp=new Ve(0);var s=n;n.domElement=document.createElement("div"),ze.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",ze.bind(n.__input,"keydown",function(t){13===t.keyCode&&onBlur.call(this)}),ze.bind(n.__input,"blur",onBlur),ze.bind(n.__selector,"mousedown",function(){ze.addClass(this,"drag").bind(window,"mouseup",function(){ze.removeClass(s.__selector,"drag")})}),ze.bind(n.__selector,"touchstart",function(){ze.addClass(this,"drag").bind(window,"touchend",function(){ze.removeClass(s.__selector,"drag")})});var r=document.createElement("div");function fieldDown(t){setSV(t),ze.bind(window,"mousemove",setSV),ze.bind(window,"touchmove",setSV),ze.bind(window,"mouseup",fieldUpSV),ze.bind(window,"touchend",fieldUpSV)}function fieldDownH(t){setH(t),ze.bind(window,"mousemove",setH),ze.bind(window,"touchmove",setH),ze.bind(window,"mouseup",fieldUpH),ze.bind(window,"touchend",fieldUpH)}function fieldUpSV(){ze.unbind(window,"mousemove",setSV),ze.unbind(window,"touchmove",setSV),ze.unbind(window,"mouseup",fieldUpSV),ze.unbind(window,"touchend",fieldUpSV),onFinish()}function fieldUpH(){ze.unbind(window,"mousemove",setH),ze.unbind(window,"touchmove",setH),ze.unbind(window,"mouseup",fieldUpH),ze.unbind(window,"touchend",fieldUpH),onFinish()}function onBlur(){var t=OX(this.value);!1!==t?(s.__color.__state=t,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function onFinish(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}function setSV(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=s.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,r=n.clientX,o=n.clientY,i=(r-e.left)/(e.right-e.left),a=1-(o-e.top)/(e.bottom-e.top);return 1<a?a=1:a<0&&(a=0),1<i?i=1:i<0&&(i=0),s.__color.v=a,s.__color.s=i,s.setValue(s.__color.toOriginal()),!1}function setH(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=s.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return 1<n?n=1:n<0&&(n=0),s.__color.h=360*n,s.setValue(s.__color.toOriginal()),!1}return De.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),De.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),De.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),De.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),De.extend(r.style,{width:"100%",height:"100%",background:"none"}),linearGradient(r,"top","rgba(0,0,0,0)","#000"),De.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),function hueGradient(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}(n.__hue_field),De.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),ze.bind(n.__saturation_field,"mousedown",fieldDown),ze.bind(n.__saturation_field,"touchstart",fieldDown),ze.bind(n.__field_knob,"mousedown",fieldDown),ze.bind(n.__field_knob,"touchstart",fieldDown),ze.bind(n.__hue_field,"mousedown",fieldDownH),ze.bind(n.__hue_field,"touchstart",fieldDownH),n.__saturation_field.appendChild(r),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}var nn=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(e,n,r,o){e.style.background="",De.each(nn,function(t){e.style.cssText+="background: "+t+"linear-gradient("+n+", "+r+" 0%, "+o+" 100%); "})}var rn=function inject(t,e){var n=e||document,r=document.createElement("style");r.type="text/css",r.innerHTML=t;var o=n.getElementsByTagName("head")[0];try{o.appendChild(r)}catch(t){}},on=function ControllerFactory(t,e,n,r,o){var i=t[e];return De.isArray(n)||De.isObject(n)?new Qe(t,e,n):De.isNumber(i)?De.isNumber(n)&&De.isNumber(r)?De.isNumber(o)?new Je(t,e,n,r,o):new Je(t,e,n,r):De.isNumber(o)?new Ze(t,e,{min:n,max:r,step:o}):new Ze(t,e,{min:n,max:r}):De.isString(i)?new Ke(t,e):De.isFunction(i)?new tn(t,e,""):De.isBoolean(i)?new Ye(t,e):null};var an=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function dat_gui_module_requestAnimationFrame(t){setTimeout(t,1e3/60)},sn=(We(CenteredDiv,[{key:"show",value:function show(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),De.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function hide(){function hide(){t.domElement.style.display="none",t.backgroundElement.style.display="none",ze.unbind(t.domElement,"webkitTransitionEnd",hide),ze.unbind(t.domElement,"transitionend",hide),ze.unbind(t.domElement,"oTransitionEnd",hide)}var t=this;ze.bind(this.domElement,"webkitTransitionEnd",hide),ze.bind(this.domElement,"transitionend",hide),ze.bind(this.domElement,"oTransitionEnd",hide),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function layout(){this.domElement.style.left=window.innerWidth/2-ze.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-ze.getHeight(this.domElement)/2+"px"}}]),CenteredDiv);function CenteredDiv(){SX(this,CenteredDiv),this.backgroundElement=document.createElement("div"),De.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),ze.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),De.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;ze.bind(this.backgroundElement,"click",function(){t.hide()})}rn(function ___$insertStyle(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var un="Default",cn=function(){try{return!!window.localStorage}catch(t){return!1}}(),ln=void 0,fn=!0,dn=void 0,hn=!1,pn=[],mn=function GUI(t){var e=this,n=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),ze.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=De.defaults(n,{closeOnTop:!1,autoPlace:!0,width:GUI.DEFAULT_WIDTH}),n=De.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),De.isUndefined(n.load)?n.load={preset:un}:n.preset&&(n.load.preset=n.preset),De.isUndefined(n.parent)&&n.hideable&&pn.push(this),n.resizable=De.isUndefined(n.parent)&&n.resizable,n.autoPlace&&De.isUndefined(n.scrollable)&&(n.scrollable=!0);var r=cn&&"true"===localStorage.getItem(getLocalStorageHash(this,"isLocal")),o=void 0,i=void 0;if(Object.defineProperties(this,{parent:{get:function get$$1(){return n.parent}},scrollable:{get:function get$$1(){return n.scrollable}},autoPlace:{get:function get$$1(){return n.autoPlace}},closeOnTop:{get:function get$$1(){return n.closeOnTop}},preset:{get:function get$$1(){return e.parent?e.getRoot().preset:n.load.preset},set:function set$$1(t){e.parent?e.getRoot().preset=t:n.load.preset=t,function setPresetSelectIndex(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),e.revert()}},width:{get:function get$$1(){return n.width},set:function set$$1(t){n.width=t,setWidth(e,t)}},name:{get:function get$$1(){return n.name},set:function set$$1(t){n.name=t,i&&(i.innerHTML=n.name)}},closed:{get:function get$$1(){return n.closed},set:function set$$1(t){n.closed=t,n.closed?ze.addClass(e.__ul,GUI.CLASS_CLOSED):ze.removeClass(e.__ul,GUI.CLASS_CLOSED),this.onResize(),e.__closeButton&&(e.__closeButton.innerHTML=t?GUI.TEXT_OPEN:GUI.TEXT_CLOSED)}},load:{get:function get$$1(){return n.load}},useLocalStorage:{get:function get$$1(){return r},set:function set$$1(t){cn&&((r=t)?ze.bind(window,"unload",o):ze.unbind(window,"unload",o),localStorage.setItem(getLocalStorageHash(e,"isLocal"),t))}}}),De.isUndefined(n.parent)){if(this.closed=n.closed||!1,ze.addClass(this.domElement,GUI.CLASS_MAIN),ze.makeSelectable(this.domElement,!1),cn&&r){e.useLocalStorage=!0;var a=localStorage.getItem(getLocalStorageHash(this,"gui"));a&&(n.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=GUI.TEXT_CLOSED,ze.addClass(this.__closeButton,GUI.CLASS_CLOSE_BUTTON),n.closeOnTop?(ze.addClass(this.__closeButton,GUI.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(ze.addClass(this.__closeButton,GUI.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),ze.bind(this.__closeButton,"click",function(){e.closed=!e.closed})}else{void 0===n.closed&&(n.closed=!0);var s=document.createTextNode(n.name);ze.addClass(s,"controller-name"),i=addRow(e,s);ze.addClass(this.__ul,GUI.CLASS_CLOSED),ze.addClass(i,"title"),ze.bind(i,"click",function onClickTitle(t){return t.preventDefault(),e.closed=!e.closed,!1}),n.closed||(this.closed=!1)}n.autoPlace&&(De.isUndefined(n.parent)&&(fn&&(dn=document.createElement("div"),ze.addClass(dn,"dg"),ze.addClass(dn,GUI.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(dn),fn=!1),dn.appendChild(this.domElement),ze.addClass(this.domElement,GUI.CLASS_AUTO_PLACE)),this.parent||setWidth(e,n.width)),this.__resizeHandler=function(){e.onResizeDebounced()},ze.bind(window,"resize",this.__resizeHandler),ze.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),ze.bind(this.__ul,"transitionend",this.__resizeHandler),ze.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&function addResizeHandle(e){var n=void 0;function drag(t){return t.preventDefault(),e.width+=n-t.clientX,e.onResize(),n=t.clientX,!1}function dragStop(){ze.removeClass(e.__closeButton,mn.CLASS_DRAG),ze.unbind(window,"mousemove",drag),ze.unbind(window,"mouseup",dragStop)}function dragStart(t){return t.preventDefault(),n=t.clientX,ze.addClass(e.__closeButton,mn.CLASS_DRAG),ze.bind(window,"mousemove",drag),ze.bind(window,"mouseup",dragStop),!1}e.__resize_handle=document.createElement("div"),De.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),ze.bind(e.__resize_handle,"mousedown",dragStart),ze.bind(e.__closeButton,"mousedown",dragStart),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}(this),o=function saveToLocalStorage(){cn&&"true"===localStorage.getItem(getLocalStorageHash(e,"isLocal"))&&localStorage.setItem(getLocalStorageHash(e,"gui"),JSON.stringify(e.getSaveObject()))},this.saveToLocalStorageIfPossible=o,n.parent||function resetWidth(){var t=e.getRoot();t.width+=1,De.defer(function(){--t.width})}()};function addRow(t,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?t.__ul.insertBefore(r,n):t.__ul.appendChild(r),t.onResize(),r}function removeListeners(t){ze.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&ze.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function markPresetModified(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function recallSavedValue(t,e){var n=t.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(-1!==r){var o=n.__rememberedObjectIndecesToControllers[r];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[r]=o),o[e.property]=e,n.load&&n.load.remembered){var i=n.load.remembered,a=void 0;if(i[t.preset])a=i[t.preset];else{if(!i[un])return;a=i[un]}if(a[r]&&void 0!==a[r][e.property]){var s=a[r][e.property];e.initialValue=s,e.setValue(s)}}}}function _add(t,e,n,r){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var o=void 0;if(r.color)o=new en(e,n);else{var i=[e,n].concat(r.factoryArgs);o=on.apply(t,i)}r.before instanceof Xe&&(r.before=r.before.__li),recallSavedValue(t,o),ze.addClass(o.domElement,"c");var a=document.createElement("span");ze.addClass(a,"property-name"),a.innerHTML=o.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(o.domElement);var u=addRow(t,s,r.before);return ze.addClass(u,mn.CLASS_CONTROLLER_ROW),o instanceof en?ze.addClass(u,"color"):ze.addClass(u,je(o.getValue())),function augmentController(i,e,a){if(a.__li=e,a.__gui=i,De.extend(a,{options:function options(t){if(1<arguments.length){var e=a.__li.nextElementSibling;return a.remove(),_add(i,a.object,a.property,{before:e,factoryArgs:[De.toArray(arguments)]})}if(De.isArray(t)||De.isObject(t)){var n=a.__li.nextElementSibling;return a.remove(),_add(i,a.object,a.property,{before:n,factoryArgs:[t]})}},name:function name(t){return a.__li.firstElementChild.firstElementChild.innerHTML=t,a},listen:function listen(){return a.__gui.listen(a),a},remove:function remove(){return a.__gui.remove(a),a}}),a instanceof Je){var o=new Ze(a.object,a.property,{min:a.__min,max:a.__max,step:a.__step});De.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(t){var e=a[t],n=o[t];a[t]=o[t]=function(){var t=Array.prototype.slice.call(arguments);return n.apply(o,t),e.apply(a,t)}}),ze.addClass(e,"has-slider"),a.domElement.insertBefore(o.domElement,a.domElement.firstElementChild)}else if(a instanceof Ze){var t=function r(t){if(De.isNumber(a.__min)&&De.isNumber(a.__max)){var e=a.__li.firstElementChild.firstElementChild.innerHTML,n=-1<a.__gui.__listening.indexOf(a);a.remove();var o=_add(i,a.object,a.property,{before:a.__li.nextElementSibling,factoryArgs:[a.__min,a.__max,a.__step]});return o.name(e),n&&o.listen(),o}return t};a.min=De.compose(t,a.min),a.max=De.compose(t,a.max)}else a instanceof Ye?(ze.bind(e,"click",function(){ze.fakeEvent(a.__checkbox,"click")}),ze.bind(a.__checkbox,"click",function(t){t.stopPropagation()})):a instanceof tn?(ze.bind(e,"click",function(){ze.fakeEvent(a.__button,"click")}),ze.bind(e,"mouseover",function(){ze.addClass(a.__button,"hover")}),ze.bind(e,"mouseout",function(){ze.removeClass(a.__button,"hover")})):a instanceof en&&(ze.addClass(e,"color"),a.updateDisplay=De.compose(function(t){return e.style.borderLeftColor=a.__color.toString(),t},a.updateDisplay),a.updateDisplay());a.setValue=De.compose(function(t){return i.getRoot().__preset_select&&a.isModified()&&markPresetModified(i.getRoot(),!0),t},a.setValue)}(t,u,o),t.__controllers.push(o),o}function getLocalStorageHash(t,e){return document.location.href+"."+e}function addPresetOption(t,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function showHideExplain(t,e){e.style.display=t.useLocalStorage?"block":"none"}function setWidth(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function getCurrentPreset(o,i){var a={};return De.each(o.__rememberedObjects,function(t,e){var n={},r=o.__rememberedObjectIndecesToControllers[e];De.each(r,function(t,e){n[e]=i?t.initialValue:t.getValue()}),a[e]=n}),a}mn.toggleHide=function(){hn=!hn,De.each(pn,function(t){t.domElement.style.display=hn?"none":""})},mn.CLASS_AUTO_PLACE="a",mn.CLASS_AUTO_PLACE_CONTAINER="ac",mn.CLASS_MAIN="main",mn.CLASS_CONTROLLER_ROW="cr",mn.CLASS_TOO_TALL="taller-than-window",mn.CLASS_CLOSED="closed",mn.CLASS_CLOSE_BUTTON="close-button",mn.CLASS_CLOSE_TOP="close-top",mn.CLASS_CLOSE_BOTTOM="close-bottom",mn.CLASS_DRAG="drag",mn.DEFAULT_WIDTH=245,mn.TEXT_CLOSED="Close Controls",mn.TEXT_OPEN="Open Controls",mn._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||mn.toggleHide()},ze.bind(window,"keydown",mn._keydownHandler,!1),De.extend(mn.prototype,{add:function add(t,e){return _add(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function addColor(t,e){return _add(this,t,e,{color:!0})},remove:function remove(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;De.defer(function(){e.onResize()})},destroy:function destroy(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&dn.removeChild(this.domElement);var e=this;De.each(this.__folders,function(t){e.removeFolder(t)}),ze.unbind(window,"keydown",mn._keydownHandler,!1),removeListeners(this)},addFolder:function addFolder(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new mn(e);this.__folders[t]=n;var r=addRow(this,n.domElement);return ze.addClass(r,"folder"),n},removeFolder:function removeFolder(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],removeListeners(e);var t=this;De.each(e.__folders,function(t){e.removeFolder(t)}),De.defer(function(){t.onResize()})},open:function open(){this.closed=!1},close:function close(){this.closed=!0},hide:function hide(){this.domElement.style.display="none"},show:function show(){this.domElement.style.display=""},onResize:function onResize(){var e=this.getRoot();if(e.scrollable){var t=ze.getOffset(e.__ul).top,n=0;De.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=ze.getHeight(t))}),window.innerHeight-t-20<n?(ze.addClass(e.domElement,mn.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(ze.removeClass(e.domElement,mn.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&De.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:De.debounce(function(){this.onResize()},50),remember:function remember(){if(De.isUndefined(ln)&&((ln=new sn).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;De.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&!function addSaveMenu(n){var t=n.__save_row=document.createElement("li");ze.addClass(n.domElement,"has-save"),n.__ul.insertBefore(t,n.__ul.firstChild),ze.addClass(t,"save-row");var e=document.createElement("span");e.innerHTML="&nbsp;",ze.addClass(e,"button gears");var r=document.createElement("span");r.innerHTML="Save",ze.addClass(r,"button"),ze.addClass(r,"save");var o=document.createElement("span");o.innerHTML="New",ze.addClass(o,"button"),ze.addClass(o,"save-as");var i=document.createElement("span");i.innerHTML="Revert",ze.addClass(i,"button"),ze.addClass(i,"revert");var a=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?De.each(n.load.remembered,function(t,e){addPresetOption(n,e,e===n.preset)}):addPresetOption(n,un,!1);if(ze.bind(a,"change",function(){for(var t=0;t<n.__preset_select.length;t++)n.__preset_select[t].innerHTML=n.__preset_select[t].value;n.preset=this.value}),t.appendChild(a),t.appendChild(e),t.appendChild(r),t.appendChild(o),t.appendChild(i),cn){var s=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(getLocalStorageHash(n,"isLocal"))&&u.setAttribute("checked","checked"),showHideExplain(n,s),ze.bind(u,"change",function(){n.useLocalStorage=!n.useLocalStorage,showHideExplain(n,s)})}var c=document.getElementById("dg-new-constructor");ze.bind(c,"keydown",function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||ln.hide()}),ze.bind(e,"click",function(){c.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),ln.show(),c.focus(),c.select()}),ze.bind(r,"click",function(){n.save()}),ze.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&n.saveAs(t)}),ze.bind(i,"click",function(){n.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&setWidth(this,this.width)},getRoot:function getRoot(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function getSaveObject(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=getCurrentPreset(this)),n.folders={},De.each(this.__folders,function(t,e){n.folders[e]=t.getSaveObject()}),n},save:function save(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=getCurrentPreset(this),markPresetModified(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function saveAs(t){this.load.remembered||(this.load.remembered={},this.load.remembered[un]=getCurrentPreset(this,!0)),this.load.remembered[t]=getCurrentPreset(this),this.preset=t,addPresetOption(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function revert(e){De.each(this.__controllers,function(t){this.getRoot().load.remembered?recallSavedValue(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),De.each(this.__folders,function(t){t.revert(t)}),e||markPresetModified(this.getRoot(),!1)},listen:function listen(t){var e=0===this.__listening.length;this.__listening.push(t),e&&function updateDisplays(t){0!==t.length&&an.call(window,function(){updateDisplays(t)});De.each(t,function(t){t.updateDisplay()})}(this.__listening)},updateDisplay:function updateDisplay(){De.each(this.__controllers,function(t){t.updateDisplay()}),De.each(this.__folders,function(t){t.updateDisplay()})}});var _n=mn;function _createForOfIteratorHelper(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function GUISystem_unsupportedIterableToArray(t,e){if(!t)return;if("string"==typeof t)return GUISystem_arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return GUISystem_arrayLikeToArray(t,e)}(t))){var r=0,o=function F(){};return{s:o,n:function n(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a,u=!0,c=!1;return{s:function s(){i=t[Symbol.iterator]()},n:function n(){var t=i.next();return u=t.done,t},e:function e(t){c=!0,a=t},f:function f(){try{u||null==i.return||i.return()}finally{if(c)throw a}}}}function GUISystem_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function GUISystem_typeof(t){return(GUISystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var vn,yn,gn=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":GUISystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},bn=function(e){function GUISystem(){var t;return(t=e.call(this)||this).gui=new _n,t}!function GUISystem_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(GUISystem,e);var t=GUISystem.prototype;return t.setUp=function setUp(){this.events.on(Lt.ENTITY_ADDED,this.onEntityAdded,this)},t.onEntityAdded=function onEntityAdded(t){var e=t.get(he).config,n=this.gui;e.folder&&(n=this.gui.addFolder(e.folder));var r,o=_createForOfIteratorHelper(e.properties);try{for(o.s();!(r=o.n()).done;){var i=r.value;(i.isColor?n.addColor(i.prop,i.propName):i.items?n.add(i.prop,i.propName,i.items):n.add(i.prop,i.propName,i.min,i.max)).onChange(i.onChange).onFinishChange(i.onFinishChange)}}catch(t){o.e(t)}finally{o.f()}},GUISystem}(UW);bn=gn([qt.System(he)],bn),(yn=vn=vn||{}).KEYDOWN="KEY_DOWN",yn.KEYPRESS="KEY_PRESS",yn.KEYUP="KEY_UP",yn.MOUSECLICK="MOUSE_CLICK",yn.CONTEXTMENU="CONTEXT_MENU",yn.DOUBLECLICK="DOUBLE_CLICK",yn.MOUSEDOWN="MOUSE_DOWN",yn.MOUSEOUT="MOUSE_OUT",yn.MOUSEOVER="MOUSE_OVER",yn.MOUSEUP="MOUSE_UP",yn.MOUSEMOVE="MOUSE_MOVE",yn.WHEEL="WHEEL";var En=new h,Tn={onKeyDown:new G(En,vn.KEYDOWN),onKeyPress:new G(En,vn.KEYPRESS),onKeyUp:new G(En,vn.KEYUP),onClick:new G(En,vn.MOUSECLICK),onContextMenu:new G(En,vn.CONTEXTMENU),onDoubleClick:new G(En,vn.DOUBLECLICK),onMouseDown:new G(En,vn.MOUSEDOWN),onMouseOut:new G(En,vn.MOUSEOUT),onMouseOver:new G(En,vn.MOUSEOVER),onMouseUp:new G(En,vn.MOUSEUP),onMouseMove:new G(En,vn.MOUSEMOVE),onWheel:new G(En,vn.WHEEL)};function LookAtCameraControlSystem_typeof(t){return(LookAtCameraControlSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}document.onkeydown=function(t){Tn.onKeyDown.dispatch(t)},document.onkeypress=function(t){Tn.onKeyPress.dispatch(t)},document.onkeyup=function(t){Tn.onKeyUp.dispatch(t)},document.onclick=function(t){Tn.onClick.dispatch(t)},document.oncontextmenu=function(t){Tn.onContextMenu.dispatch(t)},document.ondblclick=function(t){Tn.onDoubleClick.dispatch(t)},document.onmousedown=function(t){Tn.onMouseDown.dispatch(t)},document.onmouseout=function(t){Tn.onMouseOut.dispatch(t)},document.onmouseover=function(t){Tn.onMouseOver.dispatch(t)},document.onmouseup=function(t){Tn.onMouseUp.dispatch(t)},document.onmousemove=function(t){Tn.onMouseMove.dispatch(t)},document.onwheel=function(t){Tn.onWheel.dispatch(t)};var Mn=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":LookAtCameraControlSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},An=function(n){function LookAtCameraControlSystem(t){var e;return(e=n.call(this)||this).canvas=t,e.lastMouseX=-1,e.lastMouseY=-1,e.drag=!1,e}!function LookAtCameraControlSystem_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(LookAtCameraControlSystem,n);var t=LookAtCameraControlSystem.prototype;return t.setUp=function setUp(){var e=this;this.canvas.element.addEventListener("mousedown",function(t){return e.onMouseDown(t)}),this.canvas.element.addEventListener("mouseup",function(){return e.onMouseUp()}),this.canvas.element.addEventListener("mousemove",function(t){return e.onMouseMove(t)}),Tn.onWheel.add(this.onMouseWheel,this),Tn.onKeyDown.add(this.onKeyDown,this)},t.onMouseDown=function onMouseDown(t){this.drag=!0,-1===this.lastMouseX&&(this.lastMouseX=t.x),-1===this.lastMouseY&&(this.lastMouseY=t.y)},t.calcTranslation=function calcTranslation(t,e,n){var r=$.vec3.create();$.vec3.add(r,r,t),$.vec3.add(r,r,e);var o=$.vec3.fromValues(n[0]/n[3],n[1]/n[3],n[2]/n[3]);return $.vec3.add(r,r,o)},t.onMouseUp=function onMouseUp(){for(var t,e=0;t=this.entities[e];e++){var n=t.get(Ae),r=t.get(fe),o=this.calcTranslation(r.panning,r.zooming,n.rotation);$.vec3.add(n.translation,n.translation,o),$.vec3.add(r.target,r.target,r.panning),$.quat.set(n.rotation,0,0,0,n.rotation[3]),$.vec3.set(r.panning,0,0,0),$.vec3.set(r.zooming,0,0,0)}this.drag=!1,this.lastMouseX=-1,this.lastMouseY=-1},t.onMouseWheel=function onMouseWheel(t){for(var e,n=0;e=this.entities[n];n++){var r=e.get(Ae),o=e.get(fe);this.zoom(e,t.deltaY,.001);var i=this.calcTranslation(o.panning,o.zooming,r.rotation);$.vec3.add(r.translation,r.translation,i),$.vec3.set(o.zooming,0,0,0)}},t.onMouseMove=function onMouseMove(t){if(this.drag)for(var e,n=0;e=this.entities[n];n++)this.rotate(e,t.x,t.y),this.lastMouseX=t.x,this.lastMouseY=t.y},t.onKeyDown=function onKeyDown(t){var e=0,n=0;"w"===t.key&&(e+=.1),"s"===t.key&&(e-=.1),"a"===t.key&&(n+=.1),"d"===t.key&&(n-=.1);for(var r,o=0;r=this.entities[o];o++){var i=r.get(fe),a=r.get(Ae);this.pan(r,n,e);var s=this.calcTranslation(i.panning,i.zooming,a.rotation);$.vec3.add(a.translation,a.translation,s),$.vec3.add(i.target,i.target,i.panning),$.vec3.set(i.panning,0,0,0)}},t.pan=function pan(t,e,n){var r=t.get(fe),o=t.get(Ae),i=$.vec3.create();$.vec3.subtract(i,r.target,o.translation),$.vec3.normalize(i,i);var a=$.vec3.create();$.vec3.cross(a,i,r.up),$.vec3.normalize(a,a);var s=$.vec3.create();$.vec3.cross(s,i,a),$.vec3.scale(a,a,e),$.vec3.scale(s,s,n),$.vec3.add(r.panning,a,s)},t.zoom=function zoom(t,e,n){var r=t.get(fe),o=t.get(Ae),i=(r.zoomPos-e)*n,a=$.vec3.create();$.vec3.subtract(a,r.target,o.translation);var s=$.vec3.length(a);$.vec3.normalize(a,a),s-i<=1?$.vec3.scale(r.zooming,a,s-1):$.vec3.scale(r.zooming,a,i)},t.rotate=function rotate(t,e,n){var r=t.get(fe),o=t.get(Ae),i=getVSpherePos(this.lastMouseX,this.lastMouseY,this.canvas.width,this.canvas.height),a=getVSpherePos(e,n,this.canvas.width,this.canvas.height),s=$.vec3.create();if($.vec3.subtract(s,i,a),!($.vec3.squaredLength(s)<1e-4)){var u=$.vec3.dot(i,a);1<u?u=1:u<-1&&(u=-1);var c=Math.acos(u),l=$.vec3.create();$.vec3.cross(l,a,i),$.vec3.normalize(l,l);var f=$.vec3.create();$.vec3.subtract(f,o.translation,r.target);var d=function rotateAxisAngle(t,e,n){var r=Math.cos(n),o=Math.sin(n),i=$.vec3.create(),a=$.vec3.fromValues(e[0]*e[0]*(1-r)+r,e[0]*e[1]*(1-r)-e[2]*o,e[0]*e[2]*(1-r)+e[1]*o),s=$.vec3.fromValues(e[0]*e[1]*(1-r)+e[2]*o,e[1]*e[1]*(1-r)+r,e[1]*e[2]*(1-r)-e[0]*o),u=$.vec3.fromValues(e[0]*e[2]*(1-r)-e[1]*o,e[2]*e[1]*(1-r)+e[0]*o,e[2]*e[2]*(1-r)+r);return i[0]=$.vec3.dot(a,t),i[1]=$.vec3.dot(s,t),i[2]=$.vec3.dot(u,t),i}($.vec3.fromValues(0,0,$.vec3.length(f)),l,c),h=$.vec3.create();$.vec3.subtract(h,r.target,o.translation),$.vec3.normalize(h,h);var p=$.vec3.create();$.vec3.cross(p,h,r.up),$.vec3.normalize(p,p);var m=$.vec3.create();$.vec3.cross(m,p,h);var _=$.vec3.fromValues(p[0]*d[0]+m[0]*d[1]+-h[0]*d[2],p[1]*d[0]+m[1]*d[1]+-h[1]*d[2],p[2]*d[0]+m[2]*d[1]+-h[2]*d[2]),v=$.vec3.create();$.vec3.subtract(v,_,$.vec3.subtract(v,o.translation,r.target));var y=o.rotation[3];$.quat.set(o.rotation,v[0]/y,v[1]/y,v[2]/y,y)}},t.update=function update(){for(var t,e=0;t=this.entities[e];e++){var n=t.get(ce),r=t.get(Ae),o=t.get(fe),i=this.calcTranslation(o.panning,o.zooming,r.rotation);$.vec3.add(r.translation,r.translation,i),$.vec3.add(o.target,o.target,o.panning),$.quat.set(r.rotation,0,0,0,r.rotation[3]),$.vec3.set(o.panning,0,0,0),$.vec3.set(o.zooming,0,0,0);var a=$.vec3.create();$.vec3.add(a,o.target,o.panning);var s=$.vec3.create();$.vec3.add(s,o.panning,o.zooming),$.vec3.add(s,s,r.translation),$.mat4.lookAt(n.viewMatrix,s,a,o.up)}},LookAtCameraControlSystem}(UW);function CameraSystem_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function CameraSystem_typeof(t){return(CameraSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}An=Mn([qt.System(Ae,ce,fe)],An);var Sn=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":CameraSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},wn=function(n){function CameraSystem(t){var e;return(e=n.call(this)||this).gl=t.gl,e.translation=$.vec3.create(),e}!function CameraSystem_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(CameraSystem,n);var t=CameraSystem.prototype;return t.setUp=function setUp(){var t=$.mat4.create();this.cameraUBO=new f.GLUniformBufferObject(this.gl,i.CAMERA),this.cameraUBO.addItem("projectionMatrix","mat4"),this.cameraUBO.addItem("viewMatrix","mat4"),this.cameraUBO.addItem("viewPos","vec3"),this.cameraUBO.updateItem("projectionMatrix",t),this.cameraUBO.updateItem("viewMatrix",t),this.cameraUBO.updateItem("viewPos",this.translation),this.cameraUBO.upload(),this.cameraUBO.bindUBO(),this.events.on(Lt.ENTITY_ADDED,this.initEntity,this),this.events.on(Lt.ENTITY_REMOVED,this.removeEntity,this)},t.initEntity=function initEntity(t){if(!this._camera){this._camera=t;var e=this._camera.get(ce),n=this._camera.get(Ae);this.cameraUBO.updateItem("projectionMatrix",e.projMatrix),this.cameraUBO.updateItem("viewMatrix",e.viewMatrix),this.cameraUBO.updateItem("viewPos",$.mat4.getTranslation(this.translation,n.modelMatrix)),this.cameraUBO.upload(),this.cameraUBO.bindUBO()}},t.removeEntity=function removeEntity(t){t===this._camera&&(this._camera=void 0)},t.render=function render(){if(this._camera){var t=this._camera.get(ce),e=this._camera.get(Ae);this.cameraUBO.updateItem("projectionMatrix",t.projMatrix,!0),this.cameraUBO.updateItem("viewMatrix",t.viewMatrix,!0),this.cameraUBO.updateItem("viewPos",$.mat4.getTranslation(this.translation,e.modelMatrix),!0)}},function CameraSystem_createClass(t,e,n){return e&&CameraSystem_defineProperties(t.prototype,e),n&&CameraSystem_defineProperties(t,n),t}(CameraSystem,[{key:"camera",get:function get(){return this._camera},set:function set(t){this._camera=t}}]),CameraSystem}(UW);function AnimationSystem_typeof(t){return(AnimationSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}wn=Sn([qt.System(Ae,ce)],wn);var Rn=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":AnimationSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},xn=function(n){function AnimationSystem(t){var e;return(e=n.call(this)||this).cache=t,e}!function AnimationSystem_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(AnimationSystem,n);var t=AnimationSystem.prototype;return t.setUp=function setUp(){},t.tearDown=function tearDown(){},t.update=function update(t){for(var e,n=0;e=this.entities[n];n++){var r=e.get(be);r.autoStart&&r.loop&&!r.running&&r.start();var o=this.cache.get(k.ANIMATION,r.key),i=r.pauseEnd-r.pauseStart,a=t-r.startTime-i;!r.paused&&r.running&&o.animate(a),a>=o.durationMS&&r.stop()}},AnimationSystem}(UW);function worldScene_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}xn=Rn([qt.System(be)],xn);var Cn=function(){function WorldScene(t){this.entities={},this._name=t.name}var t=WorldScene.prototype;return t.setUp=function setUp(t,e){this._loader=t,this._cache=e,this._active=!0,this.preload(),this._loader.onComplete.once(this.create,this),this._loader.load()},t.tearDown=function tearDown(){this.shutdown(),this._active=!1;for(var t,e=Object.keys(this.entities),n=0;t=this.entities[e[n]];n++)qt.removeEntity(t)},t.restore=function restore(){for(var t,e=0;t=this.entities[e];e++)qt.addEntity(t)},t.add=function add(t){return this.entities[t.id]=qt.addEntity(t),t},t.remove=function remove(t){return delete this.entities[t.id],qt.removeEntity(t)},function worldScene_createClass(t,e,n){return e&&worldScene_defineProperties(t.prototype,e),n&&worldScene_defineProperties(t,n),t}(WorldScene,[{key:"name",get:function get(){return this._name}},{key:"active",get:function get(){return this._active},set:function set(t){this._active=t}},{key:"loader",get:function get(){return this._loader},set:function set(t){this._loader=t}},{key:"cache",get:function get(){return this._cache},set:function set(t){this._cache=t}}]),WorldScene}();function worldSystem_typeof(t){return(worldSystem_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Ln=function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"===("undefined"==typeof Reflect?"undefined":worldSystem_typeof(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(i<3?o(a):3<i?o(e,n,a):o(e,n))||a);return 3<i&&a&&Object.defineProperty(e,n,a),a},On=function(n){function WorldSystem(t){var e;return(e=n.call(this)||this)._loader=t.loader,e._cache=t.cache,e}!function worldSystem_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(WorldSystem,n);var t=WorldSystem.prototype;return t.setUp=function setUp(){this._scenes=Object.create(null)},t.tearDown=function tearDown(){for(var t,e=Object.keys(this._scenes),n=0;t=this._scenes[e[n]];n++)this.removeScene(t)},t.update=function update(){for(var t,e=Object.keys(this._scenes),n=0;t=this._scenes[e[n]];n++)t.active&&t.update()},t.getKey=function getKey(t){var e=t;return t instanceof Cn&&(e=t.name),e},t.addScene=function addScene(t){return this._scenes[t.name]=t},t.removeScene=function removeScene(t){var e=this.getKey(t),n=this._scenes[e];return n.tearDown(),delete this._scenes[e],n},t.start=function start(t){var e=this.getKey(t);return this._scenes[e].setUp(this._loader,this._cache),this._scenes[e]},t.stop=function stop(t){var e=this.getKey(t);return this._scenes[e].tearDown(),this._scenes[e]},t.restore=function restore(t){var e=this.getKey(t);return this._scenes[e].restore(),this._scenes[e]},WorldSystem}(UW);function Viewer_defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}On=Ln([qt.System()],On);var Pn=function(){function Viewer(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{width:1280,height:720};this._canvas=new d({width:t.width,height:t.height}),this._loader=new D,this._cache=new F}var t=Viewer.prototype;return t.init=function init(t){var e=this;this._canvas.appendCanvas("root");var n=this._canvas.context;this._gl=n,this._cache.addCache(k.MATERIAL,new U),this._cache.addCache(k.MESH,new U),this._cache.addCache(k.TEXTURE,new U),this._cache.addCache(k.SCENE,new U),this._cache.addCache(k.ANIMATION,new U),this._loader.addMiddleware(new j(n),j),this._loader.addMiddleware(new Y(n),Y),this._loader.addMiddleware(new St(n,this._cache),St),this._loader.addMiddleware(new Qt(n),Qt),this._loader.onLoadComplete.on(function(t){e._cache.add(t.type,t.key,t.data)}),this.defaultMaterial(),this._shader=new oe(this._gl,this._cache),this._skyboxShader=new ie(this._gl,this._cache),this._loader.get(Qt).add("shader","https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/shader/pbr-vert.glsl","https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/shader/pbr-frag.glsl",this._shader),this._loader.get(Qt).add("skyboxShader","https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/shader/skybox-vert.glsl","https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/shader/skybox-frag.glsl",this._skyboxShader),this.load(t)},t.defaultMaterial=function defaultMaterial(){var t=this._gl,e=f.GLTexture.fromData(t,new Uint8Array([128,128,128,255]),1,1,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE);e.enableNearestScaling(),e.enableWrapClamp(),this._cache.getCache(k.TEXTURE).add("__default__",e);var n=new Z;n.baseColorFactor=$.vec4.fromValues(.5,.5,.5,1);var r=new Q(name,n);r.maps[X.ALBEDO]=new K("__default__"),this._cache.getCache(k.MATERIAL).add("__default__",r)},t.createSystems=function createSystems(){qt.systemUpdateMethods=["update","render"],this._world=qt.addSystem(new On({loader:this._loader,cache:this._cache})),qt.addSystem(new wn({gl:this._gl})),qt.addSystem(new An(this._canvas)),qt.addSystem(new bn),qt.addSystem(new xn(this._cache)),qt.addSystem(new Pe(this._gl)),qt.addSystem(new Le({gl:this._gl,cache:this._cache,shader:this._shader})),qt.addSystem(new se({gl:this._gl,cache:this._cache,shader:this._skyboxShader}))},t.load=function load(t){var e=this;this._loader.load(function(){e._shader.upload(),e._skyboxShader.upload(),e.createSystems(),t(),e.update(0)})},t.update=function update(t){var e=this;qt.update(t),requestAnimationFrame(function(t){e.update(t)})},function Viewer_createClass(t,e,n){return e&&Viewer_defineProperties(t.prototype,e),n&&Viewer_defineProperties(t,n),t}(Viewer,[{key:"cache",get:function get(){return this._cache},set:function set(t){this._cache=t}},{key:"canvas",get:function get(){return this._canvas},set:function set(t){this._canvas=t}},{key:"loader",get:function get(){return this._loader},set:function set(t){this._loader=t}},{key:"gl",get:function get(){return this._gl},set:function set(t){this._gl=t}},{key:"shader",get:function get(){return this._shader},set:function set(t){this._shader=t}},{key:"skyboxShader",get:function get(){return this._skyboxShader},set:function set(t){this._skyboxShader=t}},{key:"world",get:function get(){return this._world},set:function set(t){this._world=t}}]),Viewer}();var kn=function(t){function EnvironmentScene(){return t.apply(this,arguments)||this}!function EnvironmentScene_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(EnvironmentScene,t);var e=EnvironmentScene.prototype;return e.preload=function preload(){this.loader.get(j).add(l,[{right:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/environment/environment_right_0.jpg",left:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/environment/environment_left_0.jpg",top:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/environment/environment_top_0.jpg",bottom:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/environment/environment_bottom_0.jpg",front:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/environment/environment_front_0.jpg",back:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/environment/environment_back_0.jpg"}]),this.loader.get(j).add(u,[{right:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/diffuse/diffuse_right_0.jpg",left:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/diffuse/diffuse_left_0.jpg",top:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/diffuse/diffuse_top_0.jpg",bottom:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/diffuse/diffuse_bottom_0.jpg",front:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/diffuse/diffuse_front_0.jpg",back:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/diffuse/diffuse_back_0.jpg"}],{premultiplyAlpha:!1,internalFormat:f.GL_INTERNALFORMAT.SRGB8_ALPHA8,format:f.GL_INTERNALFORMAT.RGBA,type:f.GL_TYPES.UNSIGNED_BYTE});for(var t=[],e=0;e<10;e++)t.push({right:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/specular/specular_right_"+e+".jpg",left:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/specular/specular_left_"+e+".jpg",top:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/specular/specular_top_"+e+".jpg",bottom:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/specular/specular_bottom_"+e+".jpg",front:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/specular/specular_front_"+e+".jpg",back:"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/specular/specular_back_"+e+".jpg"});this.loader.get(j).add(c,t,{premultiplyAlpha:!1,internalFormat:f.GL_INTERNALFORMAT.SRGB8_ALPHA8,format:f.GL_INTERNALFORMAT.RGBA,type:f.GL_TYPES.UNSIGNED_BYTE}),this.loader.get(Y).add(s,"https://raw.githubusercontent.com/Xan0C/curbl-gltf-viewer/master/assets/ibl/brdfLUT.png",{premultiplyAlpha:!1,internalFormat:f.GL_INTERNALFORMAT.SRGB8_ALPHA8,format:f.GL_INTERNALFORMAT.RGBA,type:f.GL_TYPES.UNSIGNED_BYTE,sampler:{magFilter:f.MAG_FILTER.LINEAR,minFilter:f.MIN_FILTER.LINEAR,wrapS:f.TEXTURE_WRAP.CLAMP_TO_EDGE,wrapT:f.TEXTURE_WRAP.CLAMP_TO_EDGE}})},e.create=function create(){var t=qt.createEntity(),e=new _e({lightColor:[255,255,255],lightScale:1,lightRotation:75,lightPitch:40});t.add(e),t.add(new he({folder:"Directional Light",properties:[{prop:e,propName:"lightColor",isColor:!0,onChange:function onChange(){return e.updateLight()}},{prop:e,propName:"lightScale",min:0,max:10,onChange:function onChange(){return e.updateLight()}},{prop:e,propName:"lightRotation",min:0,max:360,onChange:function onChange(){return e.updateLight()}},{prop:e,propName:"lightPitch",min:-90,max:90,onChange:function onChange(){return e.updateLight()}}]})),this.add(t)},e.shutdown=function shutdown(){},e.update=function update(){},EnvironmentScene}(Cn);var In=function(n){function ModelScene(t){var e;return(e=n.call(this,t)||this).gltfJson=void 0,e.gltfBin=void 0,e.shader=void 0,e.gltfJson=t.gltfJson,e.gltfBin=t.gltfBin,e.shader=t.shader,e}!function ModelScene_inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(ModelScene,n);var t=ModelScene.prototype;return t.preload=function preload(){this.loader.get(St).add("ExampleScene",this.gltfJson,this.gltfBin)},t.create=function create(){var t=this.cache.get(k.SCENE,"ExampleScene");this.shader.unload(),this.shader.initializeDefines(t.meshes[0]),this.shader.upload();var e=qt.createEntity();if(e.add(new Te({key:"ExampleScene"})),e.add(new Ae({position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}})),t.animations[0]){var n=t.animations[0].name;e.add(new be({key:n}))}this.add(e)},t.shutdown=function shutdown(){},t.update=function update(){},ModelScene}(Cn),Dn={BoxAnimated:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BoxAnimated/glTF/BoxAnimated.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BoxAnimated/glTF/BoxAnimated0.bin"},RiggedSimple:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/RiggedSimple/glTF/RiggedSimple.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/RiggedSimple/glTF/RiggedSimple0.bin"},BrainStem:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BrainStem/glTF/BrainStem.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BrainStem/glTF/BrainStem0.bin"},WaterBottle:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/WaterBottle/glTF/WaterBottle.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/WaterBottle/glTF/WaterBottle.bin"},Sponza:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Sponza/glTF/Sponza.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Sponza/glTF/Sponza.bin"},DamagedHelmet:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF/DamagedHelmet.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF/DamagedHelmet.bin"},MetalRoughSpheres:{gltfJson:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/MetalRoughSpheres/glTF/MetalRoughSpheres.gltf",gltfBin:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/MetalRoughSpheres/glTF/MetalRoughSpheres0.bin"}},Fn=function(){function Example(){var t=this;this.camera=void 0,this.viewer=void 0,this.scene=void 0,this.scene="DamagedHelmet",this.viewer=new Pn({width:window.innerWidth,height:window.innerHeight}),this.viewer.init(function(){return t.init()})}var t=Example.prototype;return t.init=function init(){this.createSceneSelector(),this.createCamera(),this.viewer.world.addScene(new kn({name:"Environment"})),this.viewer.world.addScene(new In({name:"ModelScene",gltfJson:Dn[this.scene].gltfJson,gltfBin:Dn[this.scene].gltfBin,shader:this.viewer.shader})),this.viewer.world.start("Environment"),this.viewer.world.start("ModelScene")},t.reloadModelScene=function reloadModelScene(){this.viewer.loader.stop(),this.viewer.world.removeScene("ModelScene"),this.viewer.world.addScene(new In({name:"ModelScene",gltfJson:Dn[this.scene].gltfJson,gltfBin:Dn[this.scene].gltfBin,shader:this.viewer.shader})),this.viewer.world.start("ModelScene")},t.createCamera=function createCamera(){var t=this;this.camera=qt.createEntity(),this.camera.add(new ce({aspect:window.innerWidth/window.innerHeight,fovy:45*Math.PI/180,near:.01,far:100})),this.camera.add(new Ae({position:{x:0,y:0,z:-4},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}})),this.camera.add(new fe),qt.addEntity(this.camera),window.addEventListener("resize",function(){return t.onResize()})},t.onResize=function onResize(){this.camera&&$.mat4.perspective(this.camera.get(ce).projMatrix,45*Math.PI/180,window.innerWidth/window.innerHeight,.01,100)},t.createSceneSelector=function createSceneSelector(){var t=this,e=qt.createEntity();e.add(new he({properties:[{prop:this,propName:"scene",items:Object.keys(Dn),onChange:function onChange(){return t.reloadModelScene()}}]})),qt.addEntity(e)},Example}();window.onload=function(){new Fn}}]);